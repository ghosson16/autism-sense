function lj(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();function uj(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ik={exports:{}},zm={},ok={exports:{}},Jt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fh=Symbol.for("react.element"),hj=Symbol.for("react.portal"),pj=Symbol.for("react.fragment"),fj=Symbol.for("react.strict_mode"),mj=Symbol.for("react.profiler"),_j=Symbol.for("react.provider"),Ej=Symbol.for("react.context"),gj=Symbol.for("react.forward_ref"),Sj=Symbol.for("react.suspense"),Tj=Symbol.for("react.memo"),vj=Symbol.for("react.lazy"),kC=Symbol.iterator;function yj(t){return t===null||typeof t!="object"?null:(t=kC&&t[kC]||t["@@iterator"],typeof t=="function"?t:null)}var sk={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ak=Object.assign,ck={};function Gd(t,e,n){this.props=t,this.context=e,this.refs=ck,this.updater=n||sk}Gd.prototype.isReactComponent={};Gd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Gd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function dk(){}dk.prototype=Gd.prototype;function fy(t,e,n){this.props=t,this.context=e,this.refs=ck,this.updater=n||sk}var my=fy.prototype=new dk;my.constructor=fy;ak(my,Gd.prototype);my.isPureReactComponent=!0;var LC=Array.isArray,lk=Object.prototype.hasOwnProperty,_y={current:null},uk={key:!0,ref:!0,__self:!0,__source:!0};function hk(t,e,n){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)lk.call(e,r)&&!uk.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var c=Array(a),d=0;d<a;d++)c[d]=arguments[d+2];i.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:fh,type:t,key:o,ref:s,props:i,_owner:_y.current}}function Rj(t,e){return{$$typeof:fh,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Ey(t){return typeof t=="object"&&t!==null&&t.$$typeof===fh}function Cj(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var MC=/\/+/g;function J_(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Cj(""+t.key):e.toString(36)}function Jp(t,e,n,r,i){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case fh:case hj:s=!0}}if(s)return s=t,i=i(s),t=r===""?"."+J_(s,0):r,LC(i)?(n="",t!=null&&(n=t.replace(MC,"$&/")+"/"),Jp(i,e,n,"",function(d){return d})):i!=null&&(Ey(i)&&(i=Rj(i,n+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(MC,"$&/")+"/")+t)),e.push(i)),1;if(s=0,r=r===""?".":r+":",LC(t))for(var a=0;a<t.length;a++){o=t[a];var c=r+J_(o,a);s+=Jp(o,e,n,c,i)}else if(c=yj(t),typeof c=="function")for(t=c.call(t),a=0;!(o=t.next()).done;)o=o.value,c=r+J_(o,a++),s+=Jp(o,e,n,c,i);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function xh(t,e,n){if(t==null)return t;var r=[],i=0;return Jp(t,r,"","",function(o){return e.call(n,o,i++)}),r}function Ij(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var dr={current:null},Xp={transition:null},wj={ReactCurrentDispatcher:dr,ReactCurrentBatchConfig:Xp,ReactCurrentOwner:_y};function pk(){throw Error("act(...) is not supported in production builds of React.")}Jt.Children={map:xh,forEach:function(t,e,n){xh(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return xh(t,function(){e++}),e},toArray:function(t){return xh(t,function(e){return e})||[]},only:function(t){if(!Ey(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Jt.Component=Gd;Jt.Fragment=pj;Jt.Profiler=mj;Jt.PureComponent=fy;Jt.StrictMode=fj;Jt.Suspense=Sj;Jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=wj;Jt.act=pk;Jt.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=ak({},t.props),i=t.key,o=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=_y.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)lk.call(e,c)&&!uk.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var d=0;d<c;d++)a[d]=arguments[d+2];r.children=a}return{$$typeof:fh,type:t.type,key:i,ref:o,props:r,_owner:s}};Jt.createContext=function(t){return t={$$typeof:Ej,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:_j,_context:t},t.Consumer=t};Jt.createElement=hk;Jt.createFactory=function(t){var e=hk.bind(null,t);return e.type=t,e};Jt.createRef=function(){return{current:null}};Jt.forwardRef=function(t){return{$$typeof:gj,render:t}};Jt.isValidElement=Ey;Jt.lazy=function(t){return{$$typeof:vj,_payload:{_status:-1,_result:t},_init:Ij}};Jt.memo=function(t,e){return{$$typeof:Tj,type:t,compare:e===void 0?null:e}};Jt.startTransition=function(t){var e=Xp.transition;Xp.transition={};try{t()}finally{Xp.transition=e}};Jt.unstable_act=pk;Jt.useCallback=function(t,e){return dr.current.useCallback(t,e)};Jt.useContext=function(t){return dr.current.useContext(t)};Jt.useDebugValue=function(){};Jt.useDeferredValue=function(t){return dr.current.useDeferredValue(t)};Jt.useEffect=function(t,e){return dr.current.useEffect(t,e)};Jt.useId=function(){return dr.current.useId()};Jt.useImperativeHandle=function(t,e,n){return dr.current.useImperativeHandle(t,e,n)};Jt.useInsertionEffect=function(t,e){return dr.current.useInsertionEffect(t,e)};Jt.useLayoutEffect=function(t,e){return dr.current.useLayoutEffect(t,e)};Jt.useMemo=function(t,e){return dr.current.useMemo(t,e)};Jt.useReducer=function(t,e,n){return dr.current.useReducer(t,e,n)};Jt.useRef=function(t){return dr.current.useRef(t)};Jt.useState=function(t){return dr.current.useState(t)};Jt.useSyncExternalStore=function(t,e,n){return dr.current.useSyncExternalStore(t,e,n)};Jt.useTransition=function(){return dr.current.useTransition()};Jt.version="18.3.1";ok.exports=Jt;var z=ok.exports;const Yo=uj(z),Aj=lj({__proto__:null,default:Yo},[z]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Oj=z,bj=Symbol.for("react.element"),Nj=Symbol.for("react.fragment"),Pj=Object.prototype.hasOwnProperty,Dj=Oj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kj={key:!0,ref:!0,__self:!0,__source:!0};function fk(t,e,n){var r,i={},o=null,s=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)Pj.call(e,r)&&!kj.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:bj,type:t,key:o,ref:s,props:i,_owner:Dj.current}}zm.Fragment=Nj;zm.jsx=fk;zm.jsxs=fk;ik.exports=zm;var D=ik.exports,QS={},mk={exports:{}},Jr={},_k={exports:{}},Ek={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(L,G){var k=L.length;L.push(G);t:for(;0<k;){var E=k-1>>>1,C=L[E];if(0<i(C,G))L[E]=G,L[k]=C,k=E;else break t}}function n(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var G=L[0],k=L.pop();if(k!==G){L[0]=k;t:for(var E=0,C=L.length,w=C>>>1;E<w;){var j=2*(E+1)-1,Q=L[j],ct=j+1,Mt=L[ct];if(0>i(Q,k))ct<C&&0>i(Mt,Q)?(L[E]=Mt,L[ct]=k,E=ct):(L[E]=Q,L[j]=k,E=j);else if(ct<C&&0>i(Mt,k))L[E]=Mt,L[ct]=k,E=ct;else break t}}return G}function i(L,G){var k=L.sortIndex-G.sortIndex;return k!==0?k:L.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();t.unstable_now=function(){return s.now()-a}}var c=[],d=[],l=1,u=null,h=3,p=!1,S=!1,f=!1,_=typeof setTimeout=="function"?setTimeout:null,T=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(L){for(var G=n(d);G!==null;){if(G.callback===null)r(d);else if(G.startTime<=L)r(d),G.sortIndex=G.expirationTime,e(c,G);else break;G=n(d)}}function I(L){if(f=!1,y(L),!S)if(n(c)!==null)S=!0,Ze(O);else{var G=n(d);G!==null&&F(I,G.startTime-L)}}function O(L,G){S=!1,f&&(f=!1,T(U),U=-1),p=!0;var k=h;try{for(y(G),u=n(c);u!==null&&(!(u.expirationTime>G)||L&&!lt());){var E=u.callback;if(typeof E=="function"){u.callback=null,h=u.priorityLevel;var C=E(u.expirationTime<=G);G=t.unstable_now(),typeof C=="function"?u.callback=C:u===n(c)&&r(c),y(G)}else r(c);u=n(c)}if(u!==null)var w=!0;else{var j=n(d);j!==null&&F(I,j.startTime-G),w=!1}return w}finally{u=null,h=k,p=!1}}var b=!1,N=null,U=-1,V=5,W=-1;function lt(){return!(t.unstable_now()-W<V)}function mt(){if(N!==null){var L=t.unstable_now();W=L;var G=!0;try{G=N(!0,L)}finally{G?St():(b=!1,N=null)}}else b=!1}var St;if(typeof g=="function")St=function(){g(mt)};else if(typeof MessageChannel<"u"){var Yt=new MessageChannel,Lt=Yt.port2;Yt.port1.onmessage=mt,St=function(){Lt.postMessage(null)}}else St=function(){_(mt,0)};function Ze(L){N=L,b||(b=!0,St())}function F(L,G){U=_(function(){L(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(L){L.callback=null},t.unstable_continueExecution=function(){S||p||(S=!0,Ze(O))},t.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):V=0<L?Math.floor(1e3/L):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(L){switch(h){case 1:case 2:case 3:var G=3;break;default:G=h}var k=h;h=G;try{return L()}finally{h=k}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(L,G){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var k=h;h=L;try{return G()}finally{h=k}},t.unstable_scheduleCallback=function(L,G,k){var E=t.unstable_now();switch(typeof k=="object"&&k!==null?(k=k.delay,k=typeof k=="number"&&0<k?E+k:E):k=E,L){case 1:var C=-1;break;case 2:C=250;break;case 5:C=1073741823;break;case 4:C=1e4;break;default:C=5e3}return C=k+C,L={id:l++,callback:G,priorityLevel:L,startTime:k,expirationTime:C,sortIndex:-1},k>E?(L.sortIndex=k,e(d,L),n(c)===null&&L===n(d)&&(f?(T(U),U=-1):f=!0,F(I,k-E))):(L.sortIndex=C,e(c,L),S||p||(S=!0,Ze(O))),L},t.unstable_shouldYield=lt,t.unstable_wrapCallback=function(L){var G=h;return function(){var k=h;h=G;try{return L.apply(this,arguments)}finally{h=k}}}})(Ek);_k.exports=Ek;var Lj=_k.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mj=z,qr=Lj;function nt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var gk=new Set,vu={};function oc(t,e){Cd(t,e),Cd(t+"Capture",e)}function Cd(t,e){for(vu[t]=e,t=0;t<e.length;t++)gk.add(e[t])}var Jo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ZS=Object.prototype.hasOwnProperty,Uj=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,UC={},xC={};function xj(t){return ZS.call(xC,t)?!0:ZS.call(UC,t)?!1:Uj.test(t)?xC[t]=!0:(UC[t]=!0,!1)}function Vj(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Fj(t,e,n,r){if(e===null||typeof e>"u"||Vj(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function lr(t,e,n,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var Bn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Bn[t]=new lr(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Bn[e]=new lr(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Bn[t]=new lr(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Bn[t]=new lr(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Bn[t]=new lr(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Bn[t]=new lr(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Bn[t]=new lr(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Bn[t]=new lr(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Bn[t]=new lr(t,5,!1,t.toLowerCase(),null,!1,!1)});var gy=/[\-:]([a-z])/g;function Sy(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(gy,Sy);Bn[e]=new lr(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(gy,Sy);Bn[e]=new lr(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(gy,Sy);Bn[e]=new lr(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Bn[t]=new lr(t,1,!1,t.toLowerCase(),null,!1,!1)});Bn.xlinkHref=new lr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Bn[t]=new lr(t,1,!1,t.toLowerCase(),null,!0,!0)});function Ty(t,e,n,r){var i=Bn.hasOwnProperty(e)?Bn[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Fj(e,n,i,r)&&(n=null),r||i===null?xj(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var es=Mj.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Vh=Symbol.for("react.element"),Fc=Symbol.for("react.portal"),jc=Symbol.for("react.fragment"),vy=Symbol.for("react.strict_mode"),tT=Symbol.for("react.profiler"),Sk=Symbol.for("react.provider"),Tk=Symbol.for("react.context"),yy=Symbol.for("react.forward_ref"),eT=Symbol.for("react.suspense"),nT=Symbol.for("react.suspense_list"),Ry=Symbol.for("react.memo"),gs=Symbol.for("react.lazy"),vk=Symbol.for("react.offscreen"),VC=Symbol.iterator;function ul(t){return t===null||typeof t!="object"?null:(t=VC&&t[VC]||t["@@iterator"],typeof t=="function"?t:null)}var Xe=Object.assign,X_;function Ll(t){if(X_===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);X_=e&&e[1]||""}return`
`+X_+t}var Q_=!1;function Z_(t,e){if(!t||Q_)return"";Q_=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var r=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){r=d}t.call(e.prototype)}else{try{throw Error()}catch(d){r=d}t()}}catch(d){if(d&&r&&typeof d.stack=="string"){for(var i=d.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var c=`
`+i[s].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=s&&0<=a);break}}}finally{Q_=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Ll(t):""}function jj(t){switch(t.tag){case 5:return Ll(t.type);case 16:return Ll("Lazy");case 13:return Ll("Suspense");case 19:return Ll("SuspenseList");case 0:case 2:case 15:return t=Z_(t.type,!1),t;case 11:return t=Z_(t.type.render,!1),t;case 1:return t=Z_(t.type,!0),t;default:return""}}function rT(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case jc:return"Fragment";case Fc:return"Portal";case tT:return"Profiler";case vy:return"StrictMode";case eT:return"Suspense";case nT:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Tk:return(t.displayName||"Context")+".Consumer";case Sk:return(t._context.displayName||"Context")+".Provider";case yy:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Ry:return e=t.displayName||null,e!==null?e:rT(t.type)||"Memo";case gs:e=t._payload,t=t._init;try{return rT(t(e))}catch{}}return null}function Bj(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return rT(e);case 8:return e===vy?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function $s(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function yk(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Gj(t){var e=yk(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Fh(t){t._valueTracker||(t._valueTracker=Gj(t))}function Rk(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=yk(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ff(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function iT(t,e){var n=e.checked;return Xe({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function FC(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=$s(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Ck(t,e){e=e.checked,e!=null&&Ty(t,"checked",e,!1)}function oT(t,e){Ck(t,e);var n=$s(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?sT(t,e.type,n):e.hasOwnProperty("defaultValue")&&sT(t,e.type,$s(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function jC(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function sT(t,e,n){(e!=="number"||Ff(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ml=Array.isArray;function cd(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+$s(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function aT(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(nt(91));return Xe({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function BC(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(nt(92));if(Ml(n)){if(1<n.length)throw Error(nt(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:$s(n)}}function Ik(t,e){var n=$s(e.value),r=$s(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function GC(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function wk(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cT(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?wk(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var jh,Ak=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(jh=jh||document.createElement("div"),jh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=jh.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function yu(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Xl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Wj=["Webkit","ms","Moz","O"];Object.keys(Xl).forEach(function(t){Wj.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Xl[e]=Xl[t]})});function Ok(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Xl.hasOwnProperty(t)&&Xl[t]?(""+e).trim():e+"px"}function bk(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=Ok(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var Hj=Xe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function dT(t,e){if(e){if(Hj[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(nt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(nt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(nt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(nt(62))}}function lT(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uT=null;function Cy(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var hT=null,dd=null,ld=null;function WC(t){if(t=Eh(t)){if(typeof hT!="function")throw Error(nt(280));var e=t.stateNode;e&&(e=Xm(e),hT(t.stateNode,t.type,e))}}function Nk(t){dd?ld?ld.push(t):ld=[t]:dd=t}function Pk(){if(dd){var t=dd,e=ld;if(ld=dd=null,WC(t),e)for(t=0;t<e.length;t++)WC(e[t])}}function Dk(t,e){return t(e)}function kk(){}var tE=!1;function Lk(t,e,n){if(tE)return t(e,n);tE=!0;try{return Dk(t,e,n)}finally{tE=!1,(dd!==null||ld!==null)&&(kk(),Pk())}}function Ru(t,e){var n=t.stateNode;if(n===null)return null;var r=Xm(n);if(r===null)return null;n=r[e];t:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break t;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(nt(231,e,typeof n));return n}var pT=!1;if(Jo)try{var hl={};Object.defineProperty(hl,"passive",{get:function(){pT=!0}}),window.addEventListener("test",hl,hl),window.removeEventListener("test",hl,hl)}catch{pT=!1}function Kj(t,e,n,r,i,o,s,a,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(l){this.onError(l)}}var Ql=!1,jf=null,Bf=!1,fT=null,zj={onError:function(t){Ql=!0,jf=t}};function Yj(t,e,n,r,i,o,s,a,c){Ql=!1,jf=null,Kj.apply(zj,arguments)}function $j(t,e,n,r,i,o,s,a,c){if(Yj.apply(this,arguments),Ql){if(Ql){var d=jf;Ql=!1,jf=null}else throw Error(nt(198));Bf||(Bf=!0,fT=d)}}function sc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Mk(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function HC(t){if(sc(t)!==t)throw Error(nt(188))}function qj(t){var e=t.alternate;if(!e){if(e=sc(t),e===null)throw Error(nt(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return HC(i),t;if(o===r)return HC(i),e;o=o.sibling}throw Error(nt(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===n){s=!0,n=i,r=o;break}if(a===r){s=!0,r=i,n=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===n){s=!0,n=o,r=i;break}if(a===r){s=!0,r=o,n=i;break}a=a.sibling}if(!s)throw Error(nt(189))}}if(n.alternate!==r)throw Error(nt(190))}if(n.tag!==3)throw Error(nt(188));return n.stateNode.current===n?t:e}function Uk(t){return t=qj(t),t!==null?xk(t):null}function xk(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=xk(t);if(e!==null)return e;t=t.sibling}return null}var Vk=qr.unstable_scheduleCallback,KC=qr.unstable_cancelCallback,Jj=qr.unstable_shouldYield,Xj=qr.unstable_requestPaint,hn=qr.unstable_now,Qj=qr.unstable_getCurrentPriorityLevel,Iy=qr.unstable_ImmediatePriority,Fk=qr.unstable_UserBlockingPriority,Gf=qr.unstable_NormalPriority,Zj=qr.unstable_LowPriority,jk=qr.unstable_IdlePriority,Ym=null,Eo=null;function tB(t){if(Eo&&typeof Eo.onCommitFiberRoot=="function")try{Eo.onCommitFiberRoot(Ym,t,void 0,(t.current.flags&128)===128)}catch{}}var Gi=Math.clz32?Math.clz32:rB,eB=Math.log,nB=Math.LN2;function rB(t){return t>>>=0,t===0?32:31-(eB(t)/nB|0)|0}var Bh=64,Gh=4194304;function Ul(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Wf(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,o=t.pingedLanes,s=n&268435455;if(s!==0){var a=s&~i;a!==0?r=Ul(a):(o&=s,o!==0&&(r=Ul(o)))}else s=n&~i,s!==0?r=Ul(s):o!==0&&(r=Ul(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Gi(e),i=1<<n,r|=t[n],e&=~i;return r}function iB(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oB(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,o=t.pendingLanes;0<o;){var s=31-Gi(o),a=1<<s,c=i[s];c===-1?(!(a&n)||a&r)&&(i[s]=iB(a,e)):c<=e&&(t.expiredLanes|=a),o&=~a}}function mT(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Bk(){var t=Bh;return Bh<<=1,!(Bh&4194240)&&(Bh=64),t}function eE(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function mh(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Gi(e),t[e]=n}function sB(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Gi(n),o=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~o}}function wy(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Gi(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var ye=0;function Gk(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Wk,Ay,Hk,Kk,zk,_T=!1,Wh=[],ks=null,Ls=null,Ms=null,Cu=new Map,Iu=new Map,Ts=[],aB="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zC(t,e){switch(t){case"focusin":case"focusout":ks=null;break;case"dragenter":case"dragleave":Ls=null;break;case"mouseover":case"mouseout":Ms=null;break;case"pointerover":case"pointerout":Cu.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Iu.delete(e.pointerId)}}function pl(t,e,n,r,i,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=Eh(e),e!==null&&Ay(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function cB(t,e,n,r,i){switch(e){case"focusin":return ks=pl(ks,t,e,n,r,i),!0;case"dragenter":return Ls=pl(Ls,t,e,n,r,i),!0;case"mouseover":return Ms=pl(Ms,t,e,n,r,i),!0;case"pointerover":var o=i.pointerId;return Cu.set(o,pl(Cu.get(o)||null,t,e,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Iu.set(o,pl(Iu.get(o)||null,t,e,n,r,i)),!0}return!1}function Yk(t){var e=Aa(t.target);if(e!==null){var n=sc(e);if(n!==null){if(e=n.tag,e===13){if(e=Mk(n),e!==null){t.blockedOn=e,zk(t.priority,function(){Hk(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Qp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=ET(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);uT=r,n.target.dispatchEvent(r),uT=null}else return e=Eh(n),e!==null&&Ay(e),t.blockedOn=n,!1;e.shift()}return!0}function YC(t,e,n){Qp(t)&&n.delete(e)}function dB(){_T=!1,ks!==null&&Qp(ks)&&(ks=null),Ls!==null&&Qp(Ls)&&(Ls=null),Ms!==null&&Qp(Ms)&&(Ms=null),Cu.forEach(YC),Iu.forEach(YC)}function fl(t,e){t.blockedOn===e&&(t.blockedOn=null,_T||(_T=!0,qr.unstable_scheduleCallback(qr.unstable_NormalPriority,dB)))}function wu(t){function e(i){return fl(i,t)}if(0<Wh.length){fl(Wh[0],t);for(var n=1;n<Wh.length;n++){var r=Wh[n];r.blockedOn===t&&(r.blockedOn=null)}}for(ks!==null&&fl(ks,t),Ls!==null&&fl(Ls,t),Ms!==null&&fl(Ms,t),Cu.forEach(e),Iu.forEach(e),n=0;n<Ts.length;n++)r=Ts[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ts.length&&(n=Ts[0],n.blockedOn===null);)Yk(n),n.blockedOn===null&&Ts.shift()}var ud=es.ReactCurrentBatchConfig,Hf=!0;function lB(t,e,n,r){var i=ye,o=ud.transition;ud.transition=null;try{ye=1,Oy(t,e,n,r)}finally{ye=i,ud.transition=o}}function uB(t,e,n,r){var i=ye,o=ud.transition;ud.transition=null;try{ye=4,Oy(t,e,n,r)}finally{ye=i,ud.transition=o}}function Oy(t,e,n,r){if(Hf){var i=ET(t,e,n,r);if(i===null)uE(t,e,r,Kf,n),zC(t,r);else if(cB(i,t,e,n,r))r.stopPropagation();else if(zC(t,r),e&4&&-1<aB.indexOf(t)){for(;i!==null;){var o=Eh(i);if(o!==null&&Wk(o),o=ET(t,e,n,r),o===null&&uE(t,e,r,Kf,n),o===i)break;i=o}i!==null&&r.stopPropagation()}else uE(t,e,r,null,n)}}var Kf=null;function ET(t,e,n,r){if(Kf=null,t=Cy(r),t=Aa(t),t!==null)if(e=sc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Mk(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Kf=t,null}function $k(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Qj()){case Iy:return 1;case Fk:return 4;case Gf:case Zj:return 16;case jk:return 536870912;default:return 16}default:return 16}}var Is=null,by=null,Zp=null;function qk(){if(Zp)return Zp;var t,e=by,n=e.length,r,i="value"in Is?Is.value:Is.textContent,o=i.length;for(t=0;t<n&&e[t]===i[t];t++);var s=n-t;for(r=1;r<=s&&e[n-r]===i[o-r];r++);return Zp=i.slice(t,1<r?1-r:void 0)}function tf(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Hh(){return!0}function $C(){return!1}function Xr(t){function e(n,r,i,o,s){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Hh:$C,this.isPropagationStopped=$C,this}return Xe(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Hh)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Hh)},persist:function(){},isPersistent:Hh}),e}var Wd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ny=Xr(Wd),_h=Xe({},Wd,{view:0,detail:0}),hB=Xr(_h),nE,rE,ml,$m=Xe({},_h,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Py,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ml&&(ml&&t.type==="mousemove"?(nE=t.screenX-ml.screenX,rE=t.screenY-ml.screenY):rE=nE=0,ml=t),nE)},movementY:function(t){return"movementY"in t?t.movementY:rE}}),qC=Xr($m),pB=Xe({},$m,{dataTransfer:0}),fB=Xr(pB),mB=Xe({},_h,{relatedTarget:0}),iE=Xr(mB),_B=Xe({},Wd,{animationName:0,elapsedTime:0,pseudoElement:0}),EB=Xr(_B),gB=Xe({},Wd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),SB=Xr(gB),TB=Xe({},Wd,{data:0}),JC=Xr(TB),vB={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yB={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},RB={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function CB(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=RB[t])?!!e[t]:!1}function Py(){return CB}var IB=Xe({},_h,{key:function(t){if(t.key){var e=vB[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=tf(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?yB[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Py,charCode:function(t){return t.type==="keypress"?tf(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?tf(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),wB=Xr(IB),AB=Xe({},$m,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),XC=Xr(AB),OB=Xe({},_h,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Py}),bB=Xr(OB),NB=Xe({},Wd,{propertyName:0,elapsedTime:0,pseudoElement:0}),PB=Xr(NB),DB=Xe({},$m,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),kB=Xr(DB),LB=[9,13,27,32],Dy=Jo&&"CompositionEvent"in window,Zl=null;Jo&&"documentMode"in document&&(Zl=document.documentMode);var MB=Jo&&"TextEvent"in window&&!Zl,Jk=Jo&&(!Dy||Zl&&8<Zl&&11>=Zl),QC=" ",ZC=!1;function Xk(t,e){switch(t){case"keyup":return LB.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Qk(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Bc=!1;function UB(t,e){switch(t){case"compositionend":return Qk(e);case"keypress":return e.which!==32?null:(ZC=!0,QC);case"textInput":return t=e.data,t===QC&&ZC?null:t;default:return null}}function xB(t,e){if(Bc)return t==="compositionend"||!Dy&&Xk(t,e)?(t=qk(),Zp=by=Is=null,Bc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Jk&&e.locale!=="ko"?null:e.data;default:return null}}var VB={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tI(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!VB[t.type]:e==="textarea"}function Zk(t,e,n,r){Nk(r),e=zf(e,"onChange"),0<e.length&&(n=new Ny("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var tu=null,Au=null;function FB(t){lL(t,0)}function qm(t){var e=Hc(t);if(Rk(e))return t}function jB(t,e){if(t==="change")return e}var tL=!1;if(Jo){var oE;if(Jo){var sE="oninput"in document;if(!sE){var eI=document.createElement("div");eI.setAttribute("oninput","return;"),sE=typeof eI.oninput=="function"}oE=sE}else oE=!1;tL=oE&&(!document.documentMode||9<document.documentMode)}function nI(){tu&&(tu.detachEvent("onpropertychange",eL),Au=tu=null)}function eL(t){if(t.propertyName==="value"&&qm(Au)){var e=[];Zk(e,Au,t,Cy(t)),Lk(FB,e)}}function BB(t,e,n){t==="focusin"?(nI(),tu=e,Au=n,tu.attachEvent("onpropertychange",eL)):t==="focusout"&&nI()}function GB(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return qm(Au)}function WB(t,e){if(t==="click")return qm(e)}function HB(t,e){if(t==="input"||t==="change")return qm(e)}function KB(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ki=typeof Object.is=="function"?Object.is:KB;function Ou(t,e){if(Ki(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!ZS.call(e,i)||!Ki(t[i],e[i]))return!1}return!0}function rI(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function iI(t,e){var n=rI(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}t:{for(;n;){if(n.nextSibling){n=n.nextSibling;break t}n=n.parentNode}n=void 0}n=rI(n)}}function nL(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?nL(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function rL(){for(var t=window,e=Ff();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ff(t.document)}return e}function ky(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function zB(t){var e=rL(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&nL(n.ownerDocument.documentElement,n)){if(r!==null&&ky(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!t.extend&&o>r&&(i=r,r=o,o=i),i=iI(n,o);var s=iI(n,r);i&&s&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),o>r?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var YB=Jo&&"documentMode"in document&&11>=document.documentMode,Gc=null,gT=null,eu=null,ST=!1;function oI(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ST||Gc==null||Gc!==Ff(r)||(r=Gc,"selectionStart"in r&&ky(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),eu&&Ou(eu,r)||(eu=r,r=zf(gT,"onSelect"),0<r.length&&(e=new Ny("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Gc)))}function Kh(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Wc={animationend:Kh("Animation","AnimationEnd"),animationiteration:Kh("Animation","AnimationIteration"),animationstart:Kh("Animation","AnimationStart"),transitionend:Kh("Transition","TransitionEnd")},aE={},iL={};Jo&&(iL=document.createElement("div").style,"AnimationEvent"in window||(delete Wc.animationend.animation,delete Wc.animationiteration.animation,delete Wc.animationstart.animation),"TransitionEvent"in window||delete Wc.transitionend.transition);function Jm(t){if(aE[t])return aE[t];if(!Wc[t])return t;var e=Wc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in iL)return aE[t]=e[n];return t}var oL=Jm("animationend"),sL=Jm("animationiteration"),aL=Jm("animationstart"),cL=Jm("transitionend"),dL=new Map,sI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zs(t,e){dL.set(t,e),oc(e,[t])}for(var cE=0;cE<sI.length;cE++){var dE=sI[cE],$B=dE.toLowerCase(),qB=dE[0].toUpperCase()+dE.slice(1);Zs($B,"on"+qB)}Zs(oL,"onAnimationEnd");Zs(sL,"onAnimationIteration");Zs(aL,"onAnimationStart");Zs("dblclick","onDoubleClick");Zs("focusin","onFocus");Zs("focusout","onBlur");Zs(cL,"onTransitionEnd");Cd("onMouseEnter",["mouseout","mouseover"]);Cd("onMouseLeave",["mouseout","mouseover"]);Cd("onPointerEnter",["pointerout","pointerover"]);Cd("onPointerLeave",["pointerout","pointerover"]);oc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));oc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));oc("onBeforeInput",["compositionend","keypress","textInput","paste"]);oc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));oc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));oc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),JB=new Set("cancel close invalid load scroll toggle".split(" ").concat(xl));function aI(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,$j(r,e,void 0,t),t.currentTarget=null}function lL(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;t:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],c=a.instance,d=a.currentTarget;if(a=a.listener,c!==o&&i.isPropagationStopped())break t;aI(i,a,d),o=c}else for(s=0;s<r.length;s++){if(a=r[s],c=a.instance,d=a.currentTarget,a=a.listener,c!==o&&i.isPropagationStopped())break t;aI(i,a,d),o=c}}}if(Bf)throw t=fT,Bf=!1,fT=null,t}function Me(t,e){var n=e[CT];n===void 0&&(n=e[CT]=new Set);var r=t+"__bubble";n.has(r)||(uL(e,t,2,!1),n.add(r))}function lE(t,e,n){var r=0;e&&(r|=4),uL(n,t,r,e)}var zh="_reactListening"+Math.random().toString(36).slice(2);function bu(t){if(!t[zh]){t[zh]=!0,gk.forEach(function(n){n!=="selectionchange"&&(JB.has(n)||lE(n,!1,t),lE(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[zh]||(e[zh]=!0,lE("selectionchange",!1,e))}}function uL(t,e,n,r){switch($k(e)){case 1:var i=lB;break;case 4:i=uB;break;default:i=Oy}n=i.bind(null,e,n,t),i=void 0,!pT||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function uE(t,e,n,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)t:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var c=s.tag;if((c===3||c===4)&&(c=s.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;s=s.return}for(;a!==null;){if(s=Aa(a),s===null)return;if(c=s.tag,c===5||c===6){r=o=s;continue t}a=a.parentNode}}r=r.return}Lk(function(){var d=o,l=Cy(n),u=[];t:{var h=dL.get(t);if(h!==void 0){var p=Ny,S=t;switch(t){case"keypress":if(tf(n)===0)break t;case"keydown":case"keyup":p=wB;break;case"focusin":S="focus",p=iE;break;case"focusout":S="blur",p=iE;break;case"beforeblur":case"afterblur":p=iE;break;case"click":if(n.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=qC;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=fB;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=bB;break;case oL:case sL:case aL:p=EB;break;case cL:p=PB;break;case"scroll":p=hB;break;case"wheel":p=kB;break;case"copy":case"cut":case"paste":p=SB;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=XC}var f=(e&4)!==0,_=!f&&t==="scroll",T=f?h!==null?h+"Capture":null:h;f=[];for(var g=d,y;g!==null;){y=g;var I=y.stateNode;if(y.tag===5&&I!==null&&(y=I,T!==null&&(I=Ru(g,T),I!=null&&f.push(Nu(g,I,y)))),_)break;g=g.return}0<f.length&&(h=new p(h,S,null,n,l),u.push({event:h,listeners:f}))}}if(!(e&7)){t:{if(h=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",h&&n!==uT&&(S=n.relatedTarget||n.fromElement)&&(Aa(S)||S[Xo]))break t;if((p||h)&&(h=l.window===l?l:(h=l.ownerDocument)?h.defaultView||h.parentWindow:window,p?(S=n.relatedTarget||n.toElement,p=d,S=S?Aa(S):null,S!==null&&(_=sc(S),S!==_||S.tag!==5&&S.tag!==6)&&(S=null)):(p=null,S=d),p!==S)){if(f=qC,I="onMouseLeave",T="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(f=XC,I="onPointerLeave",T="onPointerEnter",g="pointer"),_=p==null?h:Hc(p),y=S==null?h:Hc(S),h=new f(I,g+"leave",p,n,l),h.target=_,h.relatedTarget=y,I=null,Aa(l)===d&&(f=new f(T,g+"enter",S,n,l),f.target=y,f.relatedTarget=_,I=f),_=I,p&&S)e:{for(f=p,T=S,g=0,y=f;y;y=fc(y))g++;for(y=0,I=T;I;I=fc(I))y++;for(;0<g-y;)f=fc(f),g--;for(;0<y-g;)T=fc(T),y--;for(;g--;){if(f===T||T!==null&&f===T.alternate)break e;f=fc(f),T=fc(T)}f=null}else f=null;p!==null&&cI(u,h,p,f,!1),S!==null&&_!==null&&cI(u,_,S,f,!0)}}t:{if(h=d?Hc(d):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var O=jB;else if(tI(h))if(tL)O=HB;else{O=GB;var b=BB}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(O=WB);if(O&&(O=O(t,d))){Zk(u,O,n,l);break t}b&&b(t,h,d),t==="focusout"&&(b=h._wrapperState)&&b.controlled&&h.type==="number"&&sT(h,"number",h.value)}switch(b=d?Hc(d):window,t){case"focusin":(tI(b)||b.contentEditable==="true")&&(Gc=b,gT=d,eu=null);break;case"focusout":eu=gT=Gc=null;break;case"mousedown":ST=!0;break;case"contextmenu":case"mouseup":case"dragend":ST=!1,oI(u,n,l);break;case"selectionchange":if(YB)break;case"keydown":case"keyup":oI(u,n,l)}var N;if(Dy)t:{switch(t){case"compositionstart":var U="onCompositionStart";break t;case"compositionend":U="onCompositionEnd";break t;case"compositionupdate":U="onCompositionUpdate";break t}U=void 0}else Bc?Xk(t,n)&&(U="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(U="onCompositionStart");U&&(Jk&&n.locale!=="ko"&&(Bc||U!=="onCompositionStart"?U==="onCompositionEnd"&&Bc&&(N=qk()):(Is=l,by="value"in Is?Is.value:Is.textContent,Bc=!0)),b=zf(d,U),0<b.length&&(U=new JC(U,t,null,n,l),u.push({event:U,listeners:b}),N?U.data=N:(N=Qk(n),N!==null&&(U.data=N)))),(N=MB?UB(t,n):xB(t,n))&&(d=zf(d,"onBeforeInput"),0<d.length&&(l=new JC("onBeforeInput","beforeinput",null,n,l),u.push({event:l,listeners:d}),l.data=N))}lL(u,e)})}function Nu(t,e,n){return{instance:t,listener:e,currentTarget:n}}function zf(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Ru(t,n),o!=null&&r.unshift(Nu(t,o,i)),o=Ru(t,e),o!=null&&r.push(Nu(t,o,i))),t=t.return}return r}function fc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function cI(t,e,n,r,i){for(var o=e._reactName,s=[];n!==null&&n!==r;){var a=n,c=a.alternate,d=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&d!==null&&(a=d,i?(c=Ru(n,o),c!=null&&s.unshift(Nu(n,c,a))):i||(c=Ru(n,o),c!=null&&s.push(Nu(n,c,a)))),n=n.return}s.length!==0&&t.push({event:e,listeners:s})}var XB=/\r\n?/g,QB=/\u0000|\uFFFD/g;function dI(t){return(typeof t=="string"?t:""+t).replace(XB,`
`).replace(QB,"")}function Yh(t,e,n){if(e=dI(e),dI(t)!==e&&n)throw Error(nt(425))}function Yf(){}var TT=null,vT=null;function yT(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var RT=typeof setTimeout=="function"?setTimeout:void 0,ZB=typeof clearTimeout=="function"?clearTimeout:void 0,lI=typeof Promise=="function"?Promise:void 0,t3=typeof queueMicrotask=="function"?queueMicrotask:typeof lI<"u"?function(t){return lI.resolve(null).then(t).catch(e3)}:RT;function e3(t){setTimeout(function(){throw t})}function hE(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),wu(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);wu(e)}function Us(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function uI(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Hd=Math.random().toString(36).slice(2),uo="__reactFiber$"+Hd,Pu="__reactProps$"+Hd,Xo="__reactContainer$"+Hd,CT="__reactEvents$"+Hd,n3="__reactListeners$"+Hd,r3="__reactHandles$"+Hd;function Aa(t){var e=t[uo];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Xo]||n[uo]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=uI(t);t!==null;){if(n=t[uo])return n;t=uI(t)}return e}t=n,n=t.parentNode}return null}function Eh(t){return t=t[uo]||t[Xo],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Hc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(nt(33))}function Xm(t){return t[Pu]||null}var IT=[],Kc=-1;function ta(t){return{current:t}}function Fe(t){0>Kc||(t.current=IT[Kc],IT[Kc]=null,Kc--)}function ke(t,e){Kc++,IT[Kc]=t.current,t.current=e}var qs={},Xn=ta(qs),Ir=ta(!1),Ya=qs;function Id(t,e){var n=t.type.contextTypes;if(!n)return qs;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in n)i[o]=e[o];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function wr(t){return t=t.childContextTypes,t!=null}function $f(){Fe(Ir),Fe(Xn)}function hI(t,e,n){if(Xn.current!==qs)throw Error(nt(168));ke(Xn,e),ke(Ir,n)}function hL(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(nt(108,Bj(t)||"Unknown",i));return Xe({},n,r)}function qf(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||qs,Ya=Xn.current,ke(Xn,t),ke(Ir,Ir.current),!0}function pI(t,e,n){var r=t.stateNode;if(!r)throw Error(nt(169));n?(t=hL(t,e,Ya),r.__reactInternalMemoizedMergedChildContext=t,Fe(Ir),Fe(Xn),ke(Xn,t)):Fe(Ir),ke(Ir,n)}var jo=null,Qm=!1,pE=!1;function pL(t){jo===null?jo=[t]:jo.push(t)}function i3(t){Qm=!0,pL(t)}function ea(){if(!pE&&jo!==null){pE=!0;var t=0,e=ye;try{var n=jo;for(ye=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}jo=null,Qm=!1}catch(i){throw jo!==null&&(jo=jo.slice(t+1)),Vk(Iy,ea),i}finally{ye=e,pE=!1}}return null}var zc=[],Yc=0,Jf=null,Xf=0,mi=[],_i=0,$a=null,Ho=1,Ko="";function _a(t,e){zc[Yc++]=Xf,zc[Yc++]=Jf,Jf=t,Xf=e}function fL(t,e,n){mi[_i++]=Ho,mi[_i++]=Ko,mi[_i++]=$a,$a=t;var r=Ho;t=Ko;var i=32-Gi(r)-1;r&=~(1<<i),n+=1;var o=32-Gi(e)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Ho=1<<32-Gi(e)+i|n<<i|r,Ko=o+t}else Ho=1<<o|n<<i|r,Ko=t}function Ly(t){t.return!==null&&(_a(t,1),fL(t,1,0))}function My(t){for(;t===Jf;)Jf=zc[--Yc],zc[Yc]=null,Xf=zc[--Yc],zc[Yc]=null;for(;t===$a;)$a=mi[--_i],mi[_i]=null,Ko=mi[--_i],mi[_i]=null,Ho=mi[--_i],mi[_i]=null}var Yr=null,Gr=null,Ge=!1,ji=null;function mL(t,e){var n=Ti(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function fI(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Yr=t,Gr=Us(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Yr=t,Gr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=$a!==null?{id:Ho,overflow:Ko}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Ti(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Yr=t,Gr=null,!0):!1;default:return!1}}function wT(t){return(t.mode&1)!==0&&(t.flags&128)===0}function AT(t){if(Ge){var e=Gr;if(e){var n=e;if(!fI(t,e)){if(wT(t))throw Error(nt(418));e=Us(n.nextSibling);var r=Yr;e&&fI(t,e)?mL(r,n):(t.flags=t.flags&-4097|2,Ge=!1,Yr=t)}}else{if(wT(t))throw Error(nt(418));t.flags=t.flags&-4097|2,Ge=!1,Yr=t}}}function mI(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Yr=t}function $h(t){if(t!==Yr)return!1;if(!Ge)return mI(t),Ge=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!yT(t.type,t.memoizedProps)),e&&(e=Gr)){if(wT(t))throw _L(),Error(nt(418));for(;e;)mL(t,e),e=Us(e.nextSibling)}if(mI(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(nt(317));t:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Gr=Us(t.nextSibling);break t}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Gr=null}}else Gr=Yr?Us(t.stateNode.nextSibling):null;return!0}function _L(){for(var t=Gr;t;)t=Us(t.nextSibling)}function wd(){Gr=Yr=null,Ge=!1}function Uy(t){ji===null?ji=[t]:ji.push(t)}var o3=es.ReactCurrentBatchConfig;function _l(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(nt(309));var r=n.stateNode}if(!r)throw Error(nt(147,t));var i=r,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var a=i.refs;s===null?delete a[o]:a[o]=s},e._stringRef=o,e)}if(typeof t!="string")throw Error(nt(284));if(!n._owner)throw Error(nt(290,t))}return t}function qh(t,e){throw t=Object.prototype.toString.call(e),Error(nt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function _I(t){var e=t._init;return e(t._payload)}function EL(t){function e(T,g){if(t){var y=T.deletions;y===null?(T.deletions=[g],T.flags|=16):y.push(g)}}function n(T,g){if(!t)return null;for(;g!==null;)e(T,g),g=g.sibling;return null}function r(T,g){for(T=new Map;g!==null;)g.key!==null?T.set(g.key,g):T.set(g.index,g),g=g.sibling;return T}function i(T,g){return T=js(T,g),T.index=0,T.sibling=null,T}function o(T,g,y){return T.index=y,t?(y=T.alternate,y!==null?(y=y.index,y<g?(T.flags|=2,g):y):(T.flags|=2,g)):(T.flags|=1048576,g)}function s(T){return t&&T.alternate===null&&(T.flags|=2),T}function a(T,g,y,I){return g===null||g.tag!==6?(g=TE(y,T.mode,I),g.return=T,g):(g=i(g,y),g.return=T,g)}function c(T,g,y,I){var O=y.type;return O===jc?l(T,g,y.props.children,I,y.key):g!==null&&(g.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===gs&&_I(O)===g.type)?(I=i(g,y.props),I.ref=_l(T,g,y),I.return=T,I):(I=cf(y.type,y.key,y.props,null,T.mode,I),I.ref=_l(T,g,y),I.return=T,I)}function d(T,g,y,I){return g===null||g.tag!==4||g.stateNode.containerInfo!==y.containerInfo||g.stateNode.implementation!==y.implementation?(g=vE(y,T.mode,I),g.return=T,g):(g=i(g,y.children||[]),g.return=T,g)}function l(T,g,y,I,O){return g===null||g.tag!==7?(g=ja(y,T.mode,I,O),g.return=T,g):(g=i(g,y),g.return=T,g)}function u(T,g,y){if(typeof g=="string"&&g!==""||typeof g=="number")return g=TE(""+g,T.mode,y),g.return=T,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case Vh:return y=cf(g.type,g.key,g.props,null,T.mode,y),y.ref=_l(T,null,g),y.return=T,y;case Fc:return g=vE(g,T.mode,y),g.return=T,g;case gs:var I=g._init;return u(T,I(g._payload),y)}if(Ml(g)||ul(g))return g=ja(g,T.mode,y,null),g.return=T,g;qh(T,g)}return null}function h(T,g,y,I){var O=g!==null?g.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return O!==null?null:a(T,g,""+y,I);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Vh:return y.key===O?c(T,g,y,I):null;case Fc:return y.key===O?d(T,g,y,I):null;case gs:return O=y._init,h(T,g,O(y._payload),I)}if(Ml(y)||ul(y))return O!==null?null:l(T,g,y,I,null);qh(T,y)}return null}function p(T,g,y,I,O){if(typeof I=="string"&&I!==""||typeof I=="number")return T=T.get(y)||null,a(g,T,""+I,O);if(typeof I=="object"&&I!==null){switch(I.$$typeof){case Vh:return T=T.get(I.key===null?y:I.key)||null,c(g,T,I,O);case Fc:return T=T.get(I.key===null?y:I.key)||null,d(g,T,I,O);case gs:var b=I._init;return p(T,g,y,b(I._payload),O)}if(Ml(I)||ul(I))return T=T.get(y)||null,l(g,T,I,O,null);qh(g,I)}return null}function S(T,g,y,I){for(var O=null,b=null,N=g,U=g=0,V=null;N!==null&&U<y.length;U++){N.index>U?(V=N,N=null):V=N.sibling;var W=h(T,N,y[U],I);if(W===null){N===null&&(N=V);break}t&&N&&W.alternate===null&&e(T,N),g=o(W,g,U),b===null?O=W:b.sibling=W,b=W,N=V}if(U===y.length)return n(T,N),Ge&&_a(T,U),O;if(N===null){for(;U<y.length;U++)N=u(T,y[U],I),N!==null&&(g=o(N,g,U),b===null?O=N:b.sibling=N,b=N);return Ge&&_a(T,U),O}for(N=r(T,N);U<y.length;U++)V=p(N,T,U,y[U],I),V!==null&&(t&&V.alternate!==null&&N.delete(V.key===null?U:V.key),g=o(V,g,U),b===null?O=V:b.sibling=V,b=V);return t&&N.forEach(function(lt){return e(T,lt)}),Ge&&_a(T,U),O}function f(T,g,y,I){var O=ul(y);if(typeof O!="function")throw Error(nt(150));if(y=O.call(y),y==null)throw Error(nt(151));for(var b=O=null,N=g,U=g=0,V=null,W=y.next();N!==null&&!W.done;U++,W=y.next()){N.index>U?(V=N,N=null):V=N.sibling;var lt=h(T,N,W.value,I);if(lt===null){N===null&&(N=V);break}t&&N&&lt.alternate===null&&e(T,N),g=o(lt,g,U),b===null?O=lt:b.sibling=lt,b=lt,N=V}if(W.done)return n(T,N),Ge&&_a(T,U),O;if(N===null){for(;!W.done;U++,W=y.next())W=u(T,W.value,I),W!==null&&(g=o(W,g,U),b===null?O=W:b.sibling=W,b=W);return Ge&&_a(T,U),O}for(N=r(T,N);!W.done;U++,W=y.next())W=p(N,T,U,W.value,I),W!==null&&(t&&W.alternate!==null&&N.delete(W.key===null?U:W.key),g=o(W,g,U),b===null?O=W:b.sibling=W,b=W);return t&&N.forEach(function(mt){return e(T,mt)}),Ge&&_a(T,U),O}function _(T,g,y,I){if(typeof y=="object"&&y!==null&&y.type===jc&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Vh:t:{for(var O=y.key,b=g;b!==null;){if(b.key===O){if(O=y.type,O===jc){if(b.tag===7){n(T,b.sibling),g=i(b,y.props.children),g.return=T,T=g;break t}}else if(b.elementType===O||typeof O=="object"&&O!==null&&O.$$typeof===gs&&_I(O)===b.type){n(T,b.sibling),g=i(b,y.props),g.ref=_l(T,b,y),g.return=T,T=g;break t}n(T,b);break}else e(T,b);b=b.sibling}y.type===jc?(g=ja(y.props.children,T.mode,I,y.key),g.return=T,T=g):(I=cf(y.type,y.key,y.props,null,T.mode,I),I.ref=_l(T,g,y),I.return=T,T=I)}return s(T);case Fc:t:{for(b=y.key;g!==null;){if(g.key===b)if(g.tag===4&&g.stateNode.containerInfo===y.containerInfo&&g.stateNode.implementation===y.implementation){n(T,g.sibling),g=i(g,y.children||[]),g.return=T,T=g;break t}else{n(T,g);break}else e(T,g);g=g.sibling}g=vE(y,T.mode,I),g.return=T,T=g}return s(T);case gs:return b=y._init,_(T,g,b(y._payload),I)}if(Ml(y))return S(T,g,y,I);if(ul(y))return f(T,g,y,I);qh(T,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,g!==null&&g.tag===6?(n(T,g.sibling),g=i(g,y),g.return=T,T=g):(n(T,g),g=TE(y,T.mode,I),g.return=T,T=g),s(T)):n(T,g)}return _}var Ad=EL(!0),gL=EL(!1),Qf=ta(null),Zf=null,$c=null,xy=null;function Vy(){xy=$c=Zf=null}function Fy(t){var e=Qf.current;Fe(Qf),t._currentValue=e}function OT(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function hd(t,e){Zf=t,xy=$c=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(yr=!0),t.firstContext=null)}function Ci(t){var e=t._currentValue;if(xy!==t)if(t={context:t,memoizedValue:e,next:null},$c===null){if(Zf===null)throw Error(nt(308));$c=t,Zf.dependencies={lanes:0,firstContext:t}}else $c=$c.next=t;return e}var Oa=null;function jy(t){Oa===null?Oa=[t]:Oa.push(t)}function SL(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,jy(e)):(n.next=i.next,i.next=n),e.interleaved=n,Qo(t,r)}function Qo(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ss=!1;function By(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function TL(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function $o(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function xs(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ie&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Qo(t,n)}return i=r.interleaved,i===null?(e.next=e,jy(r)):(e.next=i.next,i.next=e),r.interleaved=e,Qo(t,n)}function ef(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,wy(t,n)}}function EI(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?i=o=s:o=o.next=s,n=n.next}while(n!==null);o===null?i=o=e:o=o.next=e}else i=o=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function tm(t,e,n,r){var i=t.updateQueue;Ss=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var c=a,d=c.next;c.next=null,s===null?o=d:s.next=d,s=c;var l=t.alternate;l!==null&&(l=l.updateQueue,a=l.lastBaseUpdate,a!==s&&(a===null?l.firstBaseUpdate=d:a.next=d,l.lastBaseUpdate=c))}if(o!==null){var u=i.baseState;s=0,l=d=c=null,a=o;do{var h=a.lane,p=a.eventTime;if((r&h)===h){l!==null&&(l=l.next={eventTime:p,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});t:{var S=t,f=a;switch(h=e,p=n,f.tag){case 1:if(S=f.payload,typeof S=="function"){u=S.call(p,u,h);break t}u=S;break t;case 3:S.flags=S.flags&-65537|128;case 0:if(S=f.payload,h=typeof S=="function"?S.call(p,u,h):S,h==null)break t;u=Xe({},u,h);break t;case 2:Ss=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else p={eventTime:p,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},l===null?(d=l=p,c=u):l=l.next=p,s|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(l===null&&(c=u),i.baseState=c,i.firstBaseUpdate=d,i.lastBaseUpdate=l,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Ja|=s,t.lanes=s,t.memoizedState=u}}function gI(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(nt(191,i));i.call(r)}}}var gh={},go=ta(gh),Du=ta(gh),ku=ta(gh);function ba(t){if(t===gh)throw Error(nt(174));return t}function Gy(t,e){switch(ke(ku,e),ke(Du,t),ke(go,gh),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:cT(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=cT(e,t)}Fe(go),ke(go,e)}function Od(){Fe(go),Fe(Du),Fe(ku)}function vL(t){ba(ku.current);var e=ba(go.current),n=cT(e,t.type);e!==n&&(ke(Du,t),ke(go,n))}function Wy(t){Du.current===t&&(Fe(go),Fe(Du))}var ze=ta(0);function em(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var fE=[];function Hy(){for(var t=0;t<fE.length;t++)fE[t]._workInProgressVersionPrimary=null;fE.length=0}var nf=es.ReactCurrentDispatcher,mE=es.ReactCurrentBatchConfig,qa=0,qe=null,Rn=null,bn=null,nm=!1,nu=!1,Lu=0,s3=0;function Kn(){throw Error(nt(321))}function Ky(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ki(t[n],e[n]))return!1;return!0}function zy(t,e,n,r,i,o){if(qa=o,qe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,nf.current=t===null||t.memoizedState===null?l3:u3,t=n(r,i),nu){o=0;do{if(nu=!1,Lu=0,25<=o)throw Error(nt(301));o+=1,bn=Rn=null,e.updateQueue=null,nf.current=h3,t=n(r,i)}while(nu)}if(nf.current=rm,e=Rn!==null&&Rn.next!==null,qa=0,bn=Rn=qe=null,nm=!1,e)throw Error(nt(300));return t}function Yy(){var t=Lu!==0;return Lu=0,t}function co(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bn===null?qe.memoizedState=bn=t:bn=bn.next=t,bn}function Ii(){if(Rn===null){var t=qe.alternate;t=t!==null?t.memoizedState:null}else t=Rn.next;var e=bn===null?qe.memoizedState:bn.next;if(e!==null)bn=e,Rn=t;else{if(t===null)throw Error(nt(310));Rn=t,t={memoizedState:Rn.memoizedState,baseState:Rn.baseState,baseQueue:Rn.baseQueue,queue:Rn.queue,next:null},bn===null?qe.memoizedState=bn=t:bn=bn.next=t}return bn}function Mu(t,e){return typeof e=="function"?e(t):e}function _E(t){var e=Ii(),n=e.queue;if(n===null)throw Error(nt(311));n.lastRenderedReducer=t;var r=Rn,i=r.baseQueue,o=n.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,n.pending=null}if(i!==null){o=i.next,r=r.baseState;var a=s=null,c=null,d=o;do{var l=d.lane;if((qa&l)===l)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),r=d.hasEagerState?d.eagerState:t(r,d.action);else{var u={lane:l,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(a=c=u,s=r):c=c.next=u,qe.lanes|=l,Ja|=l}d=d.next}while(d!==null&&d!==o);c===null?s=r:c.next=a,Ki(r,e.memoizedState)||(yr=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do o=i.lane,qe.lanes|=o,Ja|=o,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function EE(t){var e=Ii(),n=e.queue;if(n===null)throw Error(nt(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,o=e.memoizedState;if(i!==null){n.pending=null;var s=i=i.next;do o=t(o,s.action),s=s.next;while(s!==i);Ki(o,e.memoizedState)||(yr=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function yL(){}function RL(t,e){var n=qe,r=Ii(),i=e(),o=!Ki(r.memoizedState,i);if(o&&(r.memoizedState=i,yr=!0),r=r.queue,$y(wL.bind(null,n,r,t),[t]),r.getSnapshot!==e||o||bn!==null&&bn.memoizedState.tag&1){if(n.flags|=2048,Uu(9,IL.bind(null,n,r,i,e),void 0,null),Ln===null)throw Error(nt(349));qa&30||CL(n,e,i)}return i}function CL(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=qe.updateQueue,e===null?(e={lastEffect:null,stores:null},qe.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function IL(t,e,n,r){e.value=n,e.getSnapshot=r,AL(e)&&OL(t)}function wL(t,e,n){return n(function(){AL(e)&&OL(t)})}function AL(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ki(t,n)}catch{return!0}}function OL(t){var e=Qo(t,1);e!==null&&Wi(e,t,1,-1)}function SI(t){var e=co();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Mu,lastRenderedState:t},e.queue=t,t=t.dispatch=d3.bind(null,qe,t),[e.memoizedState,t]}function Uu(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=qe.updateQueue,e===null?(e={lastEffect:null,stores:null},qe.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function bL(){return Ii().memoizedState}function rf(t,e,n,r){var i=co();qe.flags|=t,i.memoizedState=Uu(1|e,n,void 0,r===void 0?null:r)}function Zm(t,e,n,r){var i=Ii();r=r===void 0?null:r;var o=void 0;if(Rn!==null){var s=Rn.memoizedState;if(o=s.destroy,r!==null&&Ky(r,s.deps)){i.memoizedState=Uu(e,n,o,r);return}}qe.flags|=t,i.memoizedState=Uu(1|e,n,o,r)}function TI(t,e){return rf(8390656,8,t,e)}function $y(t,e){return Zm(2048,8,t,e)}function NL(t,e){return Zm(4,2,t,e)}function PL(t,e){return Zm(4,4,t,e)}function DL(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function kL(t,e,n){return n=n!=null?n.concat([t]):null,Zm(4,4,DL.bind(null,e,t),n)}function qy(){}function LL(t,e){var n=Ii();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Ky(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function ML(t,e){var n=Ii();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Ky(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function UL(t,e,n){return qa&21?(Ki(n,e)||(n=Bk(),qe.lanes|=n,Ja|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,yr=!0),t.memoizedState=n)}function a3(t,e){var n=ye;ye=n!==0&&4>n?n:4,t(!0);var r=mE.transition;mE.transition={};try{t(!1),e()}finally{ye=n,mE.transition=r}}function xL(){return Ii().memoizedState}function c3(t,e,n){var r=Fs(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},VL(t))FL(e,n);else if(n=SL(t,e,n,r),n!==null){var i=cr();Wi(n,t,r,i),jL(n,e,r)}}function d3(t,e,n){var r=Fs(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(VL(t))FL(e,i);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,Ki(a,s)){var c=e.interleaved;c===null?(i.next=i,jy(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}n=SL(t,e,i,r),n!==null&&(i=cr(),Wi(n,t,r,i),jL(n,e,r))}}function VL(t){var e=t.alternate;return t===qe||e!==null&&e===qe}function FL(t,e){nu=nm=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function jL(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,wy(t,n)}}var rm={readContext:Ci,useCallback:Kn,useContext:Kn,useEffect:Kn,useImperativeHandle:Kn,useInsertionEffect:Kn,useLayoutEffect:Kn,useMemo:Kn,useReducer:Kn,useRef:Kn,useState:Kn,useDebugValue:Kn,useDeferredValue:Kn,useTransition:Kn,useMutableSource:Kn,useSyncExternalStore:Kn,useId:Kn,unstable_isNewReconciler:!1},l3={readContext:Ci,useCallback:function(t,e){return co().memoizedState=[t,e===void 0?null:e],t},useContext:Ci,useEffect:TI,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,rf(4194308,4,DL.bind(null,e,t),n)},useLayoutEffect:function(t,e){return rf(4194308,4,t,e)},useInsertionEffect:function(t,e){return rf(4,2,t,e)},useMemo:function(t,e){var n=co();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=co();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=c3.bind(null,qe,t),[r.memoizedState,t]},useRef:function(t){var e=co();return t={current:t},e.memoizedState=t},useState:SI,useDebugValue:qy,useDeferredValue:function(t){return co().memoizedState=t},useTransition:function(){var t=SI(!1),e=t[0];return t=a3.bind(null,t[1]),co().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=qe,i=co();if(Ge){if(n===void 0)throw Error(nt(407));n=n()}else{if(n=e(),Ln===null)throw Error(nt(349));qa&30||CL(r,e,n)}i.memoizedState=n;var o={value:n,getSnapshot:e};return i.queue=o,TI(wL.bind(null,r,o,t),[t]),r.flags|=2048,Uu(9,IL.bind(null,r,o,n,e),void 0,null),n},useId:function(){var t=co(),e=Ln.identifierPrefix;if(Ge){var n=Ko,r=Ho;n=(r&~(1<<32-Gi(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Lu++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=s3++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},u3={readContext:Ci,useCallback:LL,useContext:Ci,useEffect:$y,useImperativeHandle:kL,useInsertionEffect:NL,useLayoutEffect:PL,useMemo:ML,useReducer:_E,useRef:bL,useState:function(){return _E(Mu)},useDebugValue:qy,useDeferredValue:function(t){var e=Ii();return UL(e,Rn.memoizedState,t)},useTransition:function(){var t=_E(Mu)[0],e=Ii().memoizedState;return[t,e]},useMutableSource:yL,useSyncExternalStore:RL,useId:xL,unstable_isNewReconciler:!1},h3={readContext:Ci,useCallback:LL,useContext:Ci,useEffect:$y,useImperativeHandle:kL,useInsertionEffect:NL,useLayoutEffect:PL,useMemo:ML,useReducer:EE,useRef:bL,useState:function(){return EE(Mu)},useDebugValue:qy,useDeferredValue:function(t){var e=Ii();return Rn===null?e.memoizedState=t:UL(e,Rn.memoizedState,t)},useTransition:function(){var t=EE(Mu)[0],e=Ii().memoizedState;return[t,e]},useMutableSource:yL,useSyncExternalStore:RL,useId:xL,unstable_isNewReconciler:!1};function xi(t,e){if(t&&t.defaultProps){e=Xe({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function bT(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Xe({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var t_={isMounted:function(t){return(t=t._reactInternals)?sc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=cr(),i=Fs(t),o=$o(r,i);o.payload=e,n!=null&&(o.callback=n),e=xs(t,o,i),e!==null&&(Wi(e,t,i,r),ef(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=cr(),i=Fs(t),o=$o(r,i);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=xs(t,o,i),e!==null&&(Wi(e,t,i,r),ef(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=cr(),r=Fs(t),i=$o(n,r);i.tag=2,e!=null&&(i.callback=e),e=xs(t,i,r),e!==null&&(Wi(e,t,r,n),ef(e,t,r))}};function vI(t,e,n,r,i,o,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!Ou(n,r)||!Ou(i,o):!0}function BL(t,e,n){var r=!1,i=qs,o=e.contextType;return typeof o=="object"&&o!==null?o=Ci(o):(i=wr(e)?Ya:Xn.current,r=e.contextTypes,o=(r=r!=null)?Id(t,i):qs),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=t_,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=o),e}function yI(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&t_.enqueueReplaceState(e,e.state,null)}function NT(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},By(t);var o=e.contextType;typeof o=="object"&&o!==null?i.context=Ci(o):(o=wr(e)?Ya:Xn.current,i.context=Id(t,o)),i.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(bT(t,e,o,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&t_.enqueueReplaceState(i,i.state,null),tm(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function bd(t,e){try{var n="",r=e;do n+=jj(r),r=r.return;while(r);var i=n}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:i,digest:null}}function gE(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function PT(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var p3=typeof WeakMap=="function"?WeakMap:Map;function GL(t,e,n){n=$o(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){om||(om=!0,BT=r),PT(t,e)},n}function WL(t,e,n){n=$o(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){PT(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){PT(t,e),typeof r!="function"&&(Vs===null?Vs=new Set([this]):Vs.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),n}function RI(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new p3;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=A3.bind(null,t,e,n),e.then(t,t))}function CI(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function II(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=$o(-1,1),e.tag=2,xs(n,e,1))),n.lanes|=1),t)}var f3=es.ReactCurrentOwner,yr=!1;function ir(t,e,n,r){e.child=t===null?gL(e,null,n,r):Ad(e,t.child,n,r)}function wI(t,e,n,r,i){n=n.render;var o=e.ref;return hd(e,i),r=zy(t,e,n,r,o,i),n=Yy(),t!==null&&!yr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Zo(t,e,i)):(Ge&&n&&Ly(e),e.flags|=1,ir(t,e,r,i),e.child)}function AI(t,e,n,r,i){if(t===null){var o=n.type;return typeof o=="function"&&!rR(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,HL(t,e,o,r,i)):(t=cf(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&i)){var s=o.memoizedProps;if(n=n.compare,n=n!==null?n:Ou,n(s,r)&&t.ref===e.ref)return Zo(t,e,i)}return e.flags|=1,t=js(o,r),t.ref=e.ref,t.return=e,e.child=t}function HL(t,e,n,r,i){if(t!==null){var o=t.memoizedProps;if(Ou(o,r)&&t.ref===e.ref)if(yr=!1,e.pendingProps=r=o,(t.lanes&i)!==0)t.flags&131072&&(yr=!0);else return e.lanes=t.lanes,Zo(t,e,i)}return DT(t,e,n,r,i)}function KL(t,e,n){var r=e.pendingProps,i=r.children,o=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ke(Jc,Fr),Fr|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ke(Jc,Fr),Fr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,ke(Jc,Fr),Fr|=r}else o!==null?(r=o.baseLanes|n,e.memoizedState=null):r=n,ke(Jc,Fr),Fr|=r;return ir(t,e,i,n),e.child}function zL(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function DT(t,e,n,r,i){var o=wr(n)?Ya:Xn.current;return o=Id(e,o),hd(e,i),n=zy(t,e,n,r,o,i),r=Yy(),t!==null&&!yr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Zo(t,e,i)):(Ge&&r&&Ly(e),e.flags|=1,ir(t,e,n,i),e.child)}function OI(t,e,n,r,i){if(wr(n)){var o=!0;qf(e)}else o=!1;if(hd(e,i),e.stateNode===null)of(t,e),BL(e,n,r),NT(e,n,r,i),r=!0;else if(t===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var c=s.context,d=n.contextType;typeof d=="object"&&d!==null?d=Ci(d):(d=wr(n)?Ya:Xn.current,d=Id(e,d));var l=n.getDerivedStateFromProps,u=typeof l=="function"||typeof s.getSnapshotBeforeUpdate=="function";u||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||c!==d)&&yI(e,s,r,d),Ss=!1;var h=e.memoizedState;s.state=h,tm(e,r,s,i),c=e.memoizedState,a!==r||h!==c||Ir.current||Ss?(typeof l=="function"&&(bT(e,n,l,r),c=e.memoizedState),(a=Ss||vI(e,n,a,r,h,c,d))?(u||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),s.props=r,s.state=c,s.context=d,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,TL(t,e),a=e.memoizedProps,d=e.type===e.elementType?a:xi(e.type,a),s.props=d,u=e.pendingProps,h=s.context,c=n.contextType,typeof c=="object"&&c!==null?c=Ci(c):(c=wr(n)?Ya:Xn.current,c=Id(e,c));var p=n.getDerivedStateFromProps;(l=typeof p=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==u||h!==c)&&yI(e,s,r,c),Ss=!1,h=e.memoizedState,s.state=h,tm(e,r,s,i);var S=e.memoizedState;a!==u||h!==S||Ir.current||Ss?(typeof p=="function"&&(bT(e,n,p,r),S=e.memoizedState),(d=Ss||vI(e,n,d,r,h,S,c)||!1)?(l||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,S,c),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,S,c)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=S),s.props=r,s.state=S,s.context=c,r=d):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return kT(t,e,n,r,o,i)}function kT(t,e,n,r,i,o){zL(t,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&pI(e,n,!1),Zo(t,e,o);r=e.stateNode,f3.current=e;var a=s&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&s?(e.child=Ad(e,t.child,null,o),e.child=Ad(e,null,a,o)):ir(t,e,a,o),e.memoizedState=r.state,i&&pI(e,n,!0),e.child}function YL(t){var e=t.stateNode;e.pendingContext?hI(t,e.pendingContext,e.pendingContext!==e.context):e.context&&hI(t,e.context,!1),Gy(t,e.containerInfo)}function bI(t,e,n,r,i){return wd(),Uy(i),e.flags|=256,ir(t,e,n,r),e.child}var LT={dehydrated:null,treeContext:null,retryLane:0};function MT(t){return{baseLanes:t,cachePool:null,transitions:null}}function $L(t,e,n){var r=e.pendingProps,i=ze.current,o=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ke(ze,i&1),t===null)return AT(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,t=r.fallback,o?(r=e.mode,o=e.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=r_(s,r,0,null),t=ja(t,r,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=MT(n),e.memoizedState=LT,t):Jy(e,s));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return m3(t,e,s,r,a,i,n);if(o){o=r.fallback,s=e.mode,i=t.child,a=i.sibling;var c={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=js(i,c),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=js(a,o):(o=ja(o,s,n,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,s=t.child.memoizedState,s=s===null?MT(n):{baseLanes:s.baseLanes|n,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=t.childLanes&~n,e.memoizedState=LT,r}return o=t.child,t=o.sibling,r=js(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Jy(t,e){return e=r_({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Jh(t,e,n,r){return r!==null&&Uy(r),Ad(e,t.child,null,n),t=Jy(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function m3(t,e,n,r,i,o,s){if(n)return e.flags&256?(e.flags&=-257,r=gE(Error(nt(422))),Jh(t,e,s,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=r_({mode:"visible",children:r.children},i,0,null),o=ja(o,i,s,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&Ad(e,t.child,null,s),e.child.memoizedState=MT(s),e.memoizedState=LT,o);if(!(e.mode&1))return Jh(t,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,o=Error(nt(419)),r=gE(o,r,void 0),Jh(t,e,s,r)}if(a=(s&t.childLanes)!==0,yr||a){if(r=Ln,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Qo(t,i),Wi(r,t,i,-1))}return nR(),r=gE(Error(nt(421))),Jh(t,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=O3.bind(null,t),i._reactRetry=e,null):(t=o.treeContext,Gr=Us(i.nextSibling),Yr=e,Ge=!0,ji=null,t!==null&&(mi[_i++]=Ho,mi[_i++]=Ko,mi[_i++]=$a,Ho=t.id,Ko=t.overflow,$a=e),e=Jy(e,r.children),e.flags|=4096,e)}function NI(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),OT(t.return,e,n)}function SE(t,e,n,r,i){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function qL(t,e,n){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(ir(t,e,r.children,n),r=ze.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)t:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&NI(t,n,e);else if(t.tag===19)NI(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break t;for(;t.sibling===null;){if(t.return===null||t.return===e)break t;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ke(ze,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&em(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),SE(e,!1,i,n,o);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&em(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}SE(e,!0,n,null,o);break;case"together":SE(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function of(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Zo(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ja|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(nt(153));if(e.child!==null){for(t=e.child,n=js(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=js(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function _3(t,e,n){switch(e.tag){case 3:YL(e),wd();break;case 5:vL(e);break;case 1:wr(e.type)&&qf(e);break;case 4:Gy(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ke(Qf,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ke(ze,ze.current&1),e.flags|=128,null):n&e.child.childLanes?$L(t,e,n):(ke(ze,ze.current&1),t=Zo(t,e,n),t!==null?t.sibling:null);ke(ze,ze.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return qL(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ke(ze,ze.current),r)break;return null;case 22:case 23:return e.lanes=0,KL(t,e,n)}return Zo(t,e,n)}var JL,UT,XL,QL;JL=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};UT=function(){};XL=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,ba(go.current);var o=null;switch(n){case"input":i=iT(t,i),r=iT(t,r),o=[];break;case"select":i=Xe({},i,{value:void 0}),r=Xe({},r,{value:void 0}),o=[];break;case"textarea":i=aT(t,i),r=aT(t,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Yf)}dT(n,r);var s;n=null;for(d in i)if(!r.hasOwnProperty(d)&&i.hasOwnProperty(d)&&i[d]!=null)if(d==="style"){var a=i[d];for(s in a)a.hasOwnProperty(s)&&(n||(n={}),n[s]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(vu.hasOwnProperty(d)?o||(o=[]):(o=o||[]).push(d,null));for(d in r){var c=r[d];if(a=i!=null?i[d]:void 0,r.hasOwnProperty(d)&&c!==a&&(c!=null||a!=null))if(d==="style")if(a){for(s in a)!a.hasOwnProperty(s)||c&&c.hasOwnProperty(s)||(n||(n={}),n[s]="");for(s in c)c.hasOwnProperty(s)&&a[s]!==c[s]&&(n||(n={}),n[s]=c[s])}else n||(o||(o=[]),o.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(o=o||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(vu.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&Me("scroll",t),o||a===c||(o=[])):(o=o||[]).push(d,c))}n&&(o=o||[]).push("style",n);var d=o;(e.updateQueue=d)&&(e.flags|=4)}};QL=function(t,e,n,r){n!==r&&(e.flags|=4)};function El(t,e){if(!Ge)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function zn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function E3(t,e,n){var r=e.pendingProps;switch(My(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zn(e),null;case 1:return wr(e.type)&&$f(),zn(e),null;case 3:return r=e.stateNode,Od(),Fe(Ir),Fe(Xn),Hy(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&($h(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ji!==null&&(HT(ji),ji=null))),UT(t,e),zn(e),null;case 5:Wy(e);var i=ba(ku.current);if(n=e.type,t!==null&&e.stateNode!=null)XL(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(nt(166));return zn(e),null}if(t=ba(go.current),$h(e)){r=e.stateNode,n=e.type;var o=e.memoizedProps;switch(r[uo]=e,r[Pu]=o,t=(e.mode&1)!==0,n){case"dialog":Me("cancel",r),Me("close",r);break;case"iframe":case"object":case"embed":Me("load",r);break;case"video":case"audio":for(i=0;i<xl.length;i++)Me(xl[i],r);break;case"source":Me("error",r);break;case"img":case"image":case"link":Me("error",r),Me("load",r);break;case"details":Me("toggle",r);break;case"input":FC(r,o),Me("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Me("invalid",r);break;case"textarea":BC(r,o),Me("invalid",r)}dT(n,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?r.textContent!==a&&(o.suppressHydrationWarning!==!0&&Yh(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&Yh(r.textContent,a,t),i=["children",""+a]):vu.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&Me("scroll",r)}switch(n){case"input":Fh(r),jC(r,o,!0);break;case"textarea":Fh(r),GC(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Yf)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=wk(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=s.createElement(n,{is:r.is}):(t=s.createElement(n),n==="select"&&(s=t,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):t=s.createElementNS(t,n),t[uo]=e,t[Pu]=r,JL(t,e,!1,!1),e.stateNode=t;t:{switch(s=lT(n,r),n){case"dialog":Me("cancel",t),Me("close",t),i=r;break;case"iframe":case"object":case"embed":Me("load",t),i=r;break;case"video":case"audio":for(i=0;i<xl.length;i++)Me(xl[i],t);i=r;break;case"source":Me("error",t),i=r;break;case"img":case"image":case"link":Me("error",t),Me("load",t),i=r;break;case"details":Me("toggle",t),i=r;break;case"input":FC(t,r),i=iT(t,r),Me("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Xe({},r,{value:void 0}),Me("invalid",t);break;case"textarea":BC(t,r),i=aT(t,r),Me("invalid",t);break;default:i=r}dT(n,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var c=a[o];o==="style"?bk(t,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&Ak(t,c)):o==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&yu(t,c):typeof c=="number"&&yu(t,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(vu.hasOwnProperty(o)?c!=null&&o==="onScroll"&&Me("scroll",t):c!=null&&Ty(t,o,c,s))}switch(n){case"input":Fh(t),jC(t,r,!1);break;case"textarea":Fh(t),GC(t);break;case"option":r.value!=null&&t.setAttribute("value",""+$s(r.value));break;case"select":t.multiple=!!r.multiple,o=r.value,o!=null?cd(t,!!r.multiple,o,!1):r.defaultValue!=null&&cd(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Yf)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break t;case"img":r=!0;break t;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return zn(e),null;case 6:if(t&&e.stateNode!=null)QL(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(nt(166));if(n=ba(ku.current),ba(go.current),$h(e)){if(r=e.stateNode,n=e.memoizedProps,r[uo]=e,(o=r.nodeValue!==n)&&(t=Yr,t!==null))switch(t.tag){case 3:Yh(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Yh(r.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[uo]=e,e.stateNode=r}return zn(e),null;case 13:if(Fe(ze),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ge&&Gr!==null&&e.mode&1&&!(e.flags&128))_L(),wd(),e.flags|=98560,o=!1;else if(o=$h(e),r!==null&&r.dehydrated!==null){if(t===null){if(!o)throw Error(nt(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(nt(317));o[uo]=e}else wd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;zn(e),o=!1}else ji!==null&&(HT(ji),ji=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||ze.current&1?In===0&&(In=3):nR())),e.updateQueue!==null&&(e.flags|=4),zn(e),null);case 4:return Od(),UT(t,e),t===null&&bu(e.stateNode.containerInfo),zn(e),null;case 10:return Fy(e.type._context),zn(e),null;case 17:return wr(e.type)&&$f(),zn(e),null;case 19:if(Fe(ze),o=e.memoizedState,o===null)return zn(e),null;if(r=(e.flags&128)!==0,s=o.rendering,s===null)if(r)El(o,!1);else{if(In!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=em(t),s!==null){for(e.flags|=128,El(o,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)o=n,t=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,t=s.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ke(ze,ze.current&1|2),e.child}t=t.sibling}o.tail!==null&&hn()>Nd&&(e.flags|=128,r=!0,El(o,!1),e.lanes=4194304)}else{if(!r)if(t=em(s),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),El(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!Ge)return zn(e),null}else 2*hn()-o.renderingStartTime>Nd&&n!==1073741824&&(e.flags|=128,r=!0,El(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(n=o.last,n!==null?n.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=hn(),e.sibling=null,n=ze.current,ke(ze,r?n&1|2:n&1),e):(zn(e),null);case 22:case 23:return eR(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Fr&1073741824&&(zn(e),e.subtreeFlags&6&&(e.flags|=8192)):zn(e),null;case 24:return null;case 25:return null}throw Error(nt(156,e.tag))}function g3(t,e){switch(My(e),e.tag){case 1:return wr(e.type)&&$f(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Od(),Fe(Ir),Fe(Xn),Hy(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Wy(e),null;case 13:if(Fe(ze),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(nt(340));wd()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Fe(ze),null;case 4:return Od(),null;case 10:return Fy(e.type._context),null;case 22:case 23:return eR(),null;case 24:return null;default:return null}}var Xh=!1,Jn=!1,S3=typeof WeakSet=="function"?WeakSet:Set,ut=null;function qc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){on(t,e,r)}else n.current=null}function xT(t,e,n){try{n()}catch(r){on(t,e,r)}}var PI=!1;function T3(t,e){if(TT=Hf,t=rL(),ky(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else t:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break t}var s=0,a=-1,c=-1,d=0,l=0,u=t,h=null;e:for(;;){for(var p;u!==n||i!==0&&u.nodeType!==3||(a=s+i),u!==o||r!==0&&u.nodeType!==3||(c=s+r),u.nodeType===3&&(s+=u.nodeValue.length),(p=u.firstChild)!==null;)h=u,u=p;for(;;){if(u===t)break e;if(h===n&&++d===i&&(a=s),h===o&&++l===r&&(c=s),(p=u.nextSibling)!==null)break;u=h,h=u.parentNode}u=p}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(vT={focusedElem:t,selectionRange:n},Hf=!1,ut=e;ut!==null;)if(e=ut,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ut=t;else for(;ut!==null;){e=ut;try{var S=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var f=S.memoizedProps,_=S.memoizedState,T=e.stateNode,g=T.getSnapshotBeforeUpdate(e.elementType===e.type?f:xi(e.type,f),_);T.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(nt(163))}}catch(I){on(e,e.return,I)}if(t=e.sibling,t!==null){t.return=e.return,ut=t;break}ut=e.return}return S=PI,PI=!1,S}function ru(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var o=i.destroy;i.destroy=void 0,o!==void 0&&xT(e,n,o)}i=i.next}while(i!==r)}}function e_(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function VT(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function ZL(t){var e=t.alternate;e!==null&&(t.alternate=null,ZL(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[uo],delete e[Pu],delete e[CT],delete e[n3],delete e[r3])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function tM(t){return t.tag===5||t.tag===3||t.tag===4}function DI(t){t:for(;;){for(;t.sibling===null;){if(t.return===null||tM(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue t;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function FT(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Yf));else if(r!==4&&(t=t.child,t!==null))for(FT(t,e,n),t=t.sibling;t!==null;)FT(t,e,n),t=t.sibling}function jT(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(jT(t,e,n),t=t.sibling;t!==null;)jT(t,e,n),t=t.sibling}var xn=null,Vi=!1;function os(t,e,n){for(n=n.child;n!==null;)eM(t,e,n),n=n.sibling}function eM(t,e,n){if(Eo&&typeof Eo.onCommitFiberUnmount=="function")try{Eo.onCommitFiberUnmount(Ym,n)}catch{}switch(n.tag){case 5:Jn||qc(n,e);case 6:var r=xn,i=Vi;xn=null,os(t,e,n),xn=r,Vi=i,xn!==null&&(Vi?(t=xn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):xn.removeChild(n.stateNode));break;case 18:xn!==null&&(Vi?(t=xn,n=n.stateNode,t.nodeType===8?hE(t.parentNode,n):t.nodeType===1&&hE(t,n),wu(t)):hE(xn,n.stateNode));break;case 4:r=xn,i=Vi,xn=n.stateNode.containerInfo,Vi=!0,os(t,e,n),xn=r,Vi=i;break;case 0:case 11:case 14:case 15:if(!Jn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&xT(n,e,s),i=i.next}while(i!==r)}os(t,e,n);break;case 1:if(!Jn&&(qc(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){on(n,e,a)}os(t,e,n);break;case 21:os(t,e,n);break;case 22:n.mode&1?(Jn=(r=Jn)||n.memoizedState!==null,os(t,e,n),Jn=r):os(t,e,n);break;default:os(t,e,n)}}function kI(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new S3),e.forEach(function(r){var i=b3.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Ni(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var o=t,s=e,a=s;t:for(;a!==null;){switch(a.tag){case 5:xn=a.stateNode,Vi=!1;break t;case 3:xn=a.stateNode.containerInfo,Vi=!0;break t;case 4:xn=a.stateNode.containerInfo,Vi=!0;break t}a=a.return}if(xn===null)throw Error(nt(160));eM(o,s,i),xn=null,Vi=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(d){on(i,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)nM(e,t),e=e.sibling}function nM(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ni(e,t),Qi(t),r&4){try{ru(3,t,t.return),e_(3,t)}catch(f){on(t,t.return,f)}try{ru(5,t,t.return)}catch(f){on(t,t.return,f)}}break;case 1:Ni(e,t),Qi(t),r&512&&n!==null&&qc(n,n.return);break;case 5:if(Ni(e,t),Qi(t),r&512&&n!==null&&qc(n,n.return),t.flags&32){var i=t.stateNode;try{yu(i,"")}catch(f){on(t,t.return,f)}}if(r&4&&(i=t.stateNode,i!=null)){var o=t.memoizedProps,s=n!==null?n.memoizedProps:o,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&Ck(i,o),lT(a,s);var d=lT(a,o);for(s=0;s<c.length;s+=2){var l=c[s],u=c[s+1];l==="style"?bk(i,u):l==="dangerouslySetInnerHTML"?Ak(i,u):l==="children"?yu(i,u):Ty(i,l,u,d)}switch(a){case"input":oT(i,o);break;case"textarea":Ik(i,o);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var p=o.value;p!=null?cd(i,!!o.multiple,p,!1):h!==!!o.multiple&&(o.defaultValue!=null?cd(i,!!o.multiple,o.defaultValue,!0):cd(i,!!o.multiple,o.multiple?[]:"",!1))}i[Pu]=o}catch(f){on(t,t.return,f)}}break;case 6:if(Ni(e,t),Qi(t),r&4){if(t.stateNode===null)throw Error(nt(162));i=t.stateNode,o=t.memoizedProps;try{i.nodeValue=o}catch(f){on(t,t.return,f)}}break;case 3:if(Ni(e,t),Qi(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{wu(e.containerInfo)}catch(f){on(t,t.return,f)}break;case 4:Ni(e,t),Qi(t);break;case 13:Ni(e,t),Qi(t),i=t.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(Zy=hn())),r&4&&kI(t);break;case 22:if(l=n!==null&&n.memoizedState!==null,t.mode&1?(Jn=(d=Jn)||l,Ni(e,t),Jn=d):Ni(e,t),Qi(t),r&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!l&&t.mode&1)for(ut=t,l=t.child;l!==null;){for(u=ut=l;ut!==null;){switch(h=ut,p=h.child,h.tag){case 0:case 11:case 14:case 15:ru(4,h,h.return);break;case 1:qc(h,h.return);var S=h.stateNode;if(typeof S.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,S.props=e.memoizedProps,S.state=e.memoizedState,S.componentWillUnmount()}catch(f){on(r,n,f)}}break;case 5:qc(h,h.return);break;case 22:if(h.memoizedState!==null){MI(u);continue}}p!==null?(p.return=h,ut=p):MI(u)}l=l.sibling}t:for(l=null,u=t;;){if(u.tag===5){if(l===null){l=u;try{i=u.stateNode,d?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=u.stateNode,c=u.memoizedProps.style,s=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=Ok("display",s))}catch(f){on(t,t.return,f)}}}else if(u.tag===6){if(l===null)try{u.stateNode.nodeValue=d?"":u.memoizedProps}catch(f){on(t,t.return,f)}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===t)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===t)break t;for(;u.sibling===null;){if(u.return===null||u.return===t)break t;l===u&&(l=null),u=u.return}l===u&&(l=null),u.sibling.return=u.return,u=u.sibling}}break;case 19:Ni(e,t),Qi(t),r&4&&kI(t);break;case 21:break;default:Ni(e,t),Qi(t)}}function Qi(t){var e=t.flags;if(e&2){try{t:{for(var n=t.return;n!==null;){if(tM(n)){var r=n;break t}n=n.return}throw Error(nt(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(yu(i,""),r.flags&=-33);var o=DI(t);jT(t,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,a=DI(t);FT(t,a,s);break;default:throw Error(nt(161))}}catch(c){on(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function v3(t,e,n){ut=t,rM(t)}function rM(t,e,n){for(var r=(t.mode&1)!==0;ut!==null;){var i=ut,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||Xh;if(!s){var a=i.alternate,c=a!==null&&a.memoizedState!==null||Jn;a=Xh;var d=Jn;if(Xh=s,(Jn=c)&&!d)for(ut=i;ut!==null;)s=ut,c=s.child,s.tag===22&&s.memoizedState!==null?UI(i):c!==null?(c.return=s,ut=c):UI(i);for(;o!==null;)ut=o,rM(o),o=o.sibling;ut=i,Xh=a,Jn=d}LI(t)}else i.subtreeFlags&8772&&o!==null?(o.return=i,ut=o):LI(t)}}function LI(t){for(;ut!==null;){var e=ut;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Jn||e_(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Jn)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:xi(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&gI(e,o,r);break;case 3:var s=e.updateQueue;if(s!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}gI(e,s,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var l=d.memoizedState;if(l!==null){var u=l.dehydrated;u!==null&&wu(u)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(nt(163))}Jn||e.flags&512&&VT(e)}catch(h){on(e,e.return,h)}}if(e===t){ut=null;break}if(n=e.sibling,n!==null){n.return=e.return,ut=n;break}ut=e.return}}function MI(t){for(;ut!==null;){var e=ut;if(e===t){ut=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ut=n;break}ut=e.return}}function UI(t){for(;ut!==null;){var e=ut;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{e_(4,e)}catch(c){on(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(c){on(e,i,c)}}var o=e.return;try{VT(e)}catch(c){on(e,o,c)}break;case 5:var s=e.return;try{VT(e)}catch(c){on(e,s,c)}}}catch(c){on(e,e.return,c)}if(e===t){ut=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ut=a;break}ut=e.return}}var y3=Math.ceil,im=es.ReactCurrentDispatcher,Xy=es.ReactCurrentOwner,yi=es.ReactCurrentBatchConfig,ie=0,Ln=null,En=null,jn=0,Fr=0,Jc=ta(0),In=0,xu=null,Ja=0,n_=0,Qy=0,iu=null,Er=null,Zy=0,Nd=1/0,Vo=null,om=!1,BT=null,Vs=null,Qh=!1,ws=null,sm=0,ou=0,GT=null,sf=-1,af=0;function cr(){return ie&6?hn():sf!==-1?sf:sf=hn()}function Fs(t){return t.mode&1?ie&2&&jn!==0?jn&-jn:o3.transition!==null?(af===0&&(af=Bk()),af):(t=ye,t!==0||(t=window.event,t=t===void 0?16:$k(t.type)),t):1}function Wi(t,e,n,r){if(50<ou)throw ou=0,GT=null,Error(nt(185));mh(t,n,r),(!(ie&2)||t!==Ln)&&(t===Ln&&(!(ie&2)&&(n_|=n),In===4&&vs(t,jn)),Ar(t,r),n===1&&ie===0&&!(e.mode&1)&&(Nd=hn()+500,Qm&&ea()))}function Ar(t,e){var n=t.callbackNode;oB(t,e);var r=Wf(t,t===Ln?jn:0);if(r===0)n!==null&&KC(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&KC(n),e===1)t.tag===0?i3(xI.bind(null,t)):pL(xI.bind(null,t)),t3(function(){!(ie&6)&&ea()}),n=null;else{switch(Gk(r)){case 1:n=Iy;break;case 4:n=Fk;break;case 16:n=Gf;break;case 536870912:n=jk;break;default:n=Gf}n=uM(n,iM.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function iM(t,e){if(sf=-1,af=0,ie&6)throw Error(nt(327));var n=t.callbackNode;if(pd()&&t.callbackNode!==n)return null;var r=Wf(t,t===Ln?jn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=am(t,r);else{e=r;var i=ie;ie|=2;var o=sM();(Ln!==t||jn!==e)&&(Vo=null,Nd=hn()+500,Fa(t,e));do try{I3();break}catch(a){oM(t,a)}while(!0);Vy(),im.current=o,ie=i,En!==null?e=0:(Ln=null,jn=0,e=In)}if(e!==0){if(e===2&&(i=mT(t),i!==0&&(r=i,e=WT(t,i))),e===1)throw n=xu,Fa(t,0),vs(t,r),Ar(t,hn()),n;if(e===6)vs(t,r);else{if(i=t.current.alternate,!(r&30)&&!R3(i)&&(e=am(t,r),e===2&&(o=mT(t),o!==0&&(r=o,e=WT(t,o))),e===1))throw n=xu,Fa(t,0),vs(t,r),Ar(t,hn()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(nt(345));case 2:Ea(t,Er,Vo);break;case 3:if(vs(t,r),(r&130023424)===r&&(e=Zy+500-hn(),10<e)){if(Wf(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){cr(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=RT(Ea.bind(null,t,Er,Vo),e);break}Ea(t,Er,Vo);break;case 4:if(vs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var s=31-Gi(r);o=1<<s,s=e[s],s>i&&(i=s),r&=~o}if(r=i,r=hn()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*y3(r/1960))-r,10<r){t.timeoutHandle=RT(Ea.bind(null,t,Er,Vo),r);break}Ea(t,Er,Vo);break;case 5:Ea(t,Er,Vo);break;default:throw Error(nt(329))}}}return Ar(t,hn()),t.callbackNode===n?iM.bind(null,t):null}function WT(t,e){var n=iu;return t.current.memoizedState.isDehydrated&&(Fa(t,e).flags|=256),t=am(t,e),t!==2&&(e=Er,Er=n,e!==null&&HT(e)),t}function HT(t){Er===null?Er=t:Er.push.apply(Er,t)}function R3(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!Ki(o(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function vs(t,e){for(e&=~Qy,e&=~n_,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Gi(e),r=1<<n;t[n]=-1,e&=~r}}function xI(t){if(ie&6)throw Error(nt(327));pd();var e=Wf(t,0);if(!(e&1))return Ar(t,hn()),null;var n=am(t,e);if(t.tag!==0&&n===2){var r=mT(t);r!==0&&(e=r,n=WT(t,r))}if(n===1)throw n=xu,Fa(t,0),vs(t,e),Ar(t,hn()),n;if(n===6)throw Error(nt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Ea(t,Er,Vo),Ar(t,hn()),null}function tR(t,e){var n=ie;ie|=1;try{return t(e)}finally{ie=n,ie===0&&(Nd=hn()+500,Qm&&ea())}}function Xa(t){ws!==null&&ws.tag===0&&!(ie&6)&&pd();var e=ie;ie|=1;var n=yi.transition,r=ye;try{if(yi.transition=null,ye=1,t)return t()}finally{ye=r,yi.transition=n,ie=e,!(ie&6)&&ea()}}function eR(){Fr=Jc.current,Fe(Jc)}function Fa(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,ZB(n)),En!==null)for(n=En.return;n!==null;){var r=n;switch(My(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&$f();break;case 3:Od(),Fe(Ir),Fe(Xn),Hy();break;case 5:Wy(r);break;case 4:Od();break;case 13:Fe(ze);break;case 19:Fe(ze);break;case 10:Fy(r.type._context);break;case 22:case 23:eR()}n=n.return}if(Ln=t,En=t=js(t.current,null),jn=Fr=e,In=0,xu=null,Qy=n_=Ja=0,Er=iu=null,Oa!==null){for(e=0;e<Oa.length;e++)if(n=Oa[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,o=n.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}n.pending=r}Oa=null}return t}function oM(t,e){do{var n=En;try{if(Vy(),nf.current=rm,nm){for(var r=qe.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}nm=!1}if(qa=0,bn=Rn=qe=null,nu=!1,Lu=0,Xy.current=null,n===null||n.return===null){In=1,xu=e,En=null;break}t:{var o=t,s=n.return,a=n,c=e;if(e=jn,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,l=a,u=l.tag;if(!(l.mode&1)&&(u===0||u===11||u===15)){var h=l.alternate;h?(l.updateQueue=h.updateQueue,l.memoizedState=h.memoizedState,l.lanes=h.lanes):(l.updateQueue=null,l.memoizedState=null)}var p=CI(s);if(p!==null){p.flags&=-257,II(p,s,a,o,e),p.mode&1&&RI(o,d,e),e=p,c=d;var S=e.updateQueue;if(S===null){var f=new Set;f.add(c),e.updateQueue=f}else S.add(c);break t}else{if(!(e&1)){RI(o,d,e),nR();break t}c=Error(nt(426))}}else if(Ge&&a.mode&1){var _=CI(s);if(_!==null){!(_.flags&65536)&&(_.flags|=256),II(_,s,a,o,e),Uy(bd(c,a));break t}}o=c=bd(c,a),In!==4&&(In=2),iu===null?iu=[o]:iu.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var T=GL(o,c,e);EI(o,T);break t;case 1:a=c;var g=o.type,y=o.stateNode;if(!(o.flags&128)&&(typeof g.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Vs===null||!Vs.has(y)))){o.flags|=65536,e&=-e,o.lanes|=e;var I=WL(o,a,e);EI(o,I);break t}}o=o.return}while(o!==null)}cM(n)}catch(O){e=O,En===n&&n!==null&&(En=n=n.return);continue}break}while(!0)}function sM(){var t=im.current;return im.current=rm,t===null?rm:t}function nR(){(In===0||In===3||In===2)&&(In=4),Ln===null||!(Ja&268435455)&&!(n_&268435455)||vs(Ln,jn)}function am(t,e){var n=ie;ie|=2;var r=sM();(Ln!==t||jn!==e)&&(Vo=null,Fa(t,e));do try{C3();break}catch(i){oM(t,i)}while(!0);if(Vy(),ie=n,im.current=r,En!==null)throw Error(nt(261));return Ln=null,jn=0,In}function C3(){for(;En!==null;)aM(En)}function I3(){for(;En!==null&&!Jj();)aM(En)}function aM(t){var e=lM(t.alternate,t,Fr);t.memoizedProps=t.pendingProps,e===null?cM(t):En=e,Xy.current=null}function cM(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=g3(n,e),n!==null){n.flags&=32767,En=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{In=6,En=null;return}}else if(n=E3(n,e,Fr),n!==null){En=n;return}if(e=e.sibling,e!==null){En=e;return}En=e=t}while(e!==null);In===0&&(In=5)}function Ea(t,e,n){var r=ye,i=yi.transition;try{yi.transition=null,ye=1,w3(t,e,n,r)}finally{yi.transition=i,ye=r}return null}function w3(t,e,n,r){do pd();while(ws!==null);if(ie&6)throw Error(nt(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(nt(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(sB(t,o),t===Ln&&(En=Ln=null,jn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Qh||(Qh=!0,uM(Gf,function(){return pd(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=yi.transition,yi.transition=null;var s=ye;ye=1;var a=ie;ie|=4,Xy.current=null,T3(t,n),nM(n,t),zB(vT),Hf=!!TT,vT=TT=null,t.current=n,v3(n),Xj(),ie=a,ye=s,yi.transition=o}else t.current=n;if(Qh&&(Qh=!1,ws=t,sm=i),o=t.pendingLanes,o===0&&(Vs=null),tB(n.stateNode),Ar(t,hn()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(om)throw om=!1,t=BT,BT=null,t;return sm&1&&t.tag!==0&&pd(),o=t.pendingLanes,o&1?t===GT?ou++:(ou=0,GT=t):ou=0,ea(),null}function pd(){if(ws!==null){var t=Gk(sm),e=yi.transition,n=ye;try{if(yi.transition=null,ye=16>t?16:t,ws===null)var r=!1;else{if(t=ws,ws=null,sm=0,ie&6)throw Error(nt(331));var i=ie;for(ie|=4,ut=t.current;ut!==null;){var o=ut,s=o.child;if(ut.flags&16){var a=o.deletions;if(a!==null){for(var c=0;c<a.length;c++){var d=a[c];for(ut=d;ut!==null;){var l=ut;switch(l.tag){case 0:case 11:case 15:ru(8,l,o)}var u=l.child;if(u!==null)u.return=l,ut=u;else for(;ut!==null;){l=ut;var h=l.sibling,p=l.return;if(ZL(l),l===d){ut=null;break}if(h!==null){h.return=p,ut=h;break}ut=p}}}var S=o.alternate;if(S!==null){var f=S.child;if(f!==null){S.child=null;do{var _=f.sibling;f.sibling=null,f=_}while(f!==null)}}ut=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,ut=s;else t:for(;ut!==null;){if(o=ut,o.flags&2048)switch(o.tag){case 0:case 11:case 15:ru(9,o,o.return)}var T=o.sibling;if(T!==null){T.return=o.return,ut=T;break t}ut=o.return}}var g=t.current;for(ut=g;ut!==null;){s=ut;var y=s.child;if(s.subtreeFlags&2064&&y!==null)y.return=s,ut=y;else t:for(s=g;ut!==null;){if(a=ut,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:e_(9,a)}}catch(O){on(a,a.return,O)}if(a===s){ut=null;break t}var I=a.sibling;if(I!==null){I.return=a.return,ut=I;break t}ut=a.return}}if(ie=i,ea(),Eo&&typeof Eo.onPostCommitFiberRoot=="function")try{Eo.onPostCommitFiberRoot(Ym,t)}catch{}r=!0}return r}finally{ye=n,yi.transition=e}}return!1}function VI(t,e,n){e=bd(n,e),e=GL(t,e,1),t=xs(t,e,1),e=cr(),t!==null&&(mh(t,1,e),Ar(t,e))}function on(t,e,n){if(t.tag===3)VI(t,t,n);else for(;e!==null;){if(e.tag===3){VI(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Vs===null||!Vs.has(r))){t=bd(n,t),t=WL(e,t,1),e=xs(e,t,1),t=cr(),e!==null&&(mh(e,1,t),Ar(e,t));break}}e=e.return}}function A3(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=cr(),t.pingedLanes|=t.suspendedLanes&n,Ln===t&&(jn&n)===n&&(In===4||In===3&&(jn&130023424)===jn&&500>hn()-Zy?Fa(t,0):Qy|=n),Ar(t,e)}function dM(t,e){e===0&&(t.mode&1?(e=Gh,Gh<<=1,!(Gh&130023424)&&(Gh=4194304)):e=1);var n=cr();t=Qo(t,e),t!==null&&(mh(t,e,n),Ar(t,n))}function O3(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),dM(t,n)}function b3(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(nt(314))}r!==null&&r.delete(e),dM(t,n)}var lM;lM=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ir.current)yr=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return yr=!1,_3(t,e,n);yr=!!(t.flags&131072)}else yr=!1,Ge&&e.flags&1048576&&fL(e,Xf,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;of(t,e),t=e.pendingProps;var i=Id(e,Xn.current);hd(e,n),i=zy(null,e,r,t,i,n);var o=Yy();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,wr(r)?(o=!0,qf(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,By(e),i.updater=t_,e.stateNode=i,i._reactInternals=e,NT(e,r,t,n),e=kT(null,e,r,!0,o,n)):(e.tag=0,Ge&&o&&Ly(e),ir(null,e,i,n),e=e.child),e;case 16:r=e.elementType;t:{switch(of(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=P3(r),t=xi(r,t),i){case 0:e=DT(null,e,r,t,n);break t;case 1:e=OI(null,e,r,t,n);break t;case 11:e=wI(null,e,r,t,n);break t;case 14:e=AI(null,e,r,xi(r.type,t),n);break t}throw Error(nt(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:xi(r,i),DT(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:xi(r,i),OI(t,e,r,i,n);case 3:t:{if(YL(e),t===null)throw Error(nt(387));r=e.pendingProps,o=e.memoizedState,i=o.element,TL(t,e),tm(e,r,null,n);var s=e.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=bd(Error(nt(423)),e),e=bI(t,e,r,n,i);break t}else if(r!==i){i=bd(Error(nt(424)),e),e=bI(t,e,r,n,i);break t}else for(Gr=Us(e.stateNode.containerInfo.firstChild),Yr=e,Ge=!0,ji=null,n=gL(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(wd(),r===i){e=Zo(t,e,n);break t}ir(t,e,r,n)}e=e.child}return e;case 5:return vL(e),t===null&&AT(e),r=e.type,i=e.pendingProps,o=t!==null?t.memoizedProps:null,s=i.children,yT(r,i)?s=null:o!==null&&yT(r,o)&&(e.flags|=32),zL(t,e),ir(t,e,s,n),e.child;case 6:return t===null&&AT(e),null;case 13:return $L(t,e,n);case 4:return Gy(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ad(e,null,r,n):ir(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:xi(r,i),wI(t,e,r,i,n);case 7:return ir(t,e,e.pendingProps,n),e.child;case 8:return ir(t,e,e.pendingProps.children,n),e.child;case 12:return ir(t,e,e.pendingProps.children,n),e.child;case 10:t:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,ke(Qf,r._currentValue),r._currentValue=s,o!==null)if(Ki(o.value,s)){if(o.children===i.children&&!Ir.current){e=Zo(t,e,n);break t}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(o.tag===1){c=$o(-1,n&-n),c.tag=2;var d=o.updateQueue;if(d!==null){d=d.shared;var l=d.pending;l===null?c.next=c:(c.next=l.next,l.next=c),d.pending=c}}o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),OT(o.return,n,e),a.lanes|=n;break}c=c.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(nt(341));s.lanes|=n,a=s.alternate,a!==null&&(a.lanes|=n),OT(s,n,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}ir(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,hd(e,n),i=Ci(i),r=r(i),e.flags|=1,ir(t,e,r,n),e.child;case 14:return r=e.type,i=xi(r,e.pendingProps),i=xi(r.type,i),AI(t,e,r,i,n);case 15:return HL(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:xi(r,i),of(t,e),e.tag=1,wr(r)?(t=!0,qf(e)):t=!1,hd(e,n),BL(e,r,i),NT(e,r,i,n),kT(null,e,r,!0,t,n);case 19:return qL(t,e,n);case 22:return KL(t,e,n)}throw Error(nt(156,e.tag))};function uM(t,e){return Vk(t,e)}function N3(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ti(t,e,n,r){return new N3(t,e,n,r)}function rR(t){return t=t.prototype,!(!t||!t.isReactComponent)}function P3(t){if(typeof t=="function")return rR(t)?1:0;if(t!=null){if(t=t.$$typeof,t===yy)return 11;if(t===Ry)return 14}return 2}function js(t,e){var n=t.alternate;return n===null?(n=Ti(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function cf(t,e,n,r,i,o){var s=2;if(r=t,typeof t=="function")rR(t)&&(s=1);else if(typeof t=="string")s=5;else t:switch(t){case jc:return ja(n.children,i,o,e);case vy:s=8,i|=8;break;case tT:return t=Ti(12,n,e,i|2),t.elementType=tT,t.lanes=o,t;case eT:return t=Ti(13,n,e,i),t.elementType=eT,t.lanes=o,t;case nT:return t=Ti(19,n,e,i),t.elementType=nT,t.lanes=o,t;case vk:return r_(n,i,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Sk:s=10;break t;case Tk:s=9;break t;case yy:s=11;break t;case Ry:s=14;break t;case gs:s=16,r=null;break t}throw Error(nt(130,t==null?t:typeof t,""))}return e=Ti(s,n,e,i),e.elementType=t,e.type=r,e.lanes=o,e}function ja(t,e,n,r){return t=Ti(7,t,r,e),t.lanes=n,t}function r_(t,e,n,r){return t=Ti(22,t,r,e),t.elementType=vk,t.lanes=n,t.stateNode={isHidden:!1},t}function TE(t,e,n){return t=Ti(6,t,null,e),t.lanes=n,t}function vE(t,e,n){return e=Ti(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function D3(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=eE(0),this.expirationTimes=eE(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eE(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function iR(t,e,n,r,i,o,s,a,c){return t=new D3(t,e,n,a,c),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Ti(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},By(o),t}function k3(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Fc,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function hM(t){if(!t)return qs;t=t._reactInternals;t:{if(sc(t)!==t||t.tag!==1)throw Error(nt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break t;case 1:if(wr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break t}}e=e.return}while(e!==null);throw Error(nt(171))}if(t.tag===1){var n=t.type;if(wr(n))return hL(t,n,e)}return e}function pM(t,e,n,r,i,o,s,a,c){return t=iR(n,r,!0,t,i,o,s,a,c),t.context=hM(null),n=t.current,r=cr(),i=Fs(n),o=$o(r,i),o.callback=e??null,xs(n,o,i),t.current.lanes=i,mh(t,i,r),Ar(t,r),t}function i_(t,e,n,r){var i=e.current,o=cr(),s=Fs(i);return n=hM(n),e.context===null?e.context=n:e.pendingContext=n,e=$o(o,s),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=xs(i,e,s),t!==null&&(Wi(t,i,s,o),ef(t,i,s)),s}function cm(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function FI(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function oR(t,e){FI(t,e),(t=t.alternate)&&FI(t,e)}function L3(){return null}var fM=typeof reportError=="function"?reportError:function(t){console.error(t)};function sR(t){this._internalRoot=t}o_.prototype.render=sR.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(nt(409));i_(t,e,null,null)};o_.prototype.unmount=sR.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Xa(function(){i_(null,t,null,null)}),e[Xo]=null}};function o_(t){this._internalRoot=t}o_.prototype.unstable_scheduleHydration=function(t){if(t){var e=Kk();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ts.length&&e!==0&&e<Ts[n].priority;n++);Ts.splice(n,0,t),n===0&&Yk(t)}};function aR(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function s_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function jI(){}function M3(t,e,n,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var d=cm(s);o.call(d)}}var s=pM(e,r,t,0,null,!1,!1,"",jI);return t._reactRootContainer=s,t[Xo]=s.current,bu(t.nodeType===8?t.parentNode:t),Xa(),s}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var d=cm(c);a.call(d)}}var c=iR(t,0,!1,null,null,!1,!1,"",jI);return t._reactRootContainer=c,t[Xo]=c.current,bu(t.nodeType===8?t.parentNode:t),Xa(function(){i_(e,c,n,r)}),c}function a_(t,e,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var c=cm(s);a.call(c)}}i_(e,s,t,i)}else s=M3(n,e,t,i,r);return cm(s)}Wk=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ul(e.pendingLanes);n!==0&&(wy(e,n|1),Ar(e,hn()),!(ie&6)&&(Nd=hn()+500,ea()))}break;case 13:Xa(function(){var r=Qo(t,1);if(r!==null){var i=cr();Wi(r,t,1,i)}}),oR(t,1)}};Ay=function(t){if(t.tag===13){var e=Qo(t,134217728);if(e!==null){var n=cr();Wi(e,t,134217728,n)}oR(t,134217728)}};Hk=function(t){if(t.tag===13){var e=Fs(t),n=Qo(t,e);if(n!==null){var r=cr();Wi(n,t,e,r)}oR(t,e)}};Kk=function(){return ye};zk=function(t,e){var n=ye;try{return ye=t,e()}finally{ye=n}};hT=function(t,e,n){switch(e){case"input":if(oT(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Xm(r);if(!i)throw Error(nt(90));Rk(r),oT(r,i)}}}break;case"textarea":Ik(t,n);break;case"select":e=n.value,e!=null&&cd(t,!!n.multiple,e,!1)}};Dk=tR;kk=Xa;var U3={usingClientEntryPoint:!1,Events:[Eh,Hc,Xm,Nk,Pk,tR]},gl={findFiberByHostInstance:Aa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},x3={bundleType:gl.bundleType,version:gl.version,rendererPackageName:gl.rendererPackageName,rendererConfig:gl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:es.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Uk(t),t===null?null:t.stateNode},findFiberByHostInstance:gl.findFiberByHostInstance||L3,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zh.isDisabled&&Zh.supportsFiber)try{Ym=Zh.inject(x3),Eo=Zh}catch{}}Jr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=U3;Jr.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!aR(e))throw Error(nt(200));return k3(t,e,null,n)};Jr.createRoot=function(t,e){if(!aR(t))throw Error(nt(299));var n=!1,r="",i=fM;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=iR(t,1,!1,null,null,n,!1,r,i),t[Xo]=e.current,bu(t.nodeType===8?t.parentNode:t),new sR(e)};Jr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(nt(188)):(t=Object.keys(t).join(","),Error(nt(268,t)));return t=Uk(e),t=t===null?null:t.stateNode,t};Jr.flushSync=function(t){return Xa(t)};Jr.hydrate=function(t,e,n){if(!s_(e))throw Error(nt(200));return a_(null,t,e,!0,n)};Jr.hydrateRoot=function(t,e,n){if(!aR(t))throw Error(nt(405));var r=n!=null&&n.hydratedSources||null,i=!1,o="",s=fM;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(s=n.onRecoverableError)),e=pM(e,null,t,1,n??null,i,!1,o,s),t[Xo]=e.current,bu(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new o_(e)};Jr.render=function(t,e,n){if(!s_(e))throw Error(nt(200));return a_(null,t,e,!1,n)};Jr.unmountComponentAtNode=function(t){if(!s_(t))throw Error(nt(40));return t._reactRootContainer?(Xa(function(){a_(null,null,t,!1,function(){t._reactRootContainer=null,t[Xo]=null})}),!0):!1};Jr.unstable_batchedUpdates=tR;Jr.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!s_(n))throw Error(nt(200));if(t==null||t._reactInternals===void 0)throw Error(nt(38));return a_(t,e,n,!1,r)};Jr.version="18.3.1-next-f1338f8080-20240426";function mM(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(mM)}catch(t){console.error(t)}}mM(),mk.exports=Jr;var V3=mk.exports,BI=V3;QS.createRoot=BI.createRoot,QS.hydrateRoot=BI.hydrateRoot;/**
 * @remix-run/router v1.19.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Vu(){return Vu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Vu.apply(this,arguments)}var As;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(As||(As={}));const GI="popstate";function F3(t){t===void 0&&(t={});function e(i,o){let{pathname:s="/",search:a="",hash:c=""}=ac(i.location.hash.substr(1));return!s.startsWith("/")&&!s.startsWith(".")&&(s="/"+s),KT("",{pathname:s,search:a,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function n(i,o){let s=i.document.querySelector("base"),a="";if(s&&s.getAttribute("href")){let c=i.location.href,d=c.indexOf("#");a=d===-1?c:c.slice(0,d)}return a+"#"+(typeof o=="string"?o:dm(o))}function r(i,o){cR(i.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(o)+")")}return B3(e,n,r,t)}function gn(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function cR(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function j3(){return Math.random().toString(36).substr(2,8)}function WI(t,e){return{usr:t.state,key:t.key,idx:e}}function KT(t,e,n,r){return n===void 0&&(n=null),Vu({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?ac(e):e,{state:n,key:e&&e.key||r||j3()})}function dm(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function ac(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function B3(t,e,n,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:o=!1}=r,s=i.history,a=As.Pop,c=null,d=l();d==null&&(d=0,s.replaceState(Vu({},s.state,{idx:d}),""));function l(){return(s.state||{idx:null}).idx}function u(){a=As.Pop;let _=l(),T=_==null?null:_-d;d=_,c&&c({action:a,location:f.location,delta:T})}function h(_,T){a=As.Push;let g=KT(f.location,_,T);n&&n(g,_),d=l()+1;let y=WI(g,d),I=f.createHref(g);try{s.pushState(y,"",I)}catch(O){if(O instanceof DOMException&&O.name==="DataCloneError")throw O;i.location.assign(I)}o&&c&&c({action:a,location:f.location,delta:1})}function p(_,T){a=As.Replace;let g=KT(f.location,_,T);n&&n(g,_),d=l();let y=WI(g,d),I=f.createHref(g);s.replaceState(y,"",I),o&&c&&c({action:a,location:f.location,delta:0})}function S(_){let T=i.location.origin!=="null"?i.location.origin:i.location.href,g=typeof _=="string"?_:dm(_);return g=g.replace(/ $/,"%20"),gn(T,"No window.location.(origin|href) available to create URL for href: "+g),new URL(g,T)}let f={get action(){return a},get location(){return t(i,s)},listen(_){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(GI,u),c=_,()=>{i.removeEventListener(GI,u),c=null}},createHref(_){return e(i,_)},createURL:S,encodeLocation(_){let T=S(_);return{pathname:T.pathname,search:T.search,hash:T.hash}},push:h,replace:p,go(_){return s.go(_)}};return f}var HI;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(HI||(HI={}));function G3(t,e,n){return n===void 0&&(n="/"),W3(t,e,n,!1)}function W3(t,e,n,r){let i=typeof e=="string"?ac(e):e,o=dR(i.pathname||"/",n);if(o==null)return null;let s=_M(t);H3(s);let a=null;for(let c=0;a==null&&c<s.length;++c){let d=e4(o);a=Z3(s[c],d,r)}return a}function _M(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let i=(o,s,a)=>{let c={relativePath:a===void 0?o.path||"":a,caseSensitive:o.caseSensitive===!0,childrenIndex:s,route:o};c.relativePath.startsWith("/")&&(gn(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let d=Bs([r,c.relativePath]),l=n.concat(c);o.children&&o.children.length>0&&(gn(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),_M(o.children,e,l,d)),!(o.path==null&&!o.index)&&e.push({path:d,score:X3(d,o.index),routesMeta:l})};return t.forEach((o,s)=>{var a;if(o.path===""||!((a=o.path)!=null&&a.includes("?")))i(o,s);else for(let c of EM(o.path))i(o,s,c)}),e}function EM(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let s=EM(r.join("/")),a=[];return a.push(...s.map(c=>c===""?o:[o,c].join("/"))),i&&a.push(...s),a.map(c=>t.startsWith("/")&&c===""?"/":c)}function H3(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:Q3(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const K3=/^:[\w-]+$/,z3=3,Y3=2,$3=1,q3=10,J3=-2,KI=t=>t==="*";function X3(t,e){let n=t.split("/"),r=n.length;return n.some(KI)&&(r+=J3),e&&(r+=Y3),n.filter(i=>!KI(i)).reduce((i,o)=>i+(K3.test(o)?z3:o===""?$3:q3),r)}function Q3(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function Z3(t,e,n){let{routesMeta:r}=t,i={},o="/",s=[];for(let a=0;a<r.length;++a){let c=r[a],d=a===r.length-1,l=o==="/"?e:e.slice(o.length)||"/",u=zI({path:c.relativePath,caseSensitive:c.caseSensitive,end:d},l),h=c.route;if(!u&&d&&n&&!r[r.length-1].route.index&&(u=zI({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},l)),!u)return null;Object.assign(i,u.params),s.push({params:i,pathname:Bs([o,u.pathname]),pathnameBase:o4(Bs([o,u.pathnameBase])),route:h}),u.pathnameBase!=="/"&&(o=Bs([o,u.pathnameBase]))}return s}function zI(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=t4(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let o=i[0],s=o.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((d,l,u)=>{let{paramName:h,isOptional:p}=l;if(h==="*"){let f=a[u]||"";s=o.slice(0,o.length-f.length).replace(/(.)\/+$/,"$1")}const S=a[u];return p&&!S?d[h]=void 0:d[h]=(S||"").replace(/%2F/g,"/"),d},{}),pathname:o,pathnameBase:s,pattern:t}}function t4(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),cR(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,a,c)=>(r.push({paramName:a,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function e4(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return cR(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function dR(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function n4(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?ac(t):t;return{pathname:n?n.startsWith("/")?n:r4(n,e):e,search:s4(r),hash:a4(i)}}function r4(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function yE(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function i4(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function gM(t,e){let n=i4(t);return e?n.map((r,i)=>i===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function SM(t,e,n,r){r===void 0&&(r=!1);let i;typeof t=="string"?i=ac(t):(i=Vu({},t),gn(!i.pathname||!i.pathname.includes("?"),yE("?","pathname","search",i)),gn(!i.pathname||!i.pathname.includes("#"),yE("#","pathname","hash",i)),gn(!i.search||!i.search.includes("#"),yE("#","search","hash",i)));let o=t===""||i.pathname==="",s=o?"/":i.pathname,a;if(s==null)a=n;else{let u=e.length-1;if(!r&&s.startsWith("..")){let h=s.split("/");for(;h[0]==="..";)h.shift(),u-=1;i.pathname=h.join("/")}a=u>=0?e[u]:"/"}let c=n4(i,a),d=s&&s!=="/"&&s.endsWith("/"),l=(o||s===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(d||l)&&(c.pathname+="/"),c}const Bs=t=>t.join("/").replace(/\/\/+/g,"/"),o4=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),s4=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,a4=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function c4(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const TM=["post","put","patch","delete"];new Set(TM);const d4=["get",...TM];new Set(d4);/**
 * React Router v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Fu(){return Fu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Fu.apply(this,arguments)}const lR=z.createContext(null),l4=z.createContext(null),cc=z.createContext(null),c_=z.createContext(null),na=z.createContext({outlet:null,matches:[],isDataRoute:!1}),vM=z.createContext(null);function u4(t,e){let{relative:n}=e===void 0?{}:e;Sh()||gn(!1);let{basename:r,navigator:i}=z.useContext(cc),{hash:o,pathname:s,search:a}=CM(t,{relative:n}),c=s;return r!=="/"&&(c=s==="/"?r:Bs([r,s])),i.createHref({pathname:c,search:a,hash:o})}function Sh(){return z.useContext(c_)!=null}function Kd(){return Sh()||gn(!1),z.useContext(c_).location}function yM(t){z.useContext(cc).static||z.useLayoutEffect(t)}function Ro(){let{isDataRoute:t}=z.useContext(na);return t?C4():h4()}function h4(){Sh()||gn(!1);let t=z.useContext(lR),{basename:e,future:n,navigator:r}=z.useContext(cc),{matches:i}=z.useContext(na),{pathname:o}=Kd(),s=JSON.stringify(gM(i,n.v7_relativeSplatPath)),a=z.useRef(!1);return yM(()=>{a.current=!0}),z.useCallback(function(d,l){if(l===void 0&&(l={}),!a.current)return;if(typeof d=="number"){r.go(d);return}let u=SM(d,JSON.parse(s),o,l.relative==="path");t==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:Bs([e,u.pathname])),(l.replace?r.replace:r.push)(u,l.state,l)},[e,r,s,o,t])}function RM(){let{matches:t}=z.useContext(na),e=t[t.length-1];return e?e.params:{}}function CM(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=z.useContext(cc),{matches:i}=z.useContext(na),{pathname:o}=Kd(),s=JSON.stringify(gM(i,r.v7_relativeSplatPath));return z.useMemo(()=>SM(t,JSON.parse(s),o,n==="path"),[t,s,o,n])}function p4(t,e){return f4(t,e)}function f4(t,e,n,r){Sh()||gn(!1);let{navigator:i}=z.useContext(cc),{matches:o}=z.useContext(na),s=o[o.length-1],a=s?s.params:{};s&&s.pathname;let c=s?s.pathnameBase:"/";s&&s.route;let d=Kd(),l;if(e){var u;let _=typeof e=="string"?ac(e):e;c==="/"||(u=_.pathname)!=null&&u.startsWith(c)||gn(!1),l=_}else l=d;let h=l.pathname||"/",p=h;if(c!=="/"){let _=c.replace(/^\//,"").split("/");p="/"+h.replace(/^\//,"").split("/").slice(_.length).join("/")}let S=G3(t,{pathname:p}),f=S4(S&&S.map(_=>Object.assign({},_,{params:Object.assign({},a,_.params),pathname:Bs([c,i.encodeLocation?i.encodeLocation(_.pathname).pathname:_.pathname]),pathnameBase:_.pathnameBase==="/"?c:Bs([c,i.encodeLocation?i.encodeLocation(_.pathnameBase).pathname:_.pathnameBase])})),o,n,r);return e&&f?z.createElement(c_.Provider,{value:{location:Fu({pathname:"/",search:"",hash:"",state:null,key:"default"},l),navigationType:As.Pop}},f):f}function m4(){let t=R4(),e=c4(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return z.createElement(z.Fragment,null,z.createElement("h2",null,"Unexpected Application Error!"),z.createElement("h3",{style:{fontStyle:"italic"}},e),n?z.createElement("pre",{style:i},n):null,null)}const _4=z.createElement(m4,null);class E4 extends z.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?z.createElement(na.Provider,{value:this.props.routeContext},z.createElement(vM.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function g4(t){let{routeContext:e,match:n,children:r}=t,i=z.useContext(lR);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),z.createElement(na.Provider,{value:e},r)}function S4(t,e,n,r){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var o;if(!n)return null;if(n.errors)t=n.matches;else if((o=r)!=null&&o.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let s=t,a=(i=n)==null?void 0:i.errors;if(a!=null){let l=s.findIndex(u=>u.route.id&&(a==null?void 0:a[u.route.id])!==void 0);l>=0||gn(!1),s=s.slice(0,Math.min(s.length,l+1))}let c=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let l=0;l<s.length;l++){let u=s[l];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(d=l),u.route.id){let{loaderData:h,errors:p}=n,S=u.route.loader&&h[u.route.id]===void 0&&(!p||p[u.route.id]===void 0);if(u.route.lazy||S){c=!0,d>=0?s=s.slice(0,d+1):s=[s[0]];break}}}return s.reduceRight((l,u,h)=>{let p,S=!1,f=null,_=null;n&&(p=a&&u.route.id?a[u.route.id]:void 0,f=u.route.errorElement||_4,c&&(d<0&&h===0?(S=!0,_=null):d===h&&(S=!0,_=u.route.hydrateFallbackElement||null)));let T=e.concat(s.slice(0,h+1)),g=()=>{let y;return p?y=f:S?y=_:u.route.Component?y=z.createElement(u.route.Component,null):u.route.element?y=u.route.element:y=l,z.createElement(g4,{match:u,routeContext:{outlet:l,matches:T,isDataRoute:n!=null},children:y})};return n&&(u.route.ErrorBoundary||u.route.errorElement||h===0)?z.createElement(E4,{location:n.location,revalidation:n.revalidation,component:f,error:p,children:g(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):g()},null)}var IM=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(IM||{}),lm=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(lm||{});function T4(t){let e=z.useContext(lR);return e||gn(!1),e}function v4(t){let e=z.useContext(l4);return e||gn(!1),e}function y4(t){let e=z.useContext(na);return e||gn(!1),e}function wM(t){let e=y4(),n=e.matches[e.matches.length-1];return n.route.id||gn(!1),n.route.id}function R4(){var t;let e=z.useContext(vM),n=v4(lm.UseRouteError),r=wM(lm.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function C4(){let{router:t}=T4(IM.UseNavigateStable),e=wM(lm.UseNavigateStable),n=z.useRef(!1);return yM(()=>{n.current=!0}),z.useCallback(function(i,o){o===void 0&&(o={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,Fu({fromRouteId:e},o)))},[t,e])}function tr(t){gn(!1)}function I4(t){let{basename:e="/",children:n=null,location:r,navigationType:i=As.Pop,navigator:o,static:s=!1,future:a}=t;Sh()&&gn(!1);let c=e.replace(/^\/*/,"/"),d=z.useMemo(()=>({basename:c,navigator:o,static:s,future:Fu({v7_relativeSplatPath:!1},a)}),[c,a,o,s]);typeof r=="string"&&(r=ac(r));let{pathname:l="/",search:u="",hash:h="",state:p=null,key:S="default"}=r,f=z.useMemo(()=>{let _=dR(l,c);return _==null?null:{location:{pathname:_,search:u,hash:h,state:p,key:S},navigationType:i}},[c,l,u,h,p,S,i]);return f==null?null:z.createElement(cc.Provider,{value:d},z.createElement(c_.Provider,{children:n,value:f}))}function w4(t){let{children:e,location:n}=t;return p4(zT(e),n)}new Promise(()=>{});function zT(t,e){e===void 0&&(e=[]);let n=[];return z.Children.forEach(t,(r,i)=>{if(!z.isValidElement(r))return;let o=[...e,i];if(r.type===z.Fragment){n.push.apply(n,zT(r.props.children,o));return}r.type!==tr&&gn(!1),!r.props.index||!r.props.children||gn(!1);let s={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(s.children=zT(r.props.children,o)),n.push(s)}),n}/**
 * React Router DOM v6.26.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function YT(){return YT=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},YT.apply(this,arguments)}function A4(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function O4(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function b4(t,e){return t.button===0&&(!e||e==="_self")&&!O4(t)}const N4=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],P4="6";try{window.__reactRouterVersion=P4}catch{}const D4="startTransition",YI=Aj[D4];function k4(t){let{basename:e,children:n,future:r,window:i}=t,o=z.useRef();o.current==null&&(o.current=F3({window:i,v5Compat:!0}));let s=o.current,[a,c]=z.useState({action:s.action,location:s.location}),{v7_startTransition:d}=r||{},l=z.useCallback(u=>{d&&YI?YI(()=>c(u)):c(u)},[c,d]);return z.useLayoutEffect(()=>s.listen(l),[s,l]),z.createElement(I4,{basename:e,children:n,location:a.location,navigationType:a.action,navigator:s,future:r})}const L4=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",M4=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,U4=z.forwardRef(function(e,n){let{onClick:r,relative:i,reloadDocument:o,replace:s,state:a,target:c,to:d,preventScrollReset:l,unstable_viewTransition:u}=e,h=A4(e,N4),{basename:p}=z.useContext(cc),S,f=!1;if(typeof d=="string"&&M4.test(d)&&(S=d,L4))try{let y=new URL(window.location.href),I=d.startsWith("//")?new URL(y.protocol+d):new URL(d),O=dR(I.pathname,p);I.origin===y.origin&&O!=null?d=O+I.search+I.hash:f=!0}catch{}let _=u4(d,{relative:i}),T=x4(d,{replace:s,state:a,target:c,preventScrollReset:l,relative:i,unstable_viewTransition:u});function g(y){r&&r(y),y.defaultPrevented||T(y)}return z.createElement("a",YT({},h,{href:S||_,onClick:f||o?r:g,ref:n,target:c}))});var $I;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})($I||($I={}));var qI;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(qI||(qI={}));function x4(t,e){let{target:n,replace:r,state:i,preventScrollReset:o,relative:s,unstable_viewTransition:a}=e===void 0?{}:e,c=Ro(),d=Kd(),l=CM(t,{relative:s});return z.useCallback(u=>{if(b4(u,n)){u.preventDefault();let h=r!==void 0?r:dm(d)===dm(l);c(t,{replace:h,state:i,preventScrollReset:o,relative:s,unstable_viewTransition:a})}},[d,c,l,r,i,n,t,o,s,a])}function AM(t,e){return function(){return t.apply(e,arguments)}}const{toString:V4}=Object.prototype,{getPrototypeOf:uR}=Object,d_=(t=>e=>{const n=V4.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Yi=t=>(t=t.toLowerCase(),e=>d_(e)===t),l_=t=>e=>typeof e===t,{isArray:zd}=Array,ju=l_("undefined");function F4(t){return t!==null&&!ju(t)&&t.constructor!==null&&!ju(t.constructor)&&$r(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const OM=Yi("ArrayBuffer");function j4(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&OM(t.buffer),e}const B4=l_("string"),$r=l_("function"),bM=l_("number"),u_=t=>t!==null&&typeof t=="object",G4=t=>t===!0||t===!1,df=t=>{if(d_(t)!=="object")return!1;const e=uR(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},W4=Yi("Date"),H4=Yi("File"),K4=Yi("Blob"),z4=Yi("FileList"),Y4=t=>u_(t)&&$r(t.pipe),$4=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||$r(t.append)&&((e=d_(t))==="formdata"||e==="object"&&$r(t.toString)&&t.toString()==="[object FormData]"))},q4=Yi("URLSearchParams"),[J4,X4,Q4,Z4]=["ReadableStream","Request","Response","Headers"].map(Yi),tG=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Th(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let r,i;if(typeof t!="object"&&(t=[t]),zd(t))for(r=0,i=t.length;r<i;r++)e.call(null,t[r],r,t);else{const o=n?Object.getOwnPropertyNames(t):Object.keys(t),s=o.length;let a;for(r=0;r<s;r++)a=o[r],e.call(null,t[a],a,t)}}function NM(t,e){e=e.toLowerCase();const n=Object.keys(t);let r=n.length,i;for(;r-- >0;)if(i=n[r],e===i.toLowerCase())return i;return null}const Na=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,PM=t=>!ju(t)&&t!==Na;function $T(){const{caseless:t}=PM(this)&&this||{},e={},n=(r,i)=>{const o=t&&NM(e,i)||i;df(e[o])&&df(r)?e[o]=$T(e[o],r):df(r)?e[o]=$T({},r):zd(r)?e[o]=r.slice():e[o]=r};for(let r=0,i=arguments.length;r<i;r++)arguments[r]&&Th(arguments[r],n);return e}const eG=(t,e,n,{allOwnKeys:r}={})=>(Th(e,(i,o)=>{n&&$r(i)?t[o]=AM(i,n):t[o]=i},{allOwnKeys:r}),t),nG=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),rG=(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},iG=(t,e,n,r)=>{let i,o,s;const a={};if(e=e||{},t==null)return e;do{for(i=Object.getOwnPropertyNames(t),o=i.length;o-- >0;)s=i[o],(!r||r(s,t,e))&&!a[s]&&(e[s]=t[s],a[s]=!0);t=n!==!1&&uR(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},oG=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},sG=t=>{if(!t)return null;if(zd(t))return t;let e=t.length;if(!bM(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},aG=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&uR(Uint8Array)),cG=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let i;for(;(i=r.next())&&!i.done;){const o=i.value;e.call(t,o[0],o[1])}},dG=(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},lG=Yi("HTMLFormElement"),uG=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,i){return r.toUpperCase()+i}),JI=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),hG=Yi("RegExp"),DM=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};Th(n,(i,o)=>{let s;(s=e(i,o,t))!==!1&&(r[o]=s||i)}),Object.defineProperties(t,r)},pG=t=>{DM(t,(e,n)=>{if($r(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if($r(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},fG=(t,e)=>{const n={},r=i=>{i.forEach(o=>{n[o]=!0})};return zd(t)?r(t):r(String(t).split(e)),n},mG=()=>{},_G=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,RE="abcdefghijklmnopqrstuvwxyz",XI="0123456789",kM={DIGIT:XI,ALPHA:RE,ALPHA_DIGIT:RE+RE.toUpperCase()+XI},EG=(t=16,e=kM.ALPHA_DIGIT)=>{let n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n};function gG(t){return!!(t&&$r(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const SG=t=>{const e=new Array(10),n=(r,i)=>{if(u_(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const o=zd(r)?[]:{};return Th(r,(s,a)=>{const c=n(s,i+1);!ju(c)&&(o[a]=c)}),e[i]=void 0,o}}return r};return n(t,0)},TG=Yi("AsyncFunction"),vG=t=>t&&(u_(t)||$r(t))&&$r(t.then)&&$r(t.catch),LM=((t,e)=>t?setImmediate:e?((n,r)=>(Na.addEventListener("message",({source:i,data:o})=>{i===Na&&o===n&&r.length&&r.shift()()},!1),i=>{r.push(i),Na.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",$r(Na.postMessage)),yG=typeof queueMicrotask<"u"?queueMicrotask.bind(Na):typeof process<"u"&&process.nextTick||LM,K={isArray:zd,isArrayBuffer:OM,isBuffer:F4,isFormData:$4,isArrayBufferView:j4,isString:B4,isNumber:bM,isBoolean:G4,isObject:u_,isPlainObject:df,isReadableStream:J4,isRequest:X4,isResponse:Q4,isHeaders:Z4,isUndefined:ju,isDate:W4,isFile:H4,isBlob:K4,isRegExp:hG,isFunction:$r,isStream:Y4,isURLSearchParams:q4,isTypedArray:aG,isFileList:z4,forEach:Th,merge:$T,extend:eG,trim:tG,stripBOM:nG,inherits:rG,toFlatObject:iG,kindOf:d_,kindOfTest:Yi,endsWith:oG,toArray:sG,forEachEntry:cG,matchAll:dG,isHTMLForm:lG,hasOwnProperty:JI,hasOwnProp:JI,reduceDescriptors:DM,freezeMethods:pG,toObjectSet:fG,toCamelCase:uG,noop:mG,toFiniteNumber:_G,findKey:NM,global:Na,isContextDefined:PM,ALPHABET:kM,generateString:EG,isSpecCompliantForm:gG,toJSONObject:SG,isAsyncFn:TG,isThenable:vG,setImmediate:LM,asap:yG};function Ft(t,e,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}K.inherits(Ft,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:K.toJSONObject(this.config),code:this.code,status:this.status}}});const MM=Ft.prototype,UM={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{UM[t]={value:t}});Object.defineProperties(Ft,UM);Object.defineProperty(MM,"isAxiosError",{value:!0});Ft.from=(t,e,n,r,i,o)=>{const s=Object.create(MM);return K.toFlatObject(t,s,function(c){return c!==Error.prototype},a=>a!=="isAxiosError"),Ft.call(s,t.message,e,n,r,i),s.cause=t,s.name=t.name,o&&Object.assign(s,o),s};const RG=null;function qT(t){return K.isPlainObject(t)||K.isArray(t)}function xM(t){return K.endsWith(t,"[]")?t.slice(0,-2):t}function QI(t,e,n){return t?t.concat(e).map(function(i,o){return i=xM(i),!n&&o?"["+i+"]":i}).join(n?".":""):e}function CG(t){return K.isArray(t)&&!t.some(qT)}const IG=K.toFlatObject(K,{},null,function(e){return/^is[A-Z]/.test(e)});function h_(t,e,n){if(!K.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=K.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(f,_){return!K.isUndefined(_[f])});const r=n.metaTokens,i=n.visitor||l,o=n.dots,s=n.indexes,c=(n.Blob||typeof Blob<"u"&&Blob)&&K.isSpecCompliantForm(e);if(!K.isFunction(i))throw new TypeError("visitor must be a function");function d(S){if(S===null)return"";if(K.isDate(S))return S.toISOString();if(!c&&K.isBlob(S))throw new Ft("Blob is not supported. Use a Buffer instead.");return K.isArrayBuffer(S)||K.isTypedArray(S)?c&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function l(S,f,_){let T=S;if(S&&!_&&typeof S=="object"){if(K.endsWith(f,"{}"))f=r?f:f.slice(0,-2),S=JSON.stringify(S);else if(K.isArray(S)&&CG(S)||(K.isFileList(S)||K.endsWith(f,"[]"))&&(T=K.toArray(S)))return f=xM(f),T.forEach(function(y,I){!(K.isUndefined(y)||y===null)&&e.append(s===!0?QI([f],I,o):s===null?f:f+"[]",d(y))}),!1}return qT(S)?!0:(e.append(QI(_,f,o),d(S)),!1)}const u=[],h=Object.assign(IG,{defaultVisitor:l,convertValue:d,isVisitable:qT});function p(S,f){if(!K.isUndefined(S)){if(u.indexOf(S)!==-1)throw Error("Circular reference detected in "+f.join("."));u.push(S),K.forEach(S,function(T,g){(!(K.isUndefined(T)||T===null)&&i.call(e,T,K.isString(g)?g.trim():g,f,h))===!0&&p(T,f?f.concat(g):[g])}),u.pop()}}if(!K.isObject(t))throw new TypeError("data must be an object");return p(t),e}function ZI(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function hR(t,e){this._pairs=[],t&&h_(t,this,e)}const VM=hR.prototype;VM.append=function(e,n){this._pairs.push([e,n])};VM.toString=function(e){const n=e?function(r){return e.call(this,r,ZI)}:ZI;return this._pairs.map(function(i){return n(i[0])+"="+n(i[1])},"").join("&")};function wG(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function FM(t,e,n){if(!e)return t;const r=n&&n.encode||wG,i=n&&n.serialize;let o;if(i?o=i(e,n):o=K.isURLSearchParams(e)?e.toString():new hR(e,n).toString(r),o){const s=t.indexOf("#");s!==-1&&(t=t.slice(0,s)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}class tw{constructor(){this.handlers=[]}use(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){K.forEach(this.handlers,function(r){r!==null&&e(r)})}}const jM={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},AG=typeof URLSearchParams<"u"?URLSearchParams:hR,OG=typeof FormData<"u"?FormData:null,bG=typeof Blob<"u"?Blob:null,NG={isBrowser:!0,classes:{URLSearchParams:AG,FormData:OG,Blob:bG},protocols:["http","https","file","blob","url","data"]},pR=typeof window<"u"&&typeof document<"u",JT=typeof navigator=="object"&&navigator||void 0,PG=pR&&(!JT||["ReactNative","NativeScript","NS"].indexOf(JT.product)<0),DG=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",kG=pR&&window.location.href||"http://localhost",LG=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:pR,hasStandardBrowserEnv:PG,hasStandardBrowserWebWorkerEnv:DG,navigator:JT,origin:kG},Symbol.toStringTag,{value:"Module"})),Or={...LG,...NG};function MG(t,e){return h_(t,new Or.classes.URLSearchParams,Object.assign({visitor:function(n,r,i,o){return Or.isNode&&K.isBuffer(n)?(this.append(r,n.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function UG(t){return K.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function xG(t){const e={},n=Object.keys(t);let r;const i=n.length;let o;for(r=0;r<i;r++)o=n[r],e[o]=t[o];return e}function BM(t){function e(n,r,i,o){let s=n[o++];if(s==="__proto__")return!0;const a=Number.isFinite(+s),c=o>=n.length;return s=!s&&K.isArray(i)?i.length:s,c?(K.hasOwnProp(i,s)?i[s]=[i[s],r]:i[s]=r,!a):((!i[s]||!K.isObject(i[s]))&&(i[s]=[]),e(n,r,i[s],o)&&K.isArray(i[s])&&(i[s]=xG(i[s])),!a)}if(K.isFormData(t)&&K.isFunction(t.entries)){const n={};return K.forEachEntry(t,(r,i)=>{e(UG(r),i,n,0)}),n}return null}function VG(t,e,n){if(K.isString(t))try{return(e||JSON.parse)(t),K.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(0,JSON.stringify)(t)}const vh={transitional:jM,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const r=n.getContentType()||"",i=r.indexOf("application/json")>-1,o=K.isObject(e);if(o&&K.isHTMLForm(e)&&(e=new FormData(e)),K.isFormData(e))return i?JSON.stringify(BM(e)):e;if(K.isArrayBuffer(e)||K.isBuffer(e)||K.isStream(e)||K.isFile(e)||K.isBlob(e)||K.isReadableStream(e))return e;if(K.isArrayBufferView(e))return e.buffer;if(K.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(o){if(r.indexOf("application/x-www-form-urlencoded")>-1)return MG(e,this.formSerializer).toString();if((a=K.isFileList(e))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return h_(a?{"files[]":e}:e,c&&new c,this.formSerializer)}}return o||i?(n.setContentType("application/json",!1),VG(e)):e}],transformResponse:[function(e){const n=this.transitional||vh.transitional,r=n&&n.forcedJSONParsing,i=this.responseType==="json";if(K.isResponse(e)||K.isReadableStream(e))return e;if(e&&K.isString(e)&&(r&&!this.responseType||i)){const s=!(n&&n.silentJSONParsing)&&i;try{return JSON.parse(e)}catch(a){if(s)throw a.name==="SyntaxError"?Ft.from(a,Ft.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Or.classes.FormData,Blob:Or.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};K.forEach(["delete","get","head","post","put","patch"],t=>{vh.headers[t]={}});const FG=K.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),jG=t=>{const e={};let n,r,i;return t&&t.split(`
`).forEach(function(s){i=s.indexOf(":"),n=s.substring(0,i).trim().toLowerCase(),r=s.substring(i+1).trim(),!(!n||e[n]&&FG[n])&&(n==="set-cookie"?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)}),e},ew=Symbol("internals");function Sl(t){return t&&String(t).trim().toLowerCase()}function lf(t){return t===!1||t==null?t:K.isArray(t)?t.map(lf):String(t)}function BG(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}const GG=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function CE(t,e,n,r,i){if(K.isFunction(r))return r.call(this,e,n);if(i&&(e=n),!!K.isString(e)){if(K.isString(r))return e.indexOf(r)!==-1;if(K.isRegExp(r))return r.test(e)}}function WG(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,r)=>n.toUpperCase()+r)}function HG(t,e){const n=K.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(i,o,s){return this[r].call(this,e,i,o,s)},configurable:!0})})}class br{constructor(e){e&&this.set(e)}set(e,n,r){const i=this;function o(a,c,d){const l=Sl(c);if(!l)throw new Error("header name must be a non-empty string");const u=K.findKey(i,l);(!u||i[u]===void 0||d===!0||d===void 0&&i[u]!==!1)&&(i[u||c]=lf(a))}const s=(a,c)=>K.forEach(a,(d,l)=>o(d,l,c));if(K.isPlainObject(e)||e instanceof this.constructor)s(e,n);else if(K.isString(e)&&(e=e.trim())&&!GG(e))s(jG(e),n);else if(K.isHeaders(e))for(const[a,c]of e.entries())o(c,a,r);else e!=null&&o(n,e,r);return this}get(e,n){if(e=Sl(e),e){const r=K.findKey(this,e);if(r){const i=this[r];if(!n)return i;if(n===!0)return BG(i);if(K.isFunction(n))return n.call(this,i,r);if(K.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Sl(e),e){const r=K.findKey(this,e);return!!(r&&this[r]!==void 0&&(!n||CE(this,this[r],r,n)))}return!1}delete(e,n){const r=this;let i=!1;function o(s){if(s=Sl(s),s){const a=K.findKey(r,s);a&&(!n||CE(r,r[a],a,n))&&(delete r[a],i=!0)}}return K.isArray(e)?e.forEach(o):o(e),i}clear(e){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const o=n[r];(!e||CE(this,this[o],o,e,!0))&&(delete this[o],i=!0)}return i}normalize(e){const n=this,r={};return K.forEach(this,(i,o)=>{const s=K.findKey(r,o);if(s){n[s]=lf(i),delete n[o];return}const a=e?WG(o):String(o).trim();a!==o&&delete n[o],n[a]=lf(i),r[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return K.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=e&&K.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const r=new this(e);return n.forEach(i=>r.set(i)),r}static accessor(e){const r=(this[ew]=this[ew]={accessors:{}}).accessors,i=this.prototype;function o(s){const a=Sl(s);r[a]||(HG(i,s),r[a]=!0)}return K.isArray(e)?e.forEach(o):o(e),this}}br.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);K.reduceDescriptors(br.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[n]=r}}});K.freezeMethods(br);function IE(t,e){const n=this||vh,r=e||n,i=br.from(r.headers);let o=r.data;return K.forEach(t,function(a){o=a.call(n,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function GM(t){return!!(t&&t.__CANCEL__)}function Yd(t,e,n){Ft.call(this,t??"canceled",Ft.ERR_CANCELED,e,n),this.name="CanceledError"}K.inherits(Yd,Ft,{__CANCEL__:!0});function WM(t,e,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):e(new Ft("Request failed with status code "+n.status,[Ft.ERR_BAD_REQUEST,Ft.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function KG(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function zG(t,e){t=t||10;const n=new Array(t),r=new Array(t);let i=0,o=0,s;return e=e!==void 0?e:1e3,function(c){const d=Date.now(),l=r[o];s||(s=d),n[i]=c,r[i]=d;let u=o,h=0;for(;u!==i;)h+=n[u++],u=u%t;if(i=(i+1)%t,i===o&&(o=(o+1)%t),d-s<e)return;const p=l&&d-l;return p?Math.round(h*1e3/p):void 0}}function YG(t,e){let n=0,r=1e3/e,i,o;const s=(d,l=Date.now())=>{n=l,i=null,o&&(clearTimeout(o),o=null),t.apply(null,d)};return[(...d)=>{const l=Date.now(),u=l-n;u>=r?s(d,l):(i=d,o||(o=setTimeout(()=>{o=null,s(i)},r-u)))},()=>i&&s(i)]}const um=(t,e,n=3)=>{let r=0;const i=zG(50,250);return YG(o=>{const s=o.loaded,a=o.lengthComputable?o.total:void 0,c=s-r,d=i(c),l=s<=a;r=s;const u={loaded:s,total:a,progress:a?s/a:void 0,bytes:c,rate:d||void 0,estimated:d&&a&&l?(a-s)/d:void 0,event:o,lengthComputable:a!=null,[e?"download":"upload"]:!0};t(u)},n)},nw=(t,e)=>{const n=t!=null;return[r=>e[0]({lengthComputable:n,total:t,loaded:r}),e[1]]},rw=t=>(...e)=>K.asap(()=>t(...e)),$G=Or.hasStandardBrowserEnv?function(){const e=Or.navigator&&/(msie|trident)/i.test(Or.navigator.userAgent),n=document.createElement("a");let r;function i(o){let s=o;return e&&(n.setAttribute("href",s),s=n.href),n.setAttribute("href",s),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return r=i(window.location.href),function(s){const a=K.isString(s)?i(s):s;return a.protocol===r.protocol&&a.host===r.host}}():function(){return function(){return!0}}(),qG=Or.hasStandardBrowserEnv?{write(t,e,n,r,i,o){const s=[t+"="+encodeURIComponent(e)];K.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),K.isString(r)&&s.push("path="+r),K.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function JG(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function XG(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function HM(t,e){return t&&!JG(e)?XG(t,e):e}const iw=t=>t instanceof br?{...t}:t;function Qa(t,e){e=e||{};const n={};function r(d,l,u){return K.isPlainObject(d)&&K.isPlainObject(l)?K.merge.call({caseless:u},d,l):K.isPlainObject(l)?K.merge({},l):K.isArray(l)?l.slice():l}function i(d,l,u){if(K.isUndefined(l)){if(!K.isUndefined(d))return r(void 0,d,u)}else return r(d,l,u)}function o(d,l){if(!K.isUndefined(l))return r(void 0,l)}function s(d,l){if(K.isUndefined(l)){if(!K.isUndefined(d))return r(void 0,d)}else return r(void 0,l)}function a(d,l,u){if(u in e)return r(d,l);if(u in t)return r(void 0,d)}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(d,l)=>i(iw(d),iw(l),!0)};return K.forEach(Object.keys(Object.assign({},t,e)),function(l){const u=c[l]||i,h=u(t[l],e[l],l);K.isUndefined(h)&&u!==a||(n[l]=h)}),n}const KM=t=>{const e=Qa({},t);let{data:n,withXSRFToken:r,xsrfHeaderName:i,xsrfCookieName:o,headers:s,auth:a}=e;e.headers=s=br.from(s),e.url=FM(HM(e.baseURL,e.url),t.params,t.paramsSerializer),a&&s.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let c;if(K.isFormData(n)){if(Or.hasStandardBrowserEnv||Or.hasStandardBrowserWebWorkerEnv)s.setContentType(void 0);else if((c=s.getContentType())!==!1){const[d,...l]=c?c.split(";").map(u=>u.trim()).filter(Boolean):[];s.setContentType([d||"multipart/form-data",...l].join("; "))}}if(Or.hasStandardBrowserEnv&&(r&&K.isFunction(r)&&(r=r(e)),r||r!==!1&&$G(e.url))){const d=i&&o&&qG.read(o);d&&s.set(i,d)}return e},QG=typeof XMLHttpRequest<"u",ZG=QG&&function(t){return new Promise(function(n,r){const i=KM(t);let o=i.data;const s=br.from(i.headers).normalize();let{responseType:a,onUploadProgress:c,onDownloadProgress:d}=i,l,u,h,p,S;function f(){p&&p(),S&&S(),i.cancelToken&&i.cancelToken.unsubscribe(l),i.signal&&i.signal.removeEventListener("abort",l)}let _=new XMLHttpRequest;_.open(i.method.toUpperCase(),i.url,!0),_.timeout=i.timeout;function T(){if(!_)return;const y=br.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),O={data:!a||a==="text"||a==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:y,config:t,request:_};WM(function(N){n(N),f()},function(N){r(N),f()},O),_=null}"onloadend"in _?_.onloadend=T:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(T)},_.onabort=function(){_&&(r(new Ft("Request aborted",Ft.ECONNABORTED,t,_)),_=null)},_.onerror=function(){r(new Ft("Network Error",Ft.ERR_NETWORK,t,_)),_=null},_.ontimeout=function(){let I=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const O=i.transitional||jM;i.timeoutErrorMessage&&(I=i.timeoutErrorMessage),r(new Ft(I,O.clarifyTimeoutError?Ft.ETIMEDOUT:Ft.ECONNABORTED,t,_)),_=null},o===void 0&&s.setContentType(null),"setRequestHeader"in _&&K.forEach(s.toJSON(),function(I,O){_.setRequestHeader(O,I)}),K.isUndefined(i.withCredentials)||(_.withCredentials=!!i.withCredentials),a&&a!=="json"&&(_.responseType=i.responseType),d&&([h,S]=um(d,!0),_.addEventListener("progress",h)),c&&_.upload&&([u,p]=um(c),_.upload.addEventListener("progress",u),_.upload.addEventListener("loadend",p)),(i.cancelToken||i.signal)&&(l=y=>{_&&(r(!y||y.type?new Yd(null,t,_):y),_.abort(),_=null)},i.cancelToken&&i.cancelToken.subscribe(l),i.signal&&(i.signal.aborted?l():i.signal.addEventListener("abort",l)));const g=KG(i.url);if(g&&Or.protocols.indexOf(g)===-1){r(new Ft("Unsupported protocol "+g+":",Ft.ERR_BAD_REQUEST,t));return}_.send(o||null)})},tW=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let r=new AbortController,i;const o=function(d){if(!i){i=!0,a();const l=d instanceof Error?d:this.reason;r.abort(l instanceof Ft?l:new Yd(l instanceof Error?l.message:l))}};let s=e&&setTimeout(()=>{s=null,o(new Ft(`timeout ${e} of ms exceeded`,Ft.ETIMEDOUT))},e);const a=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach(d=>{d.unsubscribe?d.unsubscribe(o):d.removeEventListener("abort",o)}),t=null)};t.forEach(d=>d.addEventListener("abort",o));const{signal:c}=r;return c.unsubscribe=()=>K.asap(a),c}},eW=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let r=0,i;for(;r<n;)i=r+e,yield t.slice(r,i),r=i},nW=async function*(t,e){for await(const n of rW(t))yield*eW(n,e)},rW=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:r}=await e.read();if(n)break;yield r}}finally{await e.cancel()}},ow=(t,e,n,r)=>{const i=nW(t,e);let o=0,s,a=c=>{s||(s=!0,r&&r(c))};return new ReadableStream({async pull(c){try{const{done:d,value:l}=await i.next();if(d){a(),c.close();return}let u=l.byteLength;if(n){let h=o+=u;n(h)}c.enqueue(new Uint8Array(l))}catch(d){throw a(d),d}},cancel(c){return a(c),i.return()}},{highWaterMark:2})},p_=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",zM=p_&&typeof ReadableStream=="function",iW=p_&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),YM=(t,...e)=>{try{return!!t(...e)}catch{return!1}},oW=zM&&YM(()=>{let t=!1;const e=new Request(Or.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),sw=64*1024,XT=zM&&YM(()=>K.isReadableStream(new Response("").body)),hm={stream:XT&&(t=>t.body)};p_&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!hm[e]&&(hm[e]=K.isFunction(t[e])?n=>n[e]():(n,r)=>{throw new Ft(`Response type '${e}' is not supported`,Ft.ERR_NOT_SUPPORT,r)})})})(new Response);const sW=async t=>{if(t==null)return 0;if(K.isBlob(t))return t.size;if(K.isSpecCompliantForm(t))return(await new Request(Or.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(K.isArrayBufferView(t)||K.isArrayBuffer(t))return t.byteLength;if(K.isURLSearchParams(t)&&(t=t+""),K.isString(t))return(await iW(t)).byteLength},aW=async(t,e)=>{const n=K.toFiniteNumber(t.getContentLength());return n??sW(e)},cW=p_&&(async t=>{let{url:e,method:n,data:r,signal:i,cancelToken:o,timeout:s,onDownloadProgress:a,onUploadProgress:c,responseType:d,headers:l,withCredentials:u="same-origin",fetchOptions:h}=KM(t);d=d?(d+"").toLowerCase():"text";let p=tW([i,o&&o.toAbortSignal()],s),S;const f=p&&p.unsubscribe&&(()=>{p.unsubscribe()});let _;try{if(c&&oW&&n!=="get"&&n!=="head"&&(_=await aW(l,r))!==0){let O=new Request(e,{method:"POST",body:r,duplex:"half"}),b;if(K.isFormData(r)&&(b=O.headers.get("content-type"))&&l.setContentType(b),O.body){const[N,U]=nw(_,um(rw(c)));r=ow(O.body,sw,N,U)}}K.isString(u)||(u=u?"include":"omit");const T="credentials"in Request.prototype;S=new Request(e,{...h,signal:p,method:n.toUpperCase(),headers:l.normalize().toJSON(),body:r,duplex:"half",credentials:T?u:void 0});let g=await fetch(S);const y=XT&&(d==="stream"||d==="response");if(XT&&(a||y&&f)){const O={};["status","statusText","headers"].forEach(V=>{O[V]=g[V]});const b=K.toFiniteNumber(g.headers.get("content-length")),[N,U]=a&&nw(b,um(rw(a),!0))||[];g=new Response(ow(g.body,sw,N,()=>{U&&U(),f&&f()}),O)}d=d||"text";let I=await hm[K.findKey(hm,d)||"text"](g,t);return!y&&f&&f(),await new Promise((O,b)=>{WM(O,b,{data:I,headers:br.from(g.headers),status:g.status,statusText:g.statusText,config:t,request:S})})}catch(T){throw f&&f(),T&&T.name==="TypeError"&&/fetch/i.test(T.message)?Object.assign(new Ft("Network Error",Ft.ERR_NETWORK,t,S),{cause:T.cause||T}):Ft.from(T,T&&T.code,t,S)}}),QT={http:RG,xhr:ZG,fetch:cW};K.forEach(QT,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const aw=t=>`- ${t}`,dW=t=>K.isFunction(t)||t===null||t===!1,$M={getAdapter:t=>{t=K.isArray(t)?t:[t];const{length:e}=t;let n,r;const i={};for(let o=0;o<e;o++){n=t[o];let s;if(r=n,!dW(n)&&(r=QT[(s=String(n)).toLowerCase()],r===void 0))throw new Ft(`Unknown adapter '${s}'`);if(r)break;i[s||"#"+o]=r}if(!r){const o=Object.entries(i).map(([a,c])=>`adapter ${a} `+(c===!1?"is not supported by the environment":"is not available in the build"));let s=e?o.length>1?`since :
`+o.map(aw).join(`
`):" "+aw(o[0]):"as no adapter specified";throw new Ft("There is no suitable adapter to dispatch the request "+s,"ERR_NOT_SUPPORT")}return r},adapters:QT};function wE(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Yd(null,t)}function cw(t){return wE(t),t.headers=br.from(t.headers),t.data=IE.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),$M.getAdapter(t.adapter||vh.adapter)(t).then(function(r){return wE(t),r.data=IE.call(t,t.transformResponse,r),r.headers=br.from(r.headers),r},function(r){return GM(r)||(wE(t),r&&r.response&&(r.response.data=IE.call(t,t.transformResponse,r.response),r.response.headers=br.from(r.response.headers))),Promise.reject(r)})}const qM="1.7.7",fR={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{fR[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const dw={};fR.transitional=function(e,n,r){function i(o,s){return"[Axios v"+qM+"] Transitional option '"+o+"'"+s+(r?". "+r:"")}return(o,s,a)=>{if(e===!1)throw new Ft(i(s," has been removed"+(n?" in "+n:"")),Ft.ERR_DEPRECATED);return n&&!dw[s]&&(dw[s]=!0,console.warn(i(s," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(o,s,a):!0}};function lW(t,e,n){if(typeof t!="object")throw new Ft("options must be an object",Ft.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let i=r.length;for(;i-- >0;){const o=r[i],s=e[o];if(s){const a=t[o],c=a===void 0||s(a,o,t);if(c!==!0)throw new Ft("option "+o+" must be "+c,Ft.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Ft("Unknown option "+o,Ft.ERR_BAD_OPTION)}}const ZT={assertOptions:lW,validators:fR},ss=ZT.validators;class Ba{constructor(e){this.defaults=e,this.interceptors={request:new tw,response:new tw}}async request(e,n){try{return await this._request(e,n)}catch(r){if(r instanceof Error){let i;Error.captureStackTrace?Error.captureStackTrace(i={}):i=new Error;const o=i.stack?i.stack.replace(/^.+\n/,""):"";try{r.stack?o&&!String(r.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+o):r.stack=o}catch{}}throw r}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Qa(this.defaults,n);const{transitional:r,paramsSerializer:i,headers:o}=n;r!==void 0&&ZT.assertOptions(r,{silentJSONParsing:ss.transitional(ss.boolean),forcedJSONParsing:ss.transitional(ss.boolean),clarifyTimeoutError:ss.transitional(ss.boolean)},!1),i!=null&&(K.isFunction(i)?n.paramsSerializer={serialize:i}:ZT.assertOptions(i,{encode:ss.function,serialize:ss.function},!0)),n.method=(n.method||this.defaults.method||"get").toLowerCase();let s=o&&K.merge(o.common,o[n.method]);o&&K.forEach(["delete","get","head","post","put","patch","common"],S=>{delete o[S]}),n.headers=br.concat(s,o);const a=[];let c=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(n)===!1||(c=c&&f.synchronous,a.unshift(f.fulfilled,f.rejected))});const d=[];this.interceptors.response.forEach(function(f){d.push(f.fulfilled,f.rejected)});let l,u=0,h;if(!c){const S=[cw.bind(this),void 0];for(S.unshift.apply(S,a),S.push.apply(S,d),h=S.length,l=Promise.resolve(n);u<h;)l=l.then(S[u++],S[u++]);return l}h=a.length;let p=n;for(u=0;u<h;){const S=a[u++],f=a[u++];try{p=S(p)}catch(_){f.call(this,_);break}}try{l=cw.call(this,p)}catch(S){return Promise.reject(S)}for(u=0,h=d.length;u<h;)l=l.then(d[u++],d[u++]);return l}getUri(e){e=Qa(this.defaults,e);const n=HM(e.baseURL,e.url);return FM(n,e.params,e.paramsSerializer)}}K.forEach(["delete","get","head","options"],function(e){Ba.prototype[e]=function(n,r){return this.request(Qa(r||{},{method:e,url:n,data:(r||{}).data}))}});K.forEach(["post","put","patch"],function(e){function n(r){return function(o,s,a){return this.request(Qa(a||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:o,data:s}))}}Ba.prototype[e]=n(),Ba.prototype[e+"Form"]=n(!0)});class mR{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(o){n=o});const r=this;this.promise.then(i=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](i);r._listeners=null}),this.promise.then=i=>{let o;const s=new Promise(a=>{r.subscribe(a),o=a}).then(i);return s.cancel=function(){r.unsubscribe(o)},s},e(function(o,s,a){r.reason||(r.reason=new Yd(o,s,a),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=r=>{e.abort(r)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new mR(function(i){e=i}),cancel:e}}}function uW(t){return function(n){return t.apply(null,n)}}function hW(t){return K.isObject(t)&&t.isAxiosError===!0}const tv={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(tv).forEach(([t,e])=>{tv[e]=t});function JM(t){const e=new Ba(t),n=AM(Ba.prototype.request,e);return K.extend(n,Ba.prototype,e,{allOwnKeys:!0}),K.extend(n,e,null,{allOwnKeys:!0}),n.create=function(i){return JM(Qa(t,i))},n}const Re=JM(vh);Re.Axios=Ba;Re.CanceledError=Yd;Re.CancelToken=mR;Re.isCancel=GM;Re.VERSION=qM;Re.toFormData=h_;Re.AxiosError=Ft;Re.Cancel=Re.CanceledError;Re.all=function(e){return Promise.all(e)};Re.spread=uW;Re.isAxiosError=hW;Re.mergeConfig=Qa;Re.AxiosHeaders=br;Re.formToJSON=t=>BM(K.isHTMLForm(t)?new FormData(t):t);Re.getAdapter=$M.getAdapter;Re.HttpStatusCode=tv;Re.default=Re;const yh="https://autism-sense-backend.onrender.com",pW=async(t,e)=>{try{return(await Re.post(`${yh}/api/auth/login`,{email:t,password:e},{withCredentials:!0})).data}catch(n){throw console.error("Error during login:",n),n}},fW=async t=>{try{return(await Re.post(`${yh}/api/auth/signup`,t)).data}catch(e){throw console.error("Error during sign-up:",e),e}},mW=async t=>{try{return(await Re.post(`${yh}/api/auth/forgot-password`,{email:t})).data}catch(e){throw console.error("Error during password reset request:",e),e}},_W=async(t,e)=>{try{return await Re.post(`${yh}/api/auth/reset-password/${t}`,{password:e})}catch(n){throw n}},EW=async()=>{try{return(await Re.post(`${yh}/api/auth/logout`,{},{withCredentials:!0})).data}catch(t){throw console.error("Error during logout:",t),t}},Ga="/autism-sense/assets/default-profile-BHlb9M6-.png";var XM={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},lw=Yo.createContext&&Yo.createContext(XM),gW=["attr","size","title"];function SW(t,e){if(t==null)return{};var n=TW(t,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function TW(t,e){if(t==null)return{};var n={};for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(e.indexOf(r)>=0)continue;n[r]=t[r]}return n}function pm(){return pm=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},pm.apply(this,arguments)}function uw(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function fm(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?uw(Object(n),!0).forEach(function(r){vW(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):uw(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function vW(t,e,n){return e=yW(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function yW(t){var e=RW(t,"string");return typeof e=="symbol"?e:e+""}function RW(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function QM(t){return t&&t.map((e,n)=>Yo.createElement(e.tag,fm({key:n},e.attr),QM(e.child)))}function CW(t){return e=>Yo.createElement(IW,pm({attr:fm({},t.attr)},e),QM(t.child))}function IW(t){var e=n=>{var{attr:r,size:i,title:o}=t,s=SW(t,gW),a=i||n.size||"1em",c;return n.className&&(c=n.className),t.className&&(c=(c?c+" ":"")+t.className),Yo.createElement("svg",pm({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,s,{className:c,style:fm(fm({color:t.color||n.color},n.style),t.style),height:a,width:a,xmlns:"http://www.w3.org/2000/svg"}),o&&Yo.createElement("title",null,o),t.children)};return lw!==void 0?Yo.createElement(lw.Consumer,null,n=>e(n)):e(XM)}function ZM(t){return CW({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"},child:[]}]})(t)}const wW=()=>{const[t,e]=z.useState(""),[n,r]=z.useState(""),[i,o]=z.useState(""),[s,a]=z.useState(""),[c,d]=z.useState(""),[l,u]=z.useState(""),[h,p]=z.useState(null),[S,f]=z.useState(""),[_,T]=z.useState(""),[g,y]=z.useState(""),[I,O]=z.useState(""),[b,N]=z.useState(""),[U,V]=z.useState(""),W=Ro(),lt=Q=>{const ct=Q.target.files[0];if(ct){const Mt=new FileReader;Mt.onloadend=()=>{p(Mt.result)},Mt.readAsDataURL(ct)}},mt=Q=>/^[A-Za-z]{2,}$/.test(Q),St=Q=>/^[A-Za-z]{2,}$/.test(Q),Yt=Q=>{const ct=new Date;return new Date(Q)<=ct},Lt=Q=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(Q),Ze=Q=>Q.length>=8&&/[A-Za-z]/.test(Q)&&/\d/.test(Q),F=Q=>{const ct=Q.target.value;e(ct),f(mt(ct)?"":"First name should be at least two letters long.")},L=Q=>{const ct=Q.target.value;r(ct),T(St(ct)?"":"Last name should be at least two letters long.")},G=Q=>{const ct=Q.target.value;o(ct),y(Yt(ct)?"":"Child's date of birth cannot be in the future.")},k=Q=>{const ct=Q.target.value;a(ct),O(Lt(ct)?"":"Please enter a valid email address.")},E=Q=>{const ct=Q.target.value;d(ct),N(Ze(ct)?"":"Password must be at least 8 characters long and contain both letters and numbers.")},C=Q=>{const ct=Q.target.value;u(ct),V(ct!==c?"Passwords do not match.":"")},w=async Q=>{if(Q.preventDefault(),!mt(t)||!St(n)||!Yt(i)||!Lt(s)||!Ze(c)||c!==l){mt(t)||f("First name should be at least two letters long."),St(n)||T("Last name should be at least two letters long."),Yt(i)||y("Child's date of birth cannot be in the future."),Lt(s)||O("Please enter a valid email address."),Ze(c)||N("Password must be at least 8 characters long and contain both letters and numbers."),c!==l&&V("Passwords do not match.");return}const ct={firstName:t,lastName:n,dob:i,email:s,password:c,photo:h};try{const Mt=await fW(ct);Mt.message==="Child data saved successfully"&&W("/home",{state:{user:Mt.user}})}catch(Mt){Mt.response&&Mt.response.status===409?window.alert("This email is already in use. Please use a different email."):console.error("Sign up error:",Mt)}},j=()=>{W("/")};return D.jsxs("div",{className:"form-container",children:[D.jsx("h2",{children:"Add Child"}),D.jsxs("form",{onSubmit:w,children:[D.jsx("div",{className:"form-photo",children:D.jsxs("div",{className:"photo-ring",children:[D.jsx("img",{src:h||Ga,alt:"Profile",className:"photo-img"}),D.jsx("label",{htmlFor:"photo-input",className:"photo-pencil",children:D.jsx(ZM,{})}),D.jsx("input",{type:"file",id:"photo-input",accept:"image/*",onChange:lt,className:"photo-input"})]})}),D.jsxs("div",{className:"form-group",children:[D.jsx("input",{type:"text",placeholder:"First Name",value:t,onChange:F,required:!0,className:"input-field"}),S&&D.jsx("span",{className:"error-message",children:S})]}),D.jsxs("div",{className:"form-group",children:[D.jsx("input",{type:"text",placeholder:"Last Name",value:n,onChange:L,required:!0,className:"input-field"}),_&&D.jsx("span",{className:"error-message",children:_})]}),D.jsxs("div",{className:"form-group dob-field-container",children:[D.jsx("input",{type:"date",id:"childDOB",value:i,onChange:G,required:!0,max:new Date().toISOString().split("T")[0],className:"dob-input"}),D.jsx("label",{htmlFor:"childDOB",className:"dob-hint",children:"Enter your birthday"}),g&&D.jsx("span",{className:"error-message",children:g})]}),D.jsxs("div",{className:"form-group",children:[D.jsx("input",{type:"email",placeholder:"Email",value:s,onChange:k,required:!0,className:"input-field"}),I&&D.jsx("span",{className:"error-message",children:I})]}),D.jsxs("div",{className:"form-group",children:[D.jsx("input",{type:"password",placeholder:"Password",value:c,onChange:E,required:!0,className:"input-field"}),b&&D.jsx("span",{className:"error-message",children:b})]}),D.jsxs("div",{className:"form-group",children:[D.jsx("input",{type:"password",placeholder:"Confirm Password",value:l,onChange:C,required:!0,className:"input-field"}),U&&D.jsx("span",{className:"error-message",children:U})]}),D.jsxs("div",{className:"form-buttons",children:[D.jsx("button",{type:"button",className:"cancel-btn",onClick:j,children:"Cancel"}),D.jsx("button",{type:"submit",className:"add-child-btn",children:"Sign up"})]})]})]})},tU="/autism-sense/assets/logo-CYO5hS3s.png",AW=()=>{const t=Ro(),e=()=>{t("/meeting/host")},n=()=>{t("/sign-up")},r=()=>{t("/login")};return D.jsxs("div",{className:"landing-container",children:[D.jsxs("div",{className:"logo-container",children:[D.jsx("img",{src:tU,alt:"AutismSense Logo",className:"logo"}),D.jsx("h1",{className:"title",children:"AutismSense"})]}),D.jsx("button",{className:"btn",onClick:e,children:"Create Meeting (Normal Mode)"}),D.jsx("button",{className:"btn",onClick:n,children:"Create An Account"}),D.jsx("button",{className:"btn",onClick:r,children:"Login"}),D.jsxs("footer",{className:"landing-footer",children:[D.jsx(U4,{to:"/about-us",children:"About Us"}),D.jsx("p",{children:" 2024 AutismSense. All rights reserved."})]})]})},OW=()=>{const[t,e]=z.useState(""),[n,r]=z.useState(""),[i,o]=z.useState(""),[s,a]=z.useState(""),[c,d]=z.useState(""),l=Ro(),u=g=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(g),h=g=>g.length>=8&&/[A-Za-z]/.test(g)&&/\d/.test(g),p=g=>{const y=g.target.value;e(y),u(y)?o(""):o("Please enter a valid email address.")},S=g=>{const y=g.target.value;r(y),h(y)?a(""):a("Password must be at least 8 characters long and contain both letters and numbers.")},f=async g=>{if(g.preventDefault(),!u(t)){o("Please enter a valid email address.");return}if(!h(n)){a("Password must be at least 8 characters long and contain both letters and numbers.");return}try{const y=await pW(t,n);console.log("Login result:",y),y.message==="Login successful"?y.user?(console.log("Navigating with user:",y.user),l("/home",{state:{user:y.user}})):(console.error("No user data received from backend"),d("No user data received.")):d(y.message||"Login failed. Please try again.")}catch(y){d("An error occurred during login. Please try again."),console.error("Login error:",y)}},_=()=>{l("/")},T=()=>{l("/forget-password")};return D.jsxs("div",{className:"form-container",children:[D.jsx("h2",{children:"Login"}),D.jsxs("form",{onSubmit:f,children:[D.jsxs("div",{className:"form-group",children:[D.jsx("input",{type:"email",placeholder:"Email",value:t,onChange:p,required:!0,className:"input-field"}),i&&D.jsx("span",{className:"error-message",children:i})]}),D.jsxs("div",{className:"form-group",children:[D.jsx("input",{type:"password",placeholder:"Password",value:n,onChange:S,required:!0,className:"input-field"}),s&&D.jsx("span",{className:"error-message",children:s})]}),D.jsx("div",{children:D.jsx("button",{type:"button",className:"forget-btn",onClick:T,children:"Forget password?"})}),c&&D.jsx("span",{className:"error-message",children:c})," ",D.jsxs("div",{className:"form-buttons",children:[D.jsx("button",{type:"button",className:"cancel-btn",onClick:_,children:"Cancel"}),D.jsx("button",{type:"submit",className:"add-child-btn",children:"Login"})]})]})]})},eU="https://autism-sense-backend.onrender.com",nU=async t=>{try{return(await Re.get(`${eU}/api/child/child-profile/${t}`,{withCredentials:!0})).data}catch(e){throw e}},bW=async(t,e)=>{try{return await Re.put(`${eU}/api/child/update-child/${t}`,e,{withCredentials:!0})}catch(n){throw n}},NW=()=>{var T;const t=Kd(),e=Ro(),[n,r]=z.useState(((T=t.state)==null?void 0:T.user)||null),[i,o]=z.useState(Ga),[s,a]=z.useState("First Name Last Name"),[c,d]=z.useState(null),[l,u]=z.useState(!0),[h,p]=z.useState("");z.useEffect(()=>{var g;if(n)o(n.photo||Ga),a(`${n.firstName} ${n.lastName}`||"First Name Last Name"),d(n._id||n.id),u(!1);else{const y=(g=t.state)==null?void 0:g.id;y?nU(y).then(I=>{I?(r(I),o(I.photo||Ga),a(`${I.firstName} ${I.lastName}`||"First Name Last Name"),d(I._id||I.id)):e("/login")}).catch(()=>{p("Unable to load user data. Please try again."),e("/login")}).finally(()=>u(!1)):(p("No child ID available"),e("/login"))}},[n,e,t.state]);const S=async()=>{try{await EW(),e("/")}catch(g){console.error("Error during logout:",g)}},f=()=>{c?e(`/child-profile/${c}`,{state:{user:n,id:c}}):console.error("Child ID not found. Please wait for data to load.")},_=()=>{e("/meeting/gust")};return D.jsxs("div",{className:"container",children:[l&&D.jsx("p",{children:"Loading..."}),h&&D.jsx("p",{className:"error-message",children:h}),D.jsxs("header",{className:"navbar",children:[D.jsx("div",{className:"navbar-section logo-section",children:D.jsx("div",{className:"ring-holder",children:D.jsx("img",{src:tU,alt:"Logo",className:"logo-image"})})}),D.jsxs("button",{className:"navbar-section profile-section",onClick:f,disabled:l,children:[D.jsx("div",{className:"ring-holder",children:D.jsx("img",{src:i,alt:"Profile",className:"profile-image"})}),D.jsx("span",{children:s})]}),D.jsx("div",{className:"navbar-section logout-section",children:D.jsx("button",{onClick:S,children:"Logout"})})]}),D.jsxs("section",{className:"dashboard-content",children:[D.jsxs("div",{className:"progress-report",children:[D.jsx("h2",{children:"Progress Overview"}),D.jsx("p",{children:"This section will display an overview of the child's progress."})]}),D.jsxs("div",{className:"detailed-reports",children:[D.jsx("h2",{children:"Detailed Reports"}),D.jsx("p",{children:"This section will display detailed reports and analysis."})]})]}),D.jsx("section",{className:"zoom-navigation",children:D.jsx("button",{className:"btn",onClick:_,children:"Join Meeting (Special Mode)"})}),D.jsx("footer",{className:"footer",children:D.jsx("nav",{className:"bottom-bar",children:D.jsx("p",{children:" 2024 AutismSense. All rights reserved."})})})]})},PW=()=>{const t=Ro(),e=()=>{t("/")};return D.jsxs("div",{className:"container",children:[D.jsxs("header",{className:"header",children:[D.jsx("h1",{children:"Welcome to AutismSense"}),D.jsx("p",{children:"Your companion in creating a supportive environment for children with Autism."})]}),D.jsxs("section",{className:"content",children:[D.jsx("p",{children:"AutismSense is dedicated to creating a supportive environment for children with High-Functioning Autism (HFA). Our platform offers tools to assist in online interactions, making them more accessible and engaging for children with HFA. We believe that every child deserves the opportunity to connect with others in a way that is comfortable and supportive."}),D.jsx("p",{children:"Our team is passionate about using technology to make a positive impact in the lives of children and their families. We are committed to providing a platform that is both user-friendly and effective in helping children with HFA navigate the challenges of online communication."}),D.jsx("p",{children:"Features"}),D.jsxs("ul",{children:[D.jsx("li",{children:"Facial Expression Analysis"}),D.jsx("li",{children:"Conversation Transcription"}),D.jsx("li",{children:"Gamified Learning Modules"}),D.jsx("li",{children:"Profile Management"})]})]}),D.jsx("button",{className:"btn",onClick:e,children:"Back"}),D.jsx("footer",{className:"landing-footer",children:D.jsx("p",{children:" 2024 AutismSense. All rights reserved."})})]})},DW=()=>{const[t,e]=z.useState(""),[n,r]=z.useState(""),[i,o]=z.useState(""),s=Ro(),a=h=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h),c=h=>{const p=h.target.value;e(p),a(p)?r(""):r("Please enter a valid email address.")},[d,l]=z.useState(!1),u=async h=>{if(h.preventDefault(),l(!0),!a(t)){r("Please enter a valid email address."),l(!1);return}try{(await mW(t)).message==="Password reset email sent"&&(alert("Check your email for a password reset link"),s("/"))}catch(p){console.error("Error during reset password:",p),o("An error occurred while sending the reset email. Please try again.")}finally{l(!1)}};return D.jsxs("div",{className:"form-container",children:[D.jsx("h2",{children:"Forgot Password"}),D.jsx("p",{children:"If you forgot your password, enter your email and we will send you a reset link."}),D.jsxs("form",{onSubmit:u,children:[D.jsxs("div",{className:"form-group",children:[D.jsx("input",{type:"email",placeholder:"Enter your email",value:t,onChange:c,required:!0,className:"input-field"}),n&&D.jsx("span",{className:"error-message",children:n}),i&&D.jsx("span",{className:"server-error-message",children:i})]}),D.jsxs("div",{className:"form-buttons",children:[D.jsx("button",{type:"button",onClick:()=>s("/"),children:"Cancel"}),D.jsx("button",{type:"submit",disabled:d,children:d?"Sending...":"Send Reset Email"})]})]})]})},kW=()=>{var E;const t=Kd(),e=Ro(),{childId:n}=RM(),[r,i]=z.useState(((E=t.state)==null?void 0:E.user)||null),[o,s]=z.useState(!0),[a,c]=z.useState(""),[d,l]=z.useState(!1),[u,h]=z.useState(""),[p,S]=z.useState(""),[f,_]=z.useState(""),[T,g]=z.useState(""),[y,I]=z.useState(null),[O,b]=z.useState(""),[N,U]=z.useState(""),[V,W]=z.useState(""),[lt,mt]=z.useState("");if(z.useEffect(()=>{!r&&n?nU(n).then(C=>{i(C),h(C.firstName||""),S(C.lastName||""),_(C.dob?new Date(C.dob).toISOString().split("T")[0]:""),g(C.email||""),I(C.photo||Ga)}).catch(C=>{c("Unable to load user data. Please try again."),console.error("Error fetching child data:",C)}).finally(()=>{s(!1)}):r&&(h(r.firstName||""),S(r.lastName||""),_(r.dob?new Date(r.dob).toISOString().split("T")[0]:""),g(r.email||""),I(r.photo||Ga),s(!1))},[r,n]),o)return D.jsx("p",{children:"Loading profile..."});if(a)return D.jsx("p",{children:a});const St=C=>{const w=C.target.files[0];if(w){const j=new FileReader;j.onloadend=()=>{I(j.result)},j.readAsDataURL(w)}},Yt=C=>{const w=C.target.value;h(w),b(/^[A-Za-z]{2,}$/.test(w)?"":"First name should be at least two letters long.")},Lt=C=>{const w=C.target.value;S(w),U(/^[A-Za-z]{2,}$/.test(w)?"":"Last name should be at least two letters long.")},Ze=C=>{const w=C.target.value;_(w),W(L(w)?"":"Child's date of birth cannot be in the future.")},F=C=>{const w=C.target.value;g(w),mt(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(w)?"":"Please enter a valid email address.")},L=C=>{const w=new Date;return new Date(C)<=w},G=async C=>{var j;if(C.preventDefault(),O||N||V||lt)return;const w={firstName:u,lastName:p,dob:f,email:T,photo:y};try{const Q=await bW(n,w);Q.status===200?(l(!1),i(Q.data.updatedChild),e("/home",{replace:!0,state:{user:Q.data.updatedChild}})):console.error("Error updating child data")}catch(Q){console.error("Error:",((j=Q.response)==null?void 0:j.data)||Q.message)}},k=()=>{l(!1)};return D.jsxs("div",{className:"profile-container",children:[D.jsxs("header",{className:"profile-header",children:[D.jsx("img",{src:y||Ga,alt:"Profile",className:"profile-img"}),d&&D.jsxs("label",{htmlFor:"photo-input",className:"photo-label",children:[D.jsx(ZM,{}),D.jsx("p",{children:"Change Image"})]})]}),D.jsx("section",{className:"profile-details",children:d?D.jsxs(D.Fragment,{children:[D.jsx("div",{className:"form-group",children:D.jsx("input",{type:"file",id:"photo-input",accept:"image/*",className:"photo-input",onChange:St})}),D.jsxs("div",{className:"form-group",children:[D.jsx("input",{className:"input-field",placeholder:"First Name",type:"text",value:u,onChange:Yt}),O&&D.jsx("p",{children:O})]}),D.jsxs("div",{className:"form-group",children:[D.jsx("input",{className:"input-field",type:"text",value:p,onChange:Lt}),N&&D.jsx("p",{children:N})]}),D.jsxs("div",{className:"form-group",children:[D.jsx("input",{className:"input-field",type:"date",value:f,onChange:Ze,max:new Date().toISOString().split("T")[0]}),V&&D.jsx("p",{children:V})]}),D.jsxs("div",{className:"form-group",children:[D.jsx("input",{className:"input-field",type:"email",value:T,onChange:F}),lt&&D.jsx("p",{children:lt})]})]}):D.jsxs(D.Fragment,{children:[D.jsx("h1",{children:`${u||"First Name"} ${p||"Last Name"}`}),D.jsxs("p",{children:[D.jsx("strong",{children:"Email:"})," ",T||"Not provided"]}),D.jsxs("p",{children:[D.jsx("strong",{children:"Date of Birth:"})," ",f?new Date(f).toLocaleDateString():"Not provided"]})]})}),D.jsx("footer",{className:"profile-footer",children:d?D.jsxs("div",{className:"form-buttons",children:[D.jsx("button",{className:"cancel-btn",onClick:k,children:"Cancel"}),D.jsx("button",{className:"save-btn",onClick:G,children:"Save Changes"})]}):D.jsxs("div",{className:"form-buttons",children:[D.jsx("button",{className:"back-btn",onClick:()=>e(-1),children:"Go Back"}),D.jsx("button",{className:"edit-btn",onClick:()=>l(!0),children:"Edit Profile"})]})})]})};var LW={};const MW=()=>{const[t,e]=z.useState(null),[n,r]=z.useState(""),[i,o]=z.useState(""),[s,a]=z.useState(!1),c=l=>{e(l.target.files[0]),o("")},d=async l=>{if(l.preventDefault(),r(""),o(""),a(!0),!t){o("Please select a file to upload."),a(!1);return}const u=new FormData;u.append("image",t);try{const h=await Re.post(`${LW.REACT_APP_BACKEND_URL}/detect-emotion`,u,{headers:{"Content-Type":"multipart/form-data"}});console.log("Full response from server:",h),console.log("Emotion detected:",h.data.emotion),h.data&&h.data.emotion?r(h.data.emotion):o("Unexpected response format.")}catch(h){console.error("Error during API request:",h),o("Error detecting emotion. Please try again.")}finally{a(!1)}};return D.jsxs("div",{children:[D.jsx("h1",{children:"Emotion Detection"}),D.jsxs("form",{onSubmit:d,children:[D.jsx("input",{type:"file",onChange:c}),D.jsx("button",{type:"submit",disabled:s,children:s?"Detecting...":"Detect Emotion"})]}),n&&D.jsxs("p",{children:["Detected Emotion: ",n]}),i&&D.jsx("p",{style:{color:"red"},children:i})]})},UW=()=>{const{token:t}=RM(),[e,n]=z.useState(""),[r,i]=z.useState(""),[o,s]=z.useState(""),a=Ro(),c=h=>{n(h.target.value)},d=h=>{i(h.target.value)},l=h=>/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(h)?null:"Password must be at least 8 characters long, and contain at least one uppercase letter, one lowercase letter, and one number.",u=async h=>{h.preventDefault();const p=l(e);if(p){s(p);return}if(e!==r){s("Passwords do not match.");return}try{const S=await _W(t,e);alert("Password has been reset. You can now log in with your new password."),console.log(e),a("/login")}catch(S){S.response&&S.response.status===400?s("Invalid or expired token."):s("Unable to reset password. Please try again later."),console.error(S)}};return D.jsxs("div",{className:"form-container",children:[D.jsx("h2",{children:"Reset Your Password"}),D.jsxs("form",{onSubmit:u,children:[D.jsx("input",{type:"password",placeholder:"New Password",value:e,onChange:c,required:!0,className:"input-field"}),D.jsx("input",{type:"password",placeholder:"Confirm New Password",value:r,onChange:d,required:!0,className:"input-field"}),o&&D.jsx("p",{className:"error-message",children:o}),D.jsx("button",{type:"submit",children:"Reset Password"})]})]})},xW=()=>{const[t,e]=z.useState(""),[n,r]=z.useState(""),[i,o]=z.useState(30),[s,a]=z.useState(""),c=async d=>{d.preventDefault();try{const l=await Re.post("https://autism-sense-backend.onrender.com/api/zoom/create-meeting",{topic:t,startTime:n,duration:i,password:s});alert(`Meeting created: ${l.data.join_url}`)}catch(l){console.error("Error creating meeting:",l),alert("Failed to create meeting. Please try again.")}};return D.jsxs("div",{children:[D.jsx("h2",{children:"Create Zoom Meeting"}),D.jsxs("form",{onSubmit:c,children:[D.jsxs("div",{children:[D.jsx("label",{children:"Meeting Topic:"}),D.jsx("input",{type:"text",value:t,onChange:d=>e(d.target.value),required:!0})]}),D.jsxs("div",{children:[D.jsx("label",{children:"Start Time:"}),D.jsx("input",{type:"datetime-local",value:n,onChange:d=>r(d.target.value),required:!0})]}),D.jsxs("div",{children:[D.jsx("label",{children:"Duration (minutes):"}),D.jsx("input",{type:"number",value:i,onChange:d=>o(d.target.value),required:!0,min:"1"})]}),D.jsxs("div",{children:[D.jsx("label",{children:"Meeting Password:"}),D.jsx("input",{type:"text",value:s,onChange:d=>a(d.target.value)})]}),D.jsx("button",{type:"submit",children:"Create Meeting"})]})]})},VW=()=>{const[t,e]=z.useState([]);return z.useEffect(()=>{(async()=>{try{const r=await Re.get("https://autism-sense-backend.onrender.com/api/zoom/meetings");e(r.data)}catch(r){console.error("Error fetching meetings:",r)}})()},[]),D.jsxs("div",{children:[D.jsx("h2",{children:"Your Zoom Meetings"}),t.length===0?D.jsx("p",{children:"No meetings scheduled."}):D.jsx("ul",{children:t.map(n=>D.jsxs("li",{children:[D.jsx("strong",{children:n.topic}),D.jsx("br",{}),"Start Time: ",new Date(n.start_time).toLocaleString(),D.jsx("br",{}),"Duration: ",n.duration," minutes",D.jsx("br",{}),D.jsx("a",{href:n.join_url,target:"_blank",rel:"noopener noreferrer",children:"Join Meeting"})]},n.id))})]})};var hw={};const FW=()=>{const[t,e]=z.useState(""),[n,r]=z.useState("");Ro();const i=a=>{e(a.target.value)},o=a=>/^https:\/\/(us\d{1,2}web\.zoom\.us|zoom\.us)\/j\/\d{9,11}/.test(a),s=()=>{if(!t||!o(t)){r("Please enter a valid Zoom meeting link.");return}window.location.href=`${hw.REACT_APP_BACKEND_URL}/oauth/authorize?redirect_uri=${hw.REACT_APP_FRONTEND_URL}/oauth/callback&zoomLink=${t}`};return D.jsxs("div",{children:[D.jsx("h3",{children:"Enter Zoom Meeting Link"}),D.jsx("input",{type:"text",value:t,onChange:i,placeholder:"Enter Zoom Meeting Link"}),D.jsx("button",{onClick:s,children:"Join Meeting"}),n&&D.jsx("p",{children:n})]})};function jW(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}var fd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function de(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Pe=function(t){try{return!!t()}catch{return!0}},f_=!Pe(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),rU=f_,iU=Function.prototype,ev=iU.call,BW=rU&&iU.bind.bind(ev,ev),Ae=rU?BW:function(t){return function(){return ev.apply(t,arguments)}},Mn=Ae({}.isPrototypeOf),tp=function(t){return t&&t.Math==Math&&t},Le=tp(typeof globalThis=="object"&&globalThis)||tp(typeof window=="object"&&window)||tp(typeof self=="object"&&self)||tp(typeof fd=="object"&&fd)||function(){return this}()||fd||Function("return this")(),GW=f_,oU=Function.prototype,pw=oU.apply,fw=oU.call,m_=typeof Reflect=="object"&&Reflect.apply||(GW?fw.bind(pw):function(){return fw.apply(pw,arguments)}),sU=Ae,WW=sU({}.toString),HW=sU("".slice),Co=function(t){return HW(WW(t),8,-1)},KW=Co,zW=Ae,Bu=function(t){if(KW(t)==="Function")return zW(t)},AE=typeof document=="object"&&document.all,__={all:AE,IS_HTMLDDA:AE===void 0&&AE!==void 0},YW=__.all,Qe=__.IS_HTMLDDA?function(t){return typeof t=="function"||t===YW}:function(t){return typeof t=="function"},Rh={},Qr=!Pe(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),$W=f_,ep=Function.prototype.call,dn=$W?ep.bind(ep):function(){return ep.apply(ep,arguments)},E_={},aU={}.propertyIsEnumerable,cU=Object.getOwnPropertyDescriptor,qW=cU&&!aU.call({1:2},1);E_.f=qW?function(t){var e=cU(this,t);return!!e&&e.enumerable}:aU;var as,uf,ra=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},JW=Pe,XW=Co,OE=Object,QW=Ae("".split),g_=JW(function(){return!OE("z").propertyIsEnumerable(0)})?function(t){return XW(t)=="String"?QW(t,""):OE(t)}:OE,$d=function(t){return t==null},ZW=$d,t5=TypeError,qd=function(t){if(ZW(t))throw t5("Can't call method on "+t);return t},e5=g_,n5=qd,ia=function(t){return e5(n5(t))},mw=Qe,r5=__.all,Pr=__.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:mw(t)||t===r5}:function(t){return typeof t=="object"?t!==null:mw(t)},Zr={},bE=Zr,NE=Le,i5=Qe,_w=function(t){return i5(t)?t:void 0},ur=function(t,e){return arguments.length<2?_w(bE[t])||_w(NE[t]):bE[t]&&bE[t][e]||NE[t]&&NE[t][e]},oa=typeof navigator<"u"&&String(navigator.userAgent)||"",dU=Le,PE=oa,Ew=dU.process,gw=dU.Deno,Sw=Ew&&Ew.versions||gw&&gw.version,Tw=Sw&&Sw.v8;Tw&&(uf=(as=Tw.split("."))[0]>0&&as[0]<4?1:+(as[0]+as[1])),!uf&&PE&&(!(as=PE.match(/Edge\/(\d+)/))||as[1]>=74)&&(as=PE.match(/Chrome\/(\d+)/))&&(uf=+as[1]);var Za=uf,vw=Za,o5=Pe,s5=Le.String,Jd=!!Object.getOwnPropertySymbols&&!o5(function(){var t=Symbol();return!s5(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&vw&&vw<41}),lU=Jd&&!Symbol.sham&&typeof Symbol.iterator=="symbol",a5=ur,c5=Qe,d5=Mn,l5=Object,Ch=lU?function(t){return typeof t=="symbol"}:function(t){var e=a5("Symbol");return c5(e)&&d5(e.prototype,l5(t))},u5=String,Xd=function(t){try{return u5(t)}catch{return"Object"}},h5=Qe,p5=Xd,f5=TypeError,ti=function(t){if(h5(t))return t;throw f5(p5(t)+" is not a function")},m5=ti,_5=$d,S_=function(t,e){var n=t[e];return _5(n)?void 0:m5(n)},yw=dn,Rw=Qe,Cw=Pr,E5=TypeError,uU={exports:{}},Iw=Le,g5=Object.defineProperty,S5=function(t,e){try{g5(Iw,t,{value:e,configurable:!0,writable:!0})}catch{Iw[t]=e}return e},ww="__core-js_shared__",_R=Le[ww]||S5(ww,{}),Aw=_R;(uU.exports=function(t,e){return Aw[t]||(Aw[t]=e!==void 0?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Qd=uU.exports,T5=qd,v5=Object,Io=function(t){return v5(T5(t))},y5=Io,R5=Ae({}.hasOwnProperty),fn=Object.hasOwn||function(t,e){return R5(y5(t),e)},C5=Ae,I5=0,w5=Math.random(),A5=C5(1 .toString),ER=function(t){return"Symbol("+(t===void 0?"":t)+")_"+A5(++I5+w5,36)},O5=Qd,Ow=fn,b5=ER,N5=Jd,P5=lU,Xc=Le.Symbol,DE=O5("wks"),D5=P5?Xc.for||Xc:Xc&&Xc.withoutSetter||b5,Ce=function(t){return Ow(DE,t)||(DE[t]=N5&&Ow(Xc,t)?Xc[t]:D5("Symbol."+t)),DE[t]},k5=dn,bw=Pr,Nw=Ch,L5=S_,M5=function(t,e){var n,r;if(Rw(n=t.toString)&&!Cw(r=yw(n,t))||Rw(n=t.valueOf)&&!Cw(r=yw(n,t)))return r;throw E5("Can't convert object to primitive value")},U5=TypeError,x5=Ce("toPrimitive"),V5=function(t,e){if(!bw(t)||Nw(t))return t;var n,r=L5(t,x5);if(r){if(n=k5(r,t,e),!bw(n)||Nw(n))return n;throw U5("Can't convert object to primitive value")}return M5(t)},F5=Ch,T_=function(t){var e=V5(t,"string");return F5(e)?e:e+""},Pw=Pr,nv=Le.document,j5=Pw(nv)&&Pw(nv.createElement),gR=function(t){return j5?nv.createElement(t):{}},B5=gR,hU=!Qr&&!Pe(function(){return Object.defineProperty(B5("div"),"a",{get:function(){return 7}}).a!=7}),G5=Qr,W5=dn,H5=E_,K5=ra,z5=ia,Y5=T_,$5=fn,q5=hU,Dw=Object.getOwnPropertyDescriptor;Rh.f=G5?Dw:function(t,e){if(t=z5(t),e=Y5(e),q5)try{return Dw(t,e)}catch{}if($5(t,e))return K5(!W5(H5.f,t,e),t[e])};var J5=Pe,X5=Qe,Q5=/#|\.prototype\./,Ih=function(t,e){var n=tH[Z5(t)];return n==nH||n!=eH&&(X5(e)?J5(e):!!e)},Z5=Ih.normalize=function(t){return String(t).replace(Q5,".").toLowerCase()},tH=Ih.data={},eH=Ih.NATIVE="N",nH=Ih.POLYFILL="P",pU=Ih,rH=ti,iH=f_,oH=Bu(Bu.bind),sa=function(t,e){return rH(t),e===void 0?t:iH?oH(t,e):function(){return t.apply(e,arguments)}},wi={},fU=Qr&&Pe(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),sH=Pr,aH=String,cH=TypeError,Qn=function(t){if(sH(t))return t;throw cH(aH(t)+" is not an object")},dH=Qr,lH=hU,uH=fU,np=Qn,kw=T_,hH=TypeError,kE=Object.defineProperty,pH=Object.getOwnPropertyDescriptor,LE="enumerable",ME="configurable",UE="writable";wi.f=dH?uH?function(t,e,n){if(np(t),e=kw(e),np(n),typeof t=="function"&&e==="prototype"&&"value"in n&&UE in n&&!n[UE]){var r=pH(t,e);r&&r[UE]&&(t[e]=n.value,n={configurable:ME in n?n[ME]:r[ME],enumerable:LE in n?n[LE]:r[LE],writable:!1})}return kE(t,e,n)}:kE:function(t,e,n){if(np(t),e=kw(e),np(n),lH)try{return kE(t,e,n)}catch{}if("get"in n||"set"in n)throw hH("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var fH=wi,mH=ra,aa=Qr?function(t,e,n){return fH.f(t,e,mH(1,n))}:function(t,e,n){return t[e]=n,t},rp=Le,_H=m_,EH=Bu,gH=Qe,SH=Rh.f,TH=pU,mc=Zr,vH=sa,_c=aa,Lw=fn,yH=function(t){var e=function(n,r,i){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,i)}return _H(t,this,arguments)};return e.prototype=t.prototype,e},Bt=function(t,e){var n,r,i,o,s,a,c,d,l,u=t.target,h=t.global,p=t.stat,S=t.proto,f=h?rp:p?rp[u]:(rp[u]||{}).prototype,_=h?mc:mc[u]||_c(mc,u,{})[u],T=_.prototype;for(o in e)r=!(n=TH(h?o:u+(p?".":"#")+o,t.forced))&&f&&Lw(f,o),a=_[o],r&&(c=t.dontCallGetSet?(l=SH(f,o))&&l.value:f[o]),s=r&&c?c:e[o],r&&typeof a==typeof s||(d=t.bind&&r?vH(s,rp):t.wrap&&r?yH(s):S&&gH(s)?EH(s):s,(t.sham||s&&s.sham||a&&a.sham)&&_c(d,"sham",!0),_c(_,o,d),S&&(Lw(mc,i=u+"Prototype")||_c(mc,i,{}),_c(mc[i],o,s),t.real&&T&&(n||!T[o])&&_c(T,o,s)))},RH=Math.ceil,CH=Math.floor,IH=Math.trunc||function(t){var e=+t;return(e>0?CH:RH)(e)},wH=IH,SR=function(t){var e=+t;return e!=e||e===0?0:wH(e)},AH=SR,OH=Math.max,bH=Math.min,TR=function(t,e){var n=AH(t);return n<0?OH(n+e,0):bH(n,e)},NH=SR,PH=Math.min,mU=function(t){return t>0?PH(NH(t),9007199254740991):0},DH=mU,ns=function(t){return DH(t.length)},kH=ia,LH=TR,MH=ns,Mw=function(t){return function(e,n,r){var i,o=kH(e),s=MH(o),a=LH(r,s);if(t&&n!=n){for(;s>a;)if((i=o[a++])!=i)return!0}else for(;s>a;a++)if((t||a in o)&&o[a]===n)return t||a||0;return!t&&-1}},vR={includes:Mw(!0),indexOf:Mw(!1)},UH=vR.includes;Bt({target:"Array",proto:!0,forced:Pe(function(){return!Array(1).includes()})},{includes:function(t){return UH(this,t,arguments.length>1?arguments[1]:void 0)}});var xH=Zr,Ai=function(t){return xH[t+"Prototype"]},VH=Ai("Array").includes,FH=Pr,jH=Co,BH=Ce("match"),_U=function(t){var e;return FH(t)&&((e=t[BH])!==void 0?!!e:jH(t)=="RegExp")},GH=_U,WH=TypeError,EU={};EU[Ce("toStringTag")]="z";var yR=String(EU)==="[object z]",HH=yR,KH=Qe,hf=Co,zH=Ce("toStringTag"),YH=Object,$H=hf(function(){return arguments}())=="Arguments",wo=HH?hf:function(t){var e,n,r;return t===void 0?"Undefined":t===null?"Null":typeof(n=function(i,o){try{return i[o]}catch{}}(e=YH(t),zH))=="string"?n:$H?hf(e):(r=hf(e))=="Object"&&KH(e.callee)?"Arguments":r},qH=wo,JH=String,ei=function(t){if(qH(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return JH(t)},XH=Ce("match"),QH=Bt,ZH=function(t){if(GH(t))throw WH("The method doesn't accept regular expressions");return t},t6=qd,Uw=ei,e6=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[XH]=!1,"/./"[t](e)}catch{}}return!1},n6=Ae("".indexOf);QH({target:"String",proto:!0,forced:!e6("includes")},{includes:function(t){return!!~n6(Uw(t6(this)),Uw(ZH(t)),arguments.length>1?arguments[1]:void 0)}});var r6=Ai("String").includes,xw=Mn,i6=VH,o6=r6,xE=Array.prototype,VE=String.prototype,s6=function(t){var e=t.includes;return t===xE||xw(xE,t)&&e===xE.includes?i6:typeof t=="string"||t===VE||xw(VE,t)&&e===VE.includes?o6:e},$=de(s6),a6=ti,c6=Io,d6=g_,l6=ns,u6=TypeError,Vw=function(t){return function(e,n,r,i){a6(n);var o=c6(e),s=d6(o),a=l6(o),c=t?a-1:0,d=t?-1:1;if(r<2)for(;;){if(c in s){i=s[c],c+=d;break}if(c+=d,t?c<0:a<=c)throw u6("Reduce of empty array with no initial value")}for(;t?c>=0:a>c;c+=d)c in s&&(i=n(i,s[c],c,o));return i}},h6={left:Vw(!1),right:Vw(!0)},p6=Pe,v_=function(t,e){var n=[][t];return!!n&&p6(function(){n.call(null,e||function(){return 1},1)})},Zd=typeof process<"u"&&Co(process)=="process",f6=h6.left;Bt({target:"Array",proto:!0,forced:!Zd&&Za>79&&Za<83||!v_("reduce")},{reduce:function(t){var e=arguments.length;return f6(this,t,e,e>1?arguments[1]:void 0)}});var m6=Ai("Array").reduce,_6=Mn,E6=m6,FE=Array.prototype,g6=function(t){var e=t.reduce;return t===FE||_6(FE,t)&&e===FE.reduce?E6:e},gU=g6,zi=de(gU);let SU=!0,TU=!0;function ip(t,e,n){const r=t.match(e);return r&&r.length>=n&&parseInt(r[n],10)}function dc(t,e,n){if(!t.RTCPeerConnection)return;const r=t.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(s,a){if(s!==e)return i.apply(this,arguments);const c=d=>{const l=n(d);l&&(a.handleEvent?a.handleEvent(l):a(l))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(a,c),i.apply(this,[s,c])};const o=r.removeEventListener;r.removeEventListener=function(s,a){if(s!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(a))return o.apply(this,arguments);const c=this._eventMap[e].get(a);return this._eventMap[e].delete(a),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[s,c])},Object.defineProperty(r,"on"+e,{get(){return this["_on"+e]},set(s){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),s&&this.addEventListener(e,this["_on"+e]=s)},enumerable:!0,configurable:!0})}function S6(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(SU=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function T6(t){return typeof t!="boolean"?new Error("Argument type: "+typeof t+". Please use a boolean."):(TU=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function vU(){if(typeof window=="object"){if(SU)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function RR(t,e){TU&&console.warn(t+" is deprecated, please use "+e+" instead.")}function Fw(t){return Object.prototype.toString.call(t)==="[object Object]"}function yU(t){var e;return Fw(t)?zi(e=Object.keys(t)).call(e,function(n,r){const i=Fw(t[r]),o=i?yU(t[r]):t[r],s=i&&!Object.keys(o).length;return o===void 0||s?n:Object.assign(n,{[r]:o})},{}):t}function rv(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach(r=>{r.endsWith("Id")?rv(t,t.get(e[r]),n):r.endsWith("Ids")&&e[r].forEach(i=>{rv(t,t.get(i),n)})}))}function jw(t,e,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(e===null)return i;const o=[];return t.forEach(s=>{s.type==="track"&&s.trackIdentifier===e.id&&o.push(s)}),o.forEach(s=>{t.forEach(a=>{a.type===r&&a.trackId===s.id&&rv(t,a,i)})}),i}var v6=ER,Bw=Qd("keys"),y_=function(t){return Bw[t]||(Bw[t]=v6(t))},y6=!Pe(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),R6=fn,C6=Qe,I6=Io,w6=y6,Gw=y_("IE_PROTO"),iv=Object,A6=iv.prototype,CR=w6?iv.getPrototypeOf:function(t){var e=I6(t);if(R6(e,Gw))return e[Gw];var n=e.constructor;return C6(n)&&e instanceof n?n.prototype:e instanceof iv?A6:null},O6=Ae,b6=ti,N6=Qe,P6=String,D6=TypeError,k6=function(t,e,n){try{return O6(b6(Object.getOwnPropertyDescriptor(t,e)[n]))}catch{}},L6=Qn,M6=function(t){if(typeof t=="object"||N6(t))return t;throw D6("Can't set "+P6(t)+" as a prototype")},U6=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=k6(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch{}return function(r,i){return L6(r),M6(i),e?t(r,i):r.__proto__=i,r}}():void 0),R_={},C_={},jE=fn,x6=ia,V6=vR.indexOf,F6=C_,Ww=Ae([].push),RU=function(t,e){var n,r=x6(t),i=0,o=[];for(n in r)!jE(F6,n)&&jE(r,n)&&Ww(o,n);for(;e.length>i;)jE(r,n=e[i++])&&(~V6(o,n)||Ww(o,n));return o},IR=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],j6=RU,B6=IR.concat("length","prototype");R_.f=Object.getOwnPropertyNames||function(t){return j6(t,B6)};var wh={};wh.f=Object.getOwnPropertySymbols;var G6=ur,W6=R_,H6=wh,K6=Qn,z6=Ae([].concat),Y6=G6("Reflect","ownKeys")||function(t){var e=W6.f(K6(t)),n=H6.f;return n?z6(e,n(t)):e},Hw=fn,$6=Y6,q6=Rh,J6=wi,wR={},X6=RU,Q6=IR,I_=Object.keys||function(t){return X6(t,Q6)},Z6=Qr,tK=fU,eK=wi,nK=Qn,rK=ia,iK=I_;wR.f=Z6&&!tK?Object.defineProperties:function(t,e){nK(t);for(var n,r=rK(e),i=iK(e),o=i.length,s=0;o>s;)eK.f(t,n=i[s++],r[n]);return t};var op,CU=ur("document","documentElement"),oK=Qn,sK=wR,Kw=IR,aK=C_,cK=CU,dK=gR,ov="prototype",sv="script",IU=y_("IE_PROTO"),BE=function(){},wU=function(t){return"<"+sv+">"+t+"</"+sv+">"},zw=function(t){t.write(wU("")),t.close();var e=t.parentWindow.Object;return t=null,e},pf=function(){try{op=new ActiveXObject("htmlfile")}catch{}var t,e,n;pf=typeof document<"u"?document.domain&&op?zw(op):(e=dK("iframe"),n="java"+sv+":",e.style.display="none",cK.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(wU("document.F=Object")),t.close(),t.F):zw(op);for(var r=Kw.length;r--;)delete pf[ov][Kw[r]];return pf()};aK[IU]=!0;var Ah=Object.create||function(t,e){var n;return t!==null?(BE[ov]=oK(t),n=new BE,BE[ov]=null,n[IU]=t):n=pf(),e===void 0?n:sK.f(n,e)},lK=Pr,uK=aa,AU=Error,hK=Ae("".replace),pK=String(AU("zxcasd").stack),OU=/\n\s*at [^:]*:[^\n]*/,fK=OU.test(pK),mK=ra,_K=!Pe(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",mK(1,7)),t.stack!==7)}),EK=aa,gK=function(t,e){if(fK&&typeof t=="string"&&!AU.prepareStackTrace)for(;e--;)t=hK(t,OU,"");return t},SK=_K,Yw=Error.captureStackTrace,lc={},TK=lc,vK=Ce("iterator"),yK=Array.prototype,bU=function(t){return t!==void 0&&(TK.Array===t||yK[vK]===t)},RK=wo,$w=S_,CK=$d,IK=lc,wK=Ce("iterator"),w_=function(t){if(!CK(t))return $w(t,wK)||$w(t,"@@iterator")||IK[RK(t)]},AK=dn,OK=ti,bK=Qn,NK=Xd,PK=w_,DK=TypeError,AR=function(t,e){var n=arguments.length<2?PK(t):e;if(OK(n))return bK(AK(n,t));throw DK(NK(t)+" is not iterable")},kK=dn,qw=Qn,LK=S_,NU=function(t,e,n){var r,i;qw(t);try{if(!(r=LK(t,"return"))){if(e==="throw")throw n;return n}r=kK(r,t)}catch(o){i=!0,r=o}if(e==="throw")throw n;if(i)throw r;return qw(r),n},MK=sa,UK=dn,xK=Qn,VK=Xd,FK=bU,jK=ns,Jw=Mn,BK=AR,GK=w_,Xw=NU,WK=TypeError,ff=function(t,e){this.stopped=t,this.result=e},Qw=ff.prototype,Oh=function(t,e,n){var r,i,o,s,a,c,d,l=n&&n.that,u=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),p=!(!n||!n.IS_ITERATOR),S=!(!n||!n.INTERRUPTED),f=MK(e,l),_=function(g){return r&&Xw(r,"normal",g),new ff(!0,g)},T=function(g){return u?(xK(g),S?f(g[0],g[1],_):f(g[0],g[1])):S?f(g,_):f(g)};if(h)r=t.iterator;else if(p)r=t;else{if(!(i=GK(t)))throw WK(VK(t)+" is not iterable");if(FK(i)){for(o=0,s=jK(t);s>o;o++)if((a=T(t[o]))&&Jw(Qw,a))return a;return new ff(!1)}r=BK(t,i)}for(c=h?t.next:r.next;!(d=UK(c,r)).done;){try{a=T(d.value)}catch(g){Xw(r,"throw",g)}if(typeof a=="object"&&a&&Jw(Qw,a))return a}return new ff(!1)},HK=ei,KK=Bt,zK=Mn,YK=CR,mm=U6,$K=function(t,e,n){for(var r=$6(e),i=J6.f,o=q6.f,s=0;s<r.length;s++){var a=r[s];Hw(t,a)||n&&Hw(n,a)||i(t,a,o(e,a))}},PU=Ah,GE=aa,WE=ra,qK=function(t,e){lK(e)&&"cause"in e&&uK(t,"cause",e.cause)},JK=function(t,e,n,r){SK&&(Yw?Yw(t,e):EK(t,"stack",gK(n,r)))},XK=Oh,QK=function(t,e){return t===void 0?arguments.length<2?"":e:HK(t)},ZK=Ce("toStringTag"),_m=Error,t8=[].push,Pd=function(t,e){var n,r=zK(HE,this);mm?n=mm(_m(),r?YK(this):HE):(n=r?this:PU(HE),GE(n,ZK,"Error")),e!==void 0&&GE(n,"message",QK(e)),JK(n,Pd,n.stack,1),arguments.length>2&&qK(n,arguments[2]);var i=[];return XK(t,t8,{that:i}),GE(n,"errors",i),n};mm?mm(Pd,_m):$K(Pd,_m,{name:!0});var HE=Pd.prototype=PU(_m.prototype,{constructor:WE(1,Pd),message:WE(1,""),name:WE(1,"AggregateError")});KK({global:!0,constructor:!0,arity:2},{AggregateError:Pd});var Em,su,gm,e8=Qe,Zw=Le.WeakMap,n8=e8(Zw)&&/native code/.test(String(Zw)),DU=Le,r8=Pr,i8=aa,KE=fn,zE=_R,o8=y_,s8=C_,t0="Object already initialized",av=DU.TypeError,a8=DU.WeakMap;if(n8||zE.state){var Zi=zE.state||(zE.state=new a8);Zi.get=Zi.get,Zi.has=Zi.has,Zi.set=Zi.set,Em=function(t,e){if(Zi.has(t))throw av(t0);return e.facade=t,Zi.set(t,e),e},su=function(t){return Zi.get(t)||{}},gm=function(t){return Zi.has(t)}}else{var Ec=o8("state");s8[Ec]=!0,Em=function(t,e){if(KE(t,Ec))throw av(t0);return e.facade=t,i8(t,Ec,e),e},su=function(t){return KE(t,Ec)?t[Ec]:{}},gm=function(t){return KE(t,Ec)}}var Wa,e0,n0,uc={set:Em,get:su,has:gm,enforce:function(t){return gm(t)?su(t):Em(t,{})},getterFor:function(t){return function(e){var n;if(!r8(e)||(n=su(e)).type!==t)throw av("Incompatible receiver, "+t+" required");return n}}},cv=Qr,c8=fn,kU=Function.prototype,d8=cv&&Object.getOwnPropertyDescriptor,YE=c8(kU,"name"),LU={EXISTS:YE,PROPER:YE&&(function(){}).name==="something",CONFIGURABLE:YE&&(!cv||cv&&d8(kU,"name").configurable)},l8=aa,ca=function(t,e,n,r){return r&&r.enumerable?t[e]=n:l8(t,e,n),t},u8=Pe,h8=Qe,p8=Pr,f8=Ah,r0=CR,m8=ca,dv=Ce("iterator"),MU=!1;[].keys&&("next"in(n0=[].keys())?(e0=r0(r0(n0)))!==Object.prototype&&(Wa=e0):MU=!0);var _8=!p8(Wa)||u8(function(){var t={};return Wa[dv].call(t)!==t});h8((Wa=_8?{}:f8(Wa))[dv])||m8(Wa,dv,function(){return this});var UU={IteratorPrototype:Wa,BUGGY_SAFARI_ITERATORS:MU},E8=wo,g8=yR?{}.toString:function(){return"[object "+E8(this)+"]"},S8=yR,T8=wi.f,v8=aa,y8=fn,R8=g8,i0=Ce("toStringTag"),da=function(t,e,n,r){if(t){var i=n?t:t.prototype;y8(i,i0)||T8(i,i0,{configurable:!0,value:e}),r&&!S8&&v8(i,"toString",R8)}},C8=UU.IteratorPrototype,I8=Ah,w8=ra,A8=da,O8=lc,b8=function(){return this},OR=function(t,e,n,r){var i=e+" Iterator";return t.prototype=I8(C8,{next:w8(+!r,n)}),A8(t,i,!1,!0),O8[i]=b8,t},N8=Bt,P8=dn,D8=LU,k8=OR,L8=CR,M8=da,o0=ca,s0=lc,U8=UU,x8=D8.PROPER,sp=U8.BUGGY_SAFARI_ITERATORS,$E=Ce("iterator"),a0="keys",ap="values",c0="entries",V8=function(){return this},xU=function(t,e,n,r,i,o,s){k8(n,e,r);var a,c,d,l=function(T){if(T===i&&f)return f;if(!sp&&T in p)return p[T];switch(T){case a0:case ap:case c0:return function(){return new n(this,T)}}return function(){return new n(this)}},u=e+" Iterator",h=!1,p=t.prototype,S=p[$E]||p["@@iterator"]||i&&p[i],f=!sp&&S||l(i),_=e=="Array"&&p.entries||S;if(_&&(a=L8(_.call(new t)))!==Object.prototype&&a.next&&(M8(a,u,!0,!0),s0[u]=V8),x8&&i==ap&&S&&S.name!==ap&&(h=!0,f=function(){return P8(S,this)}),i)if(c={values:l(ap),keys:o?f:l(a0),entries:l(c0)},s)for(d in c)(sp||h||!(d in p))&&o0(p,d,c[d]);else N8({target:e,proto:!0,forced:sp||h},c);return s&&p[$E]!==f&&o0(p,$E,f,{name:i}),s0[e]=f,c},bR=function(t,e){return{value:t,done:e}},F8=ia,d0=lc,VU=uc;wi.f;var j8=xU,l0=bR,FU="Array Iterator",B8=VU.set,G8=VU.getterFor(FU);j8(Array,"Array",function(t,e){B8(this,{type:FU,target:F8(t),index:0,kind:e})},function(){var t=G8(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,l0(void 0,!0)):l0(n=="keys"?r:n=="values"?e[r]:[r,e[r]],!1)},"values"),d0.Arguments=d0.Array;var W8=wi,A_=function(t,e,n){return W8.f(t,e,n)},H8=ur,K8=A_,z8=Qr,u0=Ce("species"),Y8=Mn,$8=TypeError,NR=function(t,e){if(Y8(e,t))return t;throw $8("Incorrect invocation")},q8=Qe,lv=_R,J8=Ae(Function.toString);q8(lv.inspectSource)||(lv.inspectSource=function(t){return J8(t)});var jU=lv.inspectSource,X8=Ae,Q8=Pe,BU=Qe,Z8=wo,tz=jU,GU=function(){},ez=[],WU=ur("Reflect","construct"),PR=/^\s*(?:class|function)\b/,nz=X8(PR.exec),rz=!PR.exec(GU),Tl=function(t){if(!BU(t))return!1;try{return WU(GU,ez,t),!0}catch{return!1}},HU=function(t){if(!BU(t))return!1;switch(Z8(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return rz||!!nz(PR,tz(t))}catch{return!0}};HU.sham=!0;var Gu,gc,h0,qE,O_=!WU||Q8(function(){var t;return Tl(Tl.call)||!Tl(Object)||!Tl(function(){t=!0})||t})?HU:Tl,iz=O_,oz=Xd,sz=TypeError,p0=Qn,az=function(t){if(iz(t))return t;throw sz(oz(t)+" is not a constructor")},cz=$d,dz=Ce("species"),DR=function(t,e){var n,r=p0(t).constructor;return r===void 0||cz(n=p0(r)[dz])?e:az(n)},b_=Ae([].slice),lz=TypeError,tl=function(t,e){if(t<e)throw lz("Not enough arguments");return t},KU=/(?:ipad|iphone|ipod).*applewebkit/i.test(oa),Wr=Le,uz=m_,hz=sa,f0=Qe,pz=fn,zU=Pe,m0=CU,fz=b_,_0=gR,mz=tl,_z=KU,Ez=Zd,uv=Wr.setImmediate,hv=Wr.clearImmediate,gz=Wr.process,JE=Wr.Dispatch,Sz=Wr.Function,E0=Wr.MessageChannel,Tz=Wr.String,XE=0,au={},g0="onreadystatechange";zU(function(){Gu=Wr.location});var kR=function(t){if(pz(au,t)){var e=au[t];delete au[t],e()}},QE=function(t){return function(){kR(t)}},S0=function(t){kR(t.data)},T0=function(t){Wr.postMessage(Tz(t),Gu.protocol+"//"+Gu.host)};uv&&hv||(uv=function(t){mz(arguments.length,1);var e=f0(t)?t:Sz(t),n=fz(arguments,1);return au[++XE]=function(){uz(e,void 0,n)},gc(XE),XE},hv=function(t){delete au[t]},Ez?gc=function(t){gz.nextTick(QE(t))}:JE&&JE.now?gc=function(t){JE.now(QE(t))}:E0&&!_z?(qE=(h0=new E0).port2,h0.port1.onmessage=S0,gc=hz(qE.postMessage,qE)):Wr.addEventListener&&f0(Wr.postMessage)&&!Wr.importScripts&&Gu&&Gu.protocol!=="file:"&&!zU(T0)?(gc=T0,Wr.addEventListener("message",S0,!1)):gc=g0 in _0("script")?function(t){m0.appendChild(_0("script"))[g0]=function(){m0.removeChild(this),kR(t)}}:function(t){setTimeout(QE(t),0)});var N_={set:uv,clear:hv},YU=function(){this.head=null,this.tail=null};YU.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return(this.head=t.next)===null&&(this.tail=null),t.item}};var Sc,ZE,tg,eg,v0,$U=YU,vz=/ipad|iphone|ipod/i.test(oa)&&typeof Pebble<"u",yz=/web0s(?!.*chrome)/i.test(oa),tc=Le,y0=sa,Rz=Rh.f,ng=N_.set,Cz=$U,Iz=KU,wz=vz,Az=yz,rg=Zd,R0=tc.MutationObserver||tc.WebKitMutationObserver,C0=tc.document,I0=tc.process,cp=tc.Promise,w0=Rz(tc,"queueMicrotask"),pv=w0&&w0.value;if(!pv){var dp=new Cz,lp=function(){var t,e;for(rg&&(t=I0.domain)&&t.exit();e=dp.get();)try{e()}catch(n){throw dp.head&&Sc(),n}t&&t.enter()};Iz||rg||Az||!R0||!C0?!wz&&cp&&cp.resolve?((eg=cp.resolve(void 0)).constructor=cp,v0=y0(eg.then,eg),Sc=function(){v0(lp)}):rg?Sc=function(){I0.nextTick(lp)}:(ng=y0(ng,tc),Sc=function(){ng(lp)}):(ZE=!0,tg=C0.createTextNode(""),new R0(lp).observe(tg,{characterData:!0}),Sc=function(){tg.data=ZE=!ZE}),pv=function(t){dp.head||Sc(),dp.add(t)}}var qU=pv,el=function(t){try{return{error:!1,value:t()}}catch(e){return{error:!0,value:e}}},ec=Le.Promise,JU=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",Oz=!JU&&!Zd&&typeof window=="object"&&typeof document=="object",bz=Le,cu=ec,Nz=Qe,Pz=pU,Dz=jU,kz=Ce,Lz=Oz,Mz=JU,ig=Za,A0=cu&&cu.prototype,Uz=kz("species"),XU=!1,QU=Nz(bz.PromiseRejectionEvent),xz=Pz("Promise",function(){var t=Dz(cu),e=t!==String(cu);if(!e&&ig===66||!A0.catch||!A0.finally)return!0;if(!ig||ig<51||!/native code/.test(t)){var n=new cu(function(i){i(1)}),r=function(i){i(function(){},function(){})};if((n.constructor={})[Uz]=r,!(XU=n.then(function(){})instanceof r))return!0}return!e&&(Lz||Mz)&&!QU}),bh={CONSTRUCTOR:xz,REJECTION_EVENT:QU,SUBCLASSING:XU},Ao={},O0=ti,Vz=TypeError,Fz=function(t){var e,n;this.promise=new t(function(r,i){if(e!==void 0||n!==void 0)throw Vz("Bad Promise constructor");e=r,n=i}),this.resolve=O0(e),this.reject=O0(n)};Ao.f=function(t){return new Fz(t)};var og,b0,jz=Bt,Sm=Zd,Js=Le,Nh=dn,Bz=ca,Gz=da,Wz=function(t){var e=H8(t);z8&&e&&!e[u0]&&K8(e,u0,{configurable:!0,get:function(){return this}})},Hz=ti,fv=Qe,Kz=Pr,zz=NR,Yz=DR,ZU=N_.set,LR=qU,$z=function(t,e){try{arguments.length==1?console.error(t):console.error(t,e)}catch{}},qz=el,Jz=$U,t2=uc,mv=ec,e2=bh,n2=Ao,mf="Promise",N0=e2.CONSTRUCTOR,Xz=e2.REJECTION_EVENT,sg=t2.getterFor(mf),Qz=t2.set,Zz=mv&&mv.prototype,vl=mv,ag=Zz,r2=Js.TypeError,_v=Js.document,MR=Js.process,Ev=n2.f,tY=Ev,eY=!!(_v&&_v.createEvent&&Js.dispatchEvent),i2="unhandledrejection",o2=function(t){var e;return!(!Kz(t)||!fv(e=t.then))&&e},s2=function(t,e){var n,r,i,o=e.value,s=e.state==1,a=s?t.ok:t.fail,c=t.resolve,d=t.reject,l=t.domain;try{a?(s||(e.rejection===2&&rY(e),e.rejection=1),a===!0?n=o:(l&&l.enter(),n=a(o),l&&(l.exit(),i=!0)),n===t.promise?d(r2("Promise-chain cycle")):(r=o2(n))?Nh(r,n,c,d):c(n)):d(o)}catch(u){l&&!i&&l.exit(),d(u)}},a2=function(t,e){t.notified||(t.notified=!0,LR(function(){for(var n,r=t.reactions;n=r.get();)s2(n,t);t.notified=!1,e&&!t.rejection&&nY(t)}))},c2=function(t,e,n){var r,i;eY?((r=_v.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),Js.dispatchEvent(r)):r={promise:e,reason:n},!Xz&&(i=Js["on"+t])?i(r):t===i2&&$z("Unhandled promise rejection",n)},nY=function(t){Nh(ZU,Js,function(){var e,n=t.facade,r=t.value;if(P0(t)&&(e=qz(function(){Sm?MR.emit("unhandledRejection",r,n):c2(i2,n,r)}),t.rejection=Sm||P0(t)?2:1,e.error))throw e.value})},P0=function(t){return t.rejection!==1&&!t.parent},rY=function(t){Nh(ZU,Js,function(){var e=t.facade;Sm?MR.emit("rejectionHandled",e):c2("rejectionhandled",e,t.value)})},Qc=function(t,e,n){return function(r){t(e,r,n)}},md=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,a2(t,!0))},gv=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw r2("Promise can't be resolved itself");var r=o2(e);r?LR(function(){var i={done:!1};try{Nh(r,e,Qc(gv,i,t),Qc(md,i,t))}catch(o){md(i,o,t)}}):(t.value=e,t.state=1,a2(t,!1))}catch(i){md({done:!1},i,t)}}};N0&&(ag=(vl=function(t){zz(this,ag),Hz(t),Nh(og,this);var e=sg(this);try{t(Qc(gv,e),Qc(md,e))}catch(n){md(e,n)}}).prototype,(og=function(t){Qz(this,{type:mf,done:!1,notified:!1,parent:!1,reactions:new Jz,rejection:!1,state:0,value:void 0})}).prototype=Bz(ag,"then",function(t,e){var n=sg(this),r=Ev(Yz(this,vl));return n.parent=!0,r.ok=!fv(t)||t,r.fail=fv(e)&&e,r.domain=Sm?MR.domain:void 0,n.state==0?n.reactions.add(r):LR(function(){s2(r,n)}),r.promise}),b0=function(){var t=new og,e=sg(t);this.promise=t,this.resolve=Qc(gv,e),this.reject=Qc(md,e)},n2.f=Ev=function(t){return t===vl||t===void 0?new b0(t):tY(t)}),jz({global:!0,constructor:!0,wrap:!0,forced:N0},{Promise:vl}),Gz(vl,mf,!1,!0),Wz(mf);var d2=Ce("iterator"),l2=!1;try{var iY=0,D0={next:function(){return{done:!!iY++}},return:function(){l2=!0}};D0[d2]=function(){return this},Array.from(D0,function(){throw 2})}catch{}var oY=ec,sY=function(t,e){if(!l2)return!1;var n=!1;try{var r={};r[d2]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch{}return n},P_=bh.CONSTRUCTOR||!sY(function(t){oY.all(t).then(void 0,function(){})}),aY=dn,cY=ti,dY=Ao,lY=el,uY=Oh;Bt({target:"Promise",stat:!0,forced:P_},{all:function(t){var e=this,n=dY.f(e),r=n.resolve,i=n.reject,o=lY(function(){var s=cY(e.resolve),a=[],c=0,d=1;uY(t,function(l){var u=c++,h=!1;d++,aY(s,e,l).then(function(p){h||(h=!0,a[u]=p,--d||r(a))},i)}),--d||r(a)});return o.error&&i(o.value),n.promise}});var hY=Bt,pY=bh.CONSTRUCTOR;ec&&ec.prototype,hY({target:"Promise",proto:!0,forced:pY,real:!0},{catch:function(t){return this.then(void 0,t)}});var fY=dn,mY=ti,_Y=Ao,EY=el,gY=Oh;Bt({target:"Promise",stat:!0,forced:P_},{race:function(t){var e=this,n=_Y.f(e),r=n.reject,i=EY(function(){var o=mY(e.resolve);gY(t,function(s){fY(o,e,s).then(n.resolve,r)})});return i.error&&r(i.value),n.promise}});var SY=dn,TY=Ao;Bt({target:"Promise",stat:!0,forced:bh.CONSTRUCTOR},{reject:function(t){var e=TY.f(this);return SY(e.reject,void 0,t),e.promise}});var vY=Qn,yY=Pr,RY=Ao,u2=function(t,e){if(vY(t),yY(e)&&e.constructor===t)return e;var n=RY.f(t);return(0,n.resolve)(e),n.promise},CY=Bt,IY=ec,wY=bh.CONSTRUCTOR,AY=u2,OY=ur("Promise"),bY=!wY;CY({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return AY(bY&&this===OY?IY:this,t)}});var NY=dn,PY=ti,DY=Ao,kY=el,LY=Oh;Bt({target:"Promise",stat:!0,forced:P_},{allSettled:function(t){var e=this,n=DY.f(e),r=n.resolve,i=n.reject,o=kY(function(){var s=PY(e.resolve),a=[],c=0,d=1;LY(t,function(l){var u=c++,h=!1;d++,NY(s,e,l).then(function(p){h||(h=!0,a[u]={status:"fulfilled",value:p},--d||r(a))},function(p){h||(h=!0,a[u]={status:"rejected",reason:p},--d||r(a))})}),--d||r(a)});return o.error&&i(o.value),n.promise}});var MY=dn,UY=ti,xY=ur,VY=Ao,FY=el,jY=Oh,k0="No one promise resolved";Bt({target:"Promise",stat:!0,forced:P_},{any:function(t){var e=this,n=xY("AggregateError"),r=VY.f(e),i=r.resolve,o=r.reject,s=FY(function(){var a=UY(e.resolve),c=[],d=0,l=1,u=!1;jY(t,function(h){var p=d++,S=!1;l++,MY(a,e,h).then(function(f){S||u||(u=!0,i(f))},function(f){S||u||(S=!0,c[p]=f,--l||o(new n(c,k0)))})}),--l||o(new n(c,k0))});return s.error&&o(s.value),r.promise}});var BY=Bt,Sv=ec,GY=Pe,WY=ur,HY=Qe,KY=DR,L0=u2,zY=Sv&&Sv.prototype;BY({target:"Promise",proto:!0,real:!0,forced:!!Sv&&GY(function(){zY.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=KY(this,WY("Promise")),n=HY(t);return this.then(n?function(r){return L0(e,t()).then(function(){return r})}:t,n?function(r){return L0(e,t()).then(function(){throw r})}:t)}});var UR=Ae,YY=SR,$Y=ei,qY=qd,JY=UR("".charAt),M0=UR("".charCodeAt),XY=UR("".slice),U0=function(t){return function(e,n){var r,i,o=$Y(qY(e)),s=YY(n),a=o.length;return s<0||s>=a?t?"":void 0:(r=M0(o,s))<55296||r>56319||s+1===a||(i=M0(o,s+1))<56320||i>57343?t?JY(o,s):r:t?XY(o,s,s+2):i-56320+(r-55296<<10)+65536}},xR={codeAt:U0(!1),charAt:U0(!0)},QY=xR.charAt,ZY=ei,h2=uc,t$=xU,x0=bR,p2="String Iterator",e$=h2.set,n$=h2.getterFor(p2);t$(String,"String",function(t){e$(this,{type:p2,string:ZY(t),index:0})},function(){var t,e=n$(this),n=e.string,r=e.index;return r>=n.length?x0(void 0,!0):(t=QY(n,r),e.index+=t.length,x0(t,!1))});var r$=Zr.Promise,i$={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},o$=Le,s$=wo,a$=aa,V0=lc,F0=Ce("toStringTag");for(var cg in i$){var j0=o$[cg],dg=j0&&j0.prototype;dg&&s$(dg)!==F0&&a$(dg,F0,cg),V0[cg]=V0.Array}var f2=r$,Y=de(f2);const B0=vU;function m2(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const r=function(s){if(typeof s!="object"||s.mandatory||s.optional)return s;const a={};return Object.keys(s).forEach(c=>{if(c==="require"||c==="advanced"||c==="mediaSource")return;const d=typeof s[c]=="object"?s[c]:{ideal:s[c]};d.exact!==void 0&&typeof d.exact=="number"&&(d.min=d.max=d.exact);const l=function(u,h){return u?u+h.charAt(0).toUpperCase()+h.slice(1):h==="deviceId"?"sourceId":h};if(d.ideal!==void 0){a.optional=a.optional||[];let u={};typeof d.ideal=="number"?(u[l("min",c)]=d.ideal,a.optional.push(u),u={},u[l("max",c)]=d.ideal,a.optional.push(u)):(u[l("",c)]=d.ideal,a.optional.push(u))}d.exact!==void 0&&typeof d.exact!="number"?(a.mandatory=a.mandatory||{},a.mandatory[l("",c)]=d.exact):["min","max"].forEach(u=>{d[u]!==void 0&&(a.mandatory=a.mandatory||{},a.mandatory[l(u,c)]=d[u])})}),s.advanced&&(a.optional=(a.optional||[]).concat(s.advanced)),a},i=function(s,a){if(e.version>=61)return a(s);if((s=JSON.parse(JSON.stringify(s)))&&typeof s.audio=="object"){const c=function(d,l,u){l in d&&!(u in d)&&(d[u]=d[l],delete d[l])};c((s=JSON.parse(JSON.stringify(s))).audio,"autoGainControl","googAutoGainControl"),c(s.audio,"noiseSuppression","googNoiseSuppression"),s.audio=r(s.audio)}if(s&&typeof s.video=="object"){let c=s.video.facingMode;c=c&&(typeof c=="object"?c:{ideal:c});const d=e.version<66;if(c&&(c.exact==="user"||c.exact==="environment"||c.ideal==="user"||c.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||d)){let l;if(delete s.video.facingMode,c.exact==="environment"||c.ideal==="environment"?l=["back","rear"]:c.exact!=="user"&&c.ideal!=="user"||(l=["front"]),l)return n.mediaDevices.enumerateDevices().then(u=>{let h=(u=u.filter(p=>p.kind==="videoinput")).find(p=>l.some(S=>{var f;return $(f=p.label.toLowerCase()).call(f,S)}));return!h&&u.length&&$(l).call(l,"back")&&(h=u[u.length-1]),h&&(s.video.deviceId=c.exact?{exact:h.deviceId}:{ideal:h.deviceId}),s.video=r(s.video),B0("chrome: "+JSON.stringify(s)),a(s)})}s.video=r(s.video)}return B0("chrome: "+JSON.stringify(s)),a(s)},o=function(s){return e.version>=64?s:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[s.name]||s.name,message:s.message,constraint:s.constraint||s.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(s,a,c){i(s,d=>{n.webkitGetUserMedia(d,a,l=>{c&&c(o(l))})})}).bind(n),n.mediaDevices.getUserMedia){const s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(a){return i(a,c=>s(c).then(d=>{if(c.audio&&!d.getAudioTracks().length||c.video&&!d.getVideoTracks().length)throw d.getTracks().forEach(l=>{l.stop()}),new DOMException("","NotFoundError");return d},d=>Y.reject(o(d))))}}}function _2(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function E2(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s=>s.track&&s.track.id===r.track.id):{track:r.track};const o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[n.stream],this.dispatchEvent(o)}),n.stream.getTracks().forEach(r=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(s=>s.track&&s.track.id===r.id):{track:r};const o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[n.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else dc(t,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function g2(t){if(typeof t=="object"&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(i,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=i.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:i}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(s,a){let c=i.apply(this,arguments);return c||(c=e(this,s),this._senders.push(c)),c};const o=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(s){o.apply(this,arguments);const a=this._senders.indexOf(s);a!==-1&&this._senders.splice(a,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(e(this,o))})};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{const s=this._senders.find(a=>a.track===o);s&&this._senders.splice(this._senders.indexOf(s),1)})}}else if(typeof t=="object"&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function S2(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[n,r,i]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const o=function(a){const c={};return a.result().forEach(d=>{const l={id:d.id,timestamp:d.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[d.type]||d.type};d.names().forEach(u=>{l[u]=d.stat(u)}),c[l.id]=l}),c},s=function(a){return new Map(Object.keys(a).map(c=>[c,a[c]]))};if(arguments.length>=2){const a=function(c){r(s(o(c)))};return e.apply(this,[a,n])}return new Y((a,c)=>{e.apply(this,[function(d){a(s(o(d)))},c])}).then(r,i)}}function T2(t){if(!(typeof t=="object"&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const n=t.RTCPeerConnection.prototype.getSenders;n&&(t.RTCPeerConnection.prototype.getSenders=function(){const i=n.apply(this,[]);return i.forEach(o=>o._pc=this),i});const r=t.RTCPeerConnection.prototype.addTrack;r&&(t.RTCPeerConnection.prototype.addTrack=function(){const i=r.apply(this,arguments);return i._pc=this,i}),t.RTCRtpSender.prototype.getStats=function(){const i=this;return this._pc.getStats().then(o=>jw(o,i.track,!0))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const n=t.RTCPeerConnection.prototype.getReceivers;n&&(t.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(i=>i._pc=this),r}),dc(t,"track",r=>(r.receiver._pc=r.srcElement,r)),t.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(i=>jw(i,r.track,!1))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const n=arguments[0];let r,i,o;return this.getSenders().forEach(s=>{s.track===n&&(r?o=!0:r=s)}),this.getReceivers().forEach(s=>(s.track===n&&(i?o=!0:i=s),s.track===n)),o||r&&i?Y.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():i?i.getStats():Y.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function v2(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(o,s){if(!s)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const a=e.apply(this,arguments);return this._shimmedLocalStreams[s.id]?this._shimmedLocalStreams[s.id].indexOf(a)===-1&&this._shimmedLocalStreams[s.id].push(a):this._shimmedLocalStreams[s.id]=[s,a],a};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(c=>{if(this.getSenders().find(l=>l.track===c))throw new DOMException("Track already exists.","InvalidAccessError")});const s=this.getSenders();n.apply(this,arguments);const a=this.getSenders().filter(c=>s.indexOf(c)===-1);this._shimmedLocalStreams[o.id]=[o].concat(a)};const r=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],r.apply(this,arguments)};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(s=>{const a=this._shimmedLocalStreams[s].indexOf(o);a!==-1&&this._shimmedLocalStreams[s].splice(a,1),this._shimmedLocalStreams[s].length===1&&delete this._shimmedLocalStreams[s]}),i.apply(this,arguments)}}function y2(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return v2(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const c=n.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(d=>this._reverseStreams[d.id])};const r=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(d=>{if(this.getSenders().find(u=>u.track===d))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){const d=new t.MediaStream(c.getTracks());this._streams[c.id]=d,this._reverseStreams[d.id]=c,c=d}r.apply(this,[c])};const i=t.RTCPeerConnection.prototype.removeStream;function o(c,d){let l=d.sdp;return Object.keys(c._reverseStreams||[]).forEach(u=>{const h=c._reverseStreams[u],p=c._streams[h.id];l=l.replace(new RegExp(p.id,"g"),h.id)}),new RTCSessionDescription({type:d.type,sdp:l})}t.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},t.RTCPeerConnection.prototype.addTrack=function(c,d){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const l=[].slice.call(arguments,1);if(l.length!==1||!l[0].getTracks().find(p=>p===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(p=>p.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const h=this._streams[d.id];if(h)h.addTrack(c),Y.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const p=new t.MediaStream([c]);this._streams[d.id]=p,this._reverseStreams[p.id]=d,this.addStream(p)}return this.getSenders().find(p=>p.track===c)},["createOffer","createAnswer"].forEach(function(c){const d=t.RTCPeerConnection.prototype[c],l={[c](){const u=arguments;return arguments.length&&typeof arguments[0]=="function"?d.apply(this,[h=>{const p=o(this,h);u[0].apply(null,[p])},h=>{u[1]&&u[1].apply(null,h)},arguments[2]]):d.apply(this,arguments).then(h=>o(this,h))}};t.RTCPeerConnection.prototype[c]=l[c]});const s=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(c,d){let l=d.sdp;return Object.keys(c._reverseStreams||[]).forEach(u=>{const h=c._reverseStreams[u],p=c._streams[h.id];l=l.replace(new RegExp(h.id,"g"),p.id)}),new RTCSessionDescription({type:d.type,sdp:l})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const c=a.get.apply(this);return c.type===""?c:o(this,c)}}),t.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(c._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let d;this._streams=this._streams||{},Object.keys(this._streams).forEach(l=>{this._streams[l].getTracks().find(u=>c.track===u)&&(d=this._streams[l])}),d&&(d.getTracks().length===1?this.removeStream(this._reverseStreams[d.id]):d.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Tv(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=t.RTCPeerConnection.prototype[n],i={[n](){return arguments[0]=new(n==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};t.RTCPeerConnection.prototype[n]=i[n]})}function R2(t,e){dc(t,"negotiationneeded",n=>{const r=n.target;if(!(e.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var G0=Object.freeze({__proto__:null,fixNegotiationNeeded:R2,shimAddTrackRemoveTrack:y2,shimAddTrackRemoveTrackWithNative:v2,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(typeof e=="function"?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(r=>{const i=n.video&&n.video.width,o=n.video&&n.video.height,s=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:s||3}},i&&(n.video.mandatory.maxWidth=i),o&&(n.video.mandatory.maxHeight=o),t.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:g2,shimGetStats:S2,shimGetUserMedia:m2,shimMediaStream:_2,shimOnTrack:E2,shimPeerConnection:Tv,shimSenderReceiverGetStats:T2});function C2(t,e){const n=t&&t.navigator,r=t&&t.MediaStreamTrack;if(n.getUserMedia=function(i,o,s){RR("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(i).then(o,s)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const i=function(s,a,c){a in s&&!(c in s)&&(s[c]=s[a],delete s[a])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(s){return typeof s=="object"&&typeof s.audio=="object"&&(s=JSON.parse(JSON.stringify(s)),i(s.audio,"autoGainControl","mozAutoGainControl"),i(s.audio,"noiseSuppression","mozNoiseSuppression")),o(s)},r&&r.prototype.getSettings){const s=r.prototype.getSettings;r.prototype.getSettings=function(){const a=s.apply(this,arguments);return i(a,"mozAutoGainControl","autoGainControl"),i(a,"mozNoiseSuppression","noiseSuppression"),a}}if(r&&r.prototype.applyConstraints){const s=r.prototype.applyConstraints;r.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),i(a,"autoGainControl","mozAutoGainControl"),i(a,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[a])}}}}function I2(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function vv(t,e){if(typeof t!="object"||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const o=t.RTCPeerConnection.prototype[i],s={[i](){return arguments[0]=new(i==="addIceCandidate"?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};t.RTCPeerConnection.prototype[i]=s[i]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[i,o,s]=arguments;return r.apply(this,[i||null]).then(a=>{if(e.version<53&&!o)try{a.forEach(c=>{c.type=n[c.type]||c.type})}catch(c){if(c.name!=="TypeError")throw c;a.forEach((d,l)=>{a.set(l,Object.assign({},d,{type:n[d.type]||d.type}))})}return a}).then(o,s)}}function w2(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const r=e.apply(this,[]);return r.forEach(i=>i._pc=this),r});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Y.resolve(new Map)}}function A2(t){if(typeof t!="object"||!t.RTCPeerConnection||!t.RTCRtpSender||t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(r=>r._pc=this),n}),dc(t,"track",n=>(n.receiver._pc=n.srcElement,n)),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function O2(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(e){RR("removeStream","removeTrack"),this.getSenders().forEach(n=>{var r;n.track&&$(r=e.getTracks()).call(r,n.track)&&this.removeTrack(n)})})}function b2(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function N2(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const i=e.apply(this,arguments);if(r){const{sender:o}=i,s=o.getParameters();(!("encodings"in s)||s.encodings.length===1&&Object.keys(s.encodings[0]).length===0)&&(s.encodings=n,o.sendEncodings=n,this.setParametersPromises.push(o.setParameters(s).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function P2(t){if(typeof t!="object"||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function D2(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Y.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function k2(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Y.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}var W0=Object.freeze({__proto__:null,shimAddTransceiver:N2,shimCreateAnswer:k2,shimCreateOffer:D2,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Y.reject(r)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:P2,shimGetUserMedia:C2,shimOnTrack:I2,shimPeerConnection:vv,shimRTCDataChannel:b2,shimReceiverGetStats:A2,shimRemoveStream:O2,shimSenderGetStats:w2});function L2(t){if(typeof t=="object"&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(n){var r;this._localStreams||(this._localStreams=[]),$(r=this._localStreams).call(r,n)||this._localStreams.push(n),n.getAudioTracks().forEach(i=>e.call(this,i,n)),n.getVideoTracks().forEach(i=>e.call(this,i,n))},t.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i&&i.forEach(s=>{var a;this._localStreams?$(a=this._localStreams).call(a,s)||this._localStreams.push(s):this._localStreams=[s]}),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(e);if(n===-1)return;this._localStreams.splice(n,1);const r=e.getTracks();this.getSenders().forEach(i=>{$(r).call(r,i.track)&&this.removeTrack(i)})})}}function M2(t){if(typeof t=="object"&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(i=>{var o;if(this._remoteStreams||(this._remoteStreams=[]),$(o=this._remoteStreams).call(o,i))return;this._remoteStreams.push(i);const s=new Event("addstream");s.stream=i,this.dispatchEvent(s)})})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(i=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(i)>=0)return;n._remoteStreams.push(i);const o=new Event("addstream");o.stream=i,n.dispatchEvent(o)})}),e.apply(n,arguments)}}}function U2(t){if(typeof t!="object"||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,r=e.createAnswer,i=e.setLocalDescription,o=e.setRemoteDescription,s=e.addIceCandidate;e.createOffer=function(c,d){const l=arguments.length>=2?arguments[2]:arguments[0],u=n.apply(this,[l]);return d?(u.then(c,d),Y.resolve()):u},e.createAnswer=function(c,d){const l=arguments.length>=2?arguments[2]:arguments[0],u=r.apply(this,[l]);return d?(u.then(c,d),Y.resolve()):u};let a=function(c,d,l){const u=i.apply(this,[c]);return l?(u.then(d,l),Y.resolve()):u};e.setLocalDescription=a,a=function(c,d,l){const u=o.apply(this,[c]);return l?(u.then(d,l),Y.resolve()):u},e.setRemoteDescription=a,a=function(c,d,l){const u=s.apply(this,[c]);return l?(u.then(d,l),Y.resolve()):u},e.addIceCandidate=a}function x2(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const n=e.mediaDevices,r=n.getUserMedia.bind(n);e.mediaDevices.getUserMedia=i=>r(V2(i))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=(function(n,r,i){e.mediaDevices.getUserMedia(n).then(r,i)}).bind(e))}function V2(t){return t&&t.video!==void 0?Object.assign({},t,{video:yU(t.video)}):t}function F2(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const i=[];for(let o=0;o<n.iceServers.length;o++){let s=n.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(RR("RTCIceServer.url","RTCIceServer.urls"),s=JSON.parse(JSON.stringify(s)),s.urls=s.url,delete s.url,i.push(s)):i.push(n.iceServers[o])}n.iceServers=i}return new e(n,r)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function j2(t){typeof t=="object"&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function B2(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):n.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function G2(t){typeof t!="object"||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var H0=Object.freeze({__proto__:null,shimAudioContext:G2,shimCallbacksAPI:U2,shimConstraints:V2,shimCreateOfferLegacy:B2,shimGetUserMedia:x2,shimLocalStreamsAPI:L2,shimRTCIceServerUrls:F2,shimRemoteStreamsAPI:M2,shimTrackEventTransceiver:j2}),W2=`	
\v\f\r \u2028\u2029\uFEFF`,c$=qd,d$=ei,yv=W2,K0=Ae("".replace),l$=RegExp("^["+yv+"]+"),u$=RegExp("(^|[^"+yv+"])["+yv+"]+$"),lg=function(t){return function(e){var n=d$(c$(e));return 1&t&&(n=K0(n,l$,"")),2&t&&(n=K0(n,u$,"$1")),n}},h$={start:lg(1),end:lg(2),trim:lg(3)},p$=LU.PROPER,f$=Pe,z0=W2,m$=h$.trim;Bt({target:"String",proto:!0,forced:function(t){return f$(function(){return!!z0[t]()||""[t]()!==""||p$&&z0[t].name!==t})}("trim")},{trim:function(){return m$(this)}});var _$=Ai("String").trim,E$=Mn,g$=_$,ug=String.prototype,S$=function(t){var e=t.trim;return typeof t=="string"||t===ug||E$(ug,t)&&e===ug.trim?g$:e},Cn=de(S$),H2={exports:{}};(function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(n){return n.trim().split(`
`).map(r=>r.trim())},e.splitSections=function(n){return n.split(`
m=`).map((r,i)=>(i>0?"m="+r:r).trim()+`\r
`)},e.getDescription=function(n){const r=e.splitSections(n);return r&&r[0]},e.getMediaSections=function(n){const r=e.splitSections(n);return r.shift(),r},e.matchPrefix=function(n,r){return e.splitLines(n).filter(i=>i.indexOf(r)===0)},e.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const i={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let o=8;o<r.length;o+=2)switch(r[o]){case"raddr":i.relatedAddress=r[o+1];break;case"rport":i.relatedPort=parseInt(r[o+1],10);break;case"tcptype":i.tcpType=r[o+1];break;case"ufrag":i.ufrag=r[o+1],i.usernameFragment=r[o+1];break;default:i[r[o]]===void 0&&(i[r[o]]=r[o+1])}return i},e.writeCandidate=function(n){const r=[];r.push(n.foundation);const i=n.component;i==="rtp"?r.push(1):i==="rtcp"?r.push(2):r.push(i),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const o=n.type;return r.push("typ"),r.push(o),o!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},e.parseIceOptions=function(n){return n.substring(14).split(" ")},e.parseRtpMap=function(n){let r=n.substring(9).split(" ");const i={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),i.name=r[0],i.clockRate=parseInt(r[1],10),i.channels=r.length===3?parseInt(r[2],10):1,i.numChannels=i.channels,i},e.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const i=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(i!==1?"/"+i:"")+`\r
`},e.parseExtmap=function(n){const r=n.substring(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1],attributes:r.slice(2).join(" ")}},e.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+(n.attributes?" "+n.attributes:"")+`\r
`},e.parseFmtp=function(n){const r={};let i;const o=n.substring(n.indexOf(" ")+1).split(";");for(let s=0;s<o.length;s++)i=o[s].trim().split("="),r[i[0].trim()]=i[1];return r},e.writeFmtp=function(n){let r="",i=n.payloadType;if(n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const o=[];Object.keys(n.parameters).forEach(s=>{n.parameters[s]!==void 0?o.push(s+"="+n.parameters[s]):o.push(s)}),r+="a=fmtp:"+i+" "+o.join(";")+`\r
`}return r},e.parseRtcpFb=function(n){const r=n.substring(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},e.writeRtcpFb=function(n){let r="",i=n.payloadType;return n.preferredPayloadType!==void 0&&(i=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(o=>{r+="a=rtcp-fb:"+i+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),r},e.parseSsrcMedia=function(n){const r=n.indexOf(" "),i={ssrc:parseInt(n.substring(7,r),10)},o=n.indexOf(":",r);return o>-1?(i.attribute=n.substring(r+1,o),i.value=n.substring(o+1)):i.attribute=n.substring(r+1),i},e.parseSsrcGroup=function(n){const r=n.substring(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(i=>parseInt(i,10))}},e.getMid=function(n){const r=e.matchPrefix(n,"a=mid:")[0];if(r)return r.substring(6)},e.parseFingerprint=function(n){const r=n.substring(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},e.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:e.matchPrefix(n+r,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(n,r){let i="a=setup:"+r+`\r
`;return n.fingerprints.forEach(o=>{i+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),i},e.parseCryptoLine=function(n){const r=n.substring(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},e.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?e.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substring(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},e.getCryptoParameters=function(n,r){return e.matchPrefix(n+r,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(n,r){const i=e.matchPrefix(n+r,"a=ice-ufrag:")[0],o=e.matchPrefix(n+r,"a=ice-pwd:")[0];return i&&o?{usernameFragment:i.substring(12),password:o.substring(10)}:null},e.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},e.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(n)[0].split(" ");r.profile=i[2];for(let s=3;s<i.length;s++){const a=i[s],c=e.matchPrefix(n,"a=rtpmap:"+a+" ")[0];if(c){const d=e.parseRtpMap(c),l=e.matchPrefix(n,"a=fmtp:"+a+" ");switch(d.parameters=l.length?e.parseFmtp(l[0]):{},d.rtcpFeedback=e.matchPrefix(n,"a=rtcp-fb:"+a+" ").map(e.parseRtcpFb),r.codecs.push(d),d.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(d.name.toUpperCase())}}}e.matchPrefix(n,"a=extmap:").forEach(s=>{r.headerExtensions.push(e.parseExtmap(s))});const o=e.matchPrefix(n,"a=rtcp-fb:* ").map(e.parseRtcpFb);return r.codecs.forEach(s=>{o.forEach(a=>{s.rtcpFeedback.find(c=>c.type===a.type&&c.parameter===a.parameter)||s.rtcpFeedback.push(a)})}),r},e.writeRtpDescription=function(n,r){let i="";i+="m="+n+" ",i+=r.codecs.length>0?"9":"0",i+=" "+(r.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=r.codecs.map(s=>s.preferredPayloadType!==void 0?s.preferredPayloadType:s.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(s=>{i+=e.writeRtpMap(s),i+=e.writeFmtp(s),i+=e.writeRtcpFb(s)});let o=0;return r.codecs.forEach(s=>{s.maxptime>o&&(o=s.maxptime)}),o>0&&(i+="a=maxptime:"+o+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(s=>{i+=e.writeExtmap(s)}),i},e.parseRtpEncodingParameters=function(n){const r=[],i=e.parseRtpParameters(n),o=i.fecMechanisms.indexOf("RED")!==-1,s=i.fecMechanisms.indexOf("ULPFEC")!==-1,a=e.matchPrefix(n,"a=ssrc:").map(h=>e.parseSsrcMedia(h)).filter(h=>h.attribute==="cname"),c=a.length>0&&a[0].ssrc;let d;const l=e.matchPrefix(n,"a=ssrc-group:FID").map(h=>h.substring(17).split(" ").map(p=>parseInt(p,10)));l.length>0&&l[0].length>1&&l[0][0]===c&&(d=l[0][1]),i.codecs.forEach(h=>{if(h.name.toUpperCase()==="RTX"&&h.parameters.apt){let p={ssrc:c,codecPayloadType:parseInt(h.parameters.apt,10)};c&&d&&(p.rtx={ssrc:d}),r.push(p),o&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},r.push(p))}}),r.length===0&&c&&r.push({ssrc:c});let u=e.matchPrefix(n,"b=");return u.length&&(u=u[0].indexOf("b=TIAS:")===0?parseInt(u[0].substring(7),10):u[0].indexOf("b=AS:")===0?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,r.forEach(h=>{h.maxBitrate=u})),r},e.parseRtcpParameters=function(n){const r={},i=e.matchPrefix(n,"a=ssrc:").map(a=>e.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];i&&(r.cname=i.value,r.ssrc=i.ssrc);const o=e.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=o.length===0;const s=e.matchPrefix(n,"a=rtcp-mux");return r.mux=s.length>0,r},e.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},e.parseMsid=function(n){let r;const i=e.matchPrefix(n,"a=msid:");if(i.length===1)return r=i[0].substring(7).split(" "),{stream:r[0],track:r[1]};const o=e.matchPrefix(n,"a=ssrc:").map(s=>e.parseSsrcMedia(s)).filter(s=>s.attribute==="msid");return o.length>0?(r=o[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},e.parseSctpDescription=function(n){const r=e.parseMLine(n),i=e.matchPrefix(n,"a=max-message-size:");let o;i.length>0&&(o=parseInt(i[0].substring(19),10)),isNaN(o)&&(o=65536);const s=e.matchPrefix(n,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:r.fmt,maxMessageSize:o};const a=e.matchPrefix(n,"a=sctpmap:");if(a.length>0){const c=a[0].substring(10).split(" ");return{port:parseInt(c[0],10),protocol:c[1],maxMessageSize:o}}},e.writeSctpDescription=function(n,r){let i=[];return i=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&i.push("a=max-message-size:"+r.maxMessageSize+`\r
`),i.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(n,r,i){let o;const s=r!==void 0?r:2;return o=n||e.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+o+" "+s+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.getDirection=function(n,r){const i=e.splitLines(n);for(let o=0;o<i.length;o++)switch(i[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[o].substring(2)}return r?e.getDirection(r):"sendrecv"},e.getKind=function(n){return e.splitLines(n)[0].split(" ")[0].substring(2)},e.isRejected=function(n){return n.split(" ",2)[1]==="0"},e.parseMLine=function(n){const r=e.splitLines(n)[0].substring(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},e.parseOLine=function(n){const r=e.matchPrefix(n,"o=")[0].substring(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},e.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=e.splitLines(n);for(let i=0;i<r.length;i++)if(r[i].length<2||r[i].charAt(1)!=="=")return!1;return!0},t.exports=e})(H2);var K2=H2.exports,_d=de(K2),T$=jW({__proto__:null,default:_d},[K2]);function _f(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new e(n),i=_d.parseCandidate(n.candidate),o=Object.assign(r,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new e(n)},t.RTCIceCandidate.prototype=e.prototype,dc(t,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new t.RTCIceCandidate(n.candidate),writable:"false"}),n))}function Rv(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||dc(t,"icecandidate",e=>{if(e.candidate){const n=_d.parseCandidate(e.candidate.candidate);n.type==="relay"&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return e})}function Ef(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(a){if(!a||!a.sdp)return!1;const c=_d.splitSections(a.sdp);return c.shift(),c.some(d=>{const l=_d.parseMLine(d);return l&&l.kind==="application"&&l.protocol.indexOf("SCTP")!==-1})},r=function(a){const c=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(c===null||c.length<2)return-1;const d=parseInt(c[1],10);return d!=d?-1:d},i=function(a){let c=65536;return e.browser==="firefox"&&(c=e.version<57?a===-1?16384:2147483637:e.version<60?e.version===57?65535:65536:2147483637),c},o=function(a,c){let d=65536;e.browser==="firefox"&&e.version===57&&(d=65535);const l=_d.matchPrefix(a.sdp,"a=max-message-size:");return l.length>0?d=parseInt(l[0].substr(19),10):e.browser==="firefox"&&c!==-1&&(d=2147483637),d},s=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:a}=this.getConfiguration();a==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const a=r(arguments[0]),c=i(a),d=o(arguments[0],a);let l;l=c===0&&d===0?Number.POSITIVE_INFINITY:c===0||d===0?Math.max(c,d):Math.min(c,d);const u={};Object.defineProperty(u,"maxMessageSize",{get:()=>l}),this._sctp=u}return s.apply(this,arguments)}}function gf(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(r,i){const o=r.send;r.send=function(){const s=arguments[0],a=s.length||s.size||s.byteLength;if(r.readyState==="open"&&i.sctp&&a>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return o.apply(r,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return e(r,this),r},dc(t,"datachannel",r=>(e(r.channel,r.target),r))}function Cv(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=e[n];e[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{const o=i.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const s=new Event("connectionstatechange",i);o.dispatchEvent(s)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Iv(t,e){if(!t.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const i=r.sdp.split(`
`).filter(o=>Cn(o).call(o)!=="a=extmap-allow-mixed").join(`
`);t.RTCSessionDescription&&r instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:r.type,sdp:i}):r.sdp=i}return n.apply(this,arguments)}}function Sf(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Y.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Y.resolve())})}function Tf(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>n.apply(this,[i]))})}var v$=Object.freeze({__proto__:null,removeExtmapAllowMixed:Iv,shimAddIceCandidateNullOrEmpty:Sf,shimConnectionState:Cv,shimMaxMessageSize:Ef,shimParameterlessSetLocalDescription:Tf,shimRTCIceCandidate:_f,shimRTCIceCandidateRelayProtocol:Rv,shimSendThrowTypeError:gf});(function(){let{window:t}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=vU,r=function(o){const s={browser:null,version:null};if(o===void 0||!o.navigator)return s.browser="Not a browser.",s;const{navigator:a}=o;if(a.mozGetUserMedia)s.browser="firefox",s.version=ip(a.userAgent,/Firefox\/(\d+)\./,1);else if(a.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)s.browser="chrome",s.version=ip(a.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!a.userAgent.match(/AppleWebKit\/(\d+)\./))return s.browser="Not a supported browser.",s;s.browser="safari",s.version=ip(a.userAgent,/AppleWebKit\/(\d+)\./,1),s.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return s}(t),i={browserDetails:r,commonShim:v$,extractVersion:ip,disableLog:S6,disableWarnings:T6,sdp:T$};switch(r.browser){case"chrome":if(!G0||!Tv||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=G0,Sf(t,r),Tf(t),m2(t,r),_2(t),Tv(t,r),E2(t),y2(t,r),g2(t),S2(t),T2(t),R2(t,r),_f(t),Rv(t),Cv(t),Ef(t,r),gf(t),Iv(t,r);break;case"firefox":if(!W0||!vv||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=W0,Sf(t,r),Tf(t),C2(t,r),vv(t,r),I2(t),O2(t),w2(t),A2(t),b2(t),N2(t),P2(t),D2(t),k2(t),_f(t),Cv(t),Ef(t,r),gf(t);break;case"safari":if(!H0||!e.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=H0,Sf(t,r),Tf(t),F2(t),B2(t),U2(t),L2(t),M2(t),j2(t),x2(t),G2(t),_f(t),Rv(t),Ef(t,r),gf(t),Iv(t,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var y$=Ai("Array").keys,R$=wo,C$=fn,I$=Mn,w$=y$,hg=Array.prototype,A$={DOMTokenList:!0,NodeList:!0},O$=function(t){var e=t.keys;return t===hg||I$(hg,t)&&e===hg.keys||C$(A$,R$(t))?w$:e},_r=de(O$),Y0=Xd,b$=TypeError,N$=T_,P$=wi,D$=ra,D_=function(t,e,n){var r=N$(e);r in t?P$.f(t,r,D$(0,n)):t[r]=n},$0=TR,k$=ns,L$=D_,M$=Array,U$=Math.max,VR=function(t,e,n){for(var r=k$(t),i=$0(e,r),o=$0(n===void 0?r:n,r),s=M$(U$(o-i,0)),a=0;i<o;i++,a++)L$(s,a,t[i]);return s.length=a,s},q0=VR,x$=Math.floor,wv=function(t,e){var n=t.length,r=x$(n/2);return n<8?V$(t,e):F$(t,wv(q0(t,0,r),e),wv(q0(t,r),e),e)},V$=function(t,e){for(var n,r,i=t.length,o=1;o<i;){for(r=o,n=t[o];r&&e(t[r-1],n)>0;)t[r]=t[--r];r!==o++&&(t[r]=n)}return t},F$=function(t,e,n,r){for(var i=e.length,o=n.length,s=0,a=0;s<i||a<o;)t[s+a]=s<i&&a<o?r(e[s],n[a])<=0?e[s++]:n[a++]:s<i?e[s++]:n[a++];return t},z2=wv,J0=oa.match(/firefox\/(\d+)/i),j$=!!J0&&+J0[1],B$=/MSIE|Trident/.test(oa),X0=oa.match(/AppleWebKit\/(\d+)\./),G$=!!X0&&+X0[1],W$=Bt,Y2=Ae,H$=ti,K$=Io,Q0=ns,z$=function(t,e){if(!delete t[e])throw b$("Cannot delete property "+Y0(e)+" of "+Y0(t))},Z0=ei,FR=Pe,Y$=z2,$$=v_,tA=j$,q$=B$,eA=Za,nA=G$,Os=[],rA=Y2(Os.sort),J$=Y2(Os.push),X$=FR(function(){Os.sort(void 0)}),Q$=FR(function(){Os.sort(null)}),Z$=$$("sort"),iA=!FR(function(){if(eA)return eA<70;if(!(tA&&tA>3)){if(q$)return!0;if(nA)return nA<603;var t,e,n,r,i="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Os.push({k:e+r,v:n})}for(Os.sort(function(o,s){return s.v-o.v}),r=0;r<Os.length;r++)e=Os[r].k.charAt(0),i.charAt(i.length-1)!==e&&(i+=e);return i!=="DGBEFHACIJK"}});W$({target:"Array",proto:!0,forced:X$||!Q$||!Z$||!iA},{sort:function(t){t!==void 0&&H$(t);var e=K$(this);if(iA)return t===void 0?rA(e):rA(e,t);var n,r,i=[],o=Q0(e);for(r=0;r<o;r++)r in e&&J$(i,e[r]);for(Y$(i,function(s){return function(a,c){return c===void 0?-1:a===void 0?1:s!==void 0?+s(a,c)||0:Z0(a)>Z0(c)?1:-1}}(t)),n=Q0(i),r=0;r<n;)e[r]=i[r++];for(;r<o;)z$(e,r++);return e}});var pg,fg,tq=Ai("Array").sort,eq=Mn,nq=tq,mg=Array.prototype,rq=function(t){var e=t.sort;return t===mg||eq(mg,t)&&e===mg.sort?nq:e},Ph=de(rq),Av={exports:{}};pg=Av,fg=Av.exports,function(t,e){var n="function",r="undefined",i="object",o="string",s="major",a="model",c="name",d="type",l="vendor",u="version",h="architecture",p="console",S="mobile",f="tablet",_="smarttv",T="wearable",g="embedded",y="Amazon",I="Apple",O="ASUS",b="BlackBerry",N="Browser",U="Chrome",V="Firefox",W="Google",lt="Huawei",mt="LG",St="Microsoft",Yt="Motorola",Lt="Opera",Ze="Samsung",F="Sharp",L="Sony",G="Xiaomi",k="Zebra",E="Facebook",C="Chromium OS",w="Mac OS",j=function(pe){for(var Ie={},Xt=0;Xt<pe.length;Xt++)Ie[pe[Xt].toUpperCase()]=pe[Xt];return Ie},Q=function(pe,Ie){return typeof pe===o&&ct(Ie).indexOf(ct(pe))!==-1},ct=function(pe){return pe.toLowerCase()},Mt=function(pe,Ie){if(typeof pe===o)return pe=pe.replace(/^\s\s*/,""),typeof Ie===r?pe:pe.substring(0,350)},Wn=function(pe,Ie){for(var Xt,Zn,Xi,fe,At,Hn,is=0;is<Ie.length&&!At;){var bi=Ie[is],DC=Ie[is+1];for(Xt=Zn=0;Xt<bi.length&&!At&&bi[Xt];)if(At=bi[Xt++].exec(pe))for(Xi=0;Xi<DC.length;Xi++)Hn=At[++Zn],typeof(fe=DC[Xi])===i&&fe.length>0?fe.length===2?typeof fe[1]==n?this[fe[0]]=fe[1].call(this,Hn):this[fe[0]]=fe[1]:fe.length===3?typeof fe[1]!==n||fe[1].exec&&fe[1].test?this[fe[0]]=Hn?Hn.replace(fe[1],fe[2]):e:this[fe[0]]=Hn?fe[1].call(this,Hn,fe[2]):e:fe.length===4&&(this[fe[0]]=Hn?fe[3].call(this,Hn.replace(fe[1],fe[2])):e):this[fe]=Hn||e;is+=2}},Oo=function(pe,Ie){for(var Xt in Ie)if(typeof Ie[Xt]===i&&Ie[Xt].length>0){for(var Zn=0;Zn<Ie[Xt].length;Zn++)if(Q(Ie[Xt][Zn],pe))return Xt==="?"?e:Xt}else if(Q(Ie[Xt],pe))return Xt==="?"?e:Xt;return pe},Mh={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Uh={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[u,[c,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[u,[c,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[c,u],[/opios[\/ ]+([\w\.]+)/i],[u,[c,Lt+" Mini"]],[/\bopr\/([\w\.]+)/i],[u,[c,Lt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[c,u],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[u,[c,"UC"+N]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[u,[c,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[u,[c,"WeChat"]],[/konqueror\/([\w\.]+)/i],[u,[c,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[u,[c,"IE"]],[/yabrowser\/([\w\.]+)/i],[u,[c,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[c,/(.+)/,"$1 Secure "+N],u],[/\bfocus\/([\w\.]+)/i],[u,[c,V+" Focus"]],[/\bopt\/([\w\.]+)/i],[u,[c,Lt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[u,[c,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[u,[c,"Dolphin"]],[/coast\/([\w\.]+)/i],[u,[c,Lt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[u,[c,"MIUI "+N]],[/fxios\/([-\w\.]+)/i],[u,[c,V]],[/\bqihu|(qi?ho?o?|360)browser/i],[[c,"360 "+N]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[c,/(.+)/,"$1 "+N],u],[/(comodo_dragon)\/([\w\.]+)/i],[[c,/_/g," "],u],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[c,u],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[c],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[c,E],u],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[c,u],[/\bgsa\/([\w\.]+) .*safari\//i],[u,[c,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[u,[c,U+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[c,U+" WebView"],u],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[u,[c,"Android "+N]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[c,u],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[u,[c,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[u,c],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[c,[u,Oo,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[c,u],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[c,"Netscape"],u],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[u,[c,V+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[c,u],[/(cobalt)\/([\w\.]+)/i],[c,[u,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[h,"amd64"]],[/(ia32(?=;))/i],[[h,ct]],[/((?:i[346]|x)86)[;\)]/i],[[h,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[h,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[h,"armhf"]],[/windows (ce|mobile); ppc;/i],[[h,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[h,/ower/,"",ct]],[/(sun4\w)[;\)]/i],[[h,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[h,ct]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[a,[l,Ze],[d,f]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[a,[l,Ze],[d,S]],[/\((ip(?:hone|od)[\w ]*);/i],[a,[l,I],[d,S]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[a,[l,I],[d,f]],[/(macintosh);/i],[a,[l,I]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[a,[l,F],[d,S]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[a,[l,lt],[d,f]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[a,[l,lt],[d,S]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[a,/_/g," "],[l,G],[d,S]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[a,/_/g," "],[l,G],[d,f]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[a,[l,"OPPO"],[d,S]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[a,[l,"Vivo"],[d,S]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[a,[l,"Realme"],[d,S]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[a,[l,Yt],[d,S]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[a,[l,Yt],[d,f]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[a,[l,mt],[d,f]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[a,[l,mt],[d,S]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[a,[l,"Lenovo"],[d,f]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[a,/_/g," "],[l,"Nokia"],[d,S]],[/(pixel c)\b/i],[a,[l,W],[d,f]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[a,[l,W],[d,S]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[a,[l,L],[d,S]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[a,"Xperia Tablet"],[l,L],[d,f]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[a,[l,"OnePlus"],[d,S]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[a,[l,y],[d,f]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[a,/(.+)/g,"Fire Phone $1"],[l,y],[d,S]],[/(playbook);[-\w\),; ]+(rim)/i],[a,l,[d,f]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[a,[l,b],[d,S]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[a,[l,O],[d,f]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[a,[l,O],[d,S]],[/(nexus 9)/i],[a,[l,"HTC"],[d,f]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[l,[a,/_/g," "],[d,S]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[a,[l,"Acer"],[d,f]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[a,[l,"Meizu"],[d,S]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[l,a,[d,S]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[l,a,[d,f]],[/(surface duo)/i],[a,[l,St],[d,f]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[a,[l,"Fairphone"],[d,S]],[/(u304aa)/i],[a,[l,"AT&T"],[d,S]],[/\bsie-(\w*)/i],[a,[l,"Siemens"],[d,S]],[/\b(rct\w+) b/i],[a,[l,"RCA"],[d,f]],[/\b(venue[\d ]{2,7}) b/i],[a,[l,"Dell"],[d,f]],[/\b(q(?:mv|ta)\w+) b/i],[a,[l,"Verizon"],[d,f]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[a,[l,"Barnes & Noble"],[d,f]],[/\b(tm\d{3}\w+) b/i],[a,[l,"NuVision"],[d,f]],[/\b(k88) b/i],[a,[l,"ZTE"],[d,f]],[/\b(nx\d{3}j) b/i],[a,[l,"ZTE"],[d,S]],[/\b(gen\d{3}) b.+49h/i],[a,[l,"Swiss"],[d,S]],[/\b(zur\d{3}) b/i],[a,[l,"Swiss"],[d,f]],[/\b((zeki)?tb.*\b) b/i],[a,[l,"Zeki"],[d,f]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[l,"Dragon Touch"],a,[d,f]],[/\b(ns-?\w{0,9}) b/i],[a,[l,"Insignia"],[d,f]],[/\b((nxa|next)-?\w{0,9}) b/i],[a,[l,"NextBook"],[d,f]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[l,"Voice"],a,[d,S]],[/\b(lvtel\-)?(v1[12]) b/i],[[l,"LvTel"],a,[d,S]],[/\b(ph-1) /i],[a,[l,"Essential"],[d,S]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[a,[l,"Envizen"],[d,f]],[/\b(trio[-\w\. ]+) b/i],[a,[l,"MachSpeed"],[d,f]],[/\btu_(1491) b/i],[a,[l,"Rotor"],[d,f]],[/(shield[\w ]+) b/i],[a,[l,"Nvidia"],[d,f]],[/(sprint) (\w+)/i],[l,a,[d,S]],[/(kin\.[onetw]{3})/i],[[a,/\./g," "],[l,St],[d,S]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[a,[l,k],[d,f]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[a,[l,k],[d,S]],[/smart-tv.+(samsung)/i],[l,[d,_]],[/hbbtv.+maple;(\d+)/i],[[a,/^/,"SmartTV"],[l,Ze],[d,_]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[l,mt],[d,_]],[/(apple) ?tv/i],[l,[a,I+" TV"],[d,_]],[/crkey/i],[[a,U+"cast"],[l,W],[d,_]],[/droid.+aft(\w)( bui|\))/i],[a,[l,y],[d,_]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[a,[l,F],[d,_]],[/(bravia[\w ]+)( bui|\))/i],[a,[l,L],[d,_]],[/(mitv-\w{5}) bui/i],[a,[l,G],[d,_]],[/Hbbtv.*(technisat) (.*);/i],[l,a,[d,_]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[l,Mt],[a,Mt],[d,_]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,_]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[l,a,[d,p]],[/droid.+; (shield) bui/i],[a,[l,"Nvidia"],[d,p]],[/(playstation [345portablevi]+)/i],[a,[l,L],[d,p]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[a,[l,St],[d,p]],[/((pebble))app/i],[l,a,[d,T]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[a,[l,I],[d,T]],[/droid.+; (glass) \d/i],[a,[l,W],[d,T]],[/droid.+; (wt63?0{2,3})\)/i],[a,[l,k],[d,T]],[/(quest( 2| pro)?)/i],[a,[l,E],[d,T]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[l,[d,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[a,[d,S]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[a,[d,f]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,f]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,S]],[/(android[-\w\. ]{0,9});.+buil/i],[a,[l,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[u,[c,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[u,[c,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[c,u],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[u,c]],os:[[/microsoft (windows) (vista|xp)/i],[c,u],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[c,[u,Oo,Mh]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[c,"Windows"],[u,Oo,Mh]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[u,/_/g,"."],[c,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[c,w],[u,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[u,c],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[c,u],[/\(bb(10);/i],[u,[c,b]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[u,[c,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[u,[c,V+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[u,[c,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[u,[c,"watchOS"]],[/crkey\/([\d\.]+)/i],[u,[c,U+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[c,C],u],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[c,u],[/(sunos) ?([\w\.\d]*)/i],[[c,"Solaris"],u],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[c,u]]},Dr=function(pe,Ie){if(typeof pe===i&&(Ie=pe,pe=e),!(this instanceof Dr))return new Dr(pe,Ie).getResult();var Xt=typeof t!==r&&t.navigator?t.navigator:e,Zn=pe||(Xt&&Xt.userAgent?Xt.userAgent:""),Xi=Xt&&Xt.userAgentData?Xt.userAgentData:e,fe=Ie?function(At,Hn){var is={};for(var bi in At)Hn[bi]&&Hn[bi].length%2==0?is[bi]=Hn[bi].concat(At[bi]):is[bi]=At[bi];return is}(Uh,Ie):Uh;return this.getBrowser=function(){var At={};return At[c]=e,At[u]=e,Wn.call(At,Zn,fe.browser),At[s]=function(Hn){return typeof Hn===o?Hn.replace(/[^\d\.]/g,"").split(".")[0]:e}(At[u]),Xt&&Xt.brave&&typeof Xt.brave.isBrave==n&&(At[c]="Brave"),At},this.getCPU=function(){var At={};return At[h]=e,Wn.call(At,Zn,fe.cpu),At},this.getDevice=function(){var At={};return At[l]=e,At[a]=e,At[d]=e,Wn.call(At,Zn,fe.device),!At[d]&&Xi&&Xi.mobile&&(At[d]=S),At[a]=="Macintosh"&&Xt&&typeof Xt.standalone!==r&&Xt.maxTouchPoints&&Xt.maxTouchPoints>2&&(At[a]="iPad",At[d]=f),At},this.getEngine=function(){var At={};return At[c]=e,At[u]=e,Wn.call(At,Zn,fe.engine),At},this.getOS=function(){var At={};return At[c]=e,At[u]=e,Wn.call(At,Zn,fe.os),!At[c]&&Xi&&Xi.platform!="Unknown"&&(At[c]=Xi.platform.replace(/chrome os/i,C).replace(/macos/i,w)),At},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Zn},this.setUA=function(At){return Zn=typeof At===o&&At.length>350?Mt(At,350):At,this},this.setUA(Zn),this};Dr.VERSION="0.7.34",Dr.BROWSER=j([c,u,s]),Dr.CPU=j([h]),Dr.DEVICE=j([a,l,d,p,S,_,f,T,g]),Dr.ENGINE=Dr.OS=j([c,u]),pg.exports&&(fg=pg.exports=Dr),fg.UAParser=Dr;var rs=typeof t!==r&&(t.jQuery||t.Zepto);if(rs&&!rs.ua){var pc=new Dr;rs.ua=pc.getResult(),rs.ua.get=function(){return pc.getUA()},rs.ua.set=function(pe){pc.setUA(pe);var Ie=pc.getResult();for(var Xt in Ie)rs.ua[Xt]=Ie[Xt]}}}(typeof window=="object"?window:fd);var iq=de(Av.exports),oq=wo,sq=fn,aq=$d,cq=lc,dq=Ce("iterator"),lq=Object,uq=function(t){if(aq(t))return!1;var e=lq(t);return e[dq]!==void 0||"@@iterator"in e||sq(cq,oq(e))},hq=de(uq),_g=Le;Bt({global:!0,forced:_g.globalThis!==_g},{globalThis:_g});var oA=de(Le),sA=N_.clear;Bt({global:!0,bind:!0,enumerable:!0,forced:Le.clearImmediate!==sA},{clearImmediate:sA});var pq=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",$2=Le,fq=m_,mq=Qe,_q=pq,Eq=oa,gq=b_,Sq=tl,Tq=$2.Function,vq=/MSIE .\./.test(Eq)||_q&&function(){var t=$2.Bun.version.split(".");return t.length<3||t[0]==0&&(t[1]<3||t[1]==3&&t[2]==0)}(),yq=Bt,q2=Le,aA=N_.set,Rq=function(t,e){var n=1;return vq?function(r,i){var o=Sq(arguments.length,1)>n,s=mq(r)?r:Tq(r),a=o?gq(arguments,n):[],c=o?function(){fq(s,this,a)}:s;return t(c)}:t},cA=q2.setImmediate?Rq(aA):aA;yq({global:!0,bind:!0,enumerable:!0,forced:q2.setImmediate!==cA},{setImmediate:cA});var dA=de(Zr.setImmediate),Cq=Bt,Iq=qU,wq=ti,Aq=tl,Oq=Zd,bq=Le.process;Cq({global:!0,enumerable:!0,dontCallGetSet:!0},{queueMicrotask:function(t){Aq(arguments.length,1),wq(t);var e=Oq&&bq.domain;Iq(e?e.bind(t):t)}});var lA=de(Zr.queueMicrotask);function J2(t,e){return function(){return t.apply(e,arguments)}}const{toString:Nq}=Object.prototype,{getPrototypeOf:jR}=Object,Tm=(Eg=Object.create(null),t=>{const e=Nq.call(t);return Eg[e]||(Eg[e]=e.slice(8,-1).toLowerCase())});var Eg;const $i=t=>(t=t.toLowerCase(),e=>Tm(e)===t),k_=t=>e=>typeof e===t,{isArray:Lc}=Array,Vl=k_("undefined"),uA=$i("ArrayBuffer"),Pq=k_("string"),Mr=k_("function"),hA=k_("number"),up=t=>t!==null&&typeof t=="object",hp=t=>{if(Tm(t)!=="object")return!1;const e=jR(t);return!(e!==null&&e!==Object.prototype&&Object.getPrototypeOf(e)!==null||Symbol.toStringTag in t||hq(t))},Dq=$i("Date"),kq=$i("File"),Lq=$i("Blob"),Mq=$i("FileList"),Uq=$i("URLSearchParams"),[xq,Vq,Fq,jq]=["ReadableStream","Request","Response","Headers"].map($i);function Fl(t,e){let n,r,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(t!=null)if(typeof t!="object"&&(t=[t]),Lc(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{const o=i?Object.getOwnPropertyNames(t):Object.keys(t),s=o.length;let a;for(n=0;n<s;n++)a=o[n],e.call(null,t[a],a,t)}}function pA(t,e){e=e.toLowerCase();const n=Object.keys(t);let r,i=n.length;for(;i-- >0;)if(r=n[i],e===r.toLowerCase())return r;return null}const Pa=oA!==void 0?oA:typeof self<"u"?self:typeof window<"u"?window:global,fA=t=>!Vl(t)&&t!==Pa,Bq=(gg=typeof Uint8Array<"u"&&jR(Uint8Array),t=>gg&&t instanceof gg);var gg;const Gq=$i("HTMLFormElement"),mA=(t=>{let{hasOwnProperty:e}=t;return(n,r)=>e.call(n,r)})(Object.prototype),Wq=$i("RegExp"),_A=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};Fl(n,(i,o)=>{let s;(s=e(i,o,t))!==!1&&(r[o]=s||i)}),Object.defineProperties(t,r)},Sg="abcdefghijklmnopqrstuvwxyz",EA="0123456789",gA={DIGIT:EA,ALPHA:Sg,ALPHA_DIGIT:Sg+Sg.toUpperCase()+EA},Hq=$i("AsyncFunction"),X2=(SA=typeof dA=="function",TA=Mr(Pa.postMessage),SA?dA:TA?(Tg="axios@".concat(Math.random()),pp=[],Pa.addEventListener("message",t=>{let{source:e,data:n}=t;e===Pa&&n===Tg&&pp.length&&pp.shift()()},!1),t=>{pp.push(t),Pa.postMessage(Tg,"*")}):t=>setTimeout(t));var SA,TA,Tg,pp;const Kq=lA!==void 0?lA.bind(Pa):typeof process<"u"&&process.nextTick||X2;var H={isArray:Lc,isArrayBuffer:uA,isBuffer:function(t){return t!==null&&!Vl(t)&&t.constructor!==null&&!Vl(t.constructor)&&Mr(t.constructor.isBuffer)&&t.constructor.isBuffer(t)},isFormData:t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Mr(t.append)&&((e=Tm(t))==="formdata"||e==="object"&&Mr(t.toString)&&t.toString()==="[object FormData]"))},isArrayBufferView:function(t){let e;return e=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&uA(t.buffer),e},isString:Pq,isNumber:hA,isBoolean:t=>t===!0||t===!1,isObject:up,isPlainObject:hp,isReadableStream:xq,isRequest:Vq,isResponse:Fq,isHeaders:jq,isUndefined:Vl,isDate:Dq,isFile:kq,isBlob:Lq,isRegExp:Wq,isFunction:Mr,isStream:t=>up(t)&&Mr(t.pipe),isURLSearchParams:Uq,isTypedArray:Bq,isFileList:Mq,forEach:Fl,merge:function t(){const{caseless:e}=fA(this)&&this||{},n={},r=(i,o)=>{const s=e&&pA(n,o)||o;hp(n[s])&&hp(i)?n[s]=t(n[s],i):hp(i)?n[s]=t({},i):Lc(i)?n[s]=i.slice():n[s]=i};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&Fl(arguments[i],r);return n},extend:function(t,e,n){let{allOwnKeys:r}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Fl(e,(i,o)=>{n&&Mr(i)?t[o]=J2(i,n):t[o]=i},{allOwnKeys:r}),t},trim:t=>Cn(t)?Cn(t).call(t):t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),inherits:(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},toFlatObject:(t,e,n,r)=>{let i,o,s;const a={};if(e=e||{},t==null)return e;do{for(i=Object.getOwnPropertyNames(t),o=i.length;o-- >0;)s=i[o],r&&!r(s,t,e)||a[s]||(e[s]=t[s],a[s]=!0);t=n!==!1&&jR(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:Tm,kindOfTest:$i,endsWith:(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},toArray:t=>{if(!t)return null;if(Lc(t))return t;let e=t.length;if(!hA(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},forEachEntry:(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=n.next())&&!r.done;){const i=r.value;e.call(t,i[0],i[1])}},matchAll:(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},isHTMLForm:Gq,hasOwnProperty:mA,hasOwnProp:mA,reduceDescriptors:_A,freezeMethods:t=>{_A(t,(e,n)=>{if(Mr(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];Mr(r)&&(e.enumerable=!1,"writable"in e?e.writable=!1:e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))})},toObjectSet:(t,e)=>{const n={},r=i=>{i.forEach(o=>{n[o]=!0})};return Lc(t)?r(t):r(String(t).split(e)),n},toCamelCase:t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,n,r){return n.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e,findKey:pA,global:Pa,isContextDefined:fA,ALPHABET:gA,generateString:function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gA.ALPHA_DIGIT,n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n},isSpecCompliantForm:function(t){return!!(t&&Mr(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])},toJSONObject:t=>{const e=new Array(10),n=(r,i)=>{if(up(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[i]=r;const o=Lc(r)?[]:{};return Fl(r,(s,a)=>{const c=n(s,i+1);!Vl(c)&&(o[a]=c)}),e[i]=void 0,o}}return r};return n(t,0)},isAsyncFn:Hq,isThenable:t=>t&&(up(t)||Mr(t))&&Mr(t.then)&&Mr(t.catch),setImmediate:X2,asap:Kq};function jt(t,e,n,r,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i,this.status=i.status?i.status:null)}H.inherits(jt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:H.toJSONObject(this.config),code:this.code,status:this.status}}});const vA=jt.prototype,yA={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{yA[t]={value:t}}),Object.defineProperties(jt,yA),Object.defineProperty(vA,"isAxiosError",{value:!0}),jt.from=(t,e,n,r,i,o)=>{const s=Object.create(vA);return H.toFlatObject(t,s,function(a){return a!==Error.prototype},a=>a!=="isAxiosError"),jt.call(s,t.message,e,n,r,i),s.cause=t,s.name=t.name,o&&Object.assign(s,o),s};function vg(t){return H.isPlainObject(t)||H.isArray(t)}function Q2(t){return H.endsWith(t,"[]")?t.slice(0,-2):t}function RA(t,e,n){return t?t.concat(e).map(function(r,i){return r=Q2(r),!n&&i?"["+r+"]":r}).join(n?".":""):e}const zq=H.toFlatObject(H,{},null,function(t){return/^is[A-Z]/.test(t)});function vm(t,e,n){if(!H.isObject(t))throw new TypeError("target must be an object");e=e||new FormData;const r=(n=H.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(h,p){return!H.isUndefined(p[h])})).metaTokens,i=n.visitor||d,o=n.dots,s=n.indexes,a=(n.Blob||typeof Blob<"u"&&Blob)&&H.isSpecCompliantForm(e);if(!H.isFunction(i))throw new TypeError("visitor must be a function");function c(h){if(h===null)return"";if(H.isDate(h))return h.toISOString();if(!a&&H.isBlob(h))throw new jt("Blob is not supported. Use a Buffer instead.");return H.isArrayBuffer(h)||H.isTypedArray(h)?a&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function d(h,p,S){let f=h;if(h&&!S&&typeof h=="object"){if(H.endsWith(p,"{}"))p=r?p:p.slice(0,-2),h=JSON.stringify(h);else if(H.isArray(h)&&function(_){return H.isArray(_)&&!_.some(vg)}(h)||(H.isFileList(h)||H.endsWith(p,"[]"))&&(f=H.toArray(h)))return p=Q2(p),f.forEach(function(_,T){!H.isUndefined(_)&&_!==null&&e.append(s===!0?RA([p],T,o):s===null?p:p+"[]",c(_))}),!1}return!!vg(h)||(e.append(RA(S,p,o),c(h)),!1)}const l=[],u=Object.assign(zq,{defaultVisitor:d,convertValue:c,isVisitable:vg});if(!H.isObject(t))throw new TypeError("data must be an object");return function h(p,S){if(!H.isUndefined(p)){if(l.indexOf(p)!==-1)throw Error("Circular reference detected in "+S.join("."));l.push(p),H.forEach(p,function(f,_){(!(H.isUndefined(f)||f===null)&&i.call(e,f,H.isString(_)?Cn(_).call(_):_,S,u))===!0&&h(f,S?S.concat(_):[_])}),l.pop()}}(t),e}function CA(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function BR(t,e){this._pairs=[],t&&vm(t,this,e)}const IA=BR.prototype;function Yq(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Z2(t,e,n){if(!e)return t;const r=n&&n.encode||Yq,i=n&&n.serialize;let o;if(o=i?i(e,n):H.isURLSearchParams(e)?e.toString():new BR(e,n).toString(r),o){const s=t.indexOf("#");s!==-1&&(t=t.slice(0,s)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}IA.append=function(t,e){this._pairs.push([t,e])},IA.toString=function(t){const e=t?function(n){return t.call(this,n,CA)}:CA;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};var wA=class{constructor(){this.handlers=[]}use(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){H.forEach(this.handlers,function(e){e!==null&&t(e)})}},tx={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ex={exports:{}},$q=Bt,qq=Qr,AA=wi.f;$q({target:"Object",stat:!0,forced:Object.defineProperty!==AA,sham:!qq},{defineProperty:AA});var nx=Zr.Object,Jq=ex.exports=function(t,e,n){return nx.defineProperty(t,e,n)};nx.defineProperty.sham&&(Jq.sham=!0);var rx=de(ex.exports),Xq=Co,Dh=Array.isArray||function(t){return Xq(t)=="Array"},Qq=TypeError,OA=Dh,Zq=O_,t7=Pr,e7=Ce("species"),bA=Array,n7=function(t){var e;return OA(t)&&(e=t.constructor,(Zq(e)&&(e===bA||OA(e.prototype))||t7(e)&&(e=e[e7])===null)&&(e=void 0)),e===void 0?bA:e},ix=function(t,e){return new(n7(t))(e===0?0:e)},r7=Pe,i7=Za,o7=Ce("species"),ox=function(t){return i7>=51||!r7(function(){var e=[];return(e.constructor={})[o7]=function(){return{foo:1}},e[t](Boolean).foo!==1})},s7=Bt,a7=Pe,c7=Dh,d7=Pr,l7=Io,u7=ns,NA=function(t){if(t>9007199254740991)throw Qq("Maximum allowed index exceeded");return t},PA=D_,h7=ix,p7=ox,f7=Za,sx=Ce("isConcatSpreadable"),m7=f7>=51||!a7(function(){var t=[];return t[sx]=!1,t.concat()[0]!==t}),_7=function(t){if(!d7(t))return!1;var e=t[sx];return e!==void 0?!!e:c7(t)};s7({target:"Array",proto:!0,arity:1,forced:!m7||!p7("concat")},{concat:function(t){var e,n,r,i,o,s=l7(this),a=h7(s,0),c=0;for(e=-1,r=arguments.length;e<r;e++)if(_7(o=e===-1?s:arguments[e]))for(i=u7(o),NA(c+i),n=0;n<i;n++,c++)n in o&&PA(a,c,o[n]);else NA(c+1),PA(a,c++,o);return a.length=c,a}});var ax={},E7=Co,g7=ia,DA=R_.f,S7=VR,kA=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];ax.f=function(t){return kA&&E7(t)=="Window"?function(e){try{return DA(e)}catch{return S7(kA)}}(t):DA(g7(t))};var nl={},T7=Ce;nl.f=T7;var LA=Zr,v7=fn,y7=nl,R7=wi.f,rn=function(t){var e=LA.Symbol||(LA.Symbol={});v7(e,t)||R7(e,t,{value:y7.f(t)})},C7=dn,I7=ur,w7=Ce,A7=ca,cx=function(){var t=I7("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,r=w7("toPrimitive");e&&!e[r]&&A7(e,r,function(i){return C7(n,this)},{arity:1})},O7=sa,b7=g_,N7=Io,P7=ns,D7=ix,MA=Ae([].push),cs=function(t){var e=t==1,n=t==2,r=t==3,i=t==4,o=t==6,s=t==7,a=t==5||o;return function(c,d,l,u){for(var h,p,S=N7(c),f=b7(S),_=O7(d,l),T=P7(f),g=0,y=u||D7,I=e?y(c,T):n||s?y(c,0):void 0;T>g;g++)if((a||g in f)&&(p=_(h=f[g],g,S),t))if(e)I[g]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return g;case 2:MA(I,h)}else switch(t){case 4:return!1;case 7:MA(I,h)}return o?-1:r||i?i:I}},dx={forEach:cs(0),map:cs(1),filter:cs(2),some:cs(3),every:cs(4),find:cs(5),findIndex:cs(6),filterReject:cs(7)},fp=Bt,GR=Le,WR=dn,k7=Ae,Ed=Qr,Tc=Jd,L7=Pe,Pn=fn,M7=Mn,Ov=Qn,L_=ia,HR=T_,U7=ei,bv=ra,Wu=Ah,lx=I_,x7=R_,ux=ax,V7=wh,hx=Rh,px=wi,F7=wR,fx=E_,UA=ca,j7=A_,KR=Qd,mx=C_,xA=ER,B7=Ce,G7=nl,W7=rn,H7=cx,K7=da,_x=uc,M_=dx.forEach,gr=y_("hidden"),ym="Symbol",Hu="prototype",z7=_x.set,VA=_x.getterFor(ym),Bi=Object[Hu],Zc=GR.Symbol,vf=Zc&&Zc[Hu],Y7=GR.TypeError,yg=GR.QObject,Ex=hx.f,ya=px.f,gx=ux.f,$7=fx.f,Sx=k7([].push),ts=KR("symbols"),kh=KR("op-symbols"),q7=KR("wks"),Rg=!yg||!yg[Hu]||!yg[Hu].findChild,Nv=Ed&&L7(function(){return Wu(ya({},"a",{get:function(){return ya(this,"a",{value:7}).a}})).a!=7})?function(t,e,n){var r=Ex(Bi,e);r&&delete Bi[e],ya(t,e,n),r&&t!==Bi&&ya(Bi,e,r)}:ya,Cg=function(t,e){var n=ts[t]=Wu(vf);return z7(n,{type:ym,tag:t,description:e}),Ed||(n.description=e),n},Rm=function(t,e,n){t===Bi&&Rm(kh,e,n),Ov(t);var r=HR(e);return Ov(n),Pn(ts,r)?(n.enumerable?(Pn(t,gr)&&t[gr][r]&&(t[gr][r]=!1),n=Wu(n,{enumerable:bv(0,!1)})):(Pn(t,gr)||ya(t,gr,bv(1,{})),t[gr][r]=!0),Nv(t,r,n)):ya(t,r,n)},Ig=function(t,e){Ov(t);var n=L_(e),r=lx(n).concat(vx(n));return M_(r,function(i){Ed&&!WR(Tx,n,i)||Rm(t,i,n[i])}),t},Tx=function(t){var e=HR(t),n=WR($7,this,e);return!(this===Bi&&Pn(ts,e)&&!Pn(kh,e))&&(!(n||!Pn(this,e)||!Pn(ts,e)||Pn(this,gr)&&this[gr][e])||n)},FA=function(t,e){var n=L_(t),r=HR(e);if(n!==Bi||!Pn(ts,r)||Pn(kh,r)){var i=Ex(n,r);return!i||!Pn(ts,r)||Pn(n,gr)&&n[gr][r]||(i.enumerable=!0),i}},jA=function(t){var e=gx(L_(t)),n=[];return M_(e,function(r){Pn(ts,r)||Pn(mx,r)||Sx(n,r)}),n},vx=function(t){var e=t===Bi,n=gx(e?kh:L_(t)),r=[];return M_(n,function(i){!Pn(ts,i)||e&&!Pn(Bi,i)||Sx(r,ts[i])}),r};Tc||(UA(vf=(Zc=function(){if(M7(vf,this))throw Y7("Symbol is not a constructor");var t=arguments.length&&arguments[0]!==void 0?U7(arguments[0]):void 0,e=xA(t),n=function(r){this===Bi&&WR(n,kh,r),Pn(this,gr)&&Pn(this[gr],e)&&(this[gr][e]=!1),Nv(this,e,bv(1,r))};return Ed&&Rg&&Nv(Bi,e,{configurable:!0,set:n}),Cg(e,t)})[Hu],"toString",function(){return VA(this).tag}),UA(Zc,"withoutSetter",function(t){return Cg(xA(t),t)}),fx.f=Tx,px.f=Rm,F7.f=Ig,hx.f=FA,x7.f=ux.f=jA,V7.f=vx,G7.f=function(t){return Cg(B7(t),t)},Ed&&j7(vf,"description",{configurable:!0,get:function(){return VA(this).description}})),fp({global:!0,constructor:!0,wrap:!0,forced:!Tc,sham:!Tc},{Symbol:Zc}),M_(lx(q7),function(t){W7(t)}),fp({target:ym,stat:!0,forced:!Tc},{useSetter:function(){Rg=!0},useSimple:function(){Rg=!1}}),fp({target:"Object",stat:!0,forced:!Tc,sham:!Ed},{create:function(t,e){return e===void 0?Wu(t):Ig(Wu(t),e)},defineProperty:Rm,defineProperties:Ig,getOwnPropertyDescriptor:FA}),fp({target:"Object",stat:!0,forced:!Tc},{getOwnPropertyNames:jA}),H7(),K7(Zc,ym),mx[gr]=!0;var yx=Jd&&!!Symbol.for&&!!Symbol.keyFor,J7=Bt,X7=ur,Q7=fn,Z7=ei,Rx=Qd,t9=yx,wg=Rx("string-to-symbol-registry"),e9=Rx("symbol-to-string-registry");J7({target:"Symbol",stat:!0,forced:!t9},{for:function(t){var e=Z7(t);if(Q7(wg,e))return wg[e];var n=X7("Symbol")(e);return wg[e]=n,e9[n]=e,n}});var n9=Bt,r9=fn,i9=Ch,o9=Xd,s9=yx,BA=Qd("symbol-to-string-registry");n9({target:"Symbol",stat:!0,forced:!s9},{keyFor:function(t){if(!i9(t))throw TypeError(o9(t)+" is not a symbol");if(r9(BA,t))return BA[t]}});var GA=Dh,a9=Qe,WA=Co,c9=ei,HA=Ae([].push),d9=Bt,Cx=ur,Ix=m_,l9=dn,Lh=Ae,wx=Pe,KA=Qe,zA=Ch,Ax=b_,u9=function(t){if(a9(t))return t;if(GA(t)){for(var e=t.length,n=[],r=0;r<e;r++){var i=t[r];typeof i=="string"?HA(n,i):typeof i!="number"&&WA(i)!="Number"&&WA(i)!="String"||HA(n,c9(i))}var o=n.length,s=!0;return function(a,c){if(s)return s=!1,c;if(GA(this))return c;for(var d=0;d<o;d++)if(n[d]===a)return c}}},h9=Jd,p9=String,Gs=Cx("JSON","stringify"),mp=Lh(/./.exec),YA=Lh("".charAt),f9=Lh("".charCodeAt),m9=Lh("".replace),_9=Lh(1 .toString),E9=/[\uD800-\uDFFF]/g,$A=/^[\uD800-\uDBFF]$/,qA=/^[\uDC00-\uDFFF]$/,JA=!h9||wx(function(){var t=Cx("Symbol")();return Gs([t])!="[null]"||Gs({a:t})!="{}"||Gs(Object(t))!="{}"}),XA=wx(function(){return Gs("\uDF06\uD834")!=='"\\udf06\\ud834"'||Gs("\uDEAD")!=='"\\udead"'}),g9=function(t,e){var n=Ax(arguments),r=u9(e);if(KA(r)||t!==void 0&&!zA(t))return n[1]=function(i,o){if(KA(r)&&(o=l9(r,this,p9(i),o)),!zA(o))return o},Ix(Gs,null,n)},S9=function(t,e,n){var r=YA(n,e-1),i=YA(n,e+1);return mp($A,t)&&!mp(qA,i)||mp(qA,t)&&!mp($A,r)?"\\u"+_9(f9(t,0),16):t};Gs&&d9({target:"JSON",stat:!0,arity:3,forced:JA||XA},{stringify:function(t,e,n){var r=Ax(arguments),i=Ix(JA?g9:Gs,null,r);return XA&&typeof i=="string"?m9(i,E9,S9):i}});var QA=wh,T9=Io;Bt({target:"Object",stat:!0,forced:!Jd||Pe(function(){QA.f(1)})},{getOwnPropertySymbols:function(t){var e=QA.f;return e?e(T9(t)):[]}}),rn("asyncIterator"),rn("hasInstance"),rn("isConcatSpreadable"),rn("iterator"),rn("match"),rn("matchAll"),rn("replace"),rn("search"),rn("species"),rn("split");var v9=cx;rn("toPrimitive"),v9();var y9=ur,R9=da;rn("toStringTag"),R9(y9("Symbol"),"Symbol"),rn("unscopables"),da(Le.JSON,"JSON",!0);var C9=Zr.Symbol,I9=Ce,w9=wi.f,ZA=I9("metadata"),tO=Function.prototype;tO[ZA]===void 0&&w9(tO,ZA,{value:null}),rn("dispose"),rn("metadata");var A9=C9;rn("asyncDispose");var O9=Ae,zR=ur("Symbol"),b9=zR.keyFor,N9=O9(zR.prototype.valueOf),Ox=zR.isRegisteredSymbol||function(t){try{return b9(N9(t))!==void 0}catch{return!1}};Bt({target:"Symbol",stat:!0},{isRegisteredSymbol:Ox});for(var P9=Qd,eO=ur,D9=Ae,k9=Ch,L9=Ce,_p=eO("Symbol"),nO=_p.isWellKnownSymbol,bx=eO("Object","getOwnPropertyNames"),M9=D9(_p.prototype.valueOf),rO=P9("wks"),Ag=0,iO=bx(_p),U9=iO.length;Ag<U9;Ag++)try{var oO=iO[Ag];k9(_p[oO])&&L9(oO)}catch{}var sO=function(t){if(nO&&nO(t))return!0;try{for(var e=M9(t),n=0,r=bx(rO),i=r.length;n<i;n++)if(rO[r[n]]==e)return!0}catch{}return!1};Bt({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:sO}),rn("matcher"),rn("observable"),Bt({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:Ox}),Bt({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:sO}),rn("metadataKey"),rn("patternMatch"),rn("replaceAll");var td=de(A9),Nx=de(nl.f("iterator"));function du(t){return du=typeof td=="function"&&typeof Nx=="symbol"?function(e){return typeof e}:function(e){return e&&typeof td=="function"&&e.constructor===td&&e!==td.prototype?"symbol":typeof e},du(t)}var x9=de(nl.f("toPrimitive"));function V9(t){var e=function(n,r){if(du(n)!=="object"||n===null)return n;var i=n[x9];if(i!==void 0){var o=i.call(n,r||"default");if(du(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}(t,"string");return du(e)==="symbol"?e:String(e)}function v(t,e,n){return(e=V9(e))in t?rx(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var F9=Pe,j9=Ce("iterator"),YR=!F9(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n=new URLSearchParams("a=1&a=2"),r="";return t.pathname="c%20d",e.forEach(function(i,o){e.delete("b"),r+=o+i}),n.delete("a",2),!t.toJSON||!n.has("a",1)||n.has("a",2)||!e.size&&!0||!e.sort||t.href!=="http://a/c%20d?a=1&c=3"||e.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!e[j9]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://").host!=="xn--e1aybc"||new URL("http://a#").hash!=="#%D0%B1"||r!=="a1c3"||new URL("http://x",void 0).host!=="x"}),B9=ca,Og=Bt,Dd=Le,Ep=dn,vo=Ae,ed=Qr,aO=YR,cO=ca,G9=A_,W9=function(t,e,n){for(var r in e)n&&n.unsafe&&t[r]?t[r]=e[r]:B9(t,r,e[r],n);return t},H9=da,K9=OR,$R=uc,Px=NR,bg=Qe,z9=fn,Y9=sa,$9=wo,q9=Qn,Dx=Pr,rr=ei,J9=Ah,dO=ra,Pv=AR,X9=w_,vc=tl,Q9=z2,Z9=Ce("iterator"),Ku="URLSearchParams",kx=Ku+"Iterator",Lx=$R.set,ui=$R.getterFor(Ku),tJ=$R.getterFor(kx),eJ=Object.getOwnPropertyDescriptor,qR=function(t){if(!ed)return Dd[t];var e=eJ(Dd,t);return e&&e.value},lO=qR("fetch"),Cm=qR("Request"),lu=qR("Headers"),Ng=Cm&&Cm.prototype,uO=lu&&lu.prototype,nJ=Dd.RegExp,rJ=Dd.TypeError,Mx=Dd.decodeURIComponent,iJ=Dd.encodeURIComponent,oJ=vo("".charAt),hO=vo([].join),Da=vo([].push),Dv=vo("".replace),sJ=vo([].shift),pO=vo([].splice),fO=vo("".split),aJ=vo("".slice),cJ=/\+/g,mO=Array(4),dJ=function(t){return mO[t-1]||(mO[t-1]=nJ("((?:%[\\da-f]{2}){"+t+"})","gi"))},lJ=function(t){try{return Mx(t)}catch{return t}},_O=function(t){var e=Dv(t,cJ," "),n=4;try{return Mx(e)}catch{for(;n;)e=Dv(e,dJ(n--),lJ);return e}},uJ=/[!'()~]|%20/g,hJ={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},pJ=function(t){return hJ[t]},EO=function(t){return Dv(iJ(t),uJ,pJ)},Pg=K9(function(t,e){Lx(this,{type:kx,iterator:Pv(ui(t).entries),kind:e})},"Iterator",function(){var t=tJ(this),e=t.kind,n=t.iterator.next(),r=n.value;return n.done||(n.value=e==="keys"?r.key:e==="values"?r.value:[r.key,r.value]),n},!0),Ux=function(t){this.entries=[],this.url=null,t!==void 0&&(Dx(t)?this.parseObject(t):this.parseQuery(typeof t=="string"?oJ(t,0)==="?"?aJ(t,1):t:rr(t)))};Ux.prototype={type:Ku,bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,r,i,o,s,a,c=X9(t);if(c)for(n=(e=Pv(t,c)).next;!(r=Ep(n,e)).done;){if(o=(i=Pv(q9(r.value))).next,(s=Ep(o,i)).done||(a=Ep(o,i)).done||!Ep(o,i).done)throw rJ("Expected sequence with length 2");Da(this.entries,{key:rr(s.value),value:rr(a.value)})}else for(var d in t)z9(t,d)&&Da(this.entries,{key:d,value:rr(t[d])})},parseQuery:function(t){if(t)for(var e,n,r=fO(t,"&"),i=0;i<r.length;)(e=r[i++]).length&&(n=fO(e,"="),Da(this.entries,{key:_O(sJ(n)),value:_O(hO(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],r=0;r<e.length;)t=e[r++],Da(n,EO(t.key)+"="+EO(t.value));return hO(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Im=function(){Px(this,Mc);var t=Lx(this,new Ux(arguments.length>0?arguments[0]:void 0));ed||(this.size=t.entries.length)},Mc=Im.prototype;if(W9(Mc,{append:function(t,e){var n=ui(this);vc(arguments.length,2),Da(n.entries,{key:rr(t),value:rr(e)}),ed||this.length++,n.updateURL()},delete:function(t){for(var e=ui(this),n=vc(arguments.length,1),r=e.entries,i=rr(t),o=n<2?void 0:arguments[1],s=o===void 0?o:rr(o),a=0;a<r.length;){var c=r[a];if(c.key!==i||s!==void 0&&c.value!==s)a++;else if(pO(r,a,1),s!==void 0)break}ed||(this.size=r.length),e.updateURL()},get:function(t){var e=ui(this).entries;vc(arguments.length,1);for(var n=rr(t),r=0;r<e.length;r++)if(e[r].key===n)return e[r].value;return null},getAll:function(t){var e=ui(this).entries;vc(arguments.length,1);for(var n=rr(t),r=[],i=0;i<e.length;i++)e[i].key===n&&Da(r,e[i].value);return r},has:function(t){for(var e=ui(this).entries,n=vc(arguments.length,1),r=rr(t),i=n<2?void 0:arguments[1],o=i===void 0?i:rr(i),s=0;s<e.length;){var a=e[s++];if(a.key===r&&(o===void 0||a.value===o))return!0}return!1},set:function(t,e){var n=ui(this);vc(arguments.length,1);for(var r,i=n.entries,o=!1,s=rr(t),a=rr(e),c=0;c<i.length;c++)(r=i[c]).key===s&&(o?pO(i,c--,1):(o=!0,r.value=a));o||Da(i,{key:s,value:a}),ed||(this.size=i.length),n.updateURL()},sort:function(){var t=ui(this);Q9(t.entries,function(e,n){return e.key>n.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=ui(this).entries,r=Y9(t,arguments.length>1?arguments[1]:void 0),i=0;i<n.length;)r((e=n[i++]).value,e.key,this)},keys:function(){return new Pg(this,"keys")},values:function(){return new Pg(this,"values")},entries:function(){return new Pg(this,"entries")}},{enumerable:!0}),cO(Mc,Z9,Mc.entries,{name:"entries"}),cO(Mc,"toString",function(){return ui(this).serialize()},{enumerable:!0}),ed&&G9(Mc,"size",{get:function(){return ui(this).entries.length},configurable:!0,enumerable:!0}),H9(Im,Ku),Og({global:!0,constructor:!0,forced:!aO},{URLSearchParams:Im}),!aO&&bg(lu)){var fJ=vo(uO.has),mJ=vo(uO.set),gO=function(t){if(Dx(t)){var e,n=t.body;if($9(n)===Ku)return e=t.headers?new lu(t.headers):new lu,fJ(e,"content-type")||mJ(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),J9(t,{body:dO(0,rr(n)),headers:dO(0,e)})}return t};if(bg(lO)&&Og({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return lO(t,arguments.length>1?gO(arguments[1]):{})}}),bg(Cm)){var Dg=function(t){return Px(this,Ng),new Cm(t,arguments.length>1?gO(arguments[1]):{})};Ng.constructor=Dg,Dg.prototype=Ng,Og({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Dg})}}var _J={URLSearchParams:Im,getState:ui},SO=de(Zr.URLSearchParams),EJ={isBrowser:!0,classes:{URLSearchParams:SO!==void 0?SO:BR,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const JR=typeof window<"u"&&typeof document<"u",kv=typeof navigator=="object"&&navigator||void 0,gJ=JR&&(!kv||["ReactNative","NativeScript","NS"].indexOf(kv.product)<0),SJ=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",TJ=JR&&window.location.href||"http://localhost";function TO(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function vO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?TO(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TO(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Rr=vO(vO({},Object.freeze({__proto__:null,hasBrowserEnv:JR,hasStandardBrowserEnv:gJ,hasStandardBrowserWebWorkerEnv:SJ,navigator:kv,origin:TJ})),EJ),vJ=Qn,yJ=dn,RJ=fn,CJ=Mn,IJ=function(){var t=vJ(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},yO=RegExp.prototype,xx=function(t){var e=t.flags;return e!==void 0||"flags"in yO||RJ(t,"flags")||!CJ(yO,t)?e:yJ(IJ,t)},wJ=xR.charAt,RO=dn,AJ=Qn,OJ=Qe,bJ=Co,NJ=/./.exec,PJ=TypeError,DJ=Bt,CO=dn,Vx=Bu,kJ=OR,gp=bR,IO=qd,Fx=mU,zu=ei,LJ=Qn,MJ=$d,UJ=Co,xJ=_U,jx=xx,VJ=S_,FJ=Pe,jJ=DR,BJ=function(t,e,n){return e+(n?wJ(t,e).length:1)},GJ=function(t,e){var n=t.exec;if(OJ(n)){var r=RO(n,t,e);return r!==null&&AJ(r),r}if(bJ(t)==="RegExp")return RO(NJ,t,e);throw PJ("RegExp#exec called on incompatible receiver")},Bx=uc,WJ=Ce("matchAll"),Gx="RegExp String",Wx=Gx+" Iterator",HJ=Bx.set,KJ=Bx.getterFor(Wx),zJ=TypeError,Lv=Vx("".indexOf),wm=Vx("".matchAll),kg=!!wm&&!FJ(function(){wm("a",/./)}),YJ=kJ(function(t,e,n,r){HJ(this,{type:Wx,regexp:t,string:e,global:n,unicode:r,done:!1})},Gx,function(){var t=KJ(this);if(t.done)return gp(void 0,!0);var e=t.regexp,n=t.string,r=GJ(e,n);return r===null?(t.done=!0,gp(void 0,!0)):t.global?(zu(r[0])===""&&(e.lastIndex=BJ(n,Fx(e.lastIndex),t.unicode)),gp(r,!1)):(t.done=!0,gp(r,!1))}),wO=function(t){var e,n,r,i=LJ(this),o=zu(t),s=jJ(i,RegExp),a=zu(jx(i));return e=new s(s===RegExp?i.source:i,a),n=!!~Lv(a,"g"),r=!!~Lv(a,"u"),e.lastIndex=Fx(i.lastIndex),new YJ(e,o,n,r)};DJ({target:"String",proto:!0,forced:kg},{matchAll:function(t){var e,n,r,i,o=IO(this);if(MJ(t)){if(kg)return wm(o,t)}else{if(xJ(t)&&(e=zu(IO(jx(t))),!~Lv(e,"g")))throw zJ("`.matchAll` does not allow non-global regexes");if(kg)return wm(o,t);if((r=VJ(t,WJ))===void 0&&UJ(t)=="RegExp"&&(r=wO),r)return CO(r,t,o)}return n=zu(o),i=new RegExp(t,"g"),CO(wO,i,n)}});var $J=Ai("String").matchAll,qJ=Mn,JJ=$J,Lg=String.prototype,XJ=function(t){var e=t.matchAll;return typeof t=="string"||t===Lg||qJ(Lg,t)&&e===Lg.matchAll?JJ:e},QJ=de(XJ);function Hx(t){function e(n,r,i,o){let s=n[o++];if(s==="__proto__")return!0;const a=Number.isFinite(+s),c=o>=n.length;return s=!s&&H.isArray(i)?i.length:s,c?(H.hasOwnProp(i,s)?i[s]=[i[s],r]:i[s]=r,!a):(i[s]&&H.isObject(i[s])||(i[s]=[]),e(n,r,i[s],o)&&H.isArray(i[s])&&(i[s]=function(d){const l={},u=Object.keys(d);let h;const p=u.length;let S;for(h=0;h<p;h++)S=u[h],l[S]=d[S];return l}(i[s])),!a)}if(H.isFormData(t)&&H.isFunction(t.entries)){const n={};return H.forEachEntry(t,(r,i)=>{e(function(o){return QJ(H).call(H,/\w+|\[(\w*)]/g,o).map(s=>s[0]==="[]"?"":s[1]||s[0])}(r),i,n,0)}),n}return null}const XR={transitional:tx,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const n=e.getContentType()||"",r=n.indexOf("application/json")>-1,i=H.isObject(t);if(i&&H.isHTMLForm(t)&&(t=new FormData(t)),H.isFormData(t))return r?JSON.stringify(Hx(t)):t;if(H.isArrayBuffer(t)||H.isBuffer(t)||H.isStream(t)||H.isFile(t)||H.isBlob(t)||H.isReadableStream(t))return t;if(H.isArrayBufferView(t))return t.buffer;if(H.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let o;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(s,a){return vm(s,new Rr.classes.URLSearchParams,Object.assign({visitor:function(c,d,l,u){return Rr.isNode&&H.isBuffer(c)?(this.append(d,c.toString("base64")),!1):u.defaultVisitor.apply(this,arguments)}},a))}(t,this.formSerializer).toString();if((o=H.isFileList(t))||n.indexOf("multipart/form-data")>-1){const s=this.env&&this.env.FormData;return vm(o?{"files[]":t}:t,s&&new s,this.formSerializer)}}return i||r?(e.setContentType("application/json",!1),function(s,a,c){if(H.isString(s))try{return(a||JSON.parse)(s),Cn(H).call(H,s)}catch(d){if(d.name!=="SyntaxError")throw d}return(0,JSON.stringify)(s)}(t)):t}],transformResponse:[function(t){const e=this.transitional||XR.transitional,n=e&&e.forcedJSONParsing,r=this.responseType==="json";if(H.isResponse(t)||H.isReadableStream(t))return t;if(t&&H.isString(t)&&(n&&!this.responseType||r)){const i=!(e&&e.silentJSONParsing)&&r;try{return JSON.parse(t)}catch(o){if(i)throw o.name==="SyntaxError"?jt.from(o,jt.ERR_BAD_RESPONSE,this,null,this.response):o}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Rr.classes.FormData,Blob:Rr.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};H.forEach(["delete","get","head","post","put","patch"],t=>{XR.headers[t]={}});var QR=XR;const ZJ=H.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),AO=Symbol("internals");function yl(t){var e;return t&&Cn(e=String(t)).call(e).toLowerCase()}function yf(t){return t===!1||t==null?t:H.isArray(t)?t.map(yf):String(t)}function Mg(t,e,n,r,i){return H.isFunction(r)?r.call(this,e,n):(i&&(e=n),H.isString(e)?H.isString(r)?e.indexOf(r)!==-1:H.isRegExp(r)?r.test(e):void 0:void 0)}class Rf{constructor(e){e&&this.set(e)}set(e,n,r){const i=this;function o(c,d,l){const u=yl(d);if(!u)throw new Error("header name must be a non-empty string");const h=H.findKey(i,u);(!h||i[h]===void 0||l===!0||l===void 0&&i[h]!==!1)&&(i[h||d]=yf(c))}const s=(c,d)=>H.forEach(c,(l,u)=>o(l,u,d));if(H.isPlainObject(e)||e instanceof this.constructor)s(e,n);else if(H.isString(e)&&(e=Cn(e).call(e))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Cn(a=e).call(a)))s((c=>{const d={};let l,u,h;return c&&c.split(`
`).forEach(function(p){var S,f;h=p.indexOf(":"),l=Cn(S=p.substring(0,h)).call(S).toLowerCase(),u=Cn(f=p.substring(h+1)).call(f),!l||d[l]&&ZJ[l]||(l==="set-cookie"?d[l]?d[l].push(u):d[l]=[u]:d[l]=d[l]?d[l]+", "+u:u)}),d})(e),n);else if(H.isHeaders(e))for(const[c,d]of e.entries())o(d,c,r);else e!=null&&o(n,e,r);var a;return this}get(e,n){if(e=yl(e)){const r=H.findKey(this,e);if(r){const i=this[r];if(!n)return i;if(n===!0)return function(o){const s=Object.create(null),a=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let c;for(;c=a.exec(o);)s[c[1]]=c[2];return s}(i);if(H.isFunction(n))return n.call(this,i,r);if(H.isRegExp(n))return n.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=yl(e)){const r=H.findKey(this,e);return!(!r||this[r]===void 0||n&&!Mg(0,this[r],r,n))}return!1}delete(e,n){const r=this;let i=!1;function o(s){if(s=yl(s)){const a=H.findKey(r,s);!a||n&&!Mg(0,r[a],a,n)||(delete r[a],i=!0)}}return H.isArray(e)?e.forEach(o):o(e),i}clear(e){const n=Object.keys(this);let r=n.length,i=!1;for(;r--;){const o=n[r];e&&!Mg(0,this[o],o,e,!0)||(delete this[o],i=!0)}return i}normalize(e){const n=this,r={};return H.forEach(this,(i,o)=>{var s;const a=H.findKey(r,o);if(a)return n[a]=yf(i),void delete n[o];const c=e?function(d){return Cn(d).call(d).toLowerCase().replace(/([a-z\d])(\w*)/g,(l,u,h)=>u.toUpperCase()+h)}(o):Cn(s=String(o)).call(s);c!==o&&delete n[o],n[c]=yf(i),r[c]=!0}),this}concat(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.constructor.concat(this,...n)}toJSON(e){const n=Object.create(null);return H.forEach(this,(r,i)=>{r!=null&&r!==!1&&(n[i]=e&&H.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[n,r]=e;return n+": "+r}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const n=new this(e);for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i.forEach(s=>n.set(s)),n}static accessor(e){const n=(this[AO]=this[AO]={accessors:{}}).accessors,r=this.prototype;function i(o){const s=yl(o);n[s]||(function(a,c){const d=H.toCamelCase(" "+c);["get","set","has"].forEach(l=>{Object.defineProperty(a,l+d,{value:function(u,h,p){return this[l].call(this,c,u,h,p)},configurable:!0})})}(r,o),n[s]=!0)}return H.isArray(e)?e.forEach(i):i(e),this}}Rf.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),H.reduceDescriptors(Rf.prototype,(t,e)=>{let{value:n}=t,r=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(i){this[r]=i}}}),H.freezeMethods(Rf);var Hi=Rf;function Ug(t,e){const n=this||QR,r=e||n,i=Hi.from(r.headers);let o=r.data;return H.forEach(t,function(s){o=s.call(n,o,i.normalize(),e?e.status:void 0)}),i.normalize(),o}function Kx(t){return!(!t||!t.__CANCEL__)}function rl(t,e,n){jt.call(this,t??"canceled",jt.ERR_CANCELED,e,n),this.name="CanceledError"}function zx(t,e,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?e(new jt("Request failed with status code "+n.status,[jt.ERR_BAD_REQUEST,jt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):t(n)}H.inherits(rl,jt,{__CANCEL__:!0});const Am=function(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,r=0;const i=function(o,s){o=o||10;const a=new Array(o),c=new Array(o);let d,l=0,u=0;return s=s!==void 0?s:1e3,function(h){const p=Date.now(),S=c[u];d||(d=p),a[l]=h,c[l]=p;let f=u,_=0;for(;f!==l;)_+=a[f++],f%=o;if(l=(l+1)%o,l===u&&(u=(u+1)%o),p-d<s)return;const T=S&&p-S;return T?Math.round(1e3*_/T):void 0}}(50,250);return function(o,s){let a,c,d=0,l=1e3/s;const u=function(h){d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),a=null,c&&(clearTimeout(c),c=null),o.apply(null,h)};return[function(){const h=Date.now(),p=h-d;for(var S=arguments.length,f=new Array(S),_=0;_<S;_++)f[_]=arguments[_];p>=l?u(f,h):(a=f,c||(c=setTimeout(()=>{c=null,u(a)},l-p)))},()=>a&&u(a)]}(o=>{const s=o.loaded,a=o.lengthComputable?o.total:void 0,c=s-r,d=i(c);r=s,t({loaded:s,total:a,progress:a?s/a:void 0,bytes:c,rate:d||void 0,estimated:d&&a&&s<=a?(a-s)/d:void 0,event:o,lengthComputable:a!=null,[e?"download":"upload"]:!0})},n)},OO=(t,e)=>{const n=t!=null;return[r=>e[0]({lengthComputable:n,total:t,loaded:r}),e[1]]},bO=t=>function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return H.asap(()=>t(...n))};var tX=Rr.hasStandardBrowserEnv?function(){const t=Rr.navigator&&/(msie|trident)/i.test(Rr.navigator.userAgent),e=document.createElement("a");let n;function r(i){let o=i;return t&&(e.setAttribute("href",o),o=e.href),e.setAttribute("href",o),{href:e.href,protocol:e.protocol?e.protocol.replace(/:$/,""):"",host:e.host,search:e.search?e.search.replace(/^\?/,""):"",hash:e.hash?e.hash.replace(/^#/,""):"",hostname:e.hostname,port:e.port,pathname:e.pathname.charAt(0)==="/"?e.pathname:"/"+e.pathname}}return n=r(window.location.href),function(i){const o=H.isString(i)?r(i):i;return o.protocol===n.protocol&&o.host===n.host}}():function(){return!0},eX=Rr.hasStandardBrowserEnv?{write(t,e,n,r,i,o){const s=[t+"="+encodeURIComponent(e)];H.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),H.isString(r)&&s.push("path="+r),H.isString(i)&&s.push("domain="+i),o===!0&&s.push("secure"),document.cookie=s.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function Yx(t,e){return t&&!function(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}(e)?function(n,r){return r?n.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):n}(t,e):e}function NO(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}const PO=t=>t instanceof Hi?function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?NO(Object(r),!0).forEach(function(i){v(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NO(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}({},t):t;function nc(t,e){e=e||{};const n={};function r(d,l,u){return H.isPlainObject(d)&&H.isPlainObject(l)?H.merge.call({caseless:u},d,l):H.isPlainObject(l)?H.merge({},l):H.isArray(l)?l.slice():l}function i(d,l,u){return H.isUndefined(l)?H.isUndefined(d)?void 0:r(void 0,d,u):r(d,l,u)}function o(d,l){if(!H.isUndefined(l))return r(void 0,l)}function s(d,l){return H.isUndefined(l)?H.isUndefined(d)?void 0:r(void 0,d):r(void 0,l)}function a(d,l,u){return u in e?r(d,l):u in t?r(void 0,d):void 0}const c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,withXSRFToken:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a,headers:(d,l)=>i(PO(d),PO(l),!0)};return H.forEach(Object.keys(Object.assign({},t,e)),function(d){const l=c[d]||i,u=l(t[d],e[d],d);H.isUndefined(u)&&l!==a||(n[d]=u)}),n}var $x=t=>{const e=nc({},t);let n,{data:r,withXSRFToken:i,xsrfHeaderName:o,xsrfCookieName:s,headers:a,auth:c}=e;if(e.headers=a=Hi.from(a),e.url=Z2(Yx(e.baseURL,e.url),t.params,t.paramsSerializer),c&&a.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),H.isFormData(r)){if(Rr.hasStandardBrowserEnv||Rr.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if((n=a.getContentType())!==!1){const[d,...l]=n?n.split(";").map(u=>Cn(u).call(u)).filter(Boolean):[];a.setContentType([d||"multipart/form-data",...l].join("; "))}}if(Rr.hasStandardBrowserEnv&&(i&&H.isFunction(i)&&(i=i(e)),i||i!==!1&&tX(e.url))){const d=o&&s&&eX.read(s);d&&a.set(o,d)}return e},nX=typeof XMLHttpRequest<"u"&&function(t){return new Y(function(e,n){const r=$x(t);let i=r.data;const o=Hi.from(r.headers).normalize();let s,a,c,d,l,{responseType:u,onUploadProgress:h,onDownloadProgress:p}=r;function S(){d&&d(),l&&l(),r.cancelToken&&r.cancelToken.unsubscribe(s),r.signal&&r.signal.removeEventListener("abort",s)}let f=new XMLHttpRequest;function _(){if(!f)return;const g=Hi.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders());zx(function(y){e(y),S()},function(y){n(y),S()},{data:u&&u!=="text"&&u!=="json"?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:g,config:t,request:f}),f=null}f.open(r.method.toUpperCase(),r.url,!0),f.timeout=r.timeout,"onloadend"in f?f.onloadend=_:f.onreadystatechange=function(){f&&f.readyState===4&&(f.status!==0||f.responseURL&&f.responseURL.indexOf("file:")===0)&&setTimeout(_)},f.onabort=function(){f&&(n(new jt("Request aborted",jt.ECONNABORTED,t,f)),f=null)},f.onerror=function(){n(new jt("Network Error",jt.ERR_NETWORK,t,f)),f=null},f.ontimeout=function(){let g=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const y=r.transitional||tx;r.timeoutErrorMessage&&(g=r.timeoutErrorMessage),n(new jt(g,y.clarifyTimeoutError?jt.ETIMEDOUT:jt.ECONNABORTED,t,f)),f=null},i===void 0&&o.setContentType(null),"setRequestHeader"in f&&H.forEach(o.toJSON(),function(g,y){f.setRequestHeader(y,g)}),H.isUndefined(r.withCredentials)||(f.withCredentials=!!r.withCredentials),u&&u!=="json"&&(f.responseType=r.responseType),p&&([c,l]=Am(p,!0),f.addEventListener("progress",c)),h&&f.upload&&([a,d]=Am(h),f.upload.addEventListener("progress",a),f.upload.addEventListener("loadend",d)),(r.cancelToken||r.signal)&&(s=g=>{f&&(n(!g||g.type?new rl(null,t,f):g),f.abort(),f=null)},r.cancelToken&&r.cancelToken.subscribe(s),r.signal&&(r.signal.aborted?s():r.signal.addEventListener("abort",s)));const T=function(g){const y=/^([-+\w]{1,25})(:?\/\/|:)/.exec(g);return y&&y[1]||""}(r.url);T&&Rr.protocols.indexOf(T)===-1?n(new jt("Unsupported protocol "+T+":",jt.ERR_BAD_REQUEST,t)):f.send(i||null)})},rX=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let r,i=new AbortController;const o=function(d){if(!r){r=!0,a();const l=d instanceof Error?d:this.reason;i.abort(l instanceof jt?l:new rl(l instanceof Error?l.message:l))}};let s=e&&setTimeout(()=>{s=null,o(new jt("timeout ".concat(e," of ms exceeded"),jt.ETIMEDOUT))},e);const a=()=>{t&&(s&&clearTimeout(s),s=null,t.forEach(d=>{d.unsubscribe?d.unsubscribe(o):d.removeEventListener("abort",o)}),t=null)};t.forEach(d=>d.addEventListener("abort",o));const{signal:c}=i;return c.unsubscribe=()=>H.asap(a),c}},iX=f2,oX=Ao;Bt({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=oX.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var sX=Ao,aX=el;Bt({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=sX.f(this),n=aX(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var Mv=de(iX),qx=nl.f("asyncIterator"),cX=de(qx);function ZR(t,e){this.v=t,this.k=e}function jl(t){var e,n;function r(o,s){try{var a=t[o](s),c=a.value,d=c instanceof ZR;Mv.resolve(d?c.v:c).then(function(l){if(d){var u=o==="return"?"return":"next";if(!c.k||l.done)return r(u,l);l=t[u](l).value}i(a.done?"return":"normal",l)},function(l){r("throw",l)})}catch(l){i("throw",l)}}function i(o,s){switch(o){case"return":e.resolve({value:s,done:!0});break;case"throw":e.reject(s);break;default:e.resolve({value:s,done:!1})}(e=e.next)?r(e.key,e.arg):n=null}this._invoke=function(o,s){return new Mv(function(a,c){var d={key:o,arg:s,resolve:a,reject:c,next:null};n?n=n.next=d:(e=n=d,r(o,s))})},typeof t.return!="function"&&(this.return=void 0)}function Hr(t){return function(){return new jl(t.apply(this,arguments))}}function Ct(t){return new ZR(t,0)}function Om(t){var e={},n=!1;function r(i,o){return n=!0,{done:!1,value:new ZR(o=new Mv(function(s){s(t[i](o))}),1)}}return e[td!==void 0&&Nx||"@@iterator"]=function(){return this},e.next=function(i){return n?(n=!1,i):r("next",i)},typeof t.throw=="function"&&(e.throw=function(i){if(n)throw n=!1,i;return r("throw",i)}),typeof t.return=="function"&&(e.return=function(i){return n?(n=!1,i):r("return",i)}),e}jl.prototype[typeof td=="function"&&cX||"@@asyncIterator"]=function(){return this},jl.prototype.next=function(t){return this._invoke("next",t)},jl.prototype.throw=function(t){return this._invoke("throw",t)},jl.prototype.return=function(t){return this._invoke("return",t)};var tC=de(qx);function Uv(t){var e,n,r,i=2;for(typeof Symbol<"u"&&(n=tC,r=Symbol.iterator);i--;){if(n&&(e=t[n])!=null)return e.call(t);if(r&&(e=t[r])!=null)return new Cf(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Cf(t){function e(n){if(Object(n)!==n)return Y.reject(new TypeError(n+" is not an object."));var r=n.done;return Y.resolve(n.value).then(function(i){return{value:i,done:r}})}return Cf=function(n){this.s=n,this.n=n.next},Cf.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Y.resolve({value:n,done:!0}):e(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Y.reject(n):e(r.apply(this.s,arguments))}},new Cf(t)}const dX=function*(t,e){let n=t.byteLength;if(!e||n<e)return void(yield t);let r,i=0;for(;i<n;)r=i+e,yield t.slice(i,r),i=r},lX=function(){var t=Hr(function*(e,n){var r,i=!1,o=!1;try{for(var s,a=Uv(uX(e));i=!(s=yield Ct(a.next())).done;i=!1){const c=s.value;yield*Om(Uv(dX(c,n)))}}catch(c){o=!0,r=c}finally{try{i&&a.return!=null&&(yield Ct(a.return()))}finally{if(o)throw r}}});return function(e,n){return t.apply(this,arguments)}}(),uX=function(){var t=Hr(function*(e){if(e[tC])return void(yield*Om(Uv(e)));const n=e.getReader();try{for(;;){const{done:r,value:i}=yield Ct(n.read());if(r)break;yield i}}finally{yield Ct(n.cancel())}});return function(e){return t.apply(this,arguments)}}(),DO=(t,e,n,r)=>{const i=lX(t,e);let o,s=0,a=c=>{o||(o=!0,r&&r(c))};return new ReadableStream({async pull(c){try{const{done:d,value:l}=await i.next();if(d)return a(),void c.close();let u=l.byteLength;if(n){let h=s+=u;n(h)}c.enqueue(new Uint8Array(l))}catch(d){throw a(d),d}},cancel:c=>(a(c),i.return())},{highWaterMark:2})};function kO(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function LO(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?kO(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kO(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const U_=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Jx=U_&&typeof ReadableStream=="function",hX=U_&&(typeof TextEncoder=="function"?(MO=new TextEncoder,t=>MO.encode(t)):async t=>new Uint8Array(await new Response(t).arrayBuffer()));var MO;const Xx=function(t){try{for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return!!t(...n)}catch{return!1}},pX=Jx&&Xx(()=>{let t=!1;const e=new Request(Rr.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),xv=Jx&&Xx(()=>H.isReadableStream(new Response("").body)),bm={stream:xv&&(t=>t.body)};var UO;U_&&(UO=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(t=>{!bm[t]&&(bm[t]=H.isFunction(UO[t])?e=>e[t]():(e,n)=>{throw new jt("Response type '".concat(t,"' is not supported"),jt.ERR_NOT_SUPPORT,n)})}));const fX=async(t,e)=>{const n=H.toFiniteNumber(t.getContentLength());return n??(async r=>r==null?0:H.isBlob(r)?r.size:H.isSpecCompliantForm(r)?(await new Request(Rr.origin,{method:"POST",body:r}).arrayBuffer()).byteLength:H.isArrayBufferView(r)||H.isArrayBuffer(r)?r.byteLength:(H.isURLSearchParams(r)&&(r+=""),H.isString(r)?(await hX(r)).byteLength:void 0))(e)};var mX=U_&&(async t=>{let{url:e,method:n,data:r,signal:i,cancelToken:o,timeout:s,onDownloadProgress:a,onUploadProgress:c,responseType:d,headers:l,withCredentials:u="same-origin",fetchOptions:h}=$x(t);d=d?(d+"").toLowerCase():"text";let p,S=rX([i,o&&o.toAbortSignal()],s);const f=S&&S.unsubscribe&&(()=>{S.unsubscribe()});let _;try{if(c&&pX&&n!=="get"&&n!=="head"&&(_=await fX(l,r))!==0){let O,b=new Request(e,{method:"POST",body:r,duplex:"half"});if(H.isFormData(r)&&(O=b.headers.get("content-type"))&&l.setContentType(O),b.body){const[N,U]=OO(_,Am(bO(c)));r=DO(b.body,65536,N,U)}}H.isString(u)||(u=u?"include":"omit");const T="credentials"in Request.prototype;p=new Request(e,LO(LO({},h),{},{signal:S,method:n.toUpperCase(),headers:l.normalize().toJSON(),body:r,duplex:"half",credentials:T?u:void 0}));let g=await fetch(p);const y=xv&&(d==="stream"||d==="response");if(xv&&(a||y&&f)){const O={};["status","statusText","headers"].forEach(V=>{O[V]=g[V]});const b=H.toFiniteNumber(g.headers.get("content-length")),[N,U]=a&&OO(b,Am(bO(a),!0))||[];g=new Response(DO(g.body,65536,N,()=>{U&&U(),f&&f()}),O)}d=d||"text";let I=await bm[H.findKey(bm,d)||"text"](g,t);return!y&&f&&f(),await new Y((O,b)=>{zx(O,b,{data:I,headers:Hi.from(g.headers),status:g.status,statusText:g.statusText,config:t,request:p})})}catch(T){throw f&&f(),T&&T.name==="TypeError"&&/fetch/i.test(T.message)?Object.assign(new jt("Network Error",jt.ERR_NETWORK,t,p),{cause:T.cause||T}):jt.from(T,T&&T.code,t,p)}});const Vv={http:null,xhr:nX,fetch:mX};H.forEach(Vv,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const xO=t=>"- ".concat(t),_X=t=>H.isFunction(t)||t===null||t===!1;var Qx={getAdapter:t=>{t=H.isArray(t)?t:[t];const{length:e}=t;let n,r;const i={};for(let o=0;o<e;o++){let s;if(n=t[o],r=n,!_X(n)&&(r=Vv[(s=String(n)).toLowerCase()],r===void 0))throw new jt("Unknown adapter '".concat(s,"'"));if(r)break;i[s||"#"+o]=r}if(!r){const o=Object.entries(i).map(s=>{let[a,c]=s;return"adapter ".concat(a," ")+(c===!1?"is not supported by the environment":"is not available in the build")});throw new jt("There is no suitable adapter to dispatch the request "+(e?o.length>1?`since :
`+o.map(xO).join(`
`):" "+xO(o[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return r},adapters:Vv};function xg(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new rl(null,t)}function VO(t){return xg(t),t.headers=Hi.from(t.headers),t.data=Ug.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Qx.getAdapter(t.adapter||QR.adapter)(t).then(function(e){return xg(t),e.data=Ug.call(t,t.transformResponse,e),e.headers=Hi.from(e.headers),e},function(e){return Kx(e)||(xg(t),e&&e.response&&(e.response.data=Ug.call(t,t.transformResponse,e.response),e.response.headers=Hi.from(e.response.headers))),Y.reject(e)})}const Zx="1.7.7",eC={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{eC[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const FO={};eC.transitional=function(t,e,n){function r(i,o){return"[Axios v"+Zx+"] Transitional option '"+i+"'"+o+(n?". "+n:"")}return(i,o,s)=>{if(t===!1)throw new jt(r(o," has been removed"+(e?" in "+e:"")),jt.ERR_DEPRECATED);return e&&!FO[o]&&(FO[o]=!0,console.warn(r(o," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(i,o,s)}};var Fv={assertOptions:function(t,e,n){if(typeof t!="object")throw new jt("options must be an object",jt.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let i=r.length;for(;i-- >0;){const o=r[i],s=e[o];if(s){const a=t[o],c=a===void 0||s(a,o,t);if(c!==!0)throw new jt("option "+o+" must be "+c,jt.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new jt("Unknown option "+o,jt.ERR_BAD_OPTION)}},validators:eC};const ds=Fv.validators;let If=class{constructor(t){this.defaults=t,this.interceptors={request:new wA,response:new wA}}async request(t,e){try{return await this._request(t,e)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const i=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(t,e){typeof t=="string"?(e=e||{}).url=t:e=t||{},e=nc(this.defaults,e);const{transitional:n,paramsSerializer:r,headers:i}=e;n!==void 0&&Fv.assertOptions(n,{silentJSONParsing:ds.transitional(ds.boolean),forcedJSONParsing:ds.transitional(ds.boolean),clarifyTimeoutError:ds.transitional(ds.boolean)},!1),r!=null&&(H.isFunction(r)?e.paramsSerializer={serialize:r}:Fv.assertOptions(r,{encode:ds.function,serialize:ds.function},!0)),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=i&&H.merge(i.common,i[e.method]);i&&H.forEach(["delete","get","head","post","put","patch","common"],p=>{delete i[p]}),e.headers=Hi.concat(o,i);const s=[];let a=!0;this.interceptors.request.forEach(function(p){typeof p.runWhen=="function"&&p.runWhen(e)===!1||(a=a&&p.synchronous,s.unshift(p.fulfilled,p.rejected))});const c=[];let d;this.interceptors.response.forEach(function(p){c.push(p.fulfilled,p.rejected)});let l,u=0;if(!a){const p=[VO.bind(this),void 0];for(p.unshift.apply(p,s),p.push.apply(p,c),l=p.length,d=Y.resolve(e);u<l;)d=d.then(p[u++],p[u++]);return d}l=s.length;let h=e;for(u=0;u<l;){const p=s[u++],S=s[u++];try{h=p(h)}catch(f){S.call(this,f);break}}try{d=VO.call(this,h)}catch(p){return Y.reject(p)}for(u=0,l=c.length;u<l;)d=d.then(c[u++],c[u++]);return d}getUri(t){return Z2(Yx((t=nc(this.defaults,t)).baseURL,t.url),t.params,t.paramsSerializer)}};H.forEach(["delete","get","head","options"],function(t){If.prototype[t]=function(e,n){return this.request(nc(n||{},{method:t,url:e,data:(n||{}).data}))}}),H.forEach(["post","put","patch"],function(t){function e(n){return function(r,i,o){return this.request(nc(o||{},{method:t,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}If.prototype[t]=e(),If.prototype[t+"Form"]=e(!0)});var wf=If;class nC{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Y(function(i){n=i});const r=this;this.promise.then(i=>{if(!r._listeners)return;let o=r._listeners.length;for(;o-- >0;)r._listeners[o](i);r._listeners=null}),this.promise.then=i=>{let o;const s=new Y(a=>{r.subscribe(a),o=a}).then(i);return s.cancel=function(){r.unsubscribe(o)},s},e(function(i,o,s){r.reason||(r.reason=new rl(i,o,s),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=r=>{e.abort(r)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new nC(function(n){e=n}),cancel:e}}}var EX=nC;const jv={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(jv).forEach(t=>{let[e,n]=t;jv[n]=e});var gX=jv;const mn=function t(e){const n=new wf(e),r=J2(wf.prototype.request,n);return H.extend(r,wf.prototype,n,{allOwnKeys:!0}),H.extend(r,n,null,{allOwnKeys:!0}),r.create=function(i){return t(nc(e,i))},r}(QR);mn.Axios=wf,mn.CanceledError=rl,mn.CancelToken=EX,mn.isCancel=Kx,mn.VERSION=Zx,mn.toFormData=vm,mn.AxiosError=jt,mn.Cancel=mn.CanceledError,mn.all=function(t){return Y.all(t)},mn.spread=function(t){return function(e){return t.apply(null,e)}},mn.isAxiosError=function(t){return H.isObject(t)&&t.isAxiosError===!0},mn.mergeConfig=nc,mn.AxiosHeaders=Hi,mn.formToJSON=t=>Hx(H.isHTMLForm(t)?new FormData(t):t),mn.getAdapter=Qx.getAdapter,mn.HttpStatusCode=gX,mn.default=mn;var Gn=mn;const SX=()=>{};function Yu(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:SX};return t.promise=new Y((e,n)=>{t.resolve=r=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(r),t.value=r)},t.reject=r=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(r))}}),t}const Sp=new Map,Tp=new Map,to=new Map;let Ve=function(t){return t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.CHROMIUM_OS="Chromium OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot",t}({}),Pt=function(t){return t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger",t}({});const tV=new iq;let Fi=tV.getResult(),Vg=null;function It(t){if(!Vg){Fi=tV.getResult();const e=function(a){if(a.engine.name==="Blink"&&a.browser.name!=="WeChat")return Pt.CHROME;switch(a.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Pt.CHROME;case"Safari":case"Mobile Safari":return Pt.SAFARI;case"Edge":return Pt.EDGE;case"Firefox":return Pt.FIREFOX;case"QQ":case"QQBrowser":return Pt.QQ;case"Opera":return Pt.OPERA;case"WeChat":return Pt.WECHAT;default:return a.browser.name||""}}(Fi),n=jO(Fi),r=function(a){return a.os.name==="Windows"?a.os.version?a.os.name+" "+a.os.version:a.os.name:a.os.name||""}(Fi),i=Fi.os.version,o=jO(Fi,!1),s=Fi.device.type;if(!(e&&n&&r&&i))return{name:e,version:n,os:r,osVersion:i,browserVersion:o,deviceType:s};Vg={name:e,version:n,os:r,osVersion:i,browserVersion:o,deviceType:s}}return Vg}function jO(t){let e,n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return e=t.engine.name==="Blink"?t.engine.version||"":t.browser.version||"",n?e.split(".")[0]:e}function x_(){return It().os}function BO(){const t=It();return"".concat(t.os," ").concat(t.osVersion)}function Nm(){const t=It();return!!(Fi.engine.name==="WebKit"&&t.os===Ve.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==Pt.SAFARI||Dn()&&t.name!==Pt.SAFARI)}function Ws(){return It().name===Pt.CHROME}function an(){return It().name===Pt.SAFARI}function eV(){return It().name===Pt.EDGE}function ce(){return It().name===Pt.FIREFOX}function Dn(){return It().os===Ve.IOS}function Bv(t){const e=It();return!(e.name!==Pt.CHROME||!e.osVersion)&&Number(e.version)>=t}function nV(t){const e=It();return!(e.name!==Pt.CHROME||!e.osVersion)&&Number(e.version)<t}function GO(t){const e=It();return!(e.name!==Pt.EDGE||!e.osVersion)&&Number(e.version)>=t}function rV(t){const e=It();return!(e.name!==Pt.SAFARI||!e.osVersion)&&Number(e.version)>=t}function iV(t,e,n){const r=It();if(r.os!==Ve.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return e&&Number(i[0])===t&&Number(i[1])<e||Number(i[0])<t}function oV(t,e,n){const r=It();if(r.name!==Pt.SAFARI||!r.osVersion||!r.browserVersion)return!1;const i=r.browserVersion.split(".");return e&&Number(i[0])===t&&Number(i[1])<e||Number(i[0])<t}function WO(t){const e=It();return!(e.name!==Pt.OPERA||!e.osVersion)&&Number(e.version)>=t}function HO(){const t=It();if(t.os!==Ve.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||Number(e[0])===14&&Number(e[1])<=6}function kd(){const t=It();if(t.os!==Ve.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15}function Gv(){const t=It();if(t.os!==Ve.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===16}function KO(){const t=It();if(t.os!==Ve.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])===15&&Number(e[1])>=1}function Ri(){return an()&&navigator.maxTouchPoints>0}function sV(){return It().name===Pt.WECHAT}function aV(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function rC(){const t=x_();return function(){const{deviceType:e}=It();return e==="mobile"||e==="tablet"}()||t===Ve.ANDROID||t===Ve.IOS||t===Ve.HARMONY_OS}function Xs(){const t=It();return t.name!==Pt.EDGE&&t.name!==Pt.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function V_(){return x_()===Ve.ANDROID}function $u(){const t=It();return V_()&&(t.name===Pt.CHROME||t.name===Pt.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function Qt(t,e,n){return(e=function(r){var i=function(o,s){if(typeof o!="object"||!o)return o;var a=o[Symbol.toPrimitive];if(a!==void 0){var c=a.call(o,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(r);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function zO(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Z(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?zO(Object(n),!0).forEach(function(r){Qt(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zO(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let R=function(t){return t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",t.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",t}({}),M=class extends Error{constructor(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),Qt(this,"code",void 0),Qt(this,"message",void 0),Qt(this,"data",void 0),Qt(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return t==="error"&&(e||console).error(this.toString()),t==="warning"&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Wo(t,e){if(typeof t!="boolean")throw new M(R.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function De(t,e,n){if(!$(n).call(n,t))throw new M(R.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function Vt(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(t<n||t>r||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(t))throw new M(R.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function Fg(t,e){if(typeof t!="number"){if(!(t.min||t.max||t.ideal||t.exact))throw new M(R.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));t.min!==void 0&&Vt(t.min,"".concat(e,".min"),0,1/0),t.max!==void 0&&Vt(t.max,"".concat(e,".max"),1,1/0),t.exact!==void 0&&Vt(t.exact,"".concat(e,".exact"),1,1/0),t.ideal!==void 0&&Vt(t.ideal,"".concat(e,".ideal"),1,1/0)}else Vt(t,e,1,1/0)}function Ke(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(t==null)throw new M(R.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!cV(t,n,r,i))throw new M(R.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function Fo(t,e){if(!Array.isArray(t))throw new M(R.INVALID_PARAMS,"".concat(e," should be an array"))}function ne(t){return t==null}function cV(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof t=="string"&&t.length<=n&&t.length>=e&&(!r||function(i){if(typeof i!="string")return!1;for(let o=0;o<i.length;o+=1){const s=i.charCodeAt(o);if(s<0||s>255)return!1}return!0}(t))}var Bl=function(t){return t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE",t}(Bl||{}),Wv=function(t){return t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",t}(Wv||{});const dV=new class{constructor(){Qt(this,"_clientSize",null),Qt(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Qt(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Qt(this,"getStyle",t=>window.getComputedStyle(t,null)),Qt(this,"checkCssVisibleProperty",t=>{var e;let n=!0;const r=this.getStyle(t),{display:i,visibility:o,opacity:s,filter:a}=r;return(i==="none"||$(e=["hidden","collapse"]).call(e,o)||Number(s)<.1)&&(n=!1),!!n&&(a&&a.split(" ").filter(c=>{var d;const l=c.split("(")[0];return $(d=["brightness","blur","opacity"]).call(d,l)}).map(c=>{const[d,l]=c.split(/\(|\)/);return[d,Number(l.match(/^[0-9\.]+/))]}).forEach(c=>{const[d,l]=c;switch(d){case"brightness":(l<.1||l>3)&&(n=!1);break;case"blur":l>3&&(n=!1);break;case"opacity":l<.1&&(n=!1)}}),n)}),Qt(this,"checkPropertyUpToAllParentNodes",(t,e)=>{let n=!0,r=!0;const i=s=>e(s);let o=t;for(;o&&r;)i(o)||(n=!1,r=!1),o=o.parentElement,o||(r=!1);return n}),Qt(this,"checkActualCssVisibleIncludeInherit",t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty)),Qt(this,"getSizeAboutClient",t=>{const{width:e,height:n,left:r,right:i,top:o,bottom:s}=t.getBoundingClientRect(),a=this.getClientWidth(),c=this.getClientHeight();return{width:e,height:n,left:r,right:i,top:o,bottom:s,clientWidth:a,clientHeight:c,clientMin:Math.min(a,c)}}),Qt(this,"checkActualSize",()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)}),Qt(this,"elementFromPoint",(t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null),Qt(this,"checkCoverForAPoint",(t,e,n)=>{const r=this.elementFromPoint(t,e);return r!==null&&r!==n}),Qt(this,"getPointPositionList",()=>{const{width:t,height:e,left:n,top:r}=this._clientSize,i=t/6,o=e/6,s=[],a=10**6;for(let c=0;c<5;c++)for(let d=0;d<5;d++){const l=(n*a+(c===0?.1:c===4?(i*c*a-1e5)/a:i*c)*a)/a,u=(r*a+(d===0?.1:d===4?(o*d*a-1e5)/a:o*d)*a)/a;s.push({x:l,y:u})}return[...s]}),Qt(this,"checkElementCover",t=>this.getPointPositionList().map(e=>this.checkCoverForAPoint(e.x,e.y,t)).filter(e=>!!e).length>6),Qt(this,"checkSizeIsVisible",(t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10)),Qt(this,"checkSizeOfPartInClient",()=>{const{left:t,right:e,top:n,bottom:r,clientHeight:i,clientWidth:o,clientMin:s}=this._clientSize;let a,c,d,l;if(t<0)a=0;else{if(!(t<o))return!1;a=t}if(e<0)return!1;if(c=e<o?e:o,n<0)d=0;else{if(!(n<i))return!1;d=n}if(r<0)return!1;l=r<i?r:i;const u=c-a,h=l-d;return this.checkSizeIsVisible(u,h,s)}),Qt(this,"returnHiddenResult",t=>(this._clientSize=null,{visible:!1,reason:t})),Qt(this,"checkOneElementVisible",t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Bl.COVERED);{const e=this.checkActualSize(),n=this.checkSizeOfPartInClient();return e&&!n?this.returnHiddenResult(Bl.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Bl.SIZE)}}return this.returnHiddenResult(Bl.STYLE)}return this.returnHiddenResult(Wv.UNMOUNTED)}return this.returnHiddenResult(Wv.INVALID_HTML_ELEMENT)}),Qt(this,"checkElementIsMountedOnDom",t=>this.checkPropertyUpToAllParentNodes(t,e=>e.nodeName.toUpperCase()!=="HTML"?e.parentElement!==null:!!document.documentElement))}};function iC(t){return new TextEncoder().encode(t)}const YO=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},Hv=async t=>function(e,n){let r="";return new Uint8Array(e).forEach(i=>{r+=i.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",iC(t)),16);class oe{constructor(){Qt(this,"_events",{}),Qt(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(n=>n.listener):[]}on(e,n){this._events[e]||(this._events[e]=[]);const r=this._events[e];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!1})}once(e,n){this._events[e]||(this._events[e]=[]);const r=this._events[e];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!0})}off(e,n){if(!this._events[e])return;const r=this._events[e],i=this._indexOfListener(r,n);i!==-1&&r.splice(i,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const n=this._events[e].map(s=>s);for(var r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];for(let s=0;s<n.length;s+=1){const a=n[s];a.once&&this.off(e,a.listener),a.listener.apply(this,i||[])}}safeEmit(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];[...this._events[e]||[]].forEach(o=>{o.once&&this.off(e,o.listener);try{o.listener.apply(this,r)}catch(s){console.error("safeEmit event:".concat(e," error ").concat(s==null?void 0:s.toString()))}})}_indexOfListener(e,n){let r=e.length;for(;r--;)if(e[r].listener===n)return r;return-1}}let Rl=null;function lV(){if(Rl)return Rl;if(window.electron)return Rl=window.electron;if(!window.require)return null;try{return Rl=window.require("electron"),Rl}catch{return null}}let Ne=function(t){return t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.PRELOAD="PRELOAD",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload",t}({}),ae=function(t){return t.TRACER="tracer",t}({});function $O(t){return Vt(t.timeout,"config.timeout",0,1e5),Vt(t.timeoutFactor,"config.timeoutFactor",0,100,!1),Vt(t.maxRetryCount,"config.maxRetryConfig",0,1/0),Vt(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let TX=function(t){return t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",t}({}),kt=function(t){return t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.FALLBACK="FALLBACK",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE",t}({});function F_(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach(e=>{if(!e.urls)throw Error()})}catch{return!1}return!0}function uV(t){return Ke(t.turnServerURL,"turnServerURL"),Ke(t.username,"username"),Ke(t.password,"password"),t.udpport&&Vt(t.udpport,"udpport",1,99999,!0),t.forceturn&&Wo(t.forceturn,"forceturn"),t.security&&Wo(t.security,"security"),t.tcpport&&Vt(t.tcpport,"tcpport",1,99999,!0),!0}function qO(t){return t.level!==void 0&&De(t.level,"level",[1,2,3]),t.delay!==void 0&&Vt(t.delay,"delay",0,3e3,!0),!0}let gt=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",t}({}),sn=function(t){return t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK",t}({}),or=function(t){return t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({}),nd=function(t){return t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE",t}({});function cn(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return t.getListeners(e).length===0?Y.reject(new M(R.UNEXPECTED_ERROR,"can not emit promise")):new Y((o,s)=>{t.emit(e,...r,o,s)})}function Wt(t,e){if(t.getListeners(e).length===0)return Y.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return cn(t,e,...r)}function Kr(t,e){if(t.getListeners(e).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return qu(t,e,...r)}function qu(t,e){let n=null,r=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];if(t.emit(e,...o,a=>{n=a},a=>{r=a}),r!==null)throw r;if(n===null)throw new M(R.UNEXPECTED_ERROR,"handler is not sync");return n}const ve=new class extends oe{set networkState(t){this.emit(nd.NETWORK_STATE_CHANGE,t,this._networkState),t===or.ONLINE?this.emit(nd.ONLINE):t===or.OFFLINE&&(this.onlineWaiter=new Y(e=>{this.once(nd.ONLINE,()=>{this.onlineWaiter=void 0,e(or.ONLINE)})}),this.emit(nd.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===or.ONLINE}constructor(){super(),Qt(this,"_moduleName","network-indicator"),Qt(this,"_networkState",or.ONLINE),Qt(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=or.ONLINE}),window.addEventListener("offline",()=>{this.networkState=or.OFFLINE})}};function Pm(t,e){const n=t.indexOf(e);n!==-1&&t.splice(n,1)}function rd(t){const e=[];return t.forEach(n=>{e.indexOf(n)===-1&&e.push(n)}),e}function j_(t){Y!==void 0?Y.resolve().then(t):setTimeout(t,0)}function Se(t){return JSON.parse(JSON.stringify(t))}function ka(t){try{return Se(t)}catch{return t}}const JO={};function Qs(t,e){JO[e]||(JO[e]=!0,t())}function La(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let r=0;r<e.length;r+=1)n[r]=e.charCodeAt(r);return n}function Hs(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function hV(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,n=new TextEncoder().encode(t);if(n.length>e)n=n.slice(0,e);else if(n.length<e){const r=new Uint8Array(e);r.set(n),n=r}return n}function XO(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=zi(e).call(e,(s,a)=>s+a.length,0),i=new Uint8Array(new ArrayBuffer(r));let o=0;return e.forEach(s=>{i.set(s,o),o+=s.length}),i}function mo(t){return window.TextEncoder?new TextEncoder().encode(t).length:t.length}function pV(t){let e=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&t.realFormData&&(t=t.realFormData),t.forEach(n=>{e+=typeof n=="string"?mo(n):n.size}),e+138}function vX(t){const e=new M(R.TIMEOUT,"timeout");return new Y((n,r)=>{window.setTimeout(()=>r(e),t)})}function Je(t){return new Y(e=>{window.setTimeout(e,t)})}function zt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+zt(t-n.length,"")}function id(){return zt(32,"").toUpperCase()}const B_=()=>{},QO=new class{constructor(){Qt(this,"fnMap",new Map)}throttleByKey(t,e,n,r){for(var i=arguments.length,o=new Array(i>4?i-4:0),s=4;s<i;s++)o[s-4]=arguments[s];if(this.fnMap.has(e)){const a=this.fnMap.get(e);if(a.threshold!==n){a.fn(...a.args),clearTimeout(a.timer);const c=window.setTimeout(()=>{const d=this.fnMap.get(e);d&&d.fn(...d.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:c,args:o,skipFn:r})}else a.skipFn&&a.skipFn(...a.args),this.fnMap.set(e,Z(Z({},a),{},{fn:t,args:o,skipFn:r}))}else{const a=window.setTimeout(()=>{const c=this.fnMap.get(e);c&&c.fn(...c.args),this.fnMap.delete(e)},n);this.fnMap.set(e,{fn:t,threshold:n,timer:a,args:o,skipFn:r})}}},ZO=QO.throttleByKey.bind(QO);function tb(t){return typeof t=="object"&&t!==null&&!(t instanceof RegExp)}function Kv(t,e){if(!tb(t)||!tb(e)||Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let r=0;r<e.length;r++)n[r]=Kv(t[r],e[r]);return n}{const n=Z({},t);for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(Object.prototype.hasOwnProperty.call(t,r)?n[r]=Kv(t[r],e[r]):n[r]=e[r]);return n}}function eb(t,e){let n=[0];if(n=new Array(e).fill(0),t===0)return n;let r=0;for(;t>0&&(n[r]=255&t,t>>=8,r++,r!==e););return n}function jg(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function fV(t){const e="0123456789abcdef";function n(y){let I,O="";for(I=0;I<=3;I++)O+=e.charAt(y>>8*I+4&15)+e.charAt(y>>8*I&15);return O}function r(y,I){const O=(65535&y)+(65535&I);return(y>>16)+(I>>16)+(O>>16)<<16|65535&O}function i(y,I,O,b,N,U){return r(function(V,W){return V<<W|V>>>32-W}(r(r(I,y),r(b,U)),N),O)}function o(y,I,O,b,N,U,V){return i(I&O|~I&b,y,I,N,U,V)}function s(y,I,O,b,N,U,V){return i(I&b|O&~b,y,I,N,U,V)}function a(y,I,O,b,N,U,V){return i(I^O^b,y,I,N,U,V)}function c(y,I,O,b,N,U,V){return i(O^(I|~b),y,I,N,U,V)}const d=function(y){let I;const O=1+(y.length+8>>6),b=new Array(16*O);for(I=0;I<16*O;I++)b[I]=0;for(I=0;I<y.length;I++)b[I>>2]|=y.charCodeAt(I)<<I%4*8;return b[I>>2]|=128<<I%4*8,b[16*O-2]=8*y.length,b}(t);let l,u,h,p,S,f=1732584193,_=-271733879,T=-1732584194,g=271733878;for(l=0;l<d.length;l+=16)u=f,h=_,p=T,S=g,f=o(f,_,T,g,d[l+0],7,-680876936),g=o(g,f,_,T,d[l+1],12,-389564586),T=o(T,g,f,_,d[l+2],17,606105819),_=o(_,T,g,f,d[l+3],22,-1044525330),f=o(f,_,T,g,d[l+4],7,-176418897),g=o(g,f,_,T,d[l+5],12,1200080426),T=o(T,g,f,_,d[l+6],17,-1473231341),_=o(_,T,g,f,d[l+7],22,-45705983),f=o(f,_,T,g,d[l+8],7,1770035416),g=o(g,f,_,T,d[l+9],12,-1958414417),T=o(T,g,f,_,d[l+10],17,-42063),_=o(_,T,g,f,d[l+11],22,-1990404162),f=o(f,_,T,g,d[l+12],7,1804603682),g=o(g,f,_,T,d[l+13],12,-40341101),T=o(T,g,f,_,d[l+14],17,-1502002290),_=o(_,T,g,f,d[l+15],22,1236535329),f=s(f,_,T,g,d[l+1],5,-165796510),g=s(g,f,_,T,d[l+6],9,-1069501632),T=s(T,g,f,_,d[l+11],14,643717713),_=s(_,T,g,f,d[l+0],20,-373897302),f=s(f,_,T,g,d[l+5],5,-701558691),g=s(g,f,_,T,d[l+10],9,38016083),T=s(T,g,f,_,d[l+15],14,-660478335),_=s(_,T,g,f,d[l+4],20,-405537848),f=s(f,_,T,g,d[l+9],5,568446438),g=s(g,f,_,T,d[l+14],9,-1019803690),T=s(T,g,f,_,d[l+3],14,-187363961),_=s(_,T,g,f,d[l+8],20,1163531501),f=s(f,_,T,g,d[l+13],5,-1444681467),g=s(g,f,_,T,d[l+2],9,-51403784),T=s(T,g,f,_,d[l+7],14,1735328473),_=s(_,T,g,f,d[l+12],20,-1926607734),f=a(f,_,T,g,d[l+5],4,-378558),g=a(g,f,_,T,d[l+8],11,-2022574463),T=a(T,g,f,_,d[l+11],16,1839030562),_=a(_,T,g,f,d[l+14],23,-35309556),f=a(f,_,T,g,d[l+1],4,-1530992060),g=a(g,f,_,T,d[l+4],11,1272893353),T=a(T,g,f,_,d[l+7],16,-155497632),_=a(_,T,g,f,d[l+10],23,-1094730640),f=a(f,_,T,g,d[l+13],4,681279174),g=a(g,f,_,T,d[l+0],11,-358537222),T=a(T,g,f,_,d[l+3],16,-722521979),_=a(_,T,g,f,d[l+6],23,76029189),f=a(f,_,T,g,d[l+9],4,-640364487),g=a(g,f,_,T,d[l+12],11,-421815835),T=a(T,g,f,_,d[l+15],16,530742520),_=a(_,T,g,f,d[l+2],23,-995338651),f=c(f,_,T,g,d[l+0],6,-198630844),g=c(g,f,_,T,d[l+7],10,1126891415),T=c(T,g,f,_,d[l+14],15,-1416354905),_=c(_,T,g,f,d[l+5],21,-57434055),f=c(f,_,T,g,d[l+12],6,1700485571),g=c(g,f,_,T,d[l+3],10,-1894986606),T=c(T,g,f,_,d[l+10],15,-1051523),_=c(_,T,g,f,d[l+1],21,-2054922799),f=c(f,_,T,g,d[l+8],6,1873313359),g=c(g,f,_,T,d[l+15],10,-30611744),T=c(T,g,f,_,d[l+6],15,-1560198380),_=c(_,T,g,f,d[l+13],21,1309151649),f=c(f,_,T,g,d[l+4],6,-145523070),g=c(g,f,_,T,d[l+11],10,-1120210379),T=c(T,g,f,_,d[l+2],15,718787259),_=c(_,T,g,f,d[l+9],21,-343485551),f=r(f,u),_=r(_,h),T=r(T,p),g=r(g,S);return n(f)+n(_)+n(T)+n(g)}let yX=1,vp=console,pn=class{static setLogger(t){vp=t}constructor(t){Qt(this,"lockingPromise",Y.resolve()),Qt(this,"locks",0),Qt(this,"name",""),Qt(this,"lockId",void 0),this.lockId=yX++,t&&(this.name=t),vp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,vp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const n=new Y(i=>{e=()=>{this.locks-=1,vp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),i()}}),r=this.lockingPromise.then(()=>e);return this.lockingPromise=this.lockingPromise.then(()=>n),r}};function Ld(t,e){return function(n,r,i){const o=i.value;if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const s=this[e];if(!s)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const a=await s.lock("From ".concat(t,".").concat(r));try{for(var c=arguments.length,d=new Array(c),l=0;l<c;l++)d[l]=arguments[l];return await o.apply(this,d)}finally{a()}},i}}const we={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function oC(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function qi(t,e,n,r){const i=Object.assign({},we,r);let o=i.timeout;const s=async()=>{await function(d){return new Y(l=>{window.setTimeout(l,d)})}(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)};let a=!1;const c=new Y(async(d,l)=>{e=e||(()=>!1),n=n||(()=>!0);for(let u=0;u<i.maxRetryCount;u+=1){if(a)return l(new M(R.OPERATION_ABORTED));try{const h=await t();if(!e(h,u)||u+1===i.maxRetryCount)return d(h);await s()}catch(h){if(!n(h,u)||u+1===i.maxRetryCount)return l(h);await s()}}});return c.cancel=()=>a=!0,c}class mV{constructor(e){Qt(this,"input",[]),Qt(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:zi(e=this.input).call(e,(n,r)=>n+r)/this.input.length}}let yp,Rp=0,Bg=0;function zv(t,e,n,r){return new Y((i,o)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),Rp+=mo(e.data)):n&&(e.data.size?Rp+=e.data.size:e.data instanceof FormData?Rp+=pV(e.data):Rp+=mo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Gn.request(e).then(s=>{typeof s.data=="string"?Bg+=mo(s.data):s.data instanceof ArrayBuffer||s.data instanceof Uint8Array?Bg+=s.data.byteLength:Bg+=mo(JSON.stringify(s.data)),i(s.data)}).catch(s=>{Gn.isCancel(s)?o(new M(R.OPERATION_ABORTED,"cancel token canceled")):s.code==="ECONNABORTED"?o(new M(R.NETWORK_TIMEOUT,s.message)):s.response?o(new M(R.NETWORK_RESPONSE_ERROR,s.response.status)):o(new M(R.NETWORK_ERROR,s.message))})})}async function RX(t,e){const n=new Blob([e.data],{type:"buffer"});return await zv(t,Z(Z({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const nb=()=>window.isSecureContext!==void 0,zr=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(e&&e[1]&&e[2]){const n=e[1],r=e[2];return"".concat(n,".").concat(r)}return"4.0.0.999"}("4.22.1"),sC=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let ga=function(t){return t.Default="default",t.Auto="auto",t.Relay="relay",t.SdRtn="sd-rtn",t}({});const nn=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let a=0;a<6;a++)i.push("1");const o=i.join(""),s={};return s[t]=r,s[e]=o,Object.assign(s,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=nn;const aC={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},cC="v4.22.1-0-g1c8e27e9(9/19/2024, 2:23:30 PM)",_e=Z(Z({PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:aC,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,CUSTOM_ADAPTATION_DEFAULT_MODE:"",ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,ENABLE_PRELOAD:!0,DISABLE_SCREEN_SHARE_REMB:!1},{ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,USE_PUB_RTX:!0,USE_SUB_RTX:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_DATASTREAM_2:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,USE_XR:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,ENABLE_PREALLOC_PC:!1,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_PRE_SUB:!1,ENABLE_AUT_FEEDBACK:!1}),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0});function xt(t,e,n){var r,i,o;$(r=Object.keys(_e)).call(r,t)&&(!n&&$(i=Object.keys(bs)).call(i,t)||(_e[t]=e,t==="ENABLE_VIDEO_SEI"&&e===!0&&(_e.ENABLE_ENCODED_TRANSFORM=!0),t==="USE_NEW_NETWORK_CONFIG"&&e&&(o=!!e,_e.USE_NEW_NETWORK_CONFIG=o,o&&(_e.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],_e.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],_e.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],_e.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],_e.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",_e.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",_e.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),t==="ENABLE_PRE_SUB"&&e&&(_e.ENABLE_INSTANT_VIDEO=!0,_e.ENABLE_PREALLOC_PC=!0),t==="ENABLE_SVC"&&e&&(_e.ENABLE_AUT_CC=!0)))}function A(t){return _e[t]}sC||(_e.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],_e.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],_e.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],_e.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],_e.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],_e.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],_e.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",_e.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",_e.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",_e.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",_e.AREAS=["NORTH_AMERICA","OVERSEA"]);const bs={};var _t=function(t){return t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_INT_UID="SET_INT_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_P2P="SET_USE_P2P",t.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",t}(_t||{});class CX{constructor(e,n,r,i){Qt(this,"state",void 0),this.state={codec:e,audioCodec:n,mode:r,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:ga.Default}}dispatch(e){this.state=function(n,r){switch(r.type){case _t.SET_SESSION_ID:return Z(Z({},n),{},{sessionId:r.sessionId});case _t.SET_P2P_ID:return Z(Z({},n),{},{p2pId:r.p2pId});case _t.SET_UID:return Z(Z({},n),{},{uid:r.uid});case _t.SET_INT_UID:return Z(Z({},n),{},{intUid:r.intUid});case _t.SET_PUB_ID:return Z(Z({},n),{},{pubId:r.pubId});case _t.KEY_METRIC_CLIENT_CREATED:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{clientCreated:r.metric})});case _t.KEY_METRIC_JOIN_START:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{joinStart:r.metric})});case _t.AVOID_JOIN_START:return Z(Z({},n),{},{avoidJoinStart:r.avoidJoinStart});case _t.KEY_METRIC_JOIN_END:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{joinEnd:r.metric})});case _t.KEY_METRIC_REQUEST_AP_START:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{requestAPStart:r.metric})});case _t.KEY_METRIC_REQUEST_AP_END:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{requestAPEnd:r.metric})});case _t.KEY_METRIC_JOIN_GATEWAY_START:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{joinGatewayStart:r.metric})});case _t.KEY_METRIC_JOIN_GATEWAY_END:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{joinGatewayEnd:r.metric})});case _t.KEY_METRIC_PEER_CONNECTION_START:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{peerConnectionStart:r.metric})});case _t.KEY_METRIC_PEER_CONNECTION_END:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{peerConnectionEnd:r.metric})});case _t.KEY_METRIC_DESCRIPTION_START:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{descriptionStart:r.metric})});case _t.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{signalChannelOpen:r.metric})});case _t.KEY_METRIC_ICE_CONNECTION_END:return Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{iceConnectionEnd:r.metric})});case _t.KEY_METRIC_PUBLISH:{const i=n.keyMetrics.publish,o=i.findIndex(s=>s.trackId===r.metric.trackId);return o!==-1?(i[o]=Z(Z({},i[o]),r.metric),Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{publish:[...i]})})):Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,r.metric]})})}case _t.KEY_METRIC_SUBSCRIBE:{const i=n.keyMetrics.subscribe,o=i.findIndex(s=>s.userId===r.metric.userId&&s.type===r.metric.type);return o!==-1?(i[o]=Z(Z({},i[o]),r.metric),Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{subscribe:[...i]})})):Z(Z({},n),{},{keyMetrics:Z(Z({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,r.metric]})})}case _t.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=r.mode,n;case _t.RECORD_JOIN_CHANNEL_SERVICE:return typeof r.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,r.record]:(n.joinChannelServiceRecords[r.index]=Z(Z({},n.joinChannelServiceRecords[r.index]),r.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case _t.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case _t.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case _t.SET_USE_P2P:return Z(Z({},n),{},{useP2P:r.val});case _t.SET_TRANSPORT_TYPE:return Z(Z({},n),{},{p2pTransport:r.val});default:return n}}(this.state,e)}set sessionId(e){this.dispatch({type:_t.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}set codec(e){this.state.codec=e}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:_t.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:_t.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:_t.SET_UID,uid:e})}get uid(){return this.state.uid}set intUid(e){this.dispatch({type:_t.SET_INT_UID,intUid:e})}get intUid(){return this.state.intUid}set pubId(e){this.dispatch({type:_t.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:_t.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(e){this.dispatch({type:_t.SET_USE_P2P,val:e})}get useP2P(){return this.state.useP2P}set p2pTransport(e){this.dispatch({type:_t.SET_TRANSPORT_TYPE,val:e})}get p2pTransport(){return this.state.p2pTransport}clientCreated(){this.dispatch({type:_t.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:_t.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:_t.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:_t.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:_t.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:_t.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:_t.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:_t.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:_t.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:_t.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:_t.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:_t.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,n,r,i){this.dispatch({type:_t.KEY_METRIC_PUBLISH,metric:Z(Z({trackId:e,type:n},r&&{publishStart:r}),i&&{publishEnd:i})})}subscribe(e,n,r,i,o,s,a){this.dispatch({type:_t.KEY_METRIC_SUBSCRIBE,metric:Z(Z(Z(Z(Z({userId:e,type:n},r&&{subscribeStart:r}),i&&{subscribeEnd:i}),o&&{firstFrame:o}),s&&{streamAdded:s}),a&&{firstDecoded:a})})}massSubscribe(e,n,r,i){e.forEach(o=>{this.dispatch({type:_t.KEY_METRIC_SUBSCRIBE,metric:Z(Z(Z({userId:o.userId,type:o.type},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,n){e.service==="gateway"&&Array.isArray(e.urls)&&(e.urls=e.urls.map(r=>r.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:_t.RECORD_JOIN_CHANNEL_SERVICE,record:Z(Z({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:_t.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:_t.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:_t.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:_t.AVOID_JOIN_START,avoidJoinStart:e})}}let G_=function(t){return t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1",t}({});(function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"})({});const rb=128,IX=96,ib=1e3,yc=10;let wX=0;function ue(t,e,n){return(e=function(r){var i=function(o,s){if(typeof o!="object"||!o)return o;var a=o[Symbol.toPrimitive];if(a!==void 0){var c=a.call(o,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(r);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ob(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ht(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ob(Object(n),!0).forEach(function(r){ue(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ob(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const _V=new class extends oe{constructor(){super(...arguments),ue(this,"currentUploadLogID",0)}reportLogUploadError(t){const{errorRange:e}=t;e[e.length-1]&&e[e.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=e[e.length-1],this.emit("REPORT_LOG_UPLOAD",t))}};class AX{constructor(e){ue(this,"logger",void 0),ue(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}function Gg(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function sb(){const t=new Date,e=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return e?(e==null?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const xr={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Cp=Date.now(),Cl=t=>{for(const e in xr)if(Object.prototype.hasOwnProperty.call(xr,e)&&xr[e]===t)return e;return"DEFAULT"},m=new class{constructor(){ue(this,"proxyServerURL",void 0),ue(this,"logLevel",xr.DEBUG),ue(this,"uploadState","collecting"),ue(this,"uploadLogWaitingList",[]),ue(this,"uploadLogUploadingList",[]),ue(this,"uploadErrorCount",0),ue(this,"currentLogID",0),ue(this,"url",void 0),ue(this,"extLog",(t,e)=>{this.appendLogToWaitingList(t,...e)})}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[xr.DEBUG].concat(e);this.log.apply(this,r)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[xr.INFO].concat(e);this.log.apply(this,r)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[xr.WARNING].concat(e);this.log.apply(this,r)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[xr.ERROR].concat(e);this.log.apply(this,r)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=[xr.DEBUG].concat(e);this.uploadLog.apply(this,r)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){xt("UPLOAD_LOG",!0)}disableLogUpload(){xt("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new AX(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-Cp<100)return void setTimeout(()=>{this.log(...e)},Date.now()-Cp);const r=Math.max(0,Math.min(4,e[0]));if(e[0]=Gg()+" Agora-SDK [".concat(Cl(r),"]:"),this.appendLogToWaitingList(r,...e),r<this.logLevel)return;const i=Gg()+" %cAgora-SDK [".concat(Cl(r),"]:");let o=[];if(!A("USE_NEW_LOG"))switch(r){case xr.DEBUG:o=[i,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,o);break;case xr.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,o);break;case xr.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,o);break;case xr.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-Cp<100)return void setTimeout(()=>{this.uploadLog(...e)},Date.now()-Cp);const r=Math.max(0,Math.min(4,e[0]));e[0]=Gg()+" Agora-SDK [".concat(Cl(r),"]:"),this.appendLogToWaitingList(r,...e)}appendLogToWaitingList(t){if(!A("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=sb()+" Agora-SDK [".concat(Cl(t),"]:"):n[0]=sb()+" Agora-SDK [".concat(Cl(t),"]:");let i="";n.forEach(o=>{typeof o=="object"&&(o=JSON.stringify(o)),i+="".concat(o," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:t,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:zr,process_id:A("PROCESS_ID"),payload:JSON.stringify(t)};return qi(async()=>{const n=await Gn.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(A("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(A("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>{const r={status:-1,message:n.message,errorRange:t.map(i=>i.log_item_id)};return n.response?(r.status=n.response.status,r.data=n.response.data,r.headers=n.response.headers):n.request&&(r.status=n.request.status),_V.reportLogUploadError(r),!0},{timeout:A("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:A("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,A("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),A("UPLOAD_LOG_INTERVAL"))}).catch(t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),A("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),A("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var ab;function OX(t){return Ke(t.reportId,"params.reportId",0,100,!1),Ke(t.category,"params.category",0,100,!1),Ke(t.event,"params.event",0,100,!1),Ke(t.label,"params.label",0,100,!1),Vt(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(ab={}).FREE="free",ab.UPLOADING="uploading",function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}({});const bX={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let He=function(t){return t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats",t.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",t}({}),re=function(t){return t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats",t.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",t}({});(function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let NX=function(t){return t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",t}({});function it(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(e,n,r){const i=r.value;if(typeof i=="function"){const o=t.className||e.__className__||(e.constructor.name==="AgoraRTCClient"?"Client":e.constructor.name);r.value=function(){for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];let d=a;if(t.argsMap)try{d=t.argsMap(this,...a)}catch(u){m.warning(u),d=[]}try{JSON.stringify(d)}catch{m.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),d=[]}const l=(t.report||tt).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(String(n)),options:d,tag:ae.TRACER,reportResult:t.reportResult},t.throttleTime);try{const u=i.apply(this,a);return u instanceof Y?u.then(h=>(l.onSuccess(t.reportResult&&h),h)).catch(h=>{throw l.onError(h),h}):(l.onSuccess(t.reportResult&&u),u)}catch(u){throw l.onError(u),u}}}return r}}const tt=new class{constructor(){ue(this,"baseInfoMap",new Map),ue(this,"proxyServer",void 0),ue(this,"eventUploadTimer",void 0),ue(this,"setSessionIdTimer",void 0),ue(this,"url",void 0),ue(this,"sids",new Set),ue(this,"backupUrl",void 0),ue(this,"_appId",void 0),ue(this,"keyEventUploadPendingItems",[]),ue(this,"normalEventUploadPendingItems",[]),ue(this,"apiInvokeUploadPendingItems",[]),ue(this,"apiInvokeCount",0),ue(this,"ltsList",[]),ue(this,"lastSendNormalEventTime",Date.now()),ue(this,"customReportCounterTimer",void 0),ue(this,"customReportCount",0),ue(this,"extApiInvoke",async t=>{for(const e of t){const n=ht(ht({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:ae.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),A("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),A("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void m.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));const e=this.baseInfoMap.get(t),n=Date.now(),r=e.startTime;e.startTime=n,m.debug("rewrite session ".concat(t," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(t,e)}setAppId(t){this._appId=t}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=e.reportResult===void 0||e.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,o=()=>({tag:e.tag,invokeId:i,sid:t,name:e.name,apiInvokeTime:r,options:e.options,states:e.states||null}),s=!!A("SHOW_REPORT_INVOKER_LOG");s&&m.info("".concat(e.name," start"),e.options);let a=!1;Je(e.timeout).then(()=>{a||(this.sendApiInvoke(ht(ht({},o()),{},{error:R.API_INVOKE_TIMEOUT,success:!1})),m.debug("".concat(e.name," timeout")))});const c=new M(R.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:d=>{const l=()=>{if(a)throw c;return a=!0,this.sendApiInvoke(ht(ht({},o()),{},{success:!0},e.reportResult&&{result:d})),s&&m.info("".concat(e.name," onSuccess")),d};return n?ZO(l,e.name+"Success",n,()=>a=!0):l()},onError:d=>{const l=()=>{if(a)throw d;a=!0,this.sendApiInvoke(ht(ht({},o()),{},{success:!1,error:d})),s&&m.info("".concat(e.name," onFailure"),d.toString())};return n?ZO(l,e.name+"Error",n,()=>a=!0):l()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),r=this.createBaseInfo(t,n);r.cname=e.cname;const i=Object.assign({},{willUploadConsoleLog:A("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:sC?"global":"oversea",areas:A("AREAS")&&A("AREAS").join(",")},e.extend),{stringUid:o,channelProfile:s,channelMode:a,isABTestSuccess:c,lsid:d,clientRole:l}=e,u=Date.now(),h=ht(ht({},r),{},{eventType:He.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,buildFormat:e.buildFormat,build:cC,lts:u,elapse:u-n,extend:JSON.stringify(i),mode:e.mode,process:A("PROCESS_ID"),appType:A("APP_TYPE"),success:!0,version:zr,stringUid:o,channelProfile:s,channelMode:a,isABTestSuccess:c,lsid:d,clientType:$(p=window.navigator.userAgent).call(p,"AgoraWebView")?42:20,clientRole:l,serviceId:A("PROCESS_ID"),extensionID:A("PLUGIN_INFO").join(",")||""});var p;this.send({type:re.SESSION,data:h},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht({},r),{},{eventType:He.JOIN_CHOOSE_SERVER,lts:i,eventElapse:e.elapse||i-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:i-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3,corssRegionTagReq:e.corssRegionTagReq||void 0,corssRegionTagRes:e.corssRegionTagRes||void 0});this.send({type:re.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht({},r),{},{eventType:He.REQ_USER_ACCOUNT,lts:i,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:e.elapse||i-n.startTime,eventElapse:i-e.lts,extend:JSON.stringify(e.extend)});this.send({type:re.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info;e.vid&&(r.vid=e.vid),r.uid=e.uid,r.cid=e.cid;const i=Date.now(),{firstSuccess:o,avoidJoinStartTime:s}=e,a=i-(o&&s?s:n.startTime),c=ht(ht({},r),{},{eventType:He.JOIN_GATEWAY,lts:i,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,errorMsg:e.errorMsg||"",elapse:a,eventElapse:i-e.lts,firstSuccess:o,signalChannel:e.signalChannel,preload:e.preload?1:0});e.succ&&(n.lastJoinSuccessTime=i),this.send({type:re.JOIN_GATEWAY,data:c},!0)}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=Date.now(),i=ht(ht({},n.info),{},{lts:r,timeout:e,elapse:r-n.startTime});this.send({type:re.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht({},r),{},{eventType:He.PUBLISH,lts:i,eventElapse:e.eventElapse,elapse:i-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:re.PUBLISH,data:o},!0)}subscribe(t,e,n){const r=this.baseInfoMap.get(t);if(!r)return;const i=r.info,o=Date.now(),s=ht(ht({},i),{},{eventType:He.SUBSCRIBE,lts:o,eventElapse:e.eventElapse,elapse:o-r.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid,preSsrc:e.preSsrc?1:0},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof e.peerid=="string"?s.peerSuid=e.peerid:s.peer=e.peerid,this.send({type:re.SUBSCRIBE,data:s},!0)}wsCompressorInit(t){var e;const n=[..._r(e=this.baseInfoMap).call(e)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const o=i.info,s=Date.now(),a=ht(ht({},o),{},{eventType:He.WS_COMPRESSOR_INIT,lts:s,eventElapse:t.eventElapse,elapse:s-i.startTime,status:t.status?1:2});this.send({type:re.WS_COMPRESSOR_INIT,data:a},!0)}firstRemoteVideoDecode(t,e,n,r){const i=this.baseInfoMap.get(t);if(!i)return;const o=i.info,s=Date.now(),a=ht(ht(ht({},o),r),{},{elapse:s-i.startTime,eventType:e,lts:s,firstDecodeFrame:Math.max((r.firstFrame||s)-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:a},!0)}firstRemoteFrame(t,e,n,r){const i=this.baseInfoMap.get(t);if(!i)return;const o=i.info,s=Date.now(),a=ht(ht(ht({},o),r),{},{elapse:s-i.startTime,eventType:e,lts:s});this.send({type:n,data:a},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht(ht({},r),e),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:i-n.startTime,eventType:He.PC_STATS,lts:i,preallocation:e.preallocation?1:0});this.send({type:re.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(t,e){if(t){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht(ht({},r),e),{},{vid:r.vid===void 0?0:Number(r.vid),eventType:He.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:re.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(t,e,n,r){const i=this.baseInfoMap.get(t);if(!i)return;const o=i.info,s=Date.now(),a=ht(ht(ht({},o),r),{},{eventType:e,lts:s});this.send({type:n,data:a},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht({},r),{},{eventType:He.STREAM_SWITCH,lts:i,isDual:e.isdual,elapse:i-n.startTime,success:e.succ});this.send({type:re.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht({},r),{},{eventType:He.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-e.lts,elapse:i-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:re.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht({},r),{},{eventType:He.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-e.lts,elapse:i-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:re.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(t){this.proxyServer=t,t?m.debug("reportProxyServerurl: ".concat(t)):m.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht({},r),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:re.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now();(function(o,s,a){const c=o[s];if(!c||typeof c!="string")return[o];o[s]="";const d=mo(JSON.stringify(o));let l=0;const u=[];let h=0;for(let p=0;p<c.length;p++)h+=c.charCodeAt(p)<=127?1:3,h<=a-d||(u[u.length]=Z(Z({},o),{},{[s]:c.substring(l,p)}),l=p,h=c.charCodeAt(p)<=127?1:3);return l!==c.length-1&&(u[u.length]=Z(Z({},o),{},{[s]:c.substring(l)})),u})(ht(ht(ht({},r),e),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(o=>this.send({type:re.WORKER_EVENT,data:o},!0))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht(ht({},r),e),{},{elapse:i-n.startTime,lts:i});this.send({type:re.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht(ht({},r),e),{},{elapse:i-n.startTime,lts:i,extend:e.extend||void 0});this.send({type:re.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const r=n.info,i=Date.now(),o=ht(ht(ht({},r),e),{},{elapse:i-n.startTime,lts:i});this.send({type:re.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>A("CUSTOM_REPORT_LIMIT"))throw new M(R.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=e.map(i=>({type:re.USER_ANALYTICS,data:ht(ht({sid:t},i),{},{lts:n})}));try{A("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(i){throw m.error("send custom report message failed",i.toString()),new M(R.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(t){const e=A("NOT_REPORT_EVENT");if(t.tag&&$(e)&&$(e).call(e,t.tag))return!1;if(t.sid===null)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:r,uid:i,cid:o}=n.info;let s;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof M){const{code:c,message:d}=t.error;s=c||d||t.error.toString()}else s=t.error.toString();const a={invokeId:t.invokeId,sid:t.sid,cname:r,cid:o,uid:i,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?s:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:re.API_INVOKE,data:a},!1),!0}addSid(t){this.sids.add(t)}removeSid(t){this.sids.delete(t)}appendSessionId(){const t=this.apiInvokeUploadPendingItems;if(t.length===0)return;const e=Array.from(this.sids).find(n=>n!==null);e&&t.forEach(n=>{n&&(n.sid=e,this.sendApiInvoke(Object.assign({},n)))}),t.length=0}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>A("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],r=[];for(;t.length;){const o=t.shift();n.length<20?n.push(o):r.push(o)}t.push(...r);for(const o of[...n]){var i;this.ltsList.indexOf(o.data.lts)!==-1?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),Ph(i=this.ltsList).call(i,(s,a)=>s-a))}return e||(this.lastSendNormalEventTime=Date.now()),A("ENABLE_EVENT_REPORT")&&n.length&&(A("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((o=>s=>{A("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o),this.normalEventUploadPendingItems.length>A("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-A("NORMAL_EVENT_QUEUE_CAPACITY")),m.warning("report: drop normal events"))))})(n)),t}async postDataToStatsCollector2(t){ve.networkState===or.OFFLINE&&await Y.race([ve.onlineWaiter,Je(2*we.maxRetryTimeout)]);const e=i=>{let o=new Uint8Array;return i.forEach(s=>{const a=iC(JSON.stringify(s.data)),c=new ArrayBuffer(5),d=(u=>{let h=0;return Object.entries(re).forEach(p=>{let[S,f]=p;f===u.type&&(h=NX[S])}),h})(s),l=new DataView(c);l.setUint16(0,a.byteLength,!0),l.setUint8(2,255&d),l.setUint8(3,d>>>8&255),l.setUint8(4,d>>>16&255),o=YO(o,new Uint8Array(c)),o=YO(o,a)}),o},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(A("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(A("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){i===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(A("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(A("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await zv(r,{timeout:1e4,data:e(t),headers:ht(ht({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(o){if(i===1)throw o;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map(o=>JSON.stringify(o)),vid:(o=>{const s=o&&o.data.sid&&this.baseInfoMap.get(o.data.sid);return s&&s.info.vid&&+s.info.vid||0})(t[0])};ve.networkState===or.OFFLINE&&await Y.race([ve.onlineWaiter,Je(2*we.maxRetryTimeout)]);const r=e?"/events/proto-raws":"/events/messages";let i=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(A("EVENT_REPORT_DOMAIN"),"&p=").concat(A("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(A("EVENT_REPORT_DOMAIN"),":").concat(A("STATS_COLLECTOR_PORT")).concat(r));for(let o=0;o<2;o+=1){o===1&&(i=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(A("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(A("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(A("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(A("STATS_COLLECTOR_PORT")).concat(r)));try{e?await RX(i,{timeout:1e4,data:n}):await zv(i,{timeout:1e4,data:n})}catch(s){if(o===1)throw s;continue}return}}createBaseInfo(t,e){const n=Object.assign({},bX);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),r=n[n.length-1];r&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:r,tag:ae.TRACER}).onSuccess()}};_V.on("REPORT_LOG_UPLOAD",t=>{t.networkState=ve.networkState,tt.reportApiInvoke(null,{name:"logUploadError",options:t,tag:ae.TRACER}).onSuccess("logUploadError")});class P extends M{constructor(e){super(e,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),ue(this,"name","AgoraRTCException")}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(e,m)}throw(){super.throw(m)}}const PX=["CHINA","GLOBAL"],EV=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ra=[];function la(t,e){return!!e&&Ra.some(n=>n.uid===t&&n.channelName===e)}var DX=dx.forEach,cb=v_("forEach")?[].forEach:function(t){return DX(this,t,arguments.length>1?arguments[1]:void 0)};Bt({target:"Array",proto:!0,forced:[].forEach!=cb},{forEach:cb});var kX=Ai("Array").forEach,LX=wo,MX=fn,UX=Mn,xX=kX,Wg=Array.prototype,VX={DOMTokenList:!0,NodeList:!0},FX=function(t){var e=t.forEach;return t===Wg||UX(Wg,t)&&e===Wg.forEach||MX(VX,LX(t))?xX:e},jX=de(FX),BX=Io,db=I_;Bt({target:"Object",stat:!0,forced:Pe(function(){db(1)})},{keys:function(t){return db(BX(t))}});var gV=de(Zr.Object.keys),GX=de(gU),WX=Bt,HX=Dh,KX=Ae([].reverse),lb=[1,2];WX({target:"Array",proto:!0,forced:String(lb)===String(lb.reverse())},{reverse:function(){return HX(this)&&(this.length=this.length),KX(this)}});var zX=Ai("Array").reverse,YX=Mn,$X=zX,Hg=Array.prototype,qX=function(t){var e=t.reverse;return t===Hg||YX(Hg,t)&&e===Hg.reverse?$X:e},SV=qX,JX=de(SV),XX=Bt,ub=Dh,QX=O_,ZX=Pr,hb=TR,tQ=ns,eQ=ia,nQ=D_,rQ=Ce,iQ=b_,oQ=ox("slice"),sQ=rQ("species"),Kg=Array,aQ=Math.max;XX({target:"Array",proto:!0,forced:!oQ},{slice:function(t,e){var n,r,i,o=eQ(this),s=tQ(o),a=hb(t,s),c=hb(e===void 0?s:e,s);if(ub(o)&&(n=o.constructor,(QX(n)&&(n===Kg||ub(n.prototype))||ZX(n)&&(n=n[sQ])===null)&&(n=void 0),n===Kg||n===void 0))return iQ(o,a,c);for(r=new(n===void 0?Kg:n)(aQ(c-a,0)),i=0;a<c;a++,i++)a in o&&nQ(r,i,o[a]);return r.length=i,r}});var cQ=Ai("Array").slice,dQ=Mn,lQ=cQ,zg=Array.prototype,uQ=function(t){var e=t.slice;return t===zg||dQ(zg,t)&&e===zg.slice?lQ:e},hQ=de(uQ);function X(t,e,n,r,i){var o,s,a,c={};return jX(o=gV(r)).call(o,function(d){c[d]=r[d]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=GX(s=JX(a=hQ(n).call(n)).call(a)).call(s,function(d,l){return l(t,e,d)||d},c),i&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),c.initializer===void 0&&(rx(t,e,c),c=null),c}let Yv=function(t){return t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L1T3_KEY="L1T3_KEY",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY",t}({}),hr=function(t){return t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver",t}({}),Af=function(t){return t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",t}({}),Yg=function(t){return t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR",t}({}),ni=function(t){return t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",t}({}),wn=function(t){return t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",t}({}),rt=function(t){return t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",t}({}),Kt=function(t){return t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed",t}({}),at=function(t){return t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.PRE_CONNECT_PC="pre_connect_pc",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",t.RECOVER_NOTIFICATION="recover_notification",t}({}),st=function(t){return t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.PRE_SUBSCRIBE="pre_subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag",t}({}),Ju=function(t){return t.WRTC_STATS="wrtc_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats",t}({}),Et=function(t){return t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list",t}({}),Nn=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({}),dt=function(t){return t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",t}({});function W_(t){if(typeof t!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw m.error("Invalid Channel Name ".concat(t)),new P(R.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function H_(t){if(!function(e){return typeof e=="number"&&Math.floor(e)===e&&0<=e&&e<=4294967295}(t)&&!cV(t,1,255))throw new P(R.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");typeof t=="string"&&m.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let zo=function(t){return t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t}({});const pQ={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},$g={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function qg(t,e){Ke(t.url,"".concat(e,".url"),1,1e3,!1),ne(t.x)||Vt(t.x,"".concat(e,".x"),0,1e4),ne(t.y)||Vt(t.y,"".concat(e,".y"),0,1e4),ne(t.width)||Vt(t.width,"".concat(e,".width"),0,1e4),ne(t.height)||Vt(t.height,"".concat(e,".height"),0,1e4),ne(t.zOrder)||Vt(t.zOrder,"".concat(e,".zOrder"),0,255),ne(t.alpha)||Vt(t.alpha,"".concat(e,".alpha"),0,1,!1)}const fQ={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let ys=function(t){return t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address",t}({}),$v=function(t){return t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",t}({}),Oe=function(t){return t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",t}({});function pb(t){if(!t.channelName)throw new P(R.INVALID_PARAMS,"invalid channelName in info");if(typeof t.uid!="number")throw new P(R.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Ke(t.token,"info.token",1,2047),H_(t.uid),W_(t.channelName),!0}let An=function(t){return t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile",t}({}),ko=function(t){return t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",t}({}),$n=function(t){return t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",t}({}),Uc=function(t){return t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",t}({}),Nt=function(t){return t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low",t}({}),en=function(t){return t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.PRE_CONNECT_PC="pre-connect_pc",t}({}),Of=function(t){return t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON",t}({}),xe=function(t){return t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7",t}({}),Ot=function(t){return t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS",t}({});const fb=[Ot.AFRICA,Ot.ASIA,Ot.CHINA,Ot.EUROPE,Ot.GLOBAL,Ot.INDIA,Ot.JAPAN,Ot.NORTH_AMERICA,Ot.OCEANIA,Ot.OVERSEA,Ot.SOUTH_AMERICA];let ln=function(t){return t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL",t}({});const K_={CHINA:{},ASIA:{CODE:ln.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ln.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ln.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ln.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ln.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ln.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ln.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ln.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ln.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ln.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ln.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ln.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ln.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};sC&&(K_.CHINA={CODE:ln.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let qv=function(t){return t.UPDATE_BITRATE_LIMIT="update_bitrate_limit",t}({});class TV extends oe{constructor(e,n){super(),v(this,"onICEConnectionStateChange",void 0),v(this,"onConnectionStateChange",void 0),v(this,"onDTLSTransportStateChange",void 0),v(this,"onDTLSTransportError",void 0),v(this,"onICETransportStateChange",void 0),v(this,"onFirstAudioReceived",void 0),v(this,"onFirstVideoReceived",void 0),v(this,"onFirstAudioDecoded",void 0),v(this,"onFirstVideoDecoded",void 0),v(this,"onFirstVideoDecodedTimeout",void 0),v(this,"onSelectedLocalCandidateChanged",void 0),v(this,"onSelectedRemoteCandidateChanged",void 0),v(this,"getLocalVideoStats",void 0)}}class vV extends TV{constructor(e,n){super(e,n),v(this,"establishPromise",void 0)}}let et=function(t){return t.VIDEO="video",t.AUDIO="audio",t}({}),sr=function(t){return t[t.UDP=0]="UDP",t[t.TCP=1]="TCP",t[t.RELAY=2]="RELAY",t}({}),bo=function(t){return t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.TCP_RESTART=1]="TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",t}({}),B=function(t){return t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack",t}({}),bt=function(t){return t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected",t}({}),ot=function(t){return t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.RequestUpload="requestUpload",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE",t}({}),di=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),ri=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),Be=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),yV=function(t){return t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback",t.PRE_CONNECT_PC="transmitter:pre_connect_pc",t}({}),ho=function(t){return t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",t.SECURITY_POLICY_VIOLATION="security-policy-violation",t}({}),Ur=function(t){return t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED",t}({}),Mi=function(t){return t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url",t}({}),Rc=function(t){return t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED",t}({}),me=function(t){return t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.RESPONSE="response",t.JOIN="join",t.CHECK="check",t}({}),Cc=function(t){return t.ABORT="abort",t}({}),Ns=function(t){return t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t}({}),mQ=function(t){return t.P2P_TOKEN_TIMEOUT="p2p_token_timeout",t.P2P_TOKEN_CHANGED="p2p_token_changed",t}({});const _Q={[Af.ACCESS_POINT]:{[wn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[wn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[wn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[wn.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[wn.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[wn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[wn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Af.UNILBS]:{[ni.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[ni.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[ni.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[ni.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[ni.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[ni.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[ni.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[ni.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[ni.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[ni.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[ni.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[ni.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Af.STRING_UID_ALLOCATOR]:{[Yg.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Yg.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Yg.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Md(t){const e=_Q[Math.floor(t/1e4)];if(!e)return{desc:"unknown error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===Af.ACCESS_POINT){const r=t%1e4;if(r.toString()[0]==="1")return{desc:t.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:t.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return n}const EQ={[rt.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[rt.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[rt.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[rt.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[rt.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[rt.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[rt.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[rt.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[rt.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[rt.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[rt.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[rt.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[rt.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[rt.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[rt.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[rt.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[rt.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[rt.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[rt.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[rt.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[rt.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[rt.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[rt.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[rt.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[rt.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[rt.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[rt.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[rt.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[rt.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[rt.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[rt.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[rt.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[rt.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[rt.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[rt.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[rt.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[rt.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[rt.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[rt.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[rt.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[rt.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[rt.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[rt.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[rt.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[rt.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[rt.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[rt.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[rt.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[rt.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[rt.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[rt.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[rt.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[rt.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[rt.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[rt.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[rt.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[rt.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[rt.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[rt.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[rt.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[rt.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[rt.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Xu(t){return EQ[t]||{desc:"UNKNOWN_ERROR_".concat(t),action:"failed"}}function mb(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Jg(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mb(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mb(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function _b(t){return t.every(e=>e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)}function Eb(t,e){if(typeof t=="string")return t;const{proxy:n,host:r,port:i}=t;if(e){const o=A("JOIN_GATEWAY_FALLBACK_PORT")||443;return o===443?"wss://".concat(r,"/ws/?p=").concat(Number(i)+150):"wss://".concat(r,":").concat(o,"/ws/?p=").concat(Number(i)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(r,"&p=").concat(i):"wss://".concat(r,":").concat(i)}const gQ=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,SQ=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,TQ=/wss:\/\/(.+):([0-9]+)\/?/,vQ=/wss:\/\/(.[^\/]+)\/?/;let yQ=0;class RQ{constructor(e,n){v(this,"id",0),v(this,"store",void 0),v(this,"recordIndex",void 0),v(this,"websockets",[]),v(this,"try443PortDuration",2e3),v(this,"forceCloseWSDuration",5e3),v(this,"try443PortTimeout",null),v(this,"forceCloseTimeout",null),v(this,"isTry443PortFailed",!1),v(this,"isNormalPortFailed",!1),v(this,"useDoubleDomain",!1),v(this,"useProxy",!1),v(this,"startTime",Date.now()),this.id=++yQ,this.try443PortDuration=A("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=e||5e3,this.store=n}closeAllWebsockets(){this.websockets.forEach(e=>{e.onopen=null,e.onclose=null,e.onmessage=null,e.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var e;const n=Date.now()-this.startTime;for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];m.debug("[choose-best-ws ".concat((e=this.store)===null||e===void 0?void 0:e.clientId," ").concat(this.id,"] ").concat(n,"ms:"),...i)}createWebSocket(e,n,r){this.logger("createWebSocket:",e,{isTry443Port:n,hasTimeoutDetection:r});const i=A("GATEWAY_DOMAINS"),o=Date.now(),s=[],a=i.find(l=>{var u;return $(u=e.host).call(u,l)});a||(this.useDoubleDomain=!1);const c=[];if(this.useDoubleDomain)i.forEach(l=>{c.push(Eb(Jg(Jg({},e),{},{host:e.host.replace(a,l)}),n))});else{const l=Jg({},e);if(n&&a){const u=i.find(h=>h!==a);u&&(l.host=l.host.replace(a,u))}c.push(Eb(l,n))}try{c.forEach(l=>{const u=new WebSocket(l);u.binaryType="arraybuffer",s.push(u),this.logger("ws is connecting:",u.url)})}catch(l){if(this.logger("ws create failed"),s.forEach(u=>u.close()),s.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(e,n,r);if(!n&&Number(e.port)!==443)return this.createWebSocket(e,!0,r);throw new P(R.WS_ERR,"init websocket failed! Error: ".concat(l.toString()))}const d=Yu();return this.store&&this.store.recordJoinChannelService({urls:s.map(l=>l.url),service:"gateway"},this.recordIndex),s.forEach(l=>{l.onopen=()=>{this.logger("onopen: ws ".concat(l.url," open cost ").concat(Date.now()-o,"ms")),this.websockets.forEach(u=>{u!==l&&(u.onopen=null,u.onclose=null,u.onmessage=null,u.close(),this.logger("close backup websocket: ".concat(u.url)))}),this.websockets.length=0,d.resolve(l)},l.onclose=u=>{this.logger("onclose: ws ".concat(l.url," closed cost ").concat(Date.now()-o,"ms state: ").concat(l.readyState)),n?this.isTry443PortFailed=_b(s):this.isNormalPortFailed=_b(s),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(n&&this.isTry443PortFailed||!n&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(u.reason)),d.reject({code:u.code,reason:Of.A_ROUND_WS_FAILED}))},l.onmessage=u=>this.logger("".concat(l.url," onmessage: ").concat(u.data))}),this.websockets.push(...s),r||(()=>{const l=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",d.isResolved),this.websockets.forEach(u=>u.readyState!==WebSocket.OPEN&&u.close())};if(n||this.useProxy)return this.logger("add 5s timeout at ".concat(n?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(l,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",d.isResolved),d.isResolved)return l();It().os===Ve.MAC_OS&&ce()&&l(),this.createWebSocket(e,!0,!0).then(u=>d.resolve(u)).catch(u=>{this.isNormalPortFailed&&d.reject(u),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(l,this.forceCloseWSDuration)},this.try443PortDuration)})(),d.promise}chooseBestWebsocket(e,n,r,i){return this.useDoubleDomain=!!n,typeof e=="string"&&(e=function(o){let s,a,c;return[,s,a,c]=o.match(gQ)||[],s||([,a,c]=o.match(SQ)||[]),a&&c||([,a,c]=o.match(TQ)||[]),a&&c||([,a]=o.match(vQ)||[]),a||m.warning("un-destructible url: ",o),{proxy:s,host:a,port:c||"443"}}(e)),this.recordIndex=i,this.useProxy=!!e.proxy,r&&this.useProxy&&(m.warn("cannot use 443 only when use proxy"),r=!1),this.createWebSocket(e,!!r,!1).finally(()=>this.clearTimeout())}}function gb(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}class RV extends oe{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){var n;$(n=["tryNext","recover"]).call(n,e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._state==="reconnecting"?this.emit(dt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(dt.CONNECTED):this._state==="closed"?this.emit(dt.CLOSED):this._state==="failed"&&this.emit(dt.FAILED))}resetReconnectCount(e){m.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],o=arguments.length>4&&arguments[4]!==void 0&&arguments[4],s=arguments.length>5?arguments[5]:void 0;super(),v(this,"connectionID",0),v(this,"currentURLIndex",0),v(this,"urls",[]),v(this,"_reconnectMode","tryNext"),v(this,"reconnectReason",void 0),v(this,"_initMutex",new pn("websocket")),v(this,"name",void 0),v(this,"_state","closed"),v(this,"reconnectInterrupter",void 0),v(this,"websocket",void 0),v(this,"retryConfig",void 0),v(this,"reconnectCount",0),v(this,"forceCloseTimeout",5e3),v(this,"onlineReconnectListener",void 0),v(this,"useCompress",void 0),v(this,"tryDoubleDomain",!1),v(this,"use443PortOnly",!1),v(this,"wsInflateLength",0),v(this,"wsDeflateLength",0),v(this,"closeEstablishingWs",()=>{}),v(this,"store",void 0),v(this,"joinGatewayRecordIndex",void 0),this.store=s,this.name=e,this.retryConfig=function(u){for(var h=1;h<arguments.length;h++){var p=arguments[h]!=null?arguments[h]:{};h%2?gb(Object(p),!0).forEach(function(S){v(u,S,p[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(p)):gb(Object(p)).forEach(function(S){Object.defineProperty(u,S,Object.getOwnPropertyDescriptor(p,S))})}return u}({},n),this.useCompress=r,this.tryDoubleDomain=i,this.use443PortOnly=o;const{timeout:a,timeoutFactor:c}=n,d=Math.max(300,Math.floor(3*a/5)),l=Math.max(1.2,Math.floor(8*c)/10);or.ONLINE&&(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=l),ve.on(nd.NETWORK_STATE_CHANGE,(u,h)=>{u!==h&&(this.resetReconnectCount("network state change: ".concat(h," -> ").concat(u)),u===or.ONLINE?(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=c))})}getConnection(){return this.websocket||void 0}async init(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const r=await this._initMutex.lock();this.forceCloseTimeout=n,this.urls=e,this.state="connecting";try{const i=Yu(),o=this.urls[this.currentURLIndex];A("ENABLE_PREALLOC_PC")&&this.emit(yV.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(i.resolve).catch(i.reject),this.once(dt.CLOSED,()=>{i.reject(new M(R.WS_DISCONNECT))}),this.once(dt.CONNECTED,i.resolve),await i.promise}catch{}finally{r()}}close(e,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,n){if(!this.websocket)return void m.warning("[".concat(this.name,"] can not reconnect, no websocket"));e!==void 0&&(this.reconnectMode=e),m.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinGatewayRecordIndex);const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:n})}sendMessage(e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new M(R.WS_ABORT,"websocket is not ready");try{n||(e=JSON.stringify(e)),this.websocket.send(e)}catch(r){throw new M(R.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e){var n;const r=Yu();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=l=>{var u;(u=this.store)===null||u===void 0||u.signalChannelOpen(),m.debug("[".concat(this.name,"] websocket opened:"),l),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r.resolve()},o=async l=>{var u;if(m.debug("[".concat(this.name,"] websocket close ").concat((u=this.websocket)===null||u===void 0?void 0:u.url,", code: ").concat(l.code,", reason: ").concat(l.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)r.reject(new M(R.WS_DISCONNECT,"websocket close: ".concat(l.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=l.reason,this.state="reconnecting");const h=Kr(this,dt.WILL_RECONNECT,this.reconnectMode,l.reason)||this.reconnectMode,p=await this.reconnectWithAction(h);if(this.state==="closed")return void m.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!p)return r.reject(new M(R.WS_DISCONNECT,"websocket reconnect failed: ".concat(l.code))),this.close(!0);r.resolve()}},s=l=>{this.emit(dt.ON_MESSAGE,l)},a=l=>{m.warn("[".concat(this.connectionID,"] ws open error ").concat(l))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),A("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=A("GATEWAY_WSS_ADDRESS")),m.debug("[".concat(this.name,"] start connect, url:"),e);const c=(n=this.store)===null||n===void 0?void 0:n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var d;const l=await this.chooseBestWebsocketConnection(e);this.websocket=l,i&&i(this.websocket.url),this.websocket.onclose=o,this.websocket.onmessage=s,this.websocket.onerror=a,(d=this.store)===null||d===void 0||d.recordJoinChannelService({endTs:Date.now(),status:"success"},c),this.joinGatewayRecordIndex=c}catch(l){const u=this.state==="closed",h=l instanceof M,p=h&&l.code===R.WS_ABORT,S=h&&l.code===R.WS_ERR,f=h?l.message:l&&(l.reason||l.toString());m.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(f)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:p?"aborted":"error",errors:[l]},c),u||S?(r.reject(u?new M(R.WS_DISCONNECT,"websocket is closed: ".concat(f)):new M(R.WS_ERR,"init websocket failed: ".concat(f))),S&&m.error("[".concat(this.name,"] init websocket failed: ").concat(f))):o&&o(l)}return r.promise}async reconnectWithAction(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;m.warning("[choose-best-ws] action: =>",e),this.onlineReconnectListener||ve.isOnline||!ve.onlineWaiter||(this.onlineReconnectListener=ve.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>r=!1,n){const s=oC(this.reconnectCount,this.retryConfig);m.debug("[".concat(this.name,"] wait ").concat(s,"ms to reconnect websocket, mode: ").concat(e)),await Y.race([Je(s),this.onlineReconnectListener||new Y(()=>{})])}if(this._state==="closed"||!r)return!1;this.reconnectCount+=1;const i=async(s,a)=>{this.emit(dt.RECONNECT_CREATE_CONNECTION,a),await this.createWebSocketConnection(s)};try{if(e==="retry")this.emit(dt.RECONNECT_WAITTING_FINISH,e),await i(this.urls[this.currentURLIndex],e);else if(e==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);m.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(dt.RECONNECT_WAITTING_FINISH,e),await i(this.urls[this.currentURLIndex],e)}else e==="recover"&&(m.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(dt.RECONNECT_WAITTING_FINISH,e),this.urls=await cn(this,dt.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],e))}catch(s){var o;m.error("[".concat(this.name,"] reconnect failed ").concat(s&&s.toString()));const a=s==null||(o=s.data)===null||o===void 0?void 0:o.desc;return Array.isArray(a)&&$(a).call(a,"dynamic key expired")?(this.emit(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(e,n)}return!0}}class dC extends RV{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){const r=Yu(),i=function(s,a){return new RQ(s,a)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{m.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),r.reject(new M(R.WS_ABORT,"choose best websocket aborted"))};const o=A("GATEWAY_DOMAINS");return m.debug("[choose-best-ws] currentDomain: ",e,", domains: ",o,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(e,this.tryDoubleDomain,this.use443PortOnly,n).then(r.resolve).catch(r.reject),r.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class Qu extends RV{constructor(e,n){super(e,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(e,n){return new Y((r,i)=>{let o=!1;const s=[];this.closeEstablishingWs=()=>{m.debug("[choose-best-ws] close establishing websockets"),s.forEach(S=>{S.onclose=null,S.onopen=null,S.onmessage=null,S.close()}),i(new M(R.WS_ABORT,"choose best websocket aborted"))};const a=A("GATEWAY_DOMAINS");let c;const d=e.indexOf("?h="),l=a.find(S=>d!==-1?$(e).call(e,S,d):$(e).call(e,S));m.debug("[choose-best-ws] currentDomain: ",l,", domains: ",a);let u=!this.tryDoubleDomain||!l;if(!u&&l){var h;const S=Date.now();try{a.forEach(f=>{const _=d===-1?e.replace(l,f):e.substr(0,d)+e.substr(d).replace(l,f),T=new WebSocket(_);T.binaryType="arraybuffer",s.push(T),m.debug("[choose-best-ws] ws is connecting:",T.url)})}catch{for(m.debug("[choose-best-ws] ws create failed, fallback to single url"),s.forEach(_=>_.close());s.length;)s.pop();u=!0}(h=this.store)===null||h===void 0||h.recordJoinChannelService({urls:s.map(f=>f.url),service:"gateway"},n),s.forEach(f=>{f.onopen=()=>{if(o)return;const _=Date.now()-S;m.debug("[choose-best-ws] ws open cost ".concat(_,"ms")),s.filter(T=>T!==f).forEach(T=>{m.debug("[choose-best-ws]close backup websocket: ".concat(T.url)),T.close()}),o=!0,r(f)},f.onclose=_=>{c=_,!o&&(s.find(T=>!(T.readyState===WebSocket.CLOSED||T.readyState===WebSocket.CLOSING))||(m.debug("[choose-best-ws] all websocket is closed"),o=!0,i(c)))},f.onmessage=_=>{m.debug("[choose-best-ws]".concat(f.url," onmessage: ").concat(_.data))}}),Je(this.forceCloseTimeout).then(()=>{s.forEach(f=>{f.readyState!==WebSocket.OPEN&&f.close()})})}if(u){var p;let S;m.debug("[choose-best-ws] use single url: ",e),(p=this.store)===null||p===void 0||p.recordJoinChannelService({urls:[e],service:"gateway"},n);try{S=new WebSocket(e),s.push(S),S.binaryType="arraybuffer"}catch(f){const _=new M(R.WS_ERR,"init websocket failed! Error: ".concat(f.toString()));return m.error("[".concat(this.name,"]").concat(_)),void i(_)}S.onopen=()=>{r(S)},S.onclose=f=>{i(f)},S.onmessage=f=>{m.debug("[choose-best-ws]".concat(S.url," onmessage: ").concat(f.data))},Je(this.forceCloseTimeout).then(()=>{S&&S.readyState!==WebSocket.OPEN&&S.close()})}}).then(r=>(this.closeEstablishingWs=void 0,r)).catch(r=>{throw this.closeEstablishingWs=void 0,r})}}class CQ extends oe{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Kt.CONNECTED?this.emit(at.WS_CONNECTED):e===Kt.RECONNECTING?this.emit(at.WS_RECONNECTING,this._websocketReconnectReason):e===Kt.CLOSED&&this.emit(at.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),v(this,"_disconnectedReason",void 0),v(this,"_websocketReconnectReason",void 0),v(this,"_connectionState",Kt.CLOSED),v(this,"reconnectToken",void 0),v(this,"websocket",void 0),v(this,"openConnectionTime",void 0),v(this,"clientId",void 0),v(this,"lastMsgTime",Date.now()),v(this,"uploadCache",[]),v(this,"uploadCacheInterval",void 0),v(this,"rttRolling",new mV(5)),v(this,"pingpongTimer",void 0),v(this,"wsInflateDataTimer",void 0),v(this,"pingpongTimeoutCount",0),v(this,"joinResponse",void 0),v(this,"multiIpOption",void 0),v(this,"initError",void 0),v(this,"spec",void 0),v(this,"store",void 0),v(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(at.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const o="res-@".concat(i._id);this.emit(o,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Et.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Et.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(kt.UID_BANNED);break;case 15:this.close(kt.IP_BANNED);break;case 16:this.close(kt.CHANNEL_BANNED)}if(i._type===Et.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case rt.ERR_LICENSE_MISSING:this.close(kt.LICENSE_MISSING);break;case rt.ERR_LICENSE_EXPIRED:this.close(kt.LICENSE_EXPIRED);break;case rt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(kt.LICENSE_MINUTES_EXCEEDED);break;case rt.ERR_LICENSE_PERIOD_INVALID:this.close(kt.LICENSE_PERIOD_INVALID);break;case rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(kt.LICENSE_MULTIPLE_SDK_SERVICE);break;case rt.ERR_LICENSE_ILLEGAL:this.close(kt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new dC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,A("JOIN_GATEWAY_USE_DUAL_DOMAIN"),A("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Kt.CONNECTED&&this.reconnect("retry",sn.OFFLINE)})}async request(e,n,r,i){const o=zt(6,""),s={_id:o,_type:e,_message:n},a=this.websocket.connectionID,c=()=>new Y((S,f)=>{if(this.connectionState===Kt.CONNECTED)return S();const _=()=>{this.off(at.WS_CLOSED,T),S()},T=()=>{this.off(at.WS_CONNECTED,_),f(new P(R.WS_ABORT))};this.once(at.WS_CONNECTED,_),this.once(at.WS_CLOSED,T),e!==st.PUBLISH&&e!==st.PUBLISH_DATASTREAM&&e!==st.SUBSCRIBE&&e!==st.SUBSCRIBE_DATASTREAM&&e!==st.UNSUBSCRIBE&&e!==st.UNSUBSCRIBE_DATASTREAM&&e!==st.UNPUBLISH&&e!==st.UNPUBLISH_DATASTREAM&&e!==st.CONTROL&&e!==st.RESTART_ICE||this.once(at.DISCONNECT_P2P,()=>{f(new P(R.DISCONNECT_P2P))}),e!==st.PUBLISH&&e!==st.RESTART_ICE||this.once(at.ABORT_P2P_EXECUTION,()=>{f(new P(R.DISCONNECT_P2P))})});if(this.connectionState!==Kt.CONNECTING&&this.connectionState!==Kt.RECONNECTING||e===st.JOIN||e===st.REJOIN||await c(),this.websocket.sendMessage(s,!0),i)return;const d=new Y((S,f)=>{let _=!1;const T=(y,I)=>{_=!0,S({isSuccess:y==="success",message:I||{}}),this.off(at.WS_CLOSED,g),this.off(at.WS_RECONNECTING,g),this.emit(at.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(o),T);const g=()=>{f(new P(R.WS_ABORT,"type: ".concat(e))),this.off(at.WS_CLOSED,g),this.off(at.WS_RECONNECTING,g),this.off("res-@".concat(o),T)};this.once(at.WS_CLOSED,g),this.once(at.WS_RECONNECTING,g),Je(A("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||_||(m.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(at.REQUEST_TIMEOUT,e,n))})});let l=null;try{l=await d}catch(S){if(this.connectionState===Kt.CLOSED||e===st.LEAVE)throw new P(R.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?S.throw():e===st.JOIN||e===st.REJOIN?null:(await c(),await this.request(e,n))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),h=Xu(u),p=new P(R.UNEXPECTED_RESPONSE,"".concat(h.desc,": ").concat(l.message.error_str),{code:u,data:l.message,desc:h.desc});return h.action==="success"?l.message:(m.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(u,", message: ").concat(h.desc,", action: ").concat(h.action)),u===rt.ERR_TOO_MANY_BROADCASTERS?((e===st.JOIN||e===st.REJOIN)&&(this.initError=p,this.close()),p.throw()):h.action==="failed"?p.throw():h.action==="quit"?(this.initError=p,this.close(),p.throw()):(u===rt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,m.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",sn.MULTI_IP)):this.reconnect(h.action,sn.SERVER_ERROR),e===st.JOIN||e===st.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new Y(r=>{const i=o=>{(!n||n(o))&&(this.off(e,i),r(o))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void m.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Ju.WRTC_STATS,n)}upload(e,n){const r={_type:e,_message:n};try{this.websocket.sendMessage(r)}catch{const o=A("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Kt.CONNECTED)return;const s=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},A("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const r={_type:e,_message:n};this.websocket.sendMessage(r)}init(e,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Y((r,i)=>{this.once(at.WS_CONNECTED,()=>r(this.joinResponse)),this.once(at.WS_CLOSED,()=>i(this.initError||new P(R.WS_ABORT))),this.connectionState=Kt.CONNECTING,this.websocket.init(e).catch(i),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||kt.LEAVE,this.connectionState=Kt.CLOSED,m.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(at.ABORT_P2P_EXECUTION);const e=await cn(this,at.REQUEST_JOIN_INFO),n=await this.request(st.JOIN,e);if(!n)return this.emit(at.REPORT_JOIN_GATEWAY,Of.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(at.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Kt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new P(R.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=qu(this,at.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const n=await this.request(st.REJOIN,e);return!!n&&(this.connectionState=Kt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Et.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Et.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Et.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Et.MUTE_AUDIO,{uid:r.uid}):this.emit(Et.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Et.MUTE_VIDEO,{uid:r.uid}):this.emit(Et.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Et.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Et.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Et.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Et.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Et.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleNotification(e){m.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Xu(e.code);if(e.code===28&&"detail"in e&&(m.info("[".concat(this.clientId,"] receive recover notification: "),e.detail),this.emit(at.RECOVER_NOTIFICATION,e.detail)),n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(kt.UID_BANNED),void this.close()):void this.reconnect(n.action,sn.SERVER_ERROR);m.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=A("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(m.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>A("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",sn.TIMEOUT):this.request(st.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),A("REPORT_STATS")&&this.send(st.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:n}=this.websocket.getWsInflateData();e!==0&&n!==0&&this.upload(Ju.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(dt.RECONNECT_WAITTING_FINISH,e=>{this.emit(at.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(dt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(at.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(dt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(dt.CLOSED,()=>{this.connectionState=Kt.CLOSED}),this.websocket.on(dt.FAILED,()=>{this._disconnectedReason=kt.NETWORK_ERROR,this.connectionState=Kt.CLOSED}),this.websocket.on(dt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Kt.CONNECTED?this.connectionState=Kt.RECONNECTING:this.connectionState=Kt.CONNECTING}),this.websocket.on(dt.WILL_RECONNECT,(e,n,r)=>{const i=qu(this,at.IS_P2P_DISCONNECTED),o=i||e!=="retry";i&&e==="retry"&&(m.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),e="tryNext",n=Of.P2P_DISCONNECTED),o&&(m.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(e)),this.emit(at.REPORT_JOIN_GATEWAY,n||Of.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(at.DISCONNECT_P2P)),r(e)}),this.websocket.on(dt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(e=>{m.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",sn.SERVER_ERROR)}):this.join().catch(e=>{if(this.emit(at.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof P){if(e.code===R.UNEXPECTED_RESPONSE&&e.data.code===rt.ERR_NO_AUTHORIZED)return this.initError=new P(R.CAN_NOT_GET_GATEWAY_SERVER,"AgoraRTCError CAN_NOT_GET_GATEWAY_SERVER: dynamic key expired"),m.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",sn.SERVER_ERROR);m.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",sn.SERVER_ERROR):(this.initError=e,this.close())}})}),this.websocket.on(dt.REQUEST_NEW_URLS,(e,n)=>{cn(this,at.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(yV.PRE_CONNECT_PC,()=>{this.emit(at.PRE_CONNECT_PC)})}}let Te=function(t){return t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",t}({});function Sb(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Ip(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Sb(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Sb(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function od(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(A("TURN_DOMAIN")):(m.info("Unidentified as ip: ".concat(t,", use as host")),t)}function lC(t,e){t.addresses||(t.addresses=[]);const n=function(a,c){if(A("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return a.map(u=>{let{ip:h,port:p}=u;return{address:"".concat(h,":").concat(p)}});const d=A("GATEWAY_DOMAINS");let l=d[1]&&$(c).call(c,d[1])?1:0;return a.map(u=>{let{domain_prefix:h,port:p,ip:S}=u;if(h)return{address:"".concat(h,".").concat(d[l++%d.length],":").concat(p)};const f=/^[\.\:\d]+$/.test(S),_=f?"".concat(S.replace(/[^\d]/g,"-"),".").concat(d[l++%d.length],":").concat(p):"".concat(S,":").concat(p);return f||m.info("Unidentified as ip: ".concat(S,", use as host")),{ip:S,port:p,address:_}})}(t.addresses,e),r=Array.isArray(t.detail)&&t.detail[18];if(r&&typeof r=="string"){const a=r.split(";");for(let c=0;c<a.length;c++){var i;const d=Cn(i=a[c]).call(i);n[c]&&d&&(n[c].ip6=d)}}const o=t.detail&&t.detail.candidate;let s;if(o){const[a,c]=o.split(":");a&&c&&(s={port:Number(c),ip:a,address:"".concat(a,":").concat(c)})}return{gatewayAddrs:n,apGatewayAddress:s,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function ar(t){return typeof t=="number"?t:t.exact||t.ideal||t.max||t.min||0}function Tb(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(ar(e.width),"x").concat(ar(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return typeof e.frameRate=="number"?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function vb(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function Zu(t,e){let n,r,i;switch(e){case Te.CHOOSE_SERVER:r=4096,i="choose server";break;case Te.CLOUD_PROXY:r=1048576,i="proxy";break;case Te.CLOUD_PROXY_5:r=4194304,i="proxy5";break;case Te.CLOUD_PROXY_FALLBACK:r=4194310,i="proxy fallback";break;default:throw new P(R.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach(o=>{o.buffer&&o.buffer.flag===r&&(n={code:o.buffer.code,addresses:(o.buffer.edges_services||[]).map(s=>Ip(Ip({},s),{},{ticket:o.buffer.cert})),server_ts:t.enter_ts,uid:o.buffer.uid,cid:o.buffer.cid,cname:o.buffer.cname,detail:Ip(Ip({},o.buffer.detail),t.detail),flag:o.buffer.flag,opid:t.opid,cert:o.buffer.cert})}),!n)throw new P(R.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function CV(t,e){return await Y.all(t.addresses.map(async n=>({address:od(n.ip),tcpport:n.port,udpport:n.port,username:e&&A("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():nn.username,password:e&&A("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Hv(e.toString()):nn.password})))}function Jv(t,e){const n=e.getMediaStreamTrack(!0).getSettings(),r=e.videoHeight||n.height,i=e.videoWidth||n.width;return r&&i?Math.max(Math.min(r,i)/Math.min(ar(t.height),ar(t.width)),1):(m.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Ps(t){let{candidateType:e,relayProtocol:n,type:r,address:i,port:o,protocol:s}=t;return r==="local-candidate"?{candidateType:e,relayProtocol:n,protocol:s}:{candidateType:e,relayProtocol:n,address:i,port:o,protocol:s}}var ii,IQ=de(SV),wQ=Ai("Array").values,AQ=wo,OQ=fn,bQ=Mn,NQ=wQ,Xg=Array.prototype,PQ={DOMTokenList:!0,NodeList:!0},DQ=function(t){var e=t.values;return t===Xg||bQ(Xg,t)&&e===Xg.values||OQ(PQ,AQ(t))?NQ:e},qo=de(DQ),yb=Qr,kQ=Ae,LQ=dn,MQ=Pe,Qg=I_,UQ=wh,xQ=E_,VQ=Io,FQ=g_,Ic=Object.assign,Rb=Object.defineProperty,jQ=kQ([].concat),BQ=!Ic||MQ(function(){if(yb&&Ic({b:1},Ic(Rb({},"a",{enumerable:!0,get:function(){Rb(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach(function(i){e[i]=i}),Ic({},t)[n]!=7||Qg(Ic({},e)).join("")!=r})?function(t,e){for(var n=VQ(t),r=arguments.length,i=1,o=UQ.f,s=xQ.f;r>i;)for(var a,c=FQ(arguments[i++]),d=o?jQ(Qg(c),o(c)):Qg(c),l=d.length,u=0;l>u;)a=d[u++],yb&&!LQ(s,c,a)||(n[a]=c[a]);return n}:Ic,GQ=Qn,WQ=NU,HQ=sa,KQ=dn,zQ=Io,YQ=function(t,e,n,r){try{return r?e(GQ(n)[0],n[1]):e(n)}catch(i){WQ(t,"throw",i)}},$Q=bU,qQ=O_,JQ=ns,Cb=D_,XQ=AR,QQ=w_,Ib=Array,hc=Ae,Zg=2147483647,ZQ=/[^\0-\u007E]/,IV=/[.\u3002\uFF0E\uFF61]/g,wb="Overflow: input needs wider integers to process",Ab=RangeError,tZ=hc(IV.exec),sd=Math.floor,tS=String.fromCharCode,Ob=hc("".charCodeAt),wV=hc([].join),Es=hc([].push),eZ=hc("".replace),nZ=hc("".split),rZ=hc("".toLowerCase),bb=function(t){return t+22+75*(t<26)},iZ=function(t,e,n){var r=0;for(t=n?sd(t/700):t>>1,t+=sd(t/e);t>455;)t=sd(t/35),r+=36;return sd(r+36*t/(t+38))},oZ=function(t){var e=[];t=function(T){for(var g=[],y=0,I=T.length;y<I;){var O=Ob(T,y++);if(O>=55296&&O<=56319&&y<I){var b=Ob(T,y++);(64512&b)==56320?Es(g,((1023&O)<<10)+(1023&b)+65536):(Es(g,O),y--)}else Es(g,O)}return g}(t);var n,r,i=t.length,o=128,s=0,a=72;for(n=0;n<t.length;n++)(r=t[n])<128&&Es(e,tS(r));var c=e.length,d=c;for(c&&Es(e,"-");d<i;){var l=Zg;for(n=0;n<t.length;n++)(r=t[n])>=o&&r<l&&(l=r);var u=d+1;if(l-o>sd((Zg-s)/u))throw Ab(wb);for(s+=(l-o)*u,o=l,n=0;n<t.length;n++){if((r=t[n])<o&&++s>Zg)throw Ab(wb);if(r==o){for(var h=s,p=36;;){var S=p<=a?1:p>=a+26?26:p-a;if(h<S)break;var f=h-S,_=36-S;Es(e,tS(bb(S+f%_))),h=sd(f/_),p+=36}Es(e,tS(bb(h))),a=iZ(s,u,d==c),s=0,d++}}s++,o++}return wV(e,"")},sZ=Bt,uC=Qr,aZ=YR,hC=Le,Nb=sa,Oi=Ae,wp=ca,oi=A_,cZ=NR,Xv=fn,pC=BQ,wc=function(t){var e=zQ(t),n=qQ(this),r=arguments.length,i=r>1?arguments[1]:void 0,o=i!==void 0;o&&(i=HQ(i,r>2?arguments[2]:void 0));var s,a,c,d,l,u,h=QQ(e),p=0;if(!h||this===Ib&&$Q(h))for(s=JQ(e),a=n?new this(s):Ib(s);s>p;p++)u=o?i(e[p],p):e[p],Cb(a,p,u);else for(l=(d=XQ(e,h)).next,a=n?new this:[];!(c=KQ(l,d)).done;p++)u=o?YQ(d,i,[c.value,p],!0):c.value,Cb(a,p,u);return a.length=p,a},Pi=VR,dZ=xR.codeAt,lZ=function(t){var e,n,r=[],i=nZ(eZ(rZ(t),IV,"."),".");for(e=0;e<i.length;e++)n=i[e],Es(r,tZ(ZQ,n)?"xn--"+oZ(n):n);return wV(r,".")},Lo=ei,uZ=da,hZ=tl,AV=_J,OV=uc,pZ=OV.set,Dm=OV.getterFor("URL"),fZ=AV.URLSearchParams,mZ=AV.getState,Il=hC.URL,Qv=hC.TypeError,Ap=hC.parseInt,_Z=Math.floor,Pb=Math.pow,fi=Oi("".charAt),Li=Oi(/./.exec),Gl=Oi([].join),EZ=Oi(1 .toString),gZ=Oi([].pop),Ac=Oi([].push),eS=Oi("".replace),SZ=Oi([].shift),TZ=Oi("".split),Wl=Oi("".slice),bf=Oi("".toLowerCase),vZ=Oi([].unshift),nS="Invalid scheme",ua="Invalid host",Db="Invalid port",bV=/[a-z]/i,yZ=/[\d+-.a-z]/i,rS=/\d/,RZ=/^0x/i,CZ=/^[0-7]+$/,IZ=/^\d+$/,kb=/^[\da-f]+$/i,wZ=/[\0\t\n\r #%/:<>?@[\\\]^|]/,AZ=/[\0\t\n\r #/:<>?@[\\\]^|]/,OZ=/^[\u0000-\u0020]+/,bZ=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,NZ=/[\t\n\r]/g,wl=function(t){var e,n,r,i;if(typeof t=="number"){for(e=[],n=0;n<4;n++)vZ(e,t%256),t=_Z(t/256);return Gl(e,".")}if(typeof t=="object"){for(e="",r=function(o){for(var s=null,a=1,c=null,d=0,l=0;l<8;l++)o[l]!==0?(d>a&&(s=c,a=d),c=null,d=0):(c===null&&(c=l),++d);return d>a&&(s=c,a=d),s}(t),n=0;n<8;n++)i&&t[n]===0||(i&&(i=!1),r===n?(e+=n?":":"::",i=!0):(e+=EZ(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},Nf={},NV=pC({},Nf,{" ":1,'"':1,"<":1,">":1,"`":1}),PV=pC({},NV,{"#":1,"?":1,"{":1,"}":1}),iS=pC({},PV,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ls=function(t,e){var n=dZ(t,0);return n>32&&n<127&&!Xv(e,t)?t:encodeURIComponent(t)},Op={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Hl=function(t,e){var n;return t.length==2&&Li(bV,fi(t,0))&&((n=fi(t,1))==":"||!e&&n=="|")},Lb=function(t){var e;return t.length>1&&Hl(Wl(t,0,2))&&(t.length==2||(e=fi(t,2))==="/"||e==="\\"||e==="?"||e==="#")},PZ=function(t){return t==="."||bf(t)==="%2e"},oS={},Mb={},sS={},Ub={},xb={},aS={},Vb={},Fb={},bp={},Np={},cS={},dS={},lS={},uS={},jb={},hS={},Oc={},eo={},Bb={},ha={},No={},fC=function(t,e,n){var r,i,o,s=Lo(t);if(e){if(i=this.parse(s))throw Qv(i);this.searchParams=null}else{if(n!==void 0&&(r=new fC(n,!0)),i=this.parse(s,null,r))throw Qv(i);(o=mZ(new fZ)).bindURL(this),this.searchParams=o}};fC.prototype={type:"URL",parse:function(t,e,n){var r,i,o,s,a,c=this,d=e||oS,l=0,u="",h=!1,p=!1,S=!1;for(t=Lo(t),e||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,t=eS(t,OZ,""),t=eS(t,bZ,"$1")),t=eS(t,NZ,""),r=wc(t);l<=r.length;){switch(i=r[l],d){case oS:if(!i||!Li(bV,i)){if(e)return nS;d=sS;continue}u+=bf(i),d=Mb;break;case Mb:if(i&&(Li(yZ,i)||i=="+"||i=="-"||i=="."))u+=bf(i);else{if(i!=":"){if(e)return nS;u="",d=sS,l=0;continue}if(e&&(c.isSpecial()!=Xv(Op,u)||u=="file"&&(c.includesCredentials()||c.port!==null)||c.scheme=="file"&&!c.host))return;if(c.scheme=u,e)return void(c.isSpecial()&&Op[c.scheme]==c.port&&(c.port=null));u="",c.scheme=="file"?d=uS:c.isSpecial()&&n&&n.scheme==c.scheme?d=Ub:c.isSpecial()?d=Fb:r[l+1]=="/"?(d=xb,l++):(c.cannotBeABaseURL=!0,Ac(c.path,""),d=Bb)}break;case sS:if(!n||n.cannotBeABaseURL&&i!="#")return nS;if(n.cannotBeABaseURL&&i=="#"){c.scheme=n.scheme,c.path=Pi(n.path),c.query=n.query,c.fragment="",c.cannotBeABaseURL=!0,d=No;break}d=n.scheme=="file"?uS:aS;continue;case Ub:if(i!="/"||r[l+1]!="/"){d=aS;continue}d=bp,l++;break;case xb:if(i=="/"){d=Np;break}d=eo;continue;case aS:if(c.scheme=n.scheme,i==ii)c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Pi(n.path),c.query=n.query;else if(i=="/"||i=="\\"&&c.isSpecial())d=Vb;else if(i=="?")c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Pi(n.path),c.query="",d=ha;else{if(i!="#"){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Pi(n.path),c.path.length--,d=eo;continue}c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,c.path=Pi(n.path),c.query=n.query,c.fragment="",d=No}break;case Vb:if(!c.isSpecial()||i!="/"&&i!="\\"){if(i!="/"){c.username=n.username,c.password=n.password,c.host=n.host,c.port=n.port,d=eo;continue}d=Np}else d=bp;break;case Fb:if(d=bp,i!="/"||fi(u,l+1)!="/")continue;l++;break;case bp:if(i!="/"&&i!="\\"){d=Np;continue}break;case Np:if(i=="@"){h&&(u="%40"+u),h=!0,o=wc(u);for(var f=0;f<o.length;f++){var _=o[f];if(_!=":"||S){var T=ls(_,iS);S?c.password+=T:c.username+=T}else S=!0}u=""}else if(i==ii||i=="/"||i=="?"||i=="#"||i=="\\"&&c.isSpecial()){if(h&&u=="")return"Invalid authority";l-=wc(u).length+1,u="",d=cS}else u+=i;break;case cS:case dS:if(e&&c.scheme=="file"){d=hS;continue}if(i!=":"||p){if(i==ii||i=="/"||i=="?"||i=="#"||i=="\\"&&c.isSpecial()){if(c.isSpecial()&&u=="")return ua;if(e&&u==""&&(c.includesCredentials()||c.port!==null))return;if(s=c.parseHost(u))return s;if(u="",d=Oc,e)return;continue}i=="["?p=!0:i=="]"&&(p=!1),u+=i}else{if(u=="")return ua;if(s=c.parseHost(u))return s;if(u="",d=lS,e==dS)return}break;case lS:if(!Li(rS,i)){if(i==ii||i=="/"||i=="?"||i=="#"||i=="\\"&&c.isSpecial()||e){if(u!=""){var g=Ap(u,10);if(g>65535)return Db;c.port=c.isSpecial()&&g===Op[c.scheme]?null:g,u=""}if(e)return;d=Oc;continue}return Db}u+=i;break;case uS:if(c.scheme="file",i=="/"||i=="\\")d=jb;else{if(!n||n.scheme!="file"){d=eo;continue}if(i==ii)c.host=n.host,c.path=Pi(n.path),c.query=n.query;else if(i=="?")c.host=n.host,c.path=Pi(n.path),c.query="",d=ha;else{if(i!="#"){Lb(Gl(Pi(r,l),""))||(c.host=n.host,c.path=Pi(n.path),c.shortenPath()),d=eo;continue}c.host=n.host,c.path=Pi(n.path),c.query=n.query,c.fragment="",d=No}}break;case jb:if(i=="/"||i=="\\"){d=hS;break}n&&n.scheme=="file"&&!Lb(Gl(Pi(r,l),""))&&(Hl(n.path[0],!0)?Ac(c.path,n.path[0]):c.host=n.host),d=eo;continue;case hS:if(i==ii||i=="/"||i=="\\"||i=="?"||i=="#"){if(!e&&Hl(u))d=eo;else if(u==""){if(c.host="",e)return;d=Oc}else{if(s=c.parseHost(u))return s;if(c.host=="localhost"&&(c.host=""),e)return;u="",d=Oc}continue}u+=i;break;case Oc:if(c.isSpecial()){if(d=eo,i!="/"&&i!="\\")continue}else if(e||i!="?")if(e||i!="#"){if(i!=ii&&(d=eo,i!="/"))continue}else c.fragment="",d=No;else c.query="",d=ha;break;case eo:if(i==ii||i=="/"||i=="\\"&&c.isSpecial()||!e&&(i=="?"||i=="#")){if((a=bf(a=u))===".."||a==="%2e."||a===".%2e"||a==="%2e%2e"?(c.shortenPath(),i=="/"||i=="\\"&&c.isSpecial()||Ac(c.path,"")):PZ(u)?i=="/"||i=="\\"&&c.isSpecial()||Ac(c.path,""):(c.scheme=="file"&&!c.path.length&&Hl(u)&&(c.host&&(c.host=""),u=fi(u,0)+":"),Ac(c.path,u)),u="",c.scheme=="file"&&(i==ii||i=="?"||i=="#"))for(;c.path.length>1&&c.path[0]==="";)SZ(c.path);i=="?"?(c.query="",d=ha):i=="#"&&(c.fragment="",d=No)}else u+=ls(i,PV);break;case Bb:i=="?"?(c.query="",d=ha):i=="#"?(c.fragment="",d=No):i!=ii&&(c.path[0]+=ls(i,Nf));break;case ha:e||i!="#"?i!=ii&&(i=="'"&&c.isSpecial()?c.query+="%27":c.query+=i=="#"?"%23":ls(i,Nf)):(c.fragment="",d=No);break;case No:i!=ii&&(c.fragment+=ls(i,NV))}l++}},parseHost:function(t){var e,n,r;if(fi(t,0)=="["){if(fi(t,t.length-1)!="]"||(e=function(i){var o,s,a,c,d,l,u,h=[0,0,0,0,0,0,0,0],p=0,S=null,f=0,_=function(){return fi(i,f)};if(_()==":"){if(fi(i,1)!=":")return;f+=2,S=++p}for(;_();){if(p==8)return;if(_()!=":"){for(o=s=0;s<4&&Li(kb,_());)o=16*o+Ap(_(),16),f++,s++;if(_()=="."){if(s==0||(f-=s,p>6))return;for(a=0;_();){if(c=null,a>0){if(!(_()=="."&&a<4))return;f++}if(!Li(rS,_()))return;for(;Li(rS,_());){if(d=Ap(_(),10),c===null)c=d;else{if(c==0)return;c=10*c+d}if(c>255)return;f++}h[p]=256*h[p]+c,++a!=2&&a!=4||p++}if(a!=4)return;break}if(_()==":"){if(f++,!_())return}else if(_())return;h[p++]=o}else{if(S!==null)return;f++,S=++p}}if(S!==null)for(l=p-S,p=7;p!=0&&l>0;)u=h[p],h[p--]=h[S+l-1],h[S+--l]=u;else if(p!=8)return;return h}(Wl(t,1,-1)),!e))return ua;this.host=e}else if(this.isSpecial()){if(t=lZ(t),Li(wZ,t)||(e=function(i){var o,s,a,c,d,l,u,h=TZ(i,".");if(h.length&&h[h.length-1]==""&&h.length--,(o=h.length)>4)return i;for(s=[],a=0;a<o;a++){if((c=h[a])=="")return i;if(d=10,c.length>1&&fi(c,0)=="0"&&(d=Li(RZ,c)?16:8,c=Wl(c,d==8?1:2)),c==="")l=0;else{if(!Li(d==10?IZ:d==8?CZ:kb,c))return i;l=Ap(c,d)}Ac(s,l)}for(a=0;a<o;a++)if(l=s[a],a==o-1){if(l>=Pb(256,5-o))return null}else if(l>255)return null;for(u=gZ(s),a=0;a<s.length;a++)u+=s[a]*Pb(256,3-a);return u}(t),e===null))return ua;this.host=e}else{if(Li(AZ,t))return ua;for(e="",n=wc(t),r=0;r<n.length;r++)e+=ls(n[r],Nf);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return Xv(Op,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||this.scheme=="file"&&e==1&&Hl(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,r=t.password,i=t.host,o=t.port,s=t.path,a=t.query,c=t.fragment,d=e+":";return i!==null?(d+="//",t.includesCredentials()&&(d+=n+(r?":"+r:"")+"@"),d+=wl(i),o!==null&&(d+=":"+o)):e=="file"&&(d+="//"),d+=t.cannotBeABaseURL?s[0]:s.length?"/"+Gl(s,"/"):"",a!==null&&(d+="?"+a),c!==null&&(d+="#"+c),d},setHref:function(t){var e=this.parse(t);if(e)throw Qv(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if(t=="blob")try{return new Ud(t.path[0]).origin}catch{return"null"}return t!="file"&&this.isSpecial()?t+"://"+wl(this.host)+(e!==null?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(Lo(t)+":",oS)},getUsername:function(){return this.username},setUsername:function(t){var e=wc(Lo(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=ls(e[n],iS)}},getPassword:function(){return this.password},setPassword:function(t){var e=wc(Lo(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=ls(e[n],iS)}},getHost:function(){var t=this.host,e=this.port;return t===null?"":e===null?wl(t):wl(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,cS)},getHostname:function(){var t=this.host;return t===null?"":wl(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,dS)},getPort:function(){var t=this.port;return t===null?"":Lo(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||((t=Lo(t))==""?this.port=null:this.parse(t,lS))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+Gl(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Oc))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){(t=Lo(t))==""?this.query=null:(fi(t,0)=="?"&&(t=Wl(t,1)),this.query="",this.parse(t,ha)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){(t=Lo(t))!=""?(fi(t,0)=="#"&&(t=Wl(t,1)),this.fragment="",this.parse(t,No)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ud=function(t){var e=cZ(this,er),n=hZ(arguments.length,1)>1?arguments[1]:void 0,r=pZ(e,new fC(t,!1,n));uC||(e.href=r.serialize(),e.origin=r.getOrigin(),e.protocol=r.getProtocol(),e.username=r.getUsername(),e.password=r.getPassword(),e.host=r.getHost(),e.hostname=r.getHostname(),e.port=r.getPort(),e.pathname=r.getPathname(),e.search=r.getSearch(),e.searchParams=r.getSearchParams(),e.hash=r.getHash())},er=Ud.prototype,si=function(t,e){return{get:function(){return Dm(this)[t]()},set:e&&function(n){return Dm(this)[e](n)},configurable:!0,enumerable:!0}};if(uC&&(oi(er,"href",si("serialize","setHref")),oi(er,"origin",si("getOrigin")),oi(er,"protocol",si("getProtocol","setProtocol")),oi(er,"username",si("getUsername","setUsername")),oi(er,"password",si("getPassword","setPassword")),oi(er,"host",si("getHost","setHost")),oi(er,"hostname",si("getHostname","setHostname")),oi(er,"port",si("getPort","setPort")),oi(er,"pathname",si("getPathname","setPathname")),oi(er,"search",si("getSearch","setSearch")),oi(er,"searchParams",si("getSearchParams")),oi(er,"hash",si("getHash","setHash"))),wp(er,"toJSON",function(){return Dm(this).serialize()},{enumerable:!0}),wp(er,"toString",function(){return Dm(this).serialize()},{enumerable:!0}),Il){var Gb=Il.createObjectURL,Wb=Il.revokeObjectURL;Gb&&wp(Ud,"createObjectURL",Nb(Gb,Il)),Wb&&wp(Ud,"revokeObjectURL",Nb(Wb,Il))}uZ(Ud,"URL"),sZ({global:!0,constructor:!0,forced:!aZ,sham:!uC},{URL:Ud});var DZ=Bt,kZ=Pe,LZ=tl,Hb=ei,MZ=YR,Kb=ur("URL");DZ({target:"URL",stat:!0,forced:!(MZ&&kZ(function(){Kb.canParse()}))},{canParse:function(t){var e=LZ(arguments.length,1),n=Hb(t),r=e<2||arguments[1]===void 0?void 0:Hb(arguments[1]);try{return!!new Kb(n,r)}catch{return!1}}});var zb=de(Zr.URL);const We={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function wt(){return We}function DV(){return"setSinkId"in HTMLAudioElement.prototype&&(!A("RESTRICTION_SET_PLAYBACK_DEVICE")||(Ws()||eV())&&!rC())}function Yb(){return!We.supportUnifiedPlan||A("CHROME_FORCE_PLAN_B")&&Xs()}let Ye=function(t){return t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change",t}({});function bc(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function yt(t,e,n,r,i){return{width:t,height:e,frameRate:n,bitrateMin:r,bitrateMax:i}}function ai(t,e,n,r,i){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:r,bitrateMax:i}}function pS(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}const UZ={"90p":yt(160,90),"90p_1":yt(160,90),"120p":yt(160,120,15,30,65),"120p_1":yt(160,120,15,30,65),"120p_3":yt(120,120,15,30,50),"120p_4":yt(212,120),"180p":yt(320,180,15,30,140),"180p_1":yt(320,180,15,30,140),"180p_3":yt(180,180,15,30,100),"180p_4":yt(240,180,15,30,120),"240p":yt(320,240,15,40,200),"240p_1":yt(320,240,15,40,200),"240p_3":yt(240,240,15,40,140),"240p_4":yt(424,240,15,40,220),"360p":yt(640,360,15,80,400),"360p_1":yt(640,360,15,80,400),"360p_3":yt(360,360,15,80,260),"360p_4":yt(640,360,30,80,600),"360p_6":yt(360,360,30,80,400),"360p_7":yt(480,360,15,80,320),"360p_8":yt(480,360,30,80,490),"360p_9":yt(640,360,15,80,800),"360p_10":yt(640,360,24,80,800),"360p_11":yt(640,360,24,80,1e3),"480p":yt(640,480,15,100,500),"480p_1":yt(640,480,15,100,500),"480p_2":yt(640,480,30,100,1e3),"480p_3":yt(480,480,15,100,400),"480p_4":yt(640,480,30,100,750),"480p_6":yt(480,480,30,100,600),"480p_8":yt(848,480,15,100,610),"480p_9":yt(848,480,30,100,930),"480p_10":yt(640,480,10,100,400),"720p":yt(1280,720,15,120,1130),"720p_auto":yt(1280,720,30,900,3e3),"720p_1":yt(1280,720,15,120,1130),"720p_2":yt(1280,720,30,120,2e3),"720p_3":yt(1280,720,30,120,1710),"720p_5":yt(960,720,15,120,910),"720p_6":yt(960,720,30,120,1380),"1080p":yt(1920,1080,15,120,2080),"1080p_1":yt(1920,1080,15,120,2080),"1080p_2":yt(1920,1080,30,120,3e3),"1080p_3":yt(1920,1080,30,120,3150),"1080p_5":yt(1920,1080,60,120,4780),"1440p":yt(2560,1440,30,120,4850),"1440p_1":yt(2560,1440,30,120,4850),"1440p_2":yt(2560,1440,60,120,7350),"4k":yt(3840,2160,30,120,8910),"4k_1":yt(3840,2160,30,120,8910),"4k_3":yt(3840,2160,60,120,13500)},xZ={"480p":ai(640,480,5),"480p_1":ai(640,480,5),"480p_2":ai(640,480,30),"480p_3":ai(640,480,15),"720p":ai(1280,720,5),"720p_auto":yt(1280,720,30,900,3e3),"720p_1":ai(1280,720,5),"720p_2":ai(1280,720,30),"720p_3":ai(1280,720,15),"1080p":ai(1920,1080,5),"1080p_1":ai(1920,1080,5),"1080p_2":ai(1920,1080,30),"1080p_3":ai(1920,1080,15)},VZ={"1SL1TL":pS(1,1),"3SL3TL":pS(3,3),"2SL3TL":pS(2,3)};function _o(t){return t||(t="480p_1"),typeof t=="string"?Object.assign({},UZ[t]):t}function fS(t){return typeof t=="string"?Object.assign({},xZ[t]):t}function Pp(t){return typeof t=="string"?Object.assign({},VZ[t]):t}const FZ={speech_low_quality:bc(16e3,!1),speech_standard:bc(32e3,!1,18),music_standard:bc(48e3,!1),standard_stereo:bc(48e3,!0,56),high_quality:bc(48e3,!1,128),high_quality_stereo:bc(48e3,!0,192)};function km(t){return typeof t=="string"?Object.assign({},FZ[t]):t}const xc=[];function $b(t){return De(t,"mediaSource",["screen","window","application"]),!0}let J=function(t){return t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track",t}({}),Ht=function(t){return t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream",t.SCREEN_LOW_TRACK="screen_low_track",t}({}),xd=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t}({}),jZ=function(t){return t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",t}({}),BZ=function(t){return t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY",t[t.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",t[t.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",t[t.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",t[t.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",t[t.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",t[t.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",t}({}),Ha=function(t){return t.TRANSCEIVER_UPDATED="transceiver-updated",t.SEI_TO_SEND="sei-to-send",t.SEI_RECEIVED="sei-received",t.TRACK_UPDATED="track-updated",t}({}),il=function(t){return t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed",t}({}),gd=function(t){return t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.VIDEO_STATE_CHANGED="video-state-changed",t}({}),ol=function(t){return t.AUDIO="audio",t.VIDEO="video",t.DATA="data",t}({}),vr=function(t){return t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source",t}({});(function(t){t.UPDATE_TRACK_SOURCE="update-track-source"})({});const Zv={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},ty={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},kV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},GZ={uplinkNetworkQuality:0,downlinkNetworkQuality:0},LV={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let kn=function(t){return t.ON_TRACK="on_track",t.ON_NODE="on_node",t}({}),Nr=function(t){return t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints",t}({}),Al=function(t){return t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND",t}({}),Ma=function(t){return t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",t}({}),yn=function(t){return t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata",t}({}),no=function(t){return t[t.VideoStateStopped=0]="VideoStateStopped",t[t.VideoStateStarting=1]="VideoStateStarting",t[t.VideoStateDecoding=2]="VideoStateDecoding",t[t.VideoStateFrozen=3]="VideoStateFrozen",t}({});const mS={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let Pf=function(t){return t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error",t}({});function Rt(t,e,n,r,i){var o,s,a={};return Object.keys(r).forEach(function(c){a[c]=r[c]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=zi(o=IQ(s=n.slice()).call(s)).call(o,function(c,d){return d(t,e,c)||c},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(t,e,a),a=null),a}function x(t,e,n){return(e=function(r){var i=function(o,s){if(typeof o!="object"||!o)return o;var a=o[Symbol.toPrimitive];if(a!==void 0){var c=a.call(o,"string");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(r);return typeof i=="symbol"?i:i+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function qb(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function te(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?qb(Object(n),!0).forEach(function(r){x(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qb(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class MV extends oe{set _mediaStreamTrack(e){e!==this.mediaStreamTrack&&(this.safeEmit(Ha.TRACK_UPDATED,e),this.mediaStreamTrack=e)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(e,n){super(),x(this,"trackMediaType",void 0),x(this,"_ID",void 0),x(this,"_rtpTransceiver",void 0),x(this,"_lowRtpTransceiver",void 0),x(this,"_hints",[]),x(this,"_isClosed",!1),x(this,"_originMediaStreamTrack",void 0),x(this,"mediaStreamTrack",void 0),x(this,"_external",{}),this._ID=n||zt(8,"track-"),this._originMediaStreamTrack=e,this.mediaStreamTrack=e,function(r){$(xc).call(xc,r)||xc.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){return e||Qs(()=>{var n;tt.reportApiInvoke(null,{name:Ne.GET_MEDIA_STREAM_TRACK,options:[],tag:ae.TRACER}).onSuccess(((n=this._mediaStreamTrack)===null||n===void 0?void 0:n.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===xd.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const n=xc.indexOf(e);n!==-1&&xc.splice(n,1)}(this),this.emit(il.CLOSED),this.removeAllListeners(Ha.SEI_RECEIVED)}_updateRtpTransceiver(e,n){if(n===xd.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Ha.TRANSCEIVER_UPDATED,e,n)}}class ad extends MV{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(e,n){super(e,n),x(this,"_enabled",!0),x(this,"_muted",!1),x(this,"_isExternalTrack",!1),x(this,"_isClosed",!1),x(this,"_enabledMutex",void 0),x(this,"processor",void 0),x(this,"_processorContext",void 0),x(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new pn("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,n;return(e=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&e!==void 0?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,m.debug("[".concat(this.getTrackId(),"] close")),this.emit(J.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wt(this,J.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){m.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(il.TRACK_ENDED)}stateCheck(e,n){if(m.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(n,"]")),Wo(n,e),this._enabled&&this._muted&&e==="enabled"&&n===!1)throw new M(R.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",m);if(!this._enabled&&!this._muted&&e==="muted"&&n===!0)throw new M(R.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",m)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():Y.resolve([])}}const Jb=window.AudioContext||window.webkitAudioContext;let fr=null;const Ut=new class extends oe{constructor(){super(...arguments),x(this,"prevState",void 0),x(this,"curState",void 0),x(this,"currentTime",void 0),x(this,"currentTimeStuckAt",void 0),x(this,"interruptDetectorTrack",void 0),x(this,"onLocalAudioTrackMute",()=>{m.info("ios15-interruption-start"),this.emit(Ye.IOS_15_16_INTERRUPTION_START)}),x(this,"onLocalAudioTrackUnmute",async()=>{m.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?m.info("ios15-interruption-end-canceled"):(fr&&await fr.suspend(),this.emit(Ye.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(t){m.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){m.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function sl(){if(!fr){if(function(){if(!Jb)return void m.error("your browser is not support web audio");m.info("create audio context");const t=te({},A("WEBAUDIO_INIT_OPTIONS"));m.debug("audio context init option:",JSON.stringify(t)),fr=new Jb(t),Ut.curState=fr.state,fr.onstatechange=()=>{Ut.prevState=Ut.curState,Ut.curState=fr?fr.state:void 0;const{prevState:e,curState:n}=Ut,r=n==="running",i=n==="interrupted",o=e==="running",s=e==="suspended",a=e==="interrupted",c=It().osVersion;(Dn()||Ri())&&o&&i&&(m.info("ios".concat(c,"-interruption-start")),Ut.emit(Ye.IOS_INTERRUPTION_START)),(Dn()||Ri())&&(s||a)&&r&&(m.info("ios".concat(c,"-interruption-end")),Ut.emit(Ye.IOS_INTERRUPTION_END)),e!==n&&Ut.emit(Ye.STATE_CHANGE,n,e)},setInterval(()=>{var e;const n=(e=fr)===null||e===void 0?void 0:e.currentTime;Ut.currentTime!==n?(Ut.currentTimeStuckAt&&(m.debug("AudioContext current time resume at ".concat(n)),Ut.currentTimeStuckAt=void 0),Ut.currentTime=n):(n!==Ut.currentTimeStuckAt&&(tt.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:ae.TRACER}).onSuccess(),m.warning("AudioContext current time stuck at ".concat(n))),Ut.currentTimeStuckAt=n)},5e3),async function(e){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,i=!1,o=!1,s=!1;function a(f){e.state==="running"?c(!1):Dn()||Ri()?e.state==="suspended"&&(c(!0),f&&e.resume().then(d,d)):e.state!=="closed"&&(c(!0),f&&e.resume().then(d,d))}function c(f){if(i!==f){i=f;for(let _=0,T=n;_<T.length;_+=1){const g=T[_];f?window.addEventListener(g,l,{capture:!0,passive:!0}):window.removeEventListener(g,l,{capture:!0,passive:!0})}}}function d(){a(!1)}function l(){a(!0)}function u(f){if(!s)if(r.paused)if(f){let _;h(!1),s=!0;try{_=r.play(),_?_.then(p,p):(r.addEventListener("playing",p),r.addEventListener("abort",p),r.addEventListener("error",p))}catch{p()}}else h(!0);else h(!1)}function h(f){if(o!==f){o=f;for(let _=0,T=n;_<T.length;_++){const g=T[_];f?window.addEventListener(g,S,{capture:!0,passive:!0}):window.removeEventListener(g,S,{capture:!0,passive:!0})}}}function p(){r.removeEventListener("playing",p),r.removeEventListener("abort",p),r.removeEventListener("error",p),s=!1,u(!1)}function S(){u(!0)}if(Dn()){const f=e.createMediaStreamDestination(),_=document.createElement("div");_.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=_.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=f.stream,u(!0)}Ut.on(Ye.STATE_CHANGE,function(){a(!0)}),a(!1)}(fr)}(),!fr)throw new M(R.NOT_SUPPORTED,"can not create audio context");return fr}return fr}function Sa(t){if(function(){if(_S!==null)return _S;const r=sl(),i=r.createBufferSource(),o=r.createGain(),s=r.createGain();i.connect(o),i.connect(s),i.disconnect(o);let a=!1;try{i.disconnect(o)}catch{a=!0}return i.disconnect(),_S=a,a}())return;const e=t.connect,n=t.disconnect;t.connect=(r,i,o)=>{var s;return t._inputNodes||(t._inputNodes=[]),$(s=t._inputNodes).call(s,r)||(r instanceof AudioNode?(t._inputNodes.push(r),e.call(t,r,i,o)):e.call(t,r,i)),t},t.disconnect=(r,i,o)=>{n.call(t),r?Pm(t._inputNodes,r):t._inputNodes=[];for(const s of t._inputNodes)e.call(t,s)}}let _S=null;function mC(t,e){let n=!1;const r=1/e;if(A("DISABLE_WEBAUDIO")){const i=window.setInterval(()=>{n?window.clearInterval(i):t(performance.now()/1e3)},1e3*r)}else{const i=sl();let o=i.createGain();o.gain.value=0,o.connect(i.destination);const s=()=>{if(n)return void(o=null);const a=i.createOscillator();a.onended=s,a.connect(o),a.start(0),a.stop(i.currentTime+r),t(i.currentTime)};s()}return()=>{n=!0}}class UV{constructor(){x(this,"context",void 0),x(this,"analyserNode",void 0),x(this,"sourceNode",void 0),this.context=sl(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=e,e==null||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Dn()||Ri()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let i=0;i<e.length;++i)e[i]=r[i]/128-1}const n=zi(e).call(e,(r,i)=>r+i*i,0)/e.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,n;(e=this.sourceNode)===null||e===void 0||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{m.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class xV extends oe{get processSourceNode(){return this.sourceNode}set processedNode(e){var n;if(!this.isDestroyed&&this._processedNode!==e){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),x(this,"outputNode",void 0),x(this,"outputTrack",void 0),x(this,"isPlayed",!1),x(this,"sourceNode",void 0),x(this,"context",void 0),x(this,"audioBufferNode",void 0),x(this,"destNode",void 0),x(this,"audioOutputLevel",0),x(this,"volumeLevelAnalyser",void 0),x(this,"_processedNode",void 0),x(this,"playNode",void 0),x(this,"isDestroyed",!1),x(this,"onNoAudioInput",void 0),x(this,"isNoAudioInput",!1),x(this,"_noAudioInputCount",0),this.context=sl(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Sa(this.outputNode),this.volumeLevelAnalyser=new UV}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(vr.ON_AUDIO_BUFFER,function(r){for(let i=0;i<r.outputBuffer.numberOfChannels;i+=1){const o=r.outputBuffer.getChannelData(i);for(let s=0;s<o.length;s+=1)o[s]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!wt().webAudioMediaStreamDest)throw new M(R.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){this.context.state!=="running"&&j_(()=>{Ut.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Dn()||Ri()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let i=!1;for(let o=0;o<r.length;o++)r[o]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Je(200),await this.checkHasAudioInput(e?e+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,n;(e=this.processedNode)===null||e===void 0||e.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?(e=this.processedNode)===null||e===void 0||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class VV extends xV{get isFreeze(){return!1}constructor(e,n,r){var i;if(super(),x(this,"sourceNode",void 0),x(this,"track",void 0),x(this,"clonedTrack",void 0),x(this,"audioElement",void 0),x(this,"isCurrentTrackCloned",!1),x(this,"isRemoteTrack",!1),x(this,"originVolumeLevelAnalyser",void 0),x(this,"rebuildWebAudio",async()=>{if(m.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void m.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>m.info("resume success")),m.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const a=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?a.stop():this.isCurrentTrackCloned=!0;const c=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(c),Sa(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const d=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(d,this.context.currentTime),Sa(this.outputNode),this.emit(vr.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=c,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),e.kind!=="audio")throw new M(R.UNEXPECTED_ERROR);this.track=e;const o=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(o),Sa(this.sourceNode),r){const a=r.clone();a.enabled=!0,this.clonedTrack=a,m.debug("create an unmuted track ".concat(a.id," from the original track ").concat(r.id," to get the volume"));const c=this.context.createMediaStreamSource(new MediaStream([a]));Sa(c),this.originVolumeLevelAnalyser=new UV,this.originVolumeLevelAnalyser.updateSource(c)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=o;const s=It();n&&s.os===Ve.IOS&&Number((i=s.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(Ut.on(Ye.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(a=>{a||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const n=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(n),Sa(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(vr.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),Ut.off("state-change",this.rebuildWebAudio),(e=this.originVolumeLevelAnalyser)===null||e===void 0||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const n=e.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),m.debug("create an unmuted track ".concat(n.id," from the original track ").concat(e.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));Sa(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function FV(t,e,n){const r=(o,s)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||s:o:s,i={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:r(e.height,1080),maxWidth:r(e.width,1920)}}};return e.frameRate&&typeof e.frameRate!="number"?(i.video.mandatory.maxFrameRate=e.frameRate.max,i.video.mandatory.minFrameRate=e.frameRate.min):typeof e.frameRate=="number"&&(i.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function WZ(t,e){const n=await jV(t.mediaSource),{sourceId:r,audio:i}=await function(o){let s=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new Y((a,c)=>{const d=document.createElement("div");d.innerText="share screen",d.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const l=document.createElement("div");l.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const u=document.createElement("div");u.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",u.setAttribute("style","height: 12%;");const h=document.createElement("div");h.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const p=document.createElement("div");p.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const S=document.createElement("button");S.innerHTML="cancel",S.setAttribute("style","width: 85px;"),S.onclick=()=>{document.body.removeChild(T);const g=new Error("NotAllowedError");g.name="NotAllowedError",c(g)};let f=s;const _=document.createElement("div");if(s){const g=document.createElement("input");g.setAttribute("type","checkbox");const y=document.createElement("span");g.setAttribute("style","margin-right: 6px;"),y.innerText="Share audio",g.checked=f,g.onchange=()=>{f=g.checked},_.appendChild(g),_.appendChild(y)}p.appendChild(_),p.appendChild(S),l.appendChild(u),l.appendChild(h),l.appendChild(p);const T=document.createElement("div");T.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),T.appendChild(d),T.appendChild(l),document.body.appendChild(T),o.map(g=>{if(g.id){const y=document.createElement("div");y.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let I=g.thumbnail;try{const{width:O}=I.getSize();O>1920&&(I=I.resize({width:1920}))}catch(O){throw O&&O.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),O}y.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+I.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+g.name.replace(/[\u00A0-\u9999<>\&]/g,function(O){return"&#"+O.charCodeAt(0)+";"})+"</span>",y.onclick=()=>{document.body.removeChild(T),a({sourceId:g.id,audio:f})},h.appendChild(y)}})})}(n,e);return await FV(r,t,i)}async function jV(t){let e=["window","screen"];t!=="application"&&t!=="window"||(e=["window"]),t==="screen"&&(e=["screen"]);const n=lV();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new M(R.ELECTRON_IS_NULL);let r=null;try{var i;r=((i=n.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch{r=null}r&&r.then||(r=new Y((o,s)=>{n.desktopCapturer.getSources({types:e},(a,c)=>{a?s(a):o(c)})}));try{return await r}catch(o){throw new M(R.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}const ey=new pn("safari");let BV=!1,GV=!1;async function Sr(t,e){let n=0,r=null;for(;n<2;)try{r=await HZ(t,e,n>0);break}catch(i){if(i instanceof M)throw m.error("[".concat(e,"] ").concat(i.toString())),i;const o=Df(i.name||i.code||i,i.message);if(o.code===R.MEDIA_OPTION_INVALID){m.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await Je(500);continue}throw m.error("[".concat(e,"] ").concat(o.toString())),o}if(!r)throw new M(R.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function HZ(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new M(R.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const r=wt(),i=new MediaStream;if(t.audioSource&&i.addTrack(t.audioSource),t.videoSource&&i.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return m.debug("Using Video Source/ Audio Source"),i;if(t.screen)if(lV())t.screen.sourceId?Nc(i,await FV(t.screen.sourceId,t.screen,t.screenAudio)):Nc(i,await WZ(t.screen,t.screenAudio));else if(Ws()&&t.screen.extensionId&&t.screen.mandatory){if(!r.getStreamFromExtension)throw new M(R.NOT_SUPPORTED,"This browser does not support screen sharing");m.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const h=await(s=t.screen.extensionId,a=e,new Y((p,S)=>{try{chrome.runtime.sendMessage(s,{getStream:!0},f=>{if(!f||!f.streamId)return m.error("[".concat(a,"] No response from Chrome Plugin. Plugin not installed properly"),f),void S(new M(R.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));p(f.streamId)})}catch(f){m.error("[".concat(a,"] AgoraRTC screensharing plugin is not accessible(").concat(s,")"),f.toString()),S(new M(R.CHROME_PLUGIN_NOT_INSTALL))}}));t.screen.mandatory.chromeMediaSourceId=h,Nc(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(r.getDisplayMedia){var o;t.screen.mediaSource&&$b(t.screen.mediaSource);const h={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:(o=t.screen.displaySurface)!==null&&o!==void 0?o:t.screen.mediaSource==="screen"?"monitor":t.screen.mediaSource},{selfBrowserSurface:p,surfaceSwitching:S,systemAudio:f}=t.screen,_={selfBrowserSurface:p,surfaceSwitching:S,systemAudio:f};!p&&delete _.selfBrowserSurface,!S&&delete _.surfaceSwitching,!f&&delete _.systemAudio,m.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:h,audio:!!t.screenAudio,controls:_})),Nc(i,await navigator.mediaDevices.getDisplayMedia(te({video:h,audio:!!t.screenAudio},_)))}else{if(!ce())throw m.error("[".concat(e,"] This browser does not support screenSharing")),new M(R.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&$b(t.screen.mediaSource);const h={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};m.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(h))),Nc(i,await navigator.mediaDevices.getUserMedia(h))}}var s,a;if(!t.video&&!t.audio)return i;let c={video:t.video,audio:t.audio},d=A("MEDIA_DEVICE_CONSTRAINTS");if(d)try{typeof d=="string"&&(d=JSON.parse(d)),c=Kv(c,d)}catch{}m.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(c)),It();let l,u=null;(an()||Dn()||Nm())&&(u=await ey.lock());try{l=await navigator.mediaDevices.getUserMedia(c)}catch(h){throw u&&u(),h}return c.audio&&(BV=!0),c.video&&(GV=!0),Nc(i,l),u&&u(),i}function Df(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new M(R.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new M(R.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new M(R.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new M(R.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new M(R.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new M(R.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return m.error("getUserMedia unexpected error",t),new M(R.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function Nc(t,e){const n=t.getVideoTracks()[0],r=t.getAudioTracks()[0],i=e.getVideoTracks()[0],o=e.getAudioTracks()[0];o&&(r&&t.removeTrack(r),t.addTrack(o)),i&&(n&&t.removeTrack(n),t.addTrack(i))}const Cr=new class extends oe{get state(){return this._state}set state(t){t!==this._state&&(this.emit(Ma.STATE_CHANGE,t),this._state=t)}constructor(){super(),x(this,"_state",Al.IDLE),x(this,"isAccessMicrophonePermission",!1),x(this,"isAccessCameraPermission",!1),x(this,"lastAccessMicrophonePermission",!1),x(this,"lastAccessCameraPermission",!1),x(this,"checkdeviceMatched",!1),x(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(A("ENUMERATE_DEVICES_INTERVAL")||(V_()||x_()===Ve.HARMONY_OS)&&Xs())&&this.updateDevicesInfo()},A("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(t=>m.error(t.toString()))}async enumerateDevices(t,e){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new M(R.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let o=!this.isAccessMicrophonePermission&&t,s=!this.isAccessCameraPermission&&e;i.audio&&(o=!1),i.video&&(s=!1);let a=null,c=null,d=null;if(!n&&(o||s)){if(ey.isLocked&&(m.debug("[device manager] wait GUM lock"),(await ey.lock())(),m.debug("[device manager] GUM unlock")),BV&&(o=!1,this.isAccessMicrophonePermission=!0),GV&&(s=!1,this.isAccessCameraPermission=!0),m.debug("[device manager] check media device permissions",t,e,o,s),o&&s){try{d=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(l){const u=Df(l.name||l.code||l,l.message);if(u.code===R.PERMISSION_DENIED)throw u;m.warning("getUserMedia failed in getDevices",u)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{a=await navigator.mediaDevices.getUserMedia({audio:t})}catch(l){const u=Df(l.name||l.code||l,l.message);if(u.code===R.PERMISSION_DENIED)throw u;m.warning("getUserMedia failed in getDevices",u)}this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({video:e})}catch(l){const u=Df(l.name||l.code||l,l.message);if(u.code===R.PERMISSION_DENIED)throw u;m.warning("getUserMedia failed in getDevices",u)}this.isAccessCameraPermission=!0}m.debug("[device manager] mic permission",t,"cam permission",e)}try{const l=await navigator.mediaDevices.enumerateDevices();return a&&a.getTracks().forEach(u=>u.stop()),c&&c.getTracks().forEach(u=>u.stop()),d&&d.getTracks().forEach(u=>u.stop()),a=null,c=null,d=null,l}catch(l){return a&&a.getTracks().forEach(u=>u.stop()),c&&c.getTracks().forEach(u=>u.stop()),d&&d.getTracks().forEach(u=>u.stop()),a=null,c=null,d=null,new M(R.ENUMERATE_DEVICES_FAILED,l.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audioinput")}async getCamerasDevices(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter(e=>e.kind==="videoinput")}async getSpeakers(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter(e=>e.kind==="audiooutput")}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach(n=>{n.device.label===t&&(e=n.device.deviceId)}),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===t);if(!e)throw new M(R.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=Al.INITING;try{await this.updateDevicesInfo(),this.state=Al.INITEND}catch(t){throw m.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=Al.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new M(R.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const i=t.find(s=>s.kind==="audioinput"&&s.deviceId==="default"),o=t.find(s=>s.kind==="audiooutput"&&s.deviceId==="default");i&&o?o.groupId===i.groupId?m.debug("[device-check] default input ".concat(i.label," and output ").concat(o.label," is the same group")):m.warning("[device-check] default input ".concat(i.label," and output ").concat(o.label," is not the same group")):m.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(t);if(t.forEach(i=>{if(!i.deviceId)return;const o=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((o?o.state:"INACTIVE")!=="ACTIVE"){const s={initAt:e,updateAt:e,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),s),n.push(s)}o&&(o.updateAt=e)}),this.deviceInfoMap.forEach((i,o)=>{i.state==="ACTIVE"&&i.updateAt!==e&&(i.state="INACTIVE",n.push(i))}),this.state!==Al.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Ma.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Ma.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Ma.PLAYOUT_DEVICE_CHANGED,i)}}),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter(i=>i.kind==="audioinput"),n=t.filter(i=>i.kind==="videoinput"),r={audio:!1,video:!1};for(const i of e)if(i.label&&i.deviceId){r.audio=!0;break}for(const i of n)if(i.label&&i.deviceId){r.video=!0;break}return r}};let ES=!1;const mr=new class extends oe{constructor(){super(...arguments),x(this,"onAutoplayFailed",void 0),x(this,"onAudioAutoplayFailed",void 0)}};function WV(){if(It(),!ES){const t=e=>{e.preventDefault(),ES=!1,$u()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};ES=!0,$u()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),m.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),mr.onAutoplayFailed?mr.onAutoplayFailed():mr.onAudioAutoplayFailed?m.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):m.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),mr.emit("autoplay-failed")}}function HV(t,e,n,r){if(!t)return;const i=tt.getBaseInfoBySessionId(t);if(!i)return;const o=i.info,s=Date.now(),a=te(te({},o),{},{vid:o.vid===void 0?0:Number(o.vid),lts:s,elapse:s-i.startTime,cbRegistered:mr.onAutoplayFailed||mr.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:r,extend:void 0});tt.send({type:re.AUTOPLAY_FAILED,data:a},!0)}const KZ=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Fn=new class{constructor(){x(this,"onAutoplayFailed",void 0),x(this,"elementMap",new Map),x(this,"elementStateMap",new Map),x(this,"elementsNeedToResume",[]),x(this,"sinkIdMap",new Map),x(this,"autoResumeAfterInterruption",t=>{Array.from(this.elementMap.entries()).forEach(e=>{let[n,r]=e;const i=this.elementStateMap.get(n),o=r.srcObject.getAudioTracks()[0],s=o&&o.readyState;if(m.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(s," ").concat(t)),s==="live"){if(t)return r.pause(),void r.play();if(Ut.curState==="running")return kd()?(r.pause(),void r.play()):void(i&&i==="paused"&&r.play())}})}),x(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(t=>{let[e,n]=t;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(m.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Ut.on(Ye.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ut.on(Ye.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Ut.on(Ye.STATE_CHANGE,()=>{Dn()&&Ut.prevState==="suspended"&&Ut.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(r){throw new M(R.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(t,e,n,r){if(this.elementMap.has(e))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,i),this.elementMap.set(e,i),this.elementStateMap.set(e,yn.INIT),this.setVolume(e,n);const o=this.sinkIdMap.get(e);if(o)try{i.setSinkId(o).catch(a=>{m.warning("[".concat(e,"] set sink id failed"),a.toString())})}catch(a){m.warning("[".concat(e,"] set sink id failed"),a.toString())}const s=i.play();s&&s.then&&s.catch(a=>{r&&HV(r,"audio",a.message,e),m.warning("audio element play warning",a.toString()),this.elementMap.has(e)&&a.name==="NotAllowedError"&&(m.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),j_(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),WV()}))})}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&this.elementStateMap.get(t)==="playing"}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){KZ.forEach(n=>{e.addEventListener(n,r=>{const i=this.elementStateMap.get(t),o=r.type==="pause"?"paused":r.type;if(m.debug("[".concat(t,"] audio-element-status change ").concat(i," => ").concat(o)),r.type==="error"){const s=e==null?void 0:e.error;s&&m.error("[".concat(t,"] media error, code: ").concat(s.code,", message: ").concat(s.message))}this.elementStateMap.set(t,o)})})}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach(e=>{e.play().then(n=>{m.debug("Auto resume audio element success")}).catch(n=>{m.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new Y(e=>{document.body?e():window.addEventListener("load",()=>e())}).then(()=>{$u()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))})}};function Ee(){return function(t,e,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new M(R.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",m);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];const a=r.apply(this,o);return a instanceof Y?new Y((c,d)=>{a.then(c).catch(d)}):a}),n}}class KV extends oe{constructor(e){super(),x(this,"name","VideoProcessorDestination"),x(this,"ID","0"),x(this,"_source",void 0),x(this,"videoContext",void 0),x(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new M(R.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new M(R.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(kn.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(kn.ON_TRACK,void 0)}}class zV extends oe{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n){super(),x(this,"constraintsMap",new Map),x(this,"statsRegistry",[]),x(this,"usageRegistry",[]),x(this,"trackId",void 0),x(this,"direction",void 0),x(this,"_chained",!1),this.trackId=e,this.direction=n}async getConstraints(){return await cn(this,Nr.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,n){var r;return m.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Wt(this,Nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(qo(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return m.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),Wt(this,Nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(qo(n=this.constraintsMap).call(n)))}registerStats(e,n,r){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:r})}unregisterStats(e,n){const r=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:r,type:i,cb:o}of this.statsRegistry)try{const s=o();e.push({processorID:n,processorName:r,type:i,stats:s})}catch(s){m.error(new M(R.UNEXPECTED_ERROR,s.message))}return e}registerUsage(e,n){this.usageRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof Y&&(r=await r),e.push(te(te({},r),{},{direction:this.direction}))}catch(r){m.error("gather extension usage error",r)}return e}getDirection(){return this.direction}}class YV extends oe{constructor(e){super(),x(this,"name","AudioProcessorDestination"),x(this,"ID","0"),x(this,"inputTrack",void 0),x(this,"inputNode",void 0),x(this,"audioProcessorContext",void 0),x(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new M(R.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new M(R.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(kn.ON_TRACK,void 0),this.emit(kn.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(kn.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(kn.ON_NODE,this.inputNode))}}class $V extends oe{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,n,r){super(),x(this,"constraintsMap",new Map),x(this,"statsRegistry",[]),x(this,"audioContext",void 0),x(this,"trackId",void 0),x(this,"direction",void 0),x(this,"usageRegistry",[]),x(this,"_chained",!1),this.audioContext=e,this.trackId=n,this.direction=r}async getConstraints(){return cn(this,Nr.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,n){var r;return m.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(n,e),Wt(this,Nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(qo(r=this.constraintsMap).call(r)))}async requestRevertConstraints(e){var n;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),Wt(this,Nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(qo(n=this.constraintsMap).call(n)))}registerStats(e,n,r){this.statsRegistry.find(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n)||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:n,cb:r})}unregisterStats(e,n){const r=this.statsRegistry.findIndex(i=>i.processorID===e.ID&&i.processorName===e.name&&i.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const e=[];for(const{processorID:n,processorName:r,type:i,cb:o}of this.statsRegistry)try{const s=o();e.push({processorID:n,processorName:r,type:i,stats:s})}catch(s){m.error(new M(R.UNEXPECTED_ERROR,s.message))}return e}registerUsage(e,n){this.usageRegistry.find(r=>r.processorID===e.ID&&r.processorName===e.name)||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:n})}unregisterUsage(e){const n=this.usageRegistry.findIndex(r=>r.processorID===e.ID&&r.processorName===e.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof Y&&(r=await r),e.push(te(te({},r),{},{direction:this.direction}))}catch(r){m.error("gather extension usage error",r)}return e}getDirection(){return this.direction}}class ny extends oe{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),x(this,"context",void 0),x(this,"processSourceNode",void 0),x(this,"outputTrack",void 0),x(this,"processedNode",void 0),x(this,"clonedTrack",void 0),x(this,"outputNode",void 0),this.outputNode=new zZ}setVolume(){}createOutputTrack(){throw new M(R.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class zZ{disconnect(){}connect(){}}function qV(t){return new Y((e,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const o=Dn()?"canplay":"playing";i.addEventListener(o,()=>{const s=i.videoWidth,a=i.videoHeight;!s&&ce()||(r=!0,i.srcObject=null,i.remove(),e([s,a]))}),i.srcObject=new MediaStream([t]),i.play().catch(B_),setTimeout(()=>{r||(i.srcObject=null,i.remove(),e([i.videoWidth,i.videoHeight]))},4e3)})}function Lm(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=_o(t.encoderConfig);return n.width!=null&&(e.width=n.width),n.height!=null&&(e.height=n.height),!aV()&&n.frameRate&&(e.frameRate=n.frameRate),eV()&&typeof e.frameRate=="object"&&(e.frameRate.max=60),ce()&&(e.frameRate={ideal:30,max:30}),e}function Xb(t){const e={};if(aV()||(t.AGC!==void 0&&(e.autoGainControl=t.AGC),t.AEC!==void 0&&(e.echoCancellation=t.AEC),t.ANS!==void 0&&(e.noiseSuppression=t.ANS,Ws()&&t.ANS&&(e.googHighpassFilter=t.ANS))),t.encoderConfig){const n=km(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),V_()&&(e.sampleRate=void 0),e}const YZ=t=>{const e=t._encoderConfig;if(!e)return;const{frameRate:n,width:r,height:i}=t.getMediaStreamTrackSettings();let{frameRate:o=n,width:s=r,height:a=i}=e;if(!o||!s||!a)return;s=jg(s),a=jg(a),o=jg(o);const{max:c,min:d}=function(p,S,f){const _=200*Math.pow(f/15,.6)*Math.pow(p*S/640/360,.75);return{min:Math.floor(_),max:Math.floor(4*_)}}(s,a,o),{bitrateMax:l,bitrateMin:u}=e||{};l||m.debug("calculate bitrate: [w: ".concat(s,", h: ").concat(a,", fps: ").concat(o,"] => [brMax: ").concat(l,", brMin: ").concat(u,"]"));const{maxFramerate:h}=A("ENCODER_CONFIG_LIMIT");return h&&typeof h=="number"&&(o=Math.min(o,h)),{frameRate:o,bitrateMax:l||c,bitrateMin:u||d,scaleResolutionDownBy:1,scale:0}},JV=async(t,e,n)=>await(async(r,i,o)=>{const s=function(d){const l=[];for(let u=0;u<d.length;u+=2)l.push(parseInt(d.slice(u,u+2),16));return Uint8Array.from(l)}(fV(""+i+o)).slice(0,16),a=s.slice(0,12),c=await window.crypto.subtle.importKey("raw",s,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:a},c,r))})(t.buffer,e,n),_C=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new Y((n,r)=>{e.toBlob(async i=>{if(e.remove(),i){const o=await XV(i);n({buffer:o,width:e.width,height:e.height})}else r(new M(R.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,1)})},XV=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)};var Qb,Zb,tN,eN,nN,rN,iN,oN,sN,aN,cN,dN,lN,uN,hN,pN,fN,mN,ee,_N,EN,gN,SN,TN,vN,ro,yN,RN,CN,IN,wN,AN,ON,bN,NN,PN,DN,kN,LN,tn;let se=(Qb=it({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),Zb=it({argsMap:(t,e)=>[t.getTrackId(),e]}),tN=Ee(),eN=Ld("LocalAudioTrack","_enabledMutex"),nN=it({argsMap:(t,e)=>[t.getTrackId(),e]}),rN=Ee(),iN=Ld("LocalAudioTrack","_enabledMutex"),oN=it({argsMap:(t,e)=>[t.getTrackId(),e]}),sN=Ee(),aN=Ee(),cN=Ee(),dN=it({argsMap:t=>[t.getTrackId()]}),lN=Ee(),uN=it({argsMap:t=>[t.getTrackId()]}),hN=Ee(),pN=it({argsMap:t=>[t.getTrackId()]}),fN=it({argsMap:(t,e)=>[t.getTrackId(),e.name]}),mN=it({argsMap:t=>[t.getTrackId()]}),Rt((ee=class extends ad{get _source(){return this.initWebAudio()}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Fn.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,r){super(t,n),x(this,"trackMediaType",ol.AUDIO),x(this,"_encoderConfig",void 0),x(this,"_trackSource",void 0),x(this,"_enabled",!0),x(this,"_volume",100),x(this,"_useAudioElement",!0),x(this,"_bypassWebAudio",!1),x(this,"processor",void 0),x(this,"_processorContext",void 0),x(this,"_processorDestination",void 0),x(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!r,this._trackSource=new ny,A("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),A("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),an()&&!fr?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(t){Vt(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&Fn.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void m.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,Wt(this,J.NEED_REPLACE_TRACK,this).then(()=>{m.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{m.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement||!DV())throw new M(R.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Fn.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(m.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Wt(this,J.NEED_ENABLE_TRACK,this),m.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(r){throw n||(this._enabled=!1),m.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Wt(this,J.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),m.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,m.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Wt(this,J.NEED_MUTE_TRACK,this):await Wt(this,J.NEED_UNMUTE_TRACK,this))}getStats(){return Qs(()=>{m.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Kr(this,J.GET_STATS)||te({},Zv)}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(vr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(vr.ON_AUDIO_BUFFER),this._source.on(vr.ON_AUDIO_BUFFER,n=>t(n))}play(){m.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(m.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Fn.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){m.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Fn.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];m.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Fn.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:t,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wt(this,J.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return Y.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new M(R.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new M(R.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(t){t.on(kn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Wt(this,J.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wt(this,J.NEED_REPLACE_TRACK,this))}),t.on(kn.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(t){t.removeAllListeners(kn.ON_TRACK),t.removeAllListeners(kn.ON_NODE)}bindProcessorContextEvents(t){t.on(Nr.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(t){t.removeAllListeners(Nr.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof ny&&(this._trackSource=new VV(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const t=new $V(this._source.context,this.getTrackId(),"local"),e=new YV(t);return this._processorContext=t,this._processorDestination=e,this.bindProcessorContextEvents(t),this.bindProcessorDestinationEvents(e),this._source.on(vr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:t})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Fn.stop(this.getTrackId()),this._source.play()),Wt(this,J.NEED_REPLACE_MIXING_TRACK,this).then(()=>{m.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(n=>{m.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),n)})),{processorContext:t,processorDestination:e}}}).prototype,"setVolume",[Qb],Object.getOwnPropertyDescriptor(ee.prototype,"setVolume"),ee.prototype),Rt(ee.prototype,"setPlaybackDevice",[Zb,tN],Object.getOwnPropertyDescriptor(ee.prototype,"setPlaybackDevice"),ee.prototype),Rt(ee.prototype,"setEnabled",[eN,nN,rN],Object.getOwnPropertyDescriptor(ee.prototype,"setEnabled"),ee.prototype),Rt(ee.prototype,"setMuted",[iN,oN,sN],Object.getOwnPropertyDescriptor(ee.prototype,"setMuted"),ee.prototype),Rt(ee.prototype,"getStats",[aN],Object.getOwnPropertyDescriptor(ee.prototype,"getStats"),ee.prototype),Rt(ee.prototype,"setAudioFrameCallback",[cN],Object.getOwnPropertyDescriptor(ee.prototype,"setAudioFrameCallback"),ee.prototype),Rt(ee.prototype,"play",[dN,lN],Object.getOwnPropertyDescriptor(ee.prototype,"play"),ee.prototype),Rt(ee.prototype,"stop",[uN,hN],Object.getOwnPropertyDescriptor(ee.prototype,"stop"),ee.prototype),Rt(ee.prototype,"close",[pN],Object.getOwnPropertyDescriptor(ee.prototype,"close"),ee.prototype),Rt(ee.prototype,"pipe",[fN],Object.getOwnPropertyDescriptor(ee.prototype,"pipe"),ee.prototype),Rt(ee.prototype,"unpipe",[mN],Object.getOwnPropertyDescriptor(ee.prototype,"unpipe"),ee.prototype),ee),Mm=(_N=it({argsMap:(t,e)=>[t.getTrackId(),e]}),EN=Ee(),gN=Ld("MicrophoneAudioTrack","_enabledMutex"),SN=it({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),TN=Ee(),vN=it({argsMap:t=>[t.getTrackId()]}),Rt((ro=class extends se{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,r){super(t,e.encoderConfig?km(e.encoderConfig):{},r,A("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),x(this,"_config",void 0),x(this,"_deviceName","default"),x(this,"_constraints",void 0),x(this,"_originalConstraints",void 0),x(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,typeof e.bypassWebAudio=="boolean"&&(this._bypassWebAudio=e.bypassWebAudio),(kd()||Gv())&&Ut.bindInterruptDetectorTrack(this)}async setDevice(t){if(m.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await Cr.getDeviceById(t),n={};n.audio=te({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let r=null;try{r=await Sr(n,this.getTrackId())}catch(i){throw m.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),r=await Sr({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw m.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const e=await Cr.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(e){throw m.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}m.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return m.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(m.info("[".concat(this.getTrackId(),"] start setEnabled"),t),A("AUTO_RESET_AUDIO_ROUTE")&&(Dn()||Ri())){const s=navigator.audioSession;s&&(t||(s.type="playback"),s.type="auto")}if(!t){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await Wt(this,J.NEED_DISABLE_TRACK,this)}catch(s){throw m.error("[".concat(this.getTrackId(),"] setEnabled false failed"),s.toString()),s}return}const i=te({},this._constraints),o=Cr.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{n||(this._enabled=!0);const s=await Sr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(s.getAudioTracks()[0],!1),await Wt(this,J.NEED_ENABLE_TRACK,this)}catch(s){throw n||(this._enabled=!1),m.error("[".concat(this.getTrackId(),"] setEnabled true failed"),s.toString()),s}m.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(kd()||Gv())&&Ut.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Dn()||Ri())&&this._enabled&&!this._isClosed&&Ut.duringInterruption){const t=async()=>{Ut.off(Ye.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(m.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ut.on(Ye.IOS_INTERRUPTION_END,t)}else m.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(il.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=Cr.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const r=await Sr({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(t){super.bindProcessorContextEvents(t),t.on(Nr.REQUEST_UPDATE_CONSTRAINTS,async(e,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}})}unbindProcessorContextEvents(t){super.unbindProcessorContextEvents(t),t.removeAllListeners(Nr.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[_N,EN],Object.getOwnPropertyDescriptor(ro.prototype,"setDevice"),ro.prototype),Rt(ro.prototype,"setEnabled",[gN,SN,TN],Object.getOwnPropertyDescriptor(ro.prototype,"setEnabled"),ro.prototype),Rt(ro.prototype,"close",[vN],Object.getOwnPropertyDescriptor(ro.prototype,"close"),ro.prototype),ro),$Z=(yN=it({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),RN=Ee(),CN=it({argsMap:t=>[t.getTrackId()]}),IN=Ee(),wN=it({argsMap:t=>[t.getTrackId()]}),AN=Ee(),ON=it({argsMap:t=>[t.getTrackId()]}),bN=Ee(),NN=it({argsMap:t=>[t.getTrackId()]}),PN=Ee(),DN=it({argsMap:t=>[t.getTrackId()]}),kN=it({argsMap:t=>[t.getTrackId()]}),LN=Ee(),Rt((tn=class extends se{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,r){super(e.createOutputTrack(),n,r),x(this,"source",void 0),x(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=t,this._bufferSource=e,this._bufferSource.on(vr.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(il.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){Vt(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}).prototype,"startProcessAudioBuffer",[yN,RN],Object.getOwnPropertyDescriptor(tn.prototype,"startProcessAudioBuffer"),tn.prototype),Rt(tn.prototype,"pauseProcessAudioBuffer",[CN,IN],Object.getOwnPropertyDescriptor(tn.prototype,"pauseProcessAudioBuffer"),tn.prototype),Rt(tn.prototype,"seekAudioBuffer",[wN,AN],Object.getOwnPropertyDescriptor(tn.prototype,"seekAudioBuffer"),tn.prototype),Rt(tn.prototype,"resumeProcessAudioBuffer",[ON,bN],Object.getOwnPropertyDescriptor(tn.prototype,"resumeProcessAudioBuffer"),tn.prototype),Rt(tn.prototype,"stopProcessAudioBuffer",[NN,PN],Object.getOwnPropertyDescriptor(tn.prototype,"stopProcessAudioBuffer"),tn.prototype),Rt(tn.prototype,"close",[DN],Object.getOwnPropertyDescriptor(tn.prototype,"close"),tn.prototype),Rt(tn.prototype,"setAudioBufferPlaybackSpeed",[kN,LN],Object.getOwnPropertyDescriptor(tn.prototype,"setAudioBufferPlaybackSpeed"),tn.prototype),tn);class be extends se{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=sl().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,zt(8,"track-mix-")),x(this,"trackList",void 0),x(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return this.trackList.indexOf(e)!==-1}addAudioTrack(e){this.trackList.indexOf(e)===-1?(m.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):m.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(this.trackList.indexOf(e)!==-1){m.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch{}Pm(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(e.stereo=!0))}),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach(n=>{n instanceof be?n.emit(Ha.TRANSCEIVER_UPDATED,e):n._updateRtpTransceiver(e)}))}}class qZ extends xV{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(vr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),x(this,"audioBuffer",void 0),x(this,"sourceNode",void 0),x(this,"startPlayTime",0),x(this,"startPlayOffset",0),x(this,"pausePlayTime",0),x(this,"options",void 0),x(this,"currentLoopCount",0),x(this,"currentPlaybackSpeed",100),x(this,"_currentState","stopped"),this.audioBuffer=e,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(e){this.currentState==="stopped"?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):m.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=e,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(e){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const MN=new Map;class EC{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){const e=this.renderStats.curTs-this.renderStats.lastTs,n=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/e;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,n}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(m.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}get videoState(){return this._videoState}set videoState(e){var n;e!==this._videoState&&(this._videoState=e,(n=this.onVideoStateChanged)===null||n===void 0||n.call(this,this.videoState))}constructor(e){x(this,"trackId",void 0),x(this,"config",void 0),x(this,"onFirstVideoFrameDecoded",void 0),x(this,"onVideoStateChanged",void 0),x(this,"freezeTimeCounterList",[]),x(this,"renderFreezeAccTime",0),x(this,"isKeepLastFrame",!1),x(this,"timeUpdatedCount",0),x(this,"freezeTime",0),x(this,"playbackTime",0),x(this,"lastTimeUpdatedTime",0),x(this,"autoplayFailed",!1),x(this,"videoTrack",void 0),x(this,"videoElement",void 0),x(this,"cacheVideoElement",void 0),x(this,"renderStats",void 0),x(this,"_videoState",no.VideoStateStopped),x(this,"videoElementCheckInterval",void 0),x(this,"videoElementFreezeTimeout",void 0),x(this,"_videoElementStatus",yn.NONE),x(this,"isGettingVideoDimensions",!1),x(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return m.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),x(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Ut.curState==="running"&&(m.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(BO())),KO()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),x(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=yn.PLAYING;break;case"loadeddata":if(this.videoState=no.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=yn.CANPLAY;break;case"stalled":this.videoElementStatus=yn.STALLED;break;case"suspend":this.videoElementStatus=yn.SUSPEND;break;case"pause":this.videoElementStatus=yn.PAUSED,Dn()||Ri()||an()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(m.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=yn.WAITING;break;case"abort":this.videoElementStatus=yn.ABORT;break;case"ended":this.videoElementStatus=yn.ENDED;break;case"emptied":this.videoElementStatus=yn.EMPTIED;break;case"error":{const r=this.videoElement.error,i=r?"".concat(r.message," (").concat(r.code,")"):"";r&&(this.videoElementStatus=yn.ERROR),m.error("[".concat(this.trackId,"] media error: ").concat(i," "));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const i=r-this.lastTimeUpdatedTime,o=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Mo.lastVisibleTime<Mo.lastHiddenTime||o<Mo.lastHiddenTime||o<Mo.lastVisibleTime)return;for(i>A("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;const s=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(s),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),x(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(m.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(BO())),KO()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),Ut.on(Ye.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ut.on(Ye.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return(e=this.videoElement.parentElement)!==null&&e!==void 0?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const n=this.videoElement.play();n&&n.catch&&n.catch(i=>{e&&HV(e,"video",i.message,this.trackId),i.name==="NotAllowedError"?(m.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):m.warning("[".concat(this.trackId,"] play warning: "),i)});const r=It();if((r.name==="Safari"&&Number(r.version)===15||kd())&&n&&n.then){const i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(i).catch(i)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const n=e.getContext("2d");if(!n)return m.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height);return e.remove(),r}async getCurrentFrameToUint8Array(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,r.width,r.height),new Y((o,s)=>{r.toBlob(async a=>{if(r.remove(),a){const c=await XV(a);o({buffer:c,width:r.width,height:r.height})}else s(new M(R.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,n<0?.1:n>1?1:n)})):await _C(e)}destroy(){this.renderStats=void 0,Ut.off(Ye.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Ut.off(Ye.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=no.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=yn.INIT,!this.videoElementCheckInterval&&(UN.forEach(o=>{this.videoElement.addEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(o){return o!==document.body&&document.body.contains(o)})(this.videoElement)||(this.videoElementStatus=yn.DESTROYED)},1e3),A("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,n;let o;const s=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",s),this.videoElementFreezeTimeout=window.setTimeout(a,A("VIDEO_FREEZE_DURATION")))},a=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===no.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=no.VideoStateFrozen:document.addEventListener("visibilitychange",s))},c=(d,l)=>{if(this.videoElementStatus===yn.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=l.mediaTime):this.renderStats={lastTs:l.mediaTime,curTs:l.mediaTime,lastRenderNum:0,renderNum:0},o){const p=l.presentationTime-o.presentationTime;this.videoState===no.VideoStateStarting&&(this.videoState=no.VideoStateDecoding),this.videoState===no.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(a,A("VIDEO_FREEZE_DURATION"))),p<A("VIDEO_FREEZE_DURATION")&&this.videoState===no.VideoStateFrozen&&(this.videoState=no.VideoStateDecoding),p>A("VIDEO_FREEZE_DURATION")&&Mo.lastVisibleTime>=Mo.lastHiddenTime&&o.timestamp>Mo.lastVisibleTime&&o.timestamp>Mo.lastHiddenTime&&(this.renderFreezeAccTime+=p)}o=te(te({},l),{},{timestamp:d})}var u,h;A("ENABLE_VIDEO_FRAME_CALLBACK")&&((u=(h=this.videoElement).requestVideoFrameCallback)===null||u===void 0||u.call(h,c))};(e=(n=this.videoElement).requestVideoFrameCallback)===null||e===void 0||e.call(n,c)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),V_()&&!A("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const r=It();r.name==="Safari"&&Number(r.version)===15||kd()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ce()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,ce()&&this.videoElement.load());const i=this.videoElement.play();i!==void 0&&i.catch(o=>{m.debug("[".concat(this.trackId,"] playback interrupted"),o.toString())})}resetVideoElement(){UN.forEach(e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=yn.NONE}handleAutoPlayFailed(){const e=n=>{n.preventDefault(),this.videoElement.play().then(()=>{m.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{m.error(r)}),this.autoplayFailed=!1,$u()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};$u()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),WV()}}const UN=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class QV extends EC{constructor(e){super(e),x(this,"container",void 0),x(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const n=e.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,r):await _C(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",A("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if((e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;(e=this.container)!==null&&e!==void 0&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var xN,VN,FN,jN,BN,GN,WN,HN,KN,zN,YN,$N,qN,JN,XN,QN,ZN,tP,eP,nP,rP,iP,oP,sP,Tt,aP,cP,dP,lP,uP,hP,pP,fP,pr;let qt=(xN=it({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),VN=Ee(),FN=it({argsMap:t=>[t.getTrackId()]}),jN=Ld("LocalVideoTrack","_enabledMutex"),BN=it({argsMap:(t,e)=>[t.getTrackId(),e]}),GN=Ee(),WN=Ld("LocalVideoTrack","_enabledMutex"),HN=it({argsMap:(t,e)=>[t.getTrackId(),e]}),KN=Ee(),zN=it({argsMap:(t,e)=>[t.getTrackId(),e]}),YN=Ee(),$N=Ee(),qN=it({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),JN=Ee(),XN=Ee(),QN=Ee(),ZN=Ee(),tP=Ee(),eP=Ee(),nP=Ee(),rP=it({argsMap:(t,e)=>[t.getTrackId(),e.name]}),iP=it({argsMap:t=>[t.getTrackId()]}),oP=it({argsMap:t=>[t.getTrackId()]}),sP=it({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),Tt=class ZV extends ad{get videoHeight(){if(an()){const{height:e}=this._mediaStreamTrack.getSettings();return this._videoHeight=e,this._videoHeight}return this._videoHeight}get videoWidth(){if(an()){const{width:e}=this._mediaStreamTrack.getSettings();return this._videoWidth=e,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==yn.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,n,r,i,o,s){if(super(e,o),x(this,"trackMediaType",ol.VIDEO),x(this,"_player",void 0),x(this,"isUseScaleResolutionDownBy",!1),x(this,"_videoVisibleTimer",null),x(this,"_previousVideoVisibleStatus",void 0),x(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),x(this,"_encoderConfig",void 0),x(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),x(this,"_optimizationMode",void 0),x(this,"_videoHeight",void 0),x(this,"_videoWidth",void 0),x(this,"_forceBitrateLimit",void 0),x(this,"_enabled",!0),x(this,"_processorDestination",void 0),x(this,"_processorContext",void 0),an()){const{width:a,height:c}=e.getSettings();this._videoWidth=a,this._videoHeight=c}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=n,this._scalabilityMode=r,this._optimizationMode=i,this._hints=s||[],this._hints.indexOf(Ht.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(a,c,d){const l=It();return!(l.name!==a||!l.osVersion)&&Number(l.version)===c}(Pt.CHROME,115)&&x_().indexOf("Windows")!==-1){const a=function(c,d){if("VideoFrame"in window&&"TransformStream"in window&&wt().supportWebRTCInsertableStream){const l=new MediaStreamTrackProcessor(c),u=new MediaStreamTrackGenerator({kind:"video"});let h,p,S=Date.now();const f=()=>{_&&(clearInterval(_),_=void 0),h&&(h.close(),h=void 0),c.stop(),p=void 0,u.removeEventListener("ended",f)};let _=window.setInterval(()=>{if(p&&h&&Date.now()-S>1e3)try{u.readyState==="live"?p.enqueue(h.clone()):f()}catch{f()}},1e3);const T=new TransformStream({transform:(g,y)=>{u.readyState==="live"?(p=y,S=Date.now(),h===void 0?(h=g,y.enqueue(g.clone())):(y.enqueue(h),h=g)):g.close()}});return u.addEventListener("ended",f),l.readable.pipeThrough(T).pipeTo(u.writable),u}}(e);a&&(m.info("local screen video track begin to inject frame"),this._mediaStreamTrack=a)}n&&this._hints.indexOf(Ht.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this._processorContext=new zV(this.getTrackId(),"local"),this._processorDestination=new KV(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const i=document.getElementById(e);i?e=i:(m.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}m.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=te(te(te({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new EC(r):this._player=new QV(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const i=this.getVideoElementVisibleStatus();this.safeEmit(il.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},A("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,m.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(m.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await Wt(this,J.NEED_DISABLE_TRACK,this)}catch(r){throw m.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void m.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Wt(this,J.NEED_ENABLE_TRACK,this)}catch(r){throw m.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}m.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,m.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Wt(this,J.NEED_MUTE_TRACK,this):await Wt(this,J.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,n){if(!this._enabled)throw new M(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=_o(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const r=Lm({encoderConfig:e});(an()||Dn()||Ri())&&(r.deviceId=void 0),m.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(i){const o=new M(R.UNEXPECTED_ERROR,i.toString());throw m.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}}this._encoderConfig=e,this._hints.indexOf(Ht.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Wt(this,J.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(m)}}getStats(){return Qs(()=>{m.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Kr(this,J.GET_STATS)||te({},ty)}async setBeautyEffect(e){m.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,n):await _C(e)}async setBitrateLimit(e){if(m.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await Wt(this,J.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(m)}}}async setOptimizationMode(e){if(e!=="motion"&&e!=="detail"&&e!=="balanced")return void m.error(R.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=e,await Wt(this,J.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(r){throw this._optimizationMode=n,m.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}m.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(e.numSpatialLayers===1&&e.numTemporalLayers!==1)return m.error(R.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=e,m.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){qV(this._originMediaStreamTrack).then(e=>{let[n,r]=e;this._videoHeight=r,this._videoWidth=n}).catch(B_)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(e){if(!this._enabled)throw new M(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");m.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(e)),e=_o(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),this._encoderConfig=e,this._hints.indexOf(Ht.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Wt(this,J.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(m)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!e||!n||!r)return;const{bitrateMax:i,bitrateMin:o}=this._encoderConfig;if(o==null||i==null){const{max:s,min:a}=function(c,d,l,u,h){const p=A("BITRATE_ADAPTER_TYPE");if(p==="DEFAULT_BITRATE")return{min:u,max:h};if(h===void 0){var S;const _=Math.floor(200*Math.pow(l/15,.6)*Math.pow(c*d/640/360,.75));h=p==="STANDARD_BITRATE"?4*_:2*_,u=(S=u)!==null&&S!==void 0?S:_}else{var f;u=(f=u)!==null&&f!==void 0?f:Math.floor(h/10)}return{min:u,max:h}}(e,n,r,o,i);this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=s,m.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(s,", brMin: ").concat(a,"]"))}}getVideoElementVisibleStatus(){try{var e,n;const r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),i={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:o,slot:s}=i;if(this.isPlaying&&o instanceof HTMLVideoElement&&s instanceof HTMLElement){const a=dV.checkOneElementVisible(o),c=Object.assign({},a);if(c.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=c.visible;const d=tt.reportApiInvoke(null,{tag:ae.TRACER,name:Ne.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});c.visible?d.onSuccess("Video is visible"):d.onSuccess("Invisible because of ".concat(c.reason))}return c}return}catch(r){throw new M(R.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new M(R.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;e&&(r=te(te({},r),_o(e))),r=ka(r);const i=zt(8,"track-video-cloned-"),o=new ZV(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,r,ka(this._scalabilityMode),this._optimizationMode,i,ka(this._hints));return e&&r&&o.setEncoderConfiguration(r),m.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}async replaceTrack(e,n){if(!(e instanceof MediaStreamTrack))throw new M(R.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(e.kind!=="video")throw new M(R.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,n,!0),this.updateMediaStreamTrackResolution()}sendSeiData(e){if(Qs(()=>{tt.reportApiInvoke(null,{name:Ne.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:ae.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!A("ENABLE_VIDEO_SEI")||!A("ENABLE_ENCODED_TRANSFORM"))return void m.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(e instanceof Uint8Array==0)return new M(R.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const n=this.getRTCRtpTransceiver();if(!n)return void m.warning("Video track is not published, SEI can not be send");const r=n.sender.getParameters();if(r.codecs.length===0)return;const i=r.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"?this.safeEmit("sei-to-send",e):m.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(kn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await Wt(this,J.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Wt(this,J.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(kn.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(Nr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(Nr.REQUEST_CONSTRAINTS)}},Rt(Tt.prototype,"play",[xN,VN],Object.getOwnPropertyDescriptor(Tt.prototype,"play"),Tt.prototype),Rt(Tt.prototype,"stop",[FN],Object.getOwnPropertyDescriptor(Tt.prototype,"stop"),Tt.prototype),Rt(Tt.prototype,"setEnabled",[jN,BN,GN],Object.getOwnPropertyDescriptor(Tt.prototype,"setEnabled"),Tt.prototype),Rt(Tt.prototype,"setMuted",[WN,HN,KN],Object.getOwnPropertyDescriptor(Tt.prototype,"setMuted"),Tt.prototype),Rt(Tt.prototype,"setEncoderConfiguration",[zN,YN],Object.getOwnPropertyDescriptor(Tt.prototype,"setEncoderConfiguration"),Tt.prototype),Rt(Tt.prototype,"getStats",[$N],Object.getOwnPropertyDescriptor(Tt.prototype,"getStats"),Tt.prototype),Rt(Tt.prototype,"setBeautyEffect",[qN,JN],Object.getOwnPropertyDescriptor(Tt.prototype,"setBeautyEffect"),Tt.prototype),Rt(Tt.prototype,"getCurrentFrameData",[XN],Object.getOwnPropertyDescriptor(Tt.prototype,"getCurrentFrameData"),Tt.prototype),Rt(Tt.prototype,"getCurrentFrameImage",[QN],Object.getOwnPropertyDescriptor(Tt.prototype,"getCurrentFrameImage"),Tt.prototype),Rt(Tt.prototype,"setBitrateLimit",[ZN],Object.getOwnPropertyDescriptor(Tt.prototype,"setBitrateLimit"),Tt.prototype),Rt(Tt.prototype,"setOptimizationMode",[tP],Object.getOwnPropertyDescriptor(Tt.prototype,"setOptimizationMode"),Tt.prototype),Rt(Tt.prototype,"setScalabiltyMode",[eP],Object.getOwnPropertyDescriptor(Tt.prototype,"setScalabiltyMode"),Tt.prototype),Rt(Tt.prototype,"updateMediaStreamTrackResolution",[nP],Object.getOwnPropertyDescriptor(Tt.prototype,"updateMediaStreamTrackResolution"),Tt.prototype),Rt(Tt.prototype,"pipe",[rP],Object.getOwnPropertyDescriptor(Tt.prototype,"pipe"),Tt.prototype),Rt(Tt.prototype,"unpipe",[iP],Object.getOwnPropertyDescriptor(Tt.prototype,"unpipe"),Tt.prototype),Rt(Tt.prototype,"close",[oP],Object.getOwnPropertyDescriptor(Tt.prototype,"close"),Tt.prototype),Rt(Tt.prototype,"replaceTrack",[sP],Object.getOwnPropertyDescriptor(Tt.prototype,"replaceTrack"),Tt.prototype),Tt),ry=(aP=it({argsMap:(t,e)=>[t.getTrackId(),e]}),cP=Ee(),dP=Ld("CameraVideoTrack","_enabledMutex"),lP=it({argsMap:(t,e)=>[t.getTrackId(),e]}),uP=Ee(),hP=it({argsMap:(t,e)=>[t.getTrackId(),e]}),pP=Ee(),fP=it({argsMap:t=>[t.getTrackId()]}),pr=class tF extends qt{get __className__(){return"CameraVideoTrack"}constructor(e,n,r,i,o,s){super(e,_o(n.encoderConfig),i,o,s),x(this,"_config",void 0),x(this,"_originalConstraints",void 0),x(this,"_constraints",void 0),x(this,"_enabled",!0),x(this,"_deviceName","default"),x(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(kd()||Gv())&&!function(){const a=It();if(a.os!==Ve.IOS||!a.osVersion)return!1;const c=a.osVersion.split(".");return Number(c[0])===15&&Number(c[1])>=2}()&&sV()&&this._enabled&&!this._isClosed&&(m.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=n,this._originalConstraints=r,this._constraints=r,this._deviceName=e.label,this._encoderConfig=_o(this._config.encoderConfig),Ut.on(Ye.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ut.on(Ye.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){return typeof e=="string"?this._setDeviceById(e):e.deviceId?this._setDeviceById(e.deviceId):e.facingMode?this._setDeviceByFacingModel(e.facingMode):void 0}async _setDeviceById(e){if(m.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const n=await Cr.getDeviceById(e),r={};r.video=te({},this._constraints),r.video.deviceId={exact:e},r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Sr(r,this.getTrackId())}catch(o){throw m.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await Sr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw m.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}else try{const n=await Cr.getDeviceById(e);this._deviceName=n.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(n){throw m.error("[".concat(this.getTrackId(),"] setDevice error"),n.toString()),n}m.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(e){m.info("[".concat(this.getTrackId(),"] set facingMode ").concat(e));const n={video:te(te({},this._constraints),{},{deviceId:void 0,facingMode:{exact:e}})};if(this._enabled){this._originMediaStreamTrack.stop();let r=null;try{r=await Sr(n,this.getTrackId())}catch(i){throw m.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),r=await Sr({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=e,this._config.cameraId=void 0,this._constraints=te({},n.video),m.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(e,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(m.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const r=await Sr({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1)}await Wt(this,J.NEED_ENABLE_TRACK,this)}catch(r){throw m.error("[".concat(this.getTrackId(),"] setEnabled true error"),r.toString()),r}this.updateMediaStreamTrackResolution(),m.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),n||(this._enabled=!1);try{await Wt(this,J.NEED_DISABLE_TRACK,this)}catch(r){throw m.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}m.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,n){if(!this._enabled)throw new M(R.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=_o(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate||e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate||e.bitrateMin);const r=Se(this._config);r.encoderConfig=e;const i=Lm(r);(an()||Dn()||Ri())&&(i.deviceId=void 0),m.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){const s=new M(R.UNEXPECTED_ERROR,o.toString());throw m.error("[".concat(this.getTrackId(),"] applyConstraints error"),s.toString()),s}this._config=r,this._constraints=i,this._originalConstraints=i,this._encoderConfig=e,this._hints.indexOf(Ht.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Wt(this,J.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(m)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Dn()||Ri())&&this._enabled&&!this._isClosed&&Ut.duringInterruption){const e=async()=>{Ut.off(Ye.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(m.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Ut.on(Ye.IOS_INTERRUPTION_END,e)}else m.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(il.TRACK_ENDED)}async renewMediaStreamTrack(e){const n=e||this._constraints,r=Cr.searchDeviceIdByName(this._deviceName);if(r&&!n.deviceId&&(n.deviceId={exact:r}),this._enabled){const i=await Sr({video:n},this.getTrackId());this._constraints=n,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Ut.off(Ye.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Ut.off(Ye.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(e){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],r=this._encoderConfig;e&&(r=te(te({},r),_o(e))),r=ka(r);const i=zt(8,"track-cam-cloned-"),o=new tF(n?this._mediaStreamTrack.clone():this._mediaStreamTrack,ka(te(te({},this._config),{},{encoderConfig:r})),ka(this._constraints),ka(this._scalabilityMode),this._optimizationMode,i);return e&&r&&o.setEncoderConfiguration(r),m.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(n)),o}bindProcessorContextEvents(){this.processorContext.on(Nr.REQUEST_UPDATE_CONSTRAINTS,async(e,n,r)=>{try{const i=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(i),n()}catch(i){r(i)}}),this.processorContext.on(Nr.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}},Rt(pr.prototype,"setDevice",[aP,cP],Object.getOwnPropertyDescriptor(pr.prototype,"setDevice"),pr.prototype),Rt(pr.prototype,"setEnabled",[dP,lP,uP],Object.getOwnPropertyDescriptor(pr.prototype,"setEnabled"),pr.prototype),Rt(pr.prototype,"setEncoderConfiguration",[hP,pP],Object.getOwnPropertyDescriptor(pr.prototype,"setEncoderConfiguration"),pr.prototype),Rt(pr.prototype,"close",[fP],Object.getOwnPropertyDescriptor(pr.prototype,"close"),pr.prototype),pr);function gS(t,e,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=te(te({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?m.debug("[".concat(t,"] set content hint to"),n.optimizationMode):m.debug("[".concat(t,"] set content hint failed")))):m.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}var mP,_P,EP,gP,kr,SP,TP,vP,yP,RP,CP,Sn;class eF extends MV{getUserId(){return this._userId}constructor(e,n,r,i){super(e,"track-".concat(e.kind,"-").concat(n,"-").concat(i.clientId,"_").concat(zt(5,""))),x(this,"_userId",void 0),x(this,"_uintId",void 0),x(this,"_isDestroyed",!1),x(this,"store",void 0),x(this,"processor",void 0),x(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=i}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,m.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Sd=(mP=it({argsMap:(t,e,n)=>[t.getTrackId(),typeof e=="string"?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),_P=it({argsMap:t=>[t.getTrackId()]}),EP=it({argsMap:(t,e)=>[t.getTrackId(),e.name]}),gP=it({argsMap:t=>[t.getTrackId()]}),Rt((kr=class extends eF{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==yn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,r){super(t,e,n,r),x(this,"_videoVisibleTimer",null),x(this,"_previousVideoVisibleStatus",void 0),x(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),x(this,"trackMediaType",ol.VIDEO),x(this,"_videoWidth",void 0),x(this,"_videoHeight",void 0),x(this,"_player",void 0),x(this,"processorDestination",void 0),x(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new zV(this.getTrackId(),"remote"),this.processorDestination=new KV(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Qs(()=>{m.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Kr(this,J.GET_STATS)||te({},LV)}play(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const r=document.getElementById(t);r?t=r:(m.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}m.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=te(te({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new EC(n):this._player=new QV(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(gd.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=r=>{this.safeEmit(gd.VIDEO_STATE_CHANGED,r)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(gd.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},A("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,m.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){qV(this._originMediaStreamTrack).then(t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e}).catch(B_)}_updatePlayerSource(){m.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),r={track:this,element:this==null||(e=this._player)===null||e===void 0?void 0:e.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const s=dV.checkOneElementVisible(i),a=Object.assign({},s);if(a.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=a.visible;const c=tt.reportApiInvoke(null,{tag:ae.TRACER,name:Ne.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});a.visible?c.onSuccess("Video is visible"):c.onSuccess("Invisible because of ".concat(a.reason))}return a}return}catch(n){throw new M(R.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new M(R.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(kn.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(kn.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(t){this.emit(Ha.SEI_RECEIVED,t)}}).prototype,"play",[mP],Object.getOwnPropertyDescriptor(kr.prototype,"play"),kr.prototype),Rt(kr.prototype,"stop",[_P],Object.getOwnPropertyDescriptor(kr.prototype,"stop"),kr.prototype),Rt(kr.prototype,"pipe",[EP],Object.getOwnPropertyDescriptor(kr.prototype,"pipe"),kr.prototype),Rt(kr.prototype,"unpipe",[gP],Object.getOwnPropertyDescriptor(kr.prototype,"unpipe"),kr.prototype),kr),Td=(SP=it({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),TP=it({argsMap:(t,e)=>[t.getTrackId(),e]}),vP=it({argsMap:t=>[t.getTrackId()]}),yP=it({argsMap:t=>[t.getTrackId()]}),RP=it({argsMap:(t,e)=>[t.getTrackId(),e.name]}),CP=it({argsMap:t=>[t.getTrackId()]}),Rt((Sn=class extends eF{get isPlaying(){return this._useAudioElement?Fn.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,r){super(t,e,n,r),x(this,"trackMediaType",ol.AUDIO),x(this,"_source",void 0),x(this,"_useAudioElement",!0),x(this,"_volume",100),x(this,"processorContext",void 0),x(this,"processorDestination",void 0),x(this,"_played",!1),x(this,"_bypassWebAudio",!1),A("DISABLE_WEBAUDIO")?(this._source=new ny,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new VV(t,!0),A("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(vr.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(gd.FIRST_FRAME_DECODED)}),this.processorContext=new $V(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new YV(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(vr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!t)return this._source.removeAllListeners(vr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(vr.ON_AUDIO_BUFFER),this._source.on(vr.ON_AUDIO_BUFFER,n=>t(n))}setVolume(t){this._volume=t,this._useAudioElement?Fn.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement||!DV())throw new M(R.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Fn.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Qs(()=>{m.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Kr(this,J.GET_STATS)||te({},kV)}play(){m.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(m.debug("[".concat(this.getTrackId(),"] use audio element to play")),Fn.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){m.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Fn.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];m.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Fn.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new M(R.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new M(R.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new M(R.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;(t=this._source.processSourceNode)===null||t===void 0||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(kn.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(kn.ON_NODE,t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(kn.ON_TRACK),this.processorDestination.removeAllListeners(kn.ON_NODE)}}).prototype,"setVolume",[SP],Object.getOwnPropertyDescriptor(Sn.prototype,"setVolume"),Sn.prototype),Rt(Sn.prototype,"setPlaybackDevice",[TP],Object.getOwnPropertyDescriptor(Sn.prototype,"setPlaybackDevice"),Sn.prototype),Rt(Sn.prototype,"play",[vP],Object.getOwnPropertyDescriptor(Sn.prototype,"play"),Sn.prototype),Rt(Sn.prototype,"stop",[yP],Object.getOwnPropertyDescriptor(Sn.prototype,"stop"),Sn.prototype),Rt(Sn.prototype,"pipe",[RP],Object.getOwnPropertyDescriptor(Sn.prototype,"pipe"),Sn.prototype),Rt(Sn.prototype,"unpipe",[CP],Object.getOwnPropertyDescriptor(Sn.prototype,"unpipe"),Sn.prototype),Sn);const Mo=new class extends oe{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),x(this,"_lastHiddenTime",0),x(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),m.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class nF extends oe{constructor(e,n){super(),x(this,"trackMediaType",ol.DATA),x(this,"_version",1),x(this,"_type",3),x(this,"_config",void 0),x(this,"_originDataChannel",void 0),x(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),x(this,"_dataStreamPacketHandler",{serialize:r=>r,deserialize:r=>r}),x(this,"_datachannelEventMap",new Map),this._config=e,n&&(this._originDataChannel=n,this._bandDataChannelEvents(n)),this._initPacketHeader()}useDataStream(e){this._dataStreamPacketHandler=e}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return A("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.readyState)!==null&&e!==void 0?e:"connecting"}get _originDataChannelId(){var e,n;return(e=(n=this._originDataChannel)===null||n===void 0?void 0:n.id)!==null&&e!==void 0?e:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new Y((e,n)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&e();const r=setTimeout(()=>{var i;n(new M(R.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(r),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),e()},this._originDataChannel.onerror=()=>{throw clearTimeout(r),new M(R.DATACHANNEL_CONNECTION_TIMEOUT)}}else n(new M(R.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(e){this._originDataChannel=e,this._bandDataChannelEvents(e)}_initPacketHeader(){const e=new DataView(this._dataStreamPacketHeader);e.setUint16(0,this._version),e.setUint8(2,this._type),e.setUint8(3,this._config.id)}_bandDataChannelEvents(e){this._unbindDataChannelEvents(e),[Pf.OPEN,Pf.CLOSE,Pf.ERROR].forEach(n=>{const r=()=>{this.emit(n)};this._datachannelEventMap.set(n,r),e.addEventListener(n,r)})}_unbindDataChannelEvents(e){Array.from(this._datachannelEventMap.entries()).forEach(n=>{let[r,i]=n;e.removeEventListener(r,i)}),this._datachannelEventMap.clear()}}class JZ extends nF{constructor(e){super(e),x(this,"_messageListener",void 0),this._messageListener=n=>{if(n.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const r=n.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(r).getUint8(3);if(i!==this.id)return void(A("SHOW_DATASTREAM2_LOG")&&m.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let o=n.data.slice(this._dataStreamPacketHeader.byteLength);o=this._dataStreamPacketHandler.deserialize(o),this.emit(Pf.MESSAGE,o)}}_updateOriginDataChannel(e){super._updateOriginDataChannel(e),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class XZ extends nF{send(e){if(this._originDataChannel){let n=e;n=this._dataStreamPacketHandler.serialize(e);const r=new Uint8Array(this._dataStreamPacketHeader.byteLength+n.byteLength);r.set(new Uint8Array(this._dataStreamPacketHeader),0),r.set(new Uint8Array(n),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(r.buffer)}}}function kf(){const t=new Blob([atob("ZnVuY3Rpb24gZShlLHQsbil7bGV0IHI9bmV3IFVpbnQ4QXJyYXkoZSx0LG4pLGE9W10sbz0wO2Zvcig7YS5sZW5ndGg8bjspbyszPG4mJjA9PT1yW29dJiYwPT09cltvKzFdJiYzPT09cltvKzJdJiYoMD09PXJbbyszXXx8MT09PXJbbyszXXx8Mj09PXJbbyszXXx8Mz09PXJbbyszXSk/KGEucHVzaChyW29dLHJbbysxXSxyW28rM10pLG8rPTQpOihhLnB1c2gocltvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYSl9ZnVuY3Rpb24gdChlLHQpe2NvbnN0IG49ZnVuY3Rpb24oZSl7Y29uc3QgdD1lLmxlbmd0aDtsZXQgbj1bXSxyPTA7Zm9yKDtyPHQ7KXIrMjx0JiYwPT09ZVtyXSYmMD09PWVbcisxXSYmKDA9PT1lW3IrMl18fDE9PT1lW3IrMl18fDI9PT1lW3IrMl18fDM9PT1lW3IrMl0pPyhuLnB1c2goZVtyXSxlW3IrMV0sMyxlW3IrMl0pLHIrPTMpOihuLnB1c2goZVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KHQpLHI9bi5sZW5ndGgsYT1NYXRoLmZsb29yKHIvMjU1KSxvPXIlMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNithKzErcitlLmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8YTspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1vLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkoZSksNitpK3IpLHMuYnVmZmVyfW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIik+LTEmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKHNlbGYub25ydGN0cmFuc2Zvcm09bj0+e2NvbnN0IHI9bi50cmFuc2Zvcm1lcjtsZXQgYT1bXTtyLm9wdGlvbnMucG9ydC5vbm1lc3NhZ2U9ZT0+e2UuZGF0YS5zZWkmJmEucHVzaChlLmRhdGEuc2VpKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IG89ci5yZWFkYWJsZS5nZXRSZWFkZXIoKSxzPXIud3JpdGFibGUuZ2V0V3JpdGVyKCk7InJ4Ij09PXIub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgdD1mdW5jdGlvbih0KXtjb25zdCBuPW5ldyBEYXRhVmlldyh0LmRhdGEpO2xldCByPTA7Zm9yKDtyKzQ8dC5kYXRhLmJ5dGVMZW5ndGg7KXtpZigwPT09bi5nZXRVaW50OChyKzApJiYwPT09bi5nZXRVaW50OChyKzEpJiYwPT09bi5nZXRVaW50OChyKzIpJiYxPT09bi5nZXRVaW50OChyKzMpJiY2PT09bi5nZXRVaW50OChyKzQpKXtsZXQgYT1yKzYsbz0wLHM9MDtmb3IoOzI1NT09PShzPW4uZ2V0VWludDgoYSsrKSk7KW8rPTI1NTtvKz1zO2NvbnN0IGk9ZSh0LmRhdGEsYSxvKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaSl9cisrfXJldHVybiBudWxsfShyLnZhbHVlKTt0JiZuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7c2VpOnR9KX1zLndyaXRlKHIudmFsdWUpLG4ub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQobil9fSkpfShyKToidHgiPT09ci5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIGUobil7by5yZWFkKCkudGhlbigocj0+e2lmKCFyLmRvbmUpe2lmKHIudmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkVmlkZW9GcmFtZSl7Y29uc3QgZT1hLnNoaWZ0KCk7ZSYmKHIudmFsdWUuZGF0YT10KHIudmFsdWUuZGF0YSxlKSl9cy53cml0ZShyLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0ocil9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKSk7Cg==")],{type:"text/javascript"});return setTimeout(()=>zb.revokeObjectURL(t),0),new Worker(zb.createObjectURL(t))}const Dp=new Map,kp=new Map;function QZ(t,e,n){let r=new Uint8Array(t,e,n),i=[],o=0;for(;i.length<n;)o+3<n&&r[o]===0&&r[o+1]===0&&r[o+2]===3&&(r[o+3]===0||r[o+3]===1||r[o+3]===2||r[o+3]===3)?(i.push(r[o],r[o+1],r[o+3]),o+=4):(i.push(r[o]),o++);return new Uint8Array(i)}const Lp=new Map;async function ZZ(t,e){if(!wt().supportWebRTCEncodedTransform)return void m.warning("browser not support video encoded transform");if(Lp.has(t)||!t.track)return;const n={track:t.track};if(Ws()){if(!t.createEncodedStreams)return void m.warning("browser not support createEncodedStreams() API");let i=null;try{i=t.createEncodedStreams()}catch(a){return void m.error("create video-encoded-streams error",a&&a.message)}let o=[];e.on("sei-to-send",a=>{o.push(a)});const s=new TransformStream({transform(a,c){n.controller||(n.controller=c),t.track&&t.track.id!==n.track.id&&(m.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",r),n.track=t.track,n.track.addEventListener("ended",r));const d=o.shift();d&&(a.data=function(l,u){const h=function(g){const y=g.length;let I=[],O=0;for(;O<y;)O+2<y&&g[O]===0&&g[O+1]===0&&(g[O+2]===0||g[O+2]===1||g[O+2]===2||g[O+2]===3)?(I.push(g[O],g[O+1],3,g[O+2]),O+=3):(I.push(g[O]),O++);return new Uint8Array(I)}(u),p=h.length,S=Math.floor(p/255),f=p%255,_=new Uint8Array(6+S+1+p+l.byteLength);_[0]=0,_[1]=0,_[2]=0,_[3]=1,_[4]=6,_[5]=101;let T=0;for(;T<S;)_[6+T]=255,T++;return _[6+T]=f,T++,_.set(h,6+T),_.set(new Uint8Array(l),6+T+p),_.buffer}(a.data,d)),c.enqueue(a)}});i.readable.pipeThrough(s).pipeTo(i.writable)}else{if(!an())return;{if(typeof RTCRtpScriptTransform>"u")return void m.warning("browser not support RTCRtpScriptTransform");const i=kf(),o=new MessageChannel;await new Y(a=>i.onmessage=c=>{c.data==="registered"&&a(void 0)});const s=new RTCRtpScriptTransform(i,{name:"tx",port:o.port2},[o.port2]);t.transform=s,await new Y(a=>i.onmessage=c=>{c.data==="started"&&a(void 0)}),e.on("sei-to-send",a=>{o.port1.postMessage({sei:a})}),o.port1.onmessage=a=>{var c;a.data.transformed&&t.track&&((c=t.track)===null||c===void 0?void 0:c.id)!==n.track.id&&(m.debug("video track changed: ".concat(n.track.id," => ").concat(t.track.id)),n.track.removeEventListener("ended",r),n.track=t.track,n.track.addEventListener("ended",r))},n.worker=i}}function r(){if(t.track){if(this.id!==t.track.id)return;t.track.removeEventListener("ended",r)}const i=Lp.get(t);if(i){Lp.delete(t);try{var o,s;(o=i.controller)===null||o===void 0||o.terminate(),(s=i.worker)===null||s===void 0||s.terminate()}catch(a){m.warning(a&&a.message)}}}Lp.set(t,n),t.track.addEventListener("ended",r)}const Ol=new Map;(function(){const t=It();We.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),We.getStreamFromExtension=t.name===Pt.CHROME&&Number(t.version)>34,We.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let n=!1;try{e.addTransceiver("audio"),n=!0}catch{}return e.close(),n}(),We.supportMinBitrate=t.name===Pt.CHROME||t.name===Pt.EDGE,We.supportSetRtpSenderParameters=function(){const e=It();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Xs()||!(!an()&&!Nm())||e.name===Pt.FIREFOX&&Number(e.version)>=64)}(),t.name===Pt.SAFARI&&(Number(t.version)>=14?We.supportDualStream=!0:We.supportDualStream=!1),We.webAudioMediaStreamDest=function(){const e=It();return!(e.name===Pt.SAFARI&&Number(e.version)<12)}(),We.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",We.supportWebGL=typeof WebGLRenderingContext<"u",We.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Xs()||(We.webAudioWithAEC=!0),We.supportShareAudio=function(){const e=It();return(e.os===Ve.WIN_10||e.os===Ve.WIN_81||e.os===Ve.WIN_7||e.os===Ve.LINUX||e.os===Ve.MAC_OS||e.os===Ve.CHROMIUM_OS)&&e.name===Pt.CHROME&&Number(e.version)>=74}(),We.supportDataChannel=!!(Bv(76)||function(e){const n=It();return!(n.name!==Pt.FIREFOX||!n.osVersion)&&Number(n.version)>=e}(68)||rV(14)),We.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!ce()&&!!e&&e.prototype.setConfiguration instanceof Function}(),We.supportWebRTCEncodedTransform=function(){const e=It();return e.name==="Chrome"&&Number(e.version)>=86||e.name==="Safari"&&Number(e.version)>=15}(),We.supportWebRTCInsertableStream=function(){const e=It();return(e.name===Pt.CHROME||e.name===Pt.EDGE)&&Number(e.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),We.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,We.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,j_(()=>{We.supportDualStreamEncoding=function(){const e=It();return!!A("DISABLE_WEBAUDIO")||e.name==="Safari"&&Number(e.version)>=14||!!(e.name==="Chrome"&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&A("CHROME_DUAL_STREAM_USE_ENCODING"))}(),m.info("browser compatibility",JSON.stringify(We),JSON.stringify(t))})})();class rc extends oe{constructor(e,n){super(),v(this,"signal",void 0),v(this,"token",void 0),v(this,"tokenTimeout",void 0),v(this,"tokenInterval",void 0),v(this,"_sequence",0),v(this,"userMap",new Map),v(this,"encoder",new TextEncoder),this.signal=e,this.token=n;const r=()=>{this.signal.connectionState===Kt.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(r,1e3):this.tokenInterval=window.setTimeout(r,3*A("P2P_TOKEN_INTERVAL"))};r()}async send(e,n,r,i,o){var s,a,c;if(this.userMap.size===0)return;const d=Array.from(qo(s=this.userMap).call(s))[0].token;typeof n!="string"&&(n=JSON.stringify(n)),i=(a=i)!==null&&a!==void 0?a:zt(6,""),o=(c=o)!==null&&c!==void 0?c:this._sequence++;const l={_id:i,_type:e,_seq:o,_message:n,token:"".concat(this.token,"_").concat(d)};A("SHOW_P2P_LOG")&&m.debug("send message",l,"noNeedResponse : ".concat(r)),this.splitMessage(JSON.stringify(l)).forEach(h=>{this.signal.request(st.DATA_STREAM,{payload:Hs(this.encoder.encode(h))})});const u=new Y((h,p)=>{const S=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),f),this.off("res-@".concat(i),T),this.off(Cc.ABORT,_),m.debug("[external-signal] request timeout, type: ".concat(e,", requestId: ").concat(i)),this.userMap.size===0?p(new M(R.INVALID_REMOTE_USER)):p(new M(R.TIMEOUT))},A("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),f=()=>{S&&window.clearTimeout(S),this.off(Cc.ABORT,_),r&&h()},_=()=>{S&&window.clearTimeout(S),this.off("res-@".concat(i,"_ack"),f),this.off("res-@".concat(i),T),p(new M(R.EXTERNAL_SIGNAL_ABORT,"type: ".concat(e,", requestId: ").concat(i)))};this.once(Cc.ABORT,_),this.once("res-@".concat(i,"_ack"),f);const T=(y,I)=>{g=!0,S&&window.clearTimeout(S),this.off("res-@".concat(i,"_ack"),f),this.off(Cc.ABORT,_),y==="success"?h(I):p(new M(R.P2P_MESSAGE_FAILED,"request ".concat(e," failed, requestId: ").concat(i)))};let g=!1;r||(this.once("res-@".concat(i),T),Je(A("SIGNAL_REQUEST_TIMEOUT")).then(()=>{g||m.warning("external_signal request timeout, type: ".concat(e,", requestId: ").concat(i,", ").concat(l))}))});try{return await u}catch(h){if(h.code===R.TIMEOUT)return await this.send(e,n,r,i,o);throw h}}onMessage(e){var n;const{_uid:r}=e;let i,o=this.userMap.get(r);if(o)i=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in e)||e._type!==me.CHECK)return;const{token:d}=e;i=new Map,o={uid:r,isStart:!0,token:d,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(r,o),this.signal.emit(Et.ON_USER_ONLINE,{uid:r}),this.handleUserOnline()}if("id"in e&&"total"in e){var s;const{id:d,total:l}=e,u=(s=i.get(d))!==null&&s!==void 0?s:[];if(u.push(e),i.has(d)||i.set(d,u),u.length!==l)return;{const h=Ph(u).call(u,(p,S)=>p.index-S.index).map(p=>p.payload).join("");i.delete(d),(e=JSON.parse(h))._uid=r}}const{_type:a,token:c}=e;if($(n=[me.ACK,me.CHECK]).call(n,a))return a===me.CHECK&&this.handleCheckToken(o,c),void this.receiveMessage(e);c==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(e):m.debug('Receive unexpected message", '.concat(c,", cur_token: ").concat(o.token,"_").concat(this.token),e)}check(){const e={_id:zt(6,""),token:this.token,_type:me.CHECK};A("SHOW_P2P_LOG")&&m.debug("send message",e),this.signal.request(st.DATA_STREAM,{payload:Hs(this.encoder.encode(JSON.stringify(e)))})}ack(e){const n={_id:e,_type:me.ACK,token:this.token};A("SHOW_P2P_LOG")&&m.debug("send message",n),this.signal.request(st.DATA_STREAM,{payload:Hs(this.encoder.encode(JSON.stringify(n)))})}response(e,n,r){this.send(me.RESPONSE,JSON.stringify({success:!r,message:n}),!0,e)}handleReceivedMessage(e){const n=()=>{this.userMap.forEach(d=>{const{receivedMessagesMap:l,nextExpectedSequenceNumber:u}=d;for(;l.has(u);){const h=l.get(u);l.delete(u),this.receiveMessage(h),d.nextExpectedSequenceNumber++}})};if(!e)return void n();const{_uid:r,_seq:i}=e,o=this.userMap.get(r),{receivedMessagesMap:s,isStart:a,nextExpectedSequenceNumber:c}=o;if(i<c)return this.ack(e._id),void m.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(e._message));s.set(i,e),a&&i===c&&(this.receiveMessage(e),s.delete(c),o.nextExpectedSequenceNumber++,n())}receiveMessage(e){const{_id:n,_type:r,_message:i,_uid:o}=e;if(A("SHOW_P2P_LOG")&&m.debug("receive message",e),n){let s;switch(e._type!==me.ACK&&(i&&(s=JSON.parse(i)),this.ack(e._id)),e._type){case me.CANDIDATE:case me.CONTROL:this.signal.emit(r,s,o);break;case me.PUBLISH:case me.UNPUBLISH:case me.RESTART_ICE:case me.CALL:s.uid=o,cn(this.signal,r,s).then(a=>{this.response(e._id,a)}).catch(()=>{this.response(e._id,void 0,!0)});break;case me.ACK:this.getListeners("res-@".concat(n,"_ack")).length>0&&this.emit("res-@".concat(n,"_ack"));break;case me.RESPONSE:{const{success:a,message:c}=s;this.emit("res-@".concat(n),a?"success":"failed",c);break}}}}splitMessage(e){if(e.length<rc.MAX_MESSAGE_SIZE)return[e];const n=[],{remoteToken:r}=JSON.parse(e),i=zt(6,"");let o=0,s=800;const a=Math.ceil(e.length/s);for(;e.length>0;){o++;const c={id:i,index:o,total:a,payload:e.slice(0,s),token:"".concat(this.token,"_").concat(r)};JSON.stringify(c).length>rc.MAX_MESSAGE_SIZE?s-=50:(n.push(c),e=e.slice(s))}return n.map(c=>JSON.stringify(c))}handleCheckToken(e,n){return e.token!==n?(m.debug("token changed, from ".concat(e.token," to ").concat(n)),this.reset(e.uid,n),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{m.debug("token timeout, ".concat(n)),this.reset(e.uid)},A("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const e=await cn(this.signal,me.CALL,void 0),n=await this.send(me.CALL,e);this.signal.emit(at.P2P_CONNECTION,n,!0)}async reset(e,n){const r=this.userMap.get(e);r&&(this.emit(Cc.ABORT),this.signal.emit(Et.ON_USER_OFFLINE,{uid:r.uid,reason:mQ.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),n||(m.debug("change local token from ".concat(n," to ").concat(n)),this.token=zt(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(Cc.ABORT)}}v(rc,"MAX_SIZE",1),v(rc,"MAX_MESSAGE_SIZE",1024);class IP extends oe{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Kt.CONNECTED?this.emit(at.WS_CONNECTED):e===Kt.RECONNECTING?this.emit(at.WS_RECONNECTING,this._websocketReconnectReason):e===Kt.CLOSED&&this.emit(at.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(e,n){super(),v(this,"_disconnectedReason",void 0),v(this,"_websocketReconnectReason",void 0),v(this,"_connectionState",Kt.CLOSED),v(this,"reconnectToken",void 0),v(this,"p2pToken",void 0),v(this,"websocket",void 0),v(this,"openConnectionTime",void 0),v(this,"clientId",void 0),v(this,"lastMsgTime",Date.now()),v(this,"uploadCache",[]),v(this,"uploadCacheInterval",void 0),v(this,"rttRolling",new mV(5)),v(this,"pingpongTimer",void 0),v(this,"pingpongTimeoutCount",0),v(this,"joinResponse",void 0),v(this,"multiIpOption",void 0),v(this,"initError",void 0),v(this,"spec",void 0),v(this,"store",void 0),v(this,"_external_signal",void 0),v(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(at.ON_BINARY_DATA,r.data);const i=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){const o="res-@".concat(i._id);this.emit(o,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Et.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Et.MUTE_AUDIO:case Et.MUTE_VIDEO:case Et.ON_P2P_LOST:case Et.ON_USER_ONLINE:return;case Et.ON_USER_OFFLINE:const{uid:o}=i._message;return m.debug("[".concat(this.clientId,"] user-offline uid: ").concat(o)),void this._external_signal.reset(o)}if(this.emit(i._type,i._message),i._type===Et.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Et.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(kt.UID_BANNED);break;case 15:this.close(kt.IP_BANNED);break;case 16:this.close(kt.CHANNEL_BANNED)}if(i._type===Et.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case rt.ERR_LICENSE_MISSING:this.close(kt.LICENSE_MISSING);break;case rt.ERR_LICENSE_EXPIRED:this.close(kt.LICENSE_EXPIRED);break;case rt.ERR_LICENSE_MINUTES_EXCEEDED:this.close(kt.LICENSE_MINUTES_EXCEEDED);break;case rt.ERR_LICENSE_PERIOD_INVALID:this.close(kt.LICENSE_PERIOD_INVALID);break;case rt.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(kt.LICENSE_MULTIPLE_SDK_SERVICE);break;case rt.ERR_LICENSE_ILLEGAL:this.close(kt.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=e.clientId,this.spec=e,this.store=n,this.websocket=new dC("gateway-".concat(this.clientId),this.spec.retryConfig,!0,A("JOIN_GATEWAY_USE_DUAL_DOMAIN"),A("JOIN_GATEWAY_USE_443PORT_ONLY"),n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Kt.CONNECTED&&this.reconnect("retry",sn.OFFLINE)}),this.p2pToken=zt(6,""),this._external_signal=new rc(this,this.p2pToken)}async request(e,n,r,i){const o=zt(6,""),s={_id:o,_type:e,_message:n},a=this.websocket.connectionID,c=()=>new Y((S,f)=>{if(this.connectionState===Kt.CONNECTED)return S();const _=()=>{this.off(at.WS_CLOSED,T),S()},T=()=>{this.off(at.WS_CONNECTED,_),f(new M(R.WS_ABORT))};this.once(at.WS_CONNECTED,_),this.once(at.WS_CLOSED,T)});if(this.connectionState!==Kt.CONNECTING&&this.connectionState!==Kt.RECONNECTING||e===st.JOIN||e===st.REJOIN||await c(),this.websocket.sendMessage(s,!0),i)return;const d=new Y((S,f)=>{let _=!1;const T=(y,I)=>{_=!0,S({isSuccess:y==="success",message:I||{}}),this.off(at.WS_CLOSED,g),this.off(at.WS_RECONNECTING,g),this.emit(at.REQUEST_SUCCESS,e,n)};this.once("res-@".concat(o),T);const g=()=>{f(new M(R.WS_ABORT,"type: ".concat(e))),this.off(at.WS_CLOSED,g),this.off(at.WS_RECONNECTING,g),this.off("res-@".concat(o),T)};this.once(at.WS_CLOSED,g),this.once(at.WS_RECONNECTING,g),Je(A("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==a||_||(m.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(at.REQUEST_TIMEOUT,e,n))})});let l=null;try{l=await d}catch(S){if(this.connectionState===Kt.CLOSED||e===st.LEAVE)throw new M(R.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?S.throw():e===st.JOIN||e===st.REJOIN?null:(await c(),await this.request(e,n))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),h=Xu(u),p=new M(R.UNEXPECTED_RESPONSE,"".concat(h.desc,": ").concat(l.message.error_str),{code:u,data:l.message,desc:h.desc});return h.action==="success"?l.message:(m.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(u,", message: ").concat(h.desc,", action: ").concat(h.action)),u===rt.ERR_TOO_MANY_BROADCASTERS?((e===st.JOIN||e===st.REJOIN)&&(this.initError=p,this.close()),p.throw()):h.action==="failed"?p.throw():h.action==="quit"?(this.initError=p,this.close(),p.throw()):(u===rt.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,m.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",sn.MULTI_IP)):this.reconnect(h.action,sn.SERVER_ERROR),e===st.JOIN||e===st.REJOIN?null:await this.request(e,n)))}waitMessage(e,n){return new Y(r=>{const i=o=>{(!n||n(o))&&(this.off(e,i),r(o))};this.on(e,i)})}uploadWRTCStats(e){if(!this.store.sessionId)return void m.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const n={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:e};this.upload(Ju.WRTC_STATS,n)}upload(e,n){const r={_type:e,_message:n};try{this.websocket.sendMessage(r)}catch{const o=A("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>o&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Kt.CONNECTED)return;const s=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(s._type,s._message)},A("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,n){const r={_type:e,_message:n};this.websocket.sendMessage(r)}async sendExtensionMessage(e,n,r){return await this._external_signal.send(e,n,r)}init(e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Y((n,r)=>{this.once(at.WS_CONNECTED,()=>n(this.joinResponse)),this.once(at.WS_CLOSED,()=>r(this.initError||new M(R.WS_ABORT))),this.connectionState=Kt.CONNECTING,this.websocket.init(e).catch(r)})}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=e||kt.LEAVE,this.connectionState=Kt.CLOSED,m.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=zt(6,""),this._external_signal.clear(),this._external_signal=new rc(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(at.ABORT_P2P_EXECUTION);const e=await cn(this,at.REQUEST_JOIN_INFO),n=await this.request(st.JOIN,e);if(!n)return this.emit(at.REPORT_JOIN_GATEWAY,R.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(at.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Kt.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(e,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,n)}handleDataStream(e){try{var n;const r=La(e.payload),i=new TextDecoder().decode(r),o=JSON.parse(i);"total"in o&&"id"in o||$(n=Object.values(me)).call(n,o._type)?(o._uid=e.uid,this._external_signal.onMessage(o)):this.emit(Et.ON_DATA_STREAM,e)}catch{this.emit(Et.ON_DATA_STREAM,e)}}handleNotification(e){m.debug("[".concat(this.clientId,"] receive notification: "),e);const n=Xu(e.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(kt.UID_BANNED),void this.close()):void this.reconnect(n.action,sn.SERVER_ERROR);m.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=A("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=e&&(m.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>A("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",sn.TIMEOUT):this.request(st.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),A("REPORT_STATS")&&this.send(st.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWebsocketEvents(){this.websocket.on(dt.RECONNECT_WAITTING_FINISH,e=>{this.emit(at.WS_RECONNECT_WAITTING_FINISH,e)}),this.websocket.on(dt.RECONNECT_CREATE_CONNECTION,e=>{this.emit(at.WS_RECONNECT_CREATE_CONNECTION,e)}),this.websocket.on(dt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(dt.CLOSED,()=>{this.connectionState=Kt.CLOSED}),this.websocket.on(dt.FAILED,()=>{this._disconnectedReason=kt.NETWORK_ERROR,this.connectionState=Kt.CLOSED}),this.websocket.on(dt.RECONNECTING,e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Kt.CONNECTED?this.connectionState=Kt.RECONNECTING:this.connectionState=Kt.CONNECTING}),this.websocket.on(dt.WILL_RECONNECT,(e,n,r)=>{e!=="retry"?(m.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0):m.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),r(e)}),this.websocket.on(dt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(e=>{if(this.emit(at.REPORT_JOIN_GATEWAY,e,this.url||""),e instanceof M&&e.code===R.UNEXPECTED_RESPONSE&&e.data.code===rt.ERR_NO_AUTHORIZED)return m.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",sn.SERVER_ERROR);m.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",sn.SERVER_ERROR):(this.initError=e,this.close())})}),this.websocket.on(dt.REQUEST_NEW_URLS,(e,n)=>{cn(this,at.REQUEST_RECOVER,this.multiIpOption).then(e).catch(n)}),this.websocket.on(dt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var rF={exports:{}};rF.exports=(()=>{var t={8:(r,i,o)=>{o.r(i),o.d(i,{Parser:()=>V,Printer:()=>Yt,parse:()=>L,print:()=>G});const s=`
`,a="".concat("\r").concat(s),c=" ";let d;function l(k){return k>="0"&&k<="9"}function u(k){return k>="!"&&k<="~"}function h(k){return u(k)||k>=""&&k<=""}function p(k){return k==="!"||k>="#"&&k<="'"||k>="*"&&k<="+"||k>="-"&&k<="."||k>="0"&&k<="9"||k>="A"&&k<="Z"||k>="^"&&k<="~"}function S(k){return k>="1"&&k<="9"}function f(k){return k>="A"&&k<="Z"||k>="a"&&k<="z"}function _(k){return k==="d"||k==="h"||k==="m"||k==="s"}function T(k){return k>""&&k<"	"||k>"\v"&&k<"\f"||k>""&&k<""}function g(k){return f(k)||l(k)||k==="+"||k==="/"}function y(k){return l(k)||f(k)||k==="+"||k==="/"||k==="-"||k==="_"}function I(k){return f(k)||l(k)||k==="+"||k==="/"}function O(k,E){var C=Object.keys(k);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(k);E&&(w=w.filter(function(j){return Object.getOwnPropertyDescriptor(k,j).enumerable})),C.push.apply(C,w)}return C}function b(k){for(var E=1;E<arguments.length;E++){var C=arguments[E]!=null?arguments[E]:{};E%2?O(Object(C),!0).forEach(function(w){N(k,w,C[w])}):Object.getOwnPropertyDescriptors?Object.defineProperties(k,Object.getOwnPropertyDescriptors(C)):O(Object(C)).forEach(function(w){Object.defineProperty(k,w,Object.getOwnPropertyDescriptor(C,w))})}return k}function N(k,E,C){return E in k?Object.defineProperty(k,E,{value:C,enumerable:!0,configurable:!0,writable:!0}):k[E]=C,k}(function(k){k.VERSION="v",k.ORIGIN="o",k.SESSION_NAME="s",k.INFORMATION="i",k.URI="u",k.EMAIL="e",k.PHONE="p",k.CONNECTION="c",k.BANDWIDTH="b",k.TIME="t",k.REPEAT="r",k.ZONE_ADJUSTMENTS="z",k.KEY="k",k.ATTRIBUTE="a",k.MEDIA="m"})(d||(d={}));class U{consumeText(E,C){let w=C;for(;w<E.length;){const j=E[w];if(j==="\0"||j==="\r"||j===s)break;w+=1}if(w-C==0)throw new Error("Invalid text, at ".concat(E));return w}consumeUnicastAddress(E,C,w){return this.consumeTill(E,C,c)}consumeOneOrMore(E,C,w){let j=C;for(;w(E[j]);)j++;if(j-C==0)throw new Error("Invalid rule at ".concat(C,"."));return j}consumeSpace(E,C){if(E[C]===c)return C+1;throw new Error("Invalid space at ".concat(C,"."))}consumeIP4Address(E,C){let w=C;for(let j=0;j<4;j++)if(w=this.consumeDecimalUChar(E,w),j!==3){if(E[w]!==".")throw new Error("Invalid IP4 address.");w++}return w}consumeDecimalUChar(E,C){let w=C;for(let Q=0;Q<3&&l(E[w]);Q++,w++);if(w-C==0)throw new Error("Invalid decimal uchar.");const j=parseInt(E.slice(C,w));if(j>=0&&j<=255)return w;throw new Error("Invalid decimal uchar")}consumeIP6Address(E,C){let w=this.consumeHexpart(E,C);return E[w]===":"&&(w+=1,w=this.consumeIP4Address(E,w)),w}consumeHexpart(E,C){let w=C;if(E[w]===":"&&E[w+1]===":"){w+=2;try{w=this.consumeHexseq(E,w)}catch{}return w}if(w=this.consumeHexseq(E,w),E[w]===":"&&E[w+1]===":"){w+=2;try{w=this.consumeHexseq(E,w)}catch{}return w}return w}consumeHexseq(E,C){let w=C;for(;w=this.consumeHex4(E,w),E[w]===":"&&E[w+1]!==":";)w+=1;return w}consumeHex4(E,C){let w=0;for(;w<4;w++)if(!((j=E[C+w])>="0"&&j<="9"||j>="a"&&j<="f"||j>="A"&&j<="F")){if(w===0)throw new Error("Invalid hex 4");break}var j;return C+w}consumeFQDN(E,C){let w=C;for(;l(E[w])||f(E[w])||E[w]==="-"||E[w]===".";)w+=1;if(w-C<4)throw new Error("Invalid FQDN");return w}consumeExtnAddr(E,C){return this.consumeOneOrMore(E,C,h)}consumeMulticastAddress(E,C,w){switch(w){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(E,C);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(E,C);default:try{return this.consumeFQDN(E,C)}catch{return this.consumeExtnAddr(E,C)}}}consumeIP6MulticastAddress(E,C){const w=this.consumeHexpart(E,C);return E[w]==="/"?this.consumeInteger(E,w+1):w}consumeIP4MulticastAddress(E,C){let w=C+3;const j=E.slice(C,w),Q=parseInt(j);if(Q<224||Q>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let ct=0;ct<3;ct++){if(E[w]!==".")throw new Error("Invalid IP4 multicast address.");w+=1,w=this.consumeDecimalUChar(E,w)}return E[w]==="/"&&(w+=1),w=this.consumeTTL(E,w),E[w]==="/"&&(w=this.consumeInteger(E,w)),w}consumeInteger(E,C){if(!S(E[C]))throw new Error("Invalid integer.");for(C+=1;l(E[C]);)C+=1;return C}consumeTTL(E,C){if(E[C]==="0")return C+1;if(!S(E[C]))throw new Error("Invalid TTL.");C+=1;for(let w=0;w<2&&l(E[C]);w++)C+=1;return C}consumeToken(E,C){return this.consumeOneOrMore(E,C,p)}consumeTime(E,C){let w=C;if(E[w]==="0")return w+1;for(S(E[w])&&(w+=1);l(E[w]);)w++;if(w-C<10)throw new Error("Invalid time");return w}consumeAddress(E,C){return this.consumeTill(E,C,c)}consumeTypedTime(E,C){let w=C;return w=this.consumeOneOrMore(E,w,l),_(E[w])?w+1:w}consumeRepeatInterval(E,C){if(!S(E[C]))throw new Error("Invalid repeat interval");for(C+=1;l(E[C]);)C+=1;return _(E[C])&&(C+=1),C}consumePort(E,C){return this.consumeOneOrMore(E,C,l)}consume(E,C,w){for(let j=0;j<w.length;j++){if(C+j>=E.length)throw new Error("consume exceeding value length");if(E[C+j]!==w[j])throw new Error("consume ".concat(w," failed at ").concat(j))}return C+w.length}consumeTill(E,C,w){let j=C;for(;j<E.length&&(typeof w!="string"||E[j]!==w)&&(typeof w!="function"||!w(E[j]));)j++;return j}}class V extends U{constructor(){super(),N(this,"records",[]),N(this,"currentLine",0)}parse(E){const C=this.probeEOL(E);this.records=E.split(C).filter(Ie=>!!Cn(Ie).call(Ie)).map(this.parseLine),this.currentLine=0;const w=this.parseVersion(),j=this.parseOrigin(),Q=this.parseSessionName(),ct=this.parseInformation(),Mt=this.parseUri(),Wn=this.parseEmail(),Oo=this.parsePhone(),Mh=this.parseConnection(),Uh=this.parseBandWidth(),Dr=this.parseTimeFields(),rs=this.parseKey(),pc=this.parseSessionAttribute(),pe=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:w,origin:j,sessionName:Q,information:ct,uri:Mt,emails:Wn,phones:Oo,connection:Mh,bandwidths:Uh,timeFields:Dr,key:rs,attributes:pc,mediaDescriptions:pe}}getCurrentRecord(){const E=this.records[this.currentLine];if(!E)throw new Error("Record doesn't exit.");return E}probeEOL(E){for(let C=0;C<E.length;C++)if(E[C]===s)return E[C-1]==="\r"?a:s;throw new Error("Invalid newline character.")}parseLine(E,C){if(E.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const w=E[0];if(E[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:w,value:E.slice(2),line:C,cur:0}}parseSessionAttribute(){const E=new lt;for(;this.currentLine<this.records.length;){const C=this.getCurrentRecord();if(C.type!==d.ATTRIBUTE)break;const w={attField:this.extractOneOrMore(C,j=>p(j)&&j!==":"),_cur:0};C.value[C.cur]===":"&&(C.cur+=1,w.attValue=this.extractOneOrMore(C,T)),E.parse(w),this.currentLine++}return E.digest()}parseMediaAttributes(E){const C=new mt(E);for(;this.currentLine<this.records.length;){const w=this.getCurrentRecord();if(w.type!==d.ATTRIBUTE)break;const j={attField:this.extractOneOrMore(w,Q=>p(Q)&&Q!==":"),_cur:0};w.value[w.cur]===":"&&(w.cur+=1,j.attValue=this.extractOneOrMore(w,T)),C.parse(j),this.currentLine++}return C.digest()}parseKey(){const E=this.getCurrentRecord();if(E.type===d.KEY){if(E.value==="prompt"||E.value==="clear:"||E.value==="base64:"||E.value==="uri:")return E.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const E=this.getCurrentRecord();if(E.type===d.ZONE_ADJUSTMENTS){const C=[];for(;;)try{const w=this.extract(E,this.consumeTime);this.consumeSpaceForRecord(E);let j=!1;E.value[E.cur]==="-"&&(j=!0,E.cur+=1);const Q=this.extract(E,this.consumeTypedTime);C.push({time:w,typedTime:Q,back:j})}catch{break}if(C.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,C}return[]}parseRepeat(){const E=[];for(;;){const C=this.getCurrentRecord();if(C.type!==d.REPEAT)break;{const w=this.extract(C,this.consumeRepeatInterval),j=this.parseTypedTime(C);E.push({repeatInterval:w,typedTimes:j}),this.currentLine++}}return E}parseTypedTime(E){const C=[];for(;;)try{this.consumeSpaceForRecord(E),C.push(this.extract(E,this.consumeTypedTime))}catch{break}if(C.length===0)throw new Error("Invalid typed time.");return C}parseTime(){const E=this.getCurrentRecord(),C=this.extract(E,this.consumeTime);this.consumeSpaceForRecord(E);const w=this.extract(E,this.consumeTime);return this.currentLine++,{startTime:C,stopTime:w}}parseBandWidth(){const E=[];for(;this.currentLine<this.records.length;){const C=this.getCurrentRecord();if(C.type!==d.BANDWIDTH)break;{const w=this.extractOneOrMore(C,p);if(C.value[C.cur]!==":")throw new Error("Invalid bandwidth field.");C.cur++;const j=this.extractOneOrMore(C,l);E.push({bwtype:w,bandwidth:j}),this.currentLine++}}return E}parseVersion(){const E=this.getCurrentRecord();if(E.type!==d.VERSION)throw new Error("first sdp record must be version");const C=E.value.slice(0,this.consumeOneOrMore(E.value,0,l));if(C.length!==E.value.length)throw new Error('invalid proto version, "v='.concat(E.value,'"'));return this.currentLine++,C}parseOrigin(){const E=this.getCurrentRecord();if(E.type!==d.ORIGIN)throw new Error("second line of sdp must be origin");const C=this.extractOneOrMore(E,h);this.consumeSpaceForRecord(E);const w=this.extractOneOrMore(E,l);this.consumeSpaceForRecord(E);const j=this.extractOneOrMore(E,l);this.consumeSpaceForRecord(E);const Q=this.extractOneOrMore(E,p);this.consumeSpaceForRecord(E);const ct=this.extractOneOrMore(E,p);this.consumeSpaceForRecord(E);const Mt=this.extract(E,this.consumeUnicastAddress);return this.currentLine++,{username:C,sessId:w,sessVersion:j,nettype:Q,addrtype:ct,unicastAddress:Mt}}parseSessionName(){const E=this.getCurrentRecord();if(E.type===d.SESSION_NAME){const C=this.extract(E,this.consumeText);return this.currentLine++,C}}parseInformation(){const E=this.getCurrentRecord();if(E.type!==d.INFORMATION)return;const C=this.extract(E,this.consumeText);return this.currentLine++,C}parseUri(){const E=this.getCurrentRecord();if(E.type===d.URI)return this.currentLine++,E.value}parseEmail(){const E=[];for(;;){const C=this.getCurrentRecord();if(C.type!==d.EMAIL)break;E.push(C.value),this.currentLine++}return E}parsePhone(){const E=[];for(;;){const C=this.getCurrentRecord();if(C.type!==d.PHONE)break;E.push(C.value),this.currentLine++}return E}parseConnection(){const E=this.getCurrentRecord();if(E.type===d.CONNECTION){const C=this.extractOneOrMore(E,p);this.consumeSpaceForRecord(E);const w=this.extractOneOrMore(E,p);this.consumeSpaceForRecord(E);const j=this.extract(E,this.consumeAddress);return this.currentLine++,{nettype:C,addrtype:w,address:j}}}parseMedia(){const E=this.getCurrentRecord(),C=this.extract(E,this.consumeToken);this.consumeSpaceForRecord(E);let w=this.extract(E,this.consumePort);E.value[E.cur]==="/"&&(E.cur+=1,w+=this.extract(E,this.consumeInteger)),this.consumeSpaceForRecord(E);const j=[];for(j.push(this.extract(E,this.consumeToken));E.value[E.cur]==="/";)E.cur+=1,j.push(this.extract(E,this.consumeToken));if(j.length===0)throw new Error("Invalid proto");const Q=this.parseFmt(E);return this.currentLine++,{mediaType:C,port:w,protos:j,fmts:Q}}parseTimeFields(){const E=[];for(;this.getCurrentRecord().type===d.TIME;){const C=this.parseTime(),w=this.parseRepeat(),j=this.parseZone();E.push({time:C,repeats:w,zones:j})}return E}parseMediaDescription(){const E=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===d.MEDIA;){const C=this.parseMedia(),w=this.parseInformation(),j=this.parseConnections(),Q=this.parseBandWidth(),ct=this.parseKey(),Mt=this.parseMediaAttributes(C);E.push({media:C,information:w,connections:j,bandwidths:Q,key:ct,attributes:Mt})}return E}parseConnections(){const E=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===d.CONNECTION;)E.push(this.parseConnection());return E}parseFmt(E){const C=[];for(;;)try{this.consumeSpaceForRecord(E),C.push(this.extract(E,this.consumeToken))}catch{break}if(C.length===0)throw new Error("Invalid fmts");return C}extract(E,C){for(var w=arguments.length,j=new Array(w>2?w-2:0),Q=2;Q<w;Q++)j[Q-2]=arguments[Q];const ct=C.call(this,E.value,E.cur,...j),Mt=E.value.slice(E.cur,ct);return E.cur=ct,Mt}extractOneOrMore(E,C){const w=this.consumeOneOrMore(E.value,E.cur,C),j=E.value.slice(E.cur,w);return E.cur=w,j}consumeSpaceForRecord(E){if(E.value[E.cur]!==c)throw new Error("Invalid space at ".concat(E.cur,"."));E.cur+=1}}class W extends U{constructor(){super(...arguments),N(this,"attributes",void 0),N(this,"digested",!1)}extractOneOrMore(E,C,w){const j=this.consumeOneOrMore(E.attValue,E._cur,C),Q=E.attValue.slice(E._cur,j),[ct,Mt]=w||[];if(typeof ct=="number"&&Q.length<ct)throw new Error("error in length, should be more or equal than ".concat(ct," characters."));if(typeof Mt=="number"&&Q.length>Mt)throw new Error("error in length, should be less or equal than ".concat(Mt," characters."));return E._cur=j,Q}consumeAttributeSpace(E){if(E.attValue[E._cur]!==c)throw new Error("Invalid space at ".concat(E._cur,"."));E._cur+=1}extract(E,C){if(!E.attValue)throw new Error("Nothing to extract from attValue.");for(var w=arguments.length,j=new Array(w>2?w-2:0),Q=2;Q<w;Q++)j[Q-2]=arguments[Q];const ct=C.call(this,E.attValue,E._cur,...j),Mt=E.attValue.slice(E._cur,ct);return E._cur=ct,Mt}atEnd(E){if(!E.attValue)throw new Error;return E._cur>=E.attValue.length}peekChar(E){if(!E.attValue)throw new Error;return E.attValue[E._cur]}peek(E,C){if(!E.attValue)throw new Error;for(let w=0;w<C.length;w++)if(C[w]!==E.attValue[E._cur+w])return!1;return!0}parseIceUfrag(E){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(E,g,[4,256])}parseIcePwd(E){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(E,g,[22,256])}parseIceOptions(E){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const C=[];for(;!this.atEnd(E);){C.push(this.extractOneOrMore(E,g));try{this.consumeAttributeSpace(E)}catch(w){if(this.atEnd(E))break;throw w}}this.attributes.iceOptions=C}parseFingerprint(E){const C=this.extract(E,this.consumeToken);this.consumeAttributeSpace(E);const w=this.extract(E,this.consumeTill);this.attributes.fingerprints.push({hashFunction:C,fingerprint:w})}parseExtmap(E){const C=this.extractOneOrMore(E,l);let w;this.peekChar(E)==="/"&&(this.extract(E,this.consume,"/"),w=this.extract(E,this.consumeToken)),this.consumeAttributeSpace(E);const j=this.extract(E,this.consumeTill,c),Q=b(b({entry:parseInt(C,10)},w&&{direction:w}),{},{extensionName:j});this.peekChar(E)===c&&(this.consumeAttributeSpace(E),Q.extensionAttributes=this.extract(E,this.consumeTill)),this.attributes.extmaps.push(Q)}parseSetup(E){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const C=this.extract(E,this.consumeTill);if(C!=="active"&&C!=="passive"&&C!=="actpass"&&C!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=C}}class lt extends W{constructor(){super(...arguments),N(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(E){if(this.digested)throw new Error("already digested");try{switch(E.attField){case"group":this.parseGroup(E);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(E);break;case"ice-pwd":this.parseIcePwd(E);break;case"ice-options":this.parseIceOptions(E);break;case"fingerprint":this.parseFingerprint(E);break;case"setup":this.parseSetup(E);break;case"tls-id":this.parseTlsId(E);break;case"identity":this.parseIdentity(E);break;case"extmap":this.parseExtmap(E);break;case"msid-semantic":this.parseMsidSemantic(E);break;default:E.ignored=!0,this.attributes.unrecognized.push(E)}}catch(C){throw console.error("parsing session attribute ".concat(E.attField,' error, "a=').concat(E.attField,":").concat(E.attValue,'"')),C}if(!E.ignored&&E.attValue&&!this.atEnd(E))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(E){const C=this.extract(E,this.consumeToken),w=[];for(;!this.atEnd(E)&&this.peekChar(E)===c;)this.consumeAttributeSpace(E),w.push(this.extract(E,this.consumeToken));this.attributes.groups.push({semantic:C,identificationTag:w})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(E){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(E,y)}parseIdentity(E){const C=this.extractOneOrMore(E,I),w=[];for(;!this.atEnd(E)&&this.peekChar(E)===c;){this.consumeAttributeSpace(E);const j=this.extract(E,this.consumeToken);this.extract(E,this.consume,"=");const Q=this.extractOneOrMore(E,ct=>ct!==c&&T(ct));w.push({name:j,value:Q})}this.attributes.identities.push({assertionValue:C,extensions:w})}parseMsidSemantic(E){this.peekChar(E)===c&&this.consumeAttributeSpace(E);const C={semantic:this.extract(E,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(E)}catch{break}if(this.peekChar(E)==="*"){this.extract(E,this.consume,"*"),C.applyForAll=!0;break}{const w=this.extract(E,this.consumeTill,c);C.identifierList.push(w)}}this.attributes.msidSemantic=C}}class mt extends W{constructor(E){super(),N(this,"attributes",void 0),E.protos.indexOf("RTP")!==-1||E.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(E){if(this.digested)throw new Error("already digested");try{switch(E.attField){case"extmap":this.parseExtmap(E);break;case"setup":this.parseSetup(E);break;case"ice-ufrag":this.parseIceUfrag(E);break;case"ice-pwd":this.parseIcePwd(E);break;case"ice-options":this.parseIceOptions(E);break;case"candidate":this.parseCandidate(E);break;case"remote-candidate":this.parseRemoteCandidate(E);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(E);break;case"rtpmap":this.parseRtpmap(E);break;case"ptime":this.parsePtime(E);break;case"maxptime":this.parseMaxPtime(E);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(E);break;case"ssrc":this.parseSSRC(E);break;case"fmtp":this.parseFmtp(E);break;case"rtcp-fb":this.parseRtcpFb(E);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(E);break;case"mid":this.parseMid(E);break;case"msid":this.parseMsid(E);break;case"imageattr":this.parseImageAttr(E);break;case"rid":this.parseRid(E);break;case"simulcast":this.parseSimulcast(E);break;case"sctp-port":this.parseSctpPort(E);break;case"max-message-size":this.parseMaxMessageSize(E);break;case"ssrc-group":this.parseSSRCGroup(E);break;default:E.ignored=!0,this.attributes.unrecognized.push(E)}}catch(C){throw console.error("parsing media attribute ".concat(E.attField,' error, "a=').concat(E.attField,":").concat(E.attValue,'"')),C}if(!E.ignored&&E.attValue&&!this.atEnd(E))throw new Error("attribute parsing error")}parseCandidate(E){const C=this.extractOneOrMore(E,g,[1,32]);this.consumeAttributeSpace(E);const w=this.extractOneOrMore(E,l,[1,5]);this.consumeAttributeSpace(E);const j=this.extract(E,this.consumeToken);this.consumeAttributeSpace(E);const Q=this.extractOneOrMore(E,l,[1,10]);this.consumeAttributeSpace(E);const ct=this.extract(E,this.consumeAddress);this.consumeAttributeSpace(E);const Mt=this.extract(E,this.consumePort);this.consumeAttributeSpace(E),this.extract(E,this.consume,"typ"),this.consumeAttributeSpace(E);const Wn={foundation:C,componentId:w,transport:j,priority:Q,connectionAddress:ct,port:Mt,type:this.extract(E,this.consumeToken),extension:{}};for(this.peek(E," raddr")&&(this.extract(E,this.consume," raddr"),this.consumeAttributeSpace(E),Wn.relAddr=this.extract(E,this.consumeAddress)),this.peek(E," rport")&&(this.extract(E,this.consume," rport"),this.consumeAttributeSpace(E),Wn.relPort=this.extract(E,this.consumePort));this.peekChar(E)===c;){this.consumeAttributeSpace(E);const Oo=this.extract(E,this.consumeToken);this.consumeAttributeSpace(E),Wn.extension[Oo]=this.extractOneOrMore(E,u)}this.attributes.candidates.push(Wn)}parseRemoteCandidate(E){const C=[];for(;;){const w=this.extractOneOrMore(E,l,[1,5]);this.consumeAttributeSpace(E);const j=this.extract(E,this.consumeAddress);this.consumeAttributeSpace(E);const Q=this.extract(E,this.consumePort);C.push({componentId:w,connectionAddress:j,port:Q});try{this.consumeAttributeSpace(E)}catch{break}}this.attributes.remoteCandidatesList.push(C)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(E){const C=this.extract(E,this.consumeToken);this.consumeAttributeSpace(E);const w=this.extract(E,this.consumeTill,"/");this.extract(E,this.consume,"/");const j={encodingName:w,clockRate:this.extractOneOrMore(E,l)};this.atEnd(E)||this.peekChar(E)!=="/"||(this.extract(E,this.consume,"/"),j.encodingParameters=parseInt(this.extract(E,this.consumeTill),10));const Q=this.attributes.payloads.find(ct=>ct.payloadType===parseInt(C,10));Q?Q.rtpMap=j:this.attributes.payloads.push({payloadType:parseInt(C,10),rtpMap:j,rtcpFeedbacks:[]})}parsePtime(E){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(E,this.consumeTill)}parseMaxPtime(E){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(E,this.consumeTill)}parseDirection(E){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=E.attField}parseSSRC(E){const C=this.extractOneOrMore(E,l);this.consumeAttributeSpace(E);const w=this.extract(E,this.consumeTill,":");let j;this.peekChar(E)===":"&&(this.extract(E,this.consume,":"),j=this.extract(E,this.consumeTill));const Q=this.attributes.ssrcs.find(ct=>ct.ssrcId===parseInt(C,10));Q?Q.attributes[w]=j:this.attributes.ssrcs.push({ssrcId:parseInt(C,10),attributes:{[w]:j}})}parseFmtp(E){const C=this.extract(E,this.consumeTill,c);this.consumeAttributeSpace(E);const w=this.extract(E,this.consumeTill),j={};w.split(";").forEach(ct=>{let[Mt,Wn]=ct.split("=");Mt=Cn(Mt).call(Mt);const Oo=typeof Wn=="string"?Cn(Wn).call(Wn):null;typeof Mt=="string"&&Mt.length>0&&(j[Mt]=Oo)});const Q=this.attributes.payloads.find(ct=>ct.payloadType===parseInt(C,10));Q?Q.fmtp={parameters:j}:this.attributes.payloads.push({payloadType:parseInt(C,10),rtcpFeedbacks:[],fmtp:{parameters:j}})}parseFmtParameters(E){const C={},w=this.extract(E,this.consumeTill,"=");E._cur++;const j=this.extract(E,this.consumeTill,";");for(C[w]=j;E.attValue[E._cur]===";";){const Q=this.extract(E,this.consumeTill,"=");E._cur++;const ct=this.extract(E,this.consumeTill,";");C[Q]=ct}return C}parseRtcpFb(E){let C="";C=this.peekChar(E)==="*"?this.extract(E,this.consume,"*"):this.extract(E,this.consumeTill,c),this.consumeAttributeSpace(E);const w=this.extract(E,this.consumeTill,c);let j;if(w==="trr-int")j={type:w,interval:this.extract(E,this.consumeTill)};else{const Q={type:w};this.peekChar(E)===c&&(this.consumeAttributeSpace(E),Q.parameter=this.extract(E,this.consumeToken),this.peekChar(E)===c&&(Q.additional=this.extract(E,this.consumeTill))),j=Q}if(C==="*")this.attributes.rtcpFeedbackWildcards.push(j);else{const Q=this.attributes.payloads.find(ct=>ct.payloadType===parseInt(C,10));Q?Q.rtcpFeedbacks.push(j):this.attributes.payloads.push({payloadType:parseInt(C,10),rtcpFeedbacks:[j]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(E){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const C={port:this.extract(E,this.consumePort)};this.peekChar(E)===c&&(this.consumeAttributeSpace(E),C.netType=this.extractOneOrMore(E,p),this.consumeAttributeSpace(E),C.addressType=this.extractOneOrMore(E,p),this.consumeAttributeSpace(E),C.address=this.extract(E,this.consumeAddress)),this.attributes.rtcp=C}parseMsid(E){const C={id:this.extractOneOrMore(E,p,[1,64])};this.peekChar(E)===c&&(this.consumeAttributeSpace(E),C.appdata=this.extractOneOrMore(E,p,[1,64])),this.attributes.msids.push(C)}parseImageAttr(E){this.attributes.imageattr.push(E.attValue)}parseRid(E){const C=this.extractOneOrMore(E,j=>f(j)||l(j)||j==="_"||j==="-");this.consumeAttributeSpace(E);const w={id:C,direction:this.extract(E,this.consumeToken),params:[]};if(this.peekChar(E)===c){if(this.consumeAttributeSpace(E),this.peek(E,"pt=")){this.extract(E,this.consume,"pt=");const j=[];for(;;){const Q=this.extract(E,this.consumeToken);j.push(Q);try{this.extract(E,this.consume,",")}catch{break}}w.payloads=j,this.peekChar(E)===c&&this.extract(E,this.consume,c)}for(;;){const j=this.extract(E,this.consumeToken);switch(j){case"depend":{const Q={type:j,rids:this.extract(E,this.consume,"=").split(",")};w.params.push(Q);break}default:{const Q={type:j};this.peekChar(E)==="="&&(this.extract(E,this.consume,"="),Q.val=this.extract(E,this.consumeTill,";")),w.params.push(Q)}}try{this.extract(E,this.consume,";")}catch{break}}}this.attributes.rids.push(w)}parseSimulcast(E){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=E.attValue,this.extract(E,this.consumeTill)}parseSctpPort(E){this.attributes.sctpPort=this.extractOneOrMore(E,l,[1,5])}parseMaxMessageSize(E){this.attributes.maxMessageSize=this.extractOneOrMore(E,l,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(E){this.attributes.mid=this.extract(E,this.consumeToken)}parseSSRCGroup(E){const C=this.extract(E,this.consumeToken),w=[];for(;;)try{this.consumeAttributeSpace(E);const j=this.extract(E,this.consumeInteger);w.push(parseInt(j,10))}catch{break}this.attributes.ssrcGroups.push({semantic:C,ssrcIds:w})}}function St(k,E,C){return E in k?Object.defineProperty(k,E,{value:C,enumerable:!0,configurable:!0,writable:!0}):k[E]=C,k}class Yt{constructor(){St(this,"eol",a)}print(E,C){let w="";return C&&(this.eol=C),w+=this.printVersion(E.version),w+=this.printOrigin(E.origin),w+=this.printSessionName(E.sessionName),w+=this.printInformation(E.information),w+=this.printUri(E.uri),w+=this.printEmail(E.emails),w+=this.printPhone(E.phones),w+=this.printConnection(E.connection),w+=this.printBandwidth(E.bandwidths),w+=this.printTimeFields(E.timeFields),w+=this.printKey(E.key),w+=this.printSessionAttributes(E.attributes),w+=this.printMediaDescription(E.mediaDescriptions),w}printVersion(E){return"v=".concat(E).concat(this.eol)}printOrigin(E){return"o=".concat(E.username," ").concat(E.sessId," ").concat(E.sessVersion," ").concat(E.nettype," ").concat(E.addrtype," ").concat(E.unicastAddress).concat(this.eol)}printSessionName(E){return E?"s=".concat(E).concat(this.eol):""}printInformation(E){return E?"i=".concat(E).concat(this.eol):""}printUri(E){return E?"u=".concat(E).concat(this.eol):""}printEmail(E){let C="";for(const w of E)C+="e=".concat(w).concat(this.eol);return C}printPhone(E){let C="";for(const w of E)C+="e=".concat(w).concat(this.eol);return C}printConnection(E){return E?"c=".concat(E.nettype," ").concat(E.addrtype," ").concat(E.address).concat(this.eol):""}printBandwidth(E){let C="";for(const w of E)C+="b=".concat(w.bwtype,":").concat(w.bandwidth).concat(this.eol);return C}printTimeFields(E){let C="";for(const w of E){C+="t=".concat(w.time.startTime," ").concat(w.time.startTime).concat(this.eol);for(const j of w.repeats)C+="r=".concat(j.repeatInterval," ").concat(j.typedTimes.join(" ")).concat(this.eol);w.zoneAdjustments&&(C+="z=",C+="z=".concat(w.zoneAdjustments.map(j=>"".concat(j.time," ").concat(j.back?"-":""," ").concat(j.typedTime)).join(" ")).concat(this.eol),C+=this.eol)}return C}printKey(E){return E?"k=".concat(E).concat(this.eol):""}printAttributes(E){let C="";for(const w of E)C+="a=".concat(w.attField).concat(w.attValue?":".concat(w.attValue):"").concat(this.eol);return C}printMediaDescription(E){let C="";for(const w of E)C+=this.printMedia(w.media),C+=this.printInformation(w.information),C+=this.printConnections(w.connections),C+=this.printBandwidth(w.bandwidths),C+=this.printKey(w.key),C+=this.printMediaAttributes(w);return C}printConnections(E){let C="";for(const w of E)C+=this.printConnection(w);return C}printMedia(E){return"m=".concat(E.mediaType," ").concat(E.port," ").concat(E.protos.join("/")," ").concat(E.fmts.join(" ")).concat(this.eol)}printSessionAttributes(E){return new Ze(this.eol).print(E)}printMediaAttributes(E){return new F(this.eol).print(E)}}class Lt{constructor(E){St(this,"eol",void 0),this.eol=E}printIceUfrag(E){return E===void 0?"":"a=ice-ufrag:".concat(E).concat(this.eol)}printIcePwd(E){return E===void 0?"":"a=ice-pwd:".concat(E).concat(this.eol)}printIceOptions(E){return E===void 0?"":"a=ice-options:".concat(E.join(c)).concat(this.eol)}printFingerprints(E){return E.length>0?E.map(C=>"a=fingerprint:".concat(C.hashFunction).concat(c).concat(C.fingerprint)).join(this.eol)+this.eol:""}printExtmap(E){return E.map(C=>"a=extmap:".concat(C.entry).concat(C.direction?"/".concat(C.direction):"").concat(c).concat(C.extensionName).concat(C.extensionAttributes?"".concat(c).concat(C.extensionAttributes):"").concat(this.eol)).join("")}printSetup(E){return E===void 0?"":"a=setup:".concat(E).concat(this.eol)}printUnrecognized(E){return E.map(C=>"a=".concat(C.attField).concat(C.attValue?":".concat(C.attValue):"").concat(this.eol)).join("")}}class Ze extends Lt{print(E){let C="";return C+=this.printGroups(E.groups),C+=this.printMsidSemantic(E.msidSemantic),C+=this.printIceLite(E.iceLite),C+=this.printIceUfrag(E.iceUfrag),C+=this.printIcePwd(E.icePwd),C+=this.printIceOptions(E.iceOptions),C+=this.printFingerprints(E.fingerprints),C+=this.printSetup(E.setup),C+=this.printTlsId(E.tlsId),C+=this.printIdentity(E.identities),C+=this.printExtmap(E.extmaps),C+=this.printUnrecognized(E.unrecognized),C}printGroups(E){let C="";return E.length>0&&(C+=E.map(w=>"a=group:".concat(w.semantic).concat(w.identificationTag.map(j=>"".concat(c).concat(j)).join("")).concat(this.eol)).join("")),C}printIceLite(E){return E===void 0?"":"a=ice-lite"+this.eol}printTlsId(E){return E?"a=tls-id:".concat(E).concat(this.eol):""}printIdentity(E){return E.length===0?"":E.map(C=>"a=identity:".concat(C.assertionValue).concat(C.extensions.map(w=>"".concat(c).concat(w.name).concat(w.value?"=".concat(w.value):"")))).join(this.eol)+this.eol}printMsidSemantic(E){if(!E)return"";let C="a=msid-semantic:".concat(E.semantic);return E.applyForAll?C+="".concat(c,"*"):E.identifierList.length>0&&(C+=E.identifierList.map(w=>"".concat(c).concat(w))),C+this.eol}}class F extends Lt{print(E){const C=E.attributes;let w="";return w+=this.printRTCP(C.rtcp),w+=this.printIceUfrag(C.iceUfrag),w+=this.printIcePwd(C.icePwd),w+=this.printIceOptions(C.iceOptions),w+=this.printCandidates(C.candidates),w+=this.printRemoteCandidatesList(C.remoteCandidatesList),w+=this.printEndOfCandidates(C.endOfCandidates),w+=this.printFingerprints(C.fingerprints),w+=this.printSetup(C.setup),w+=this.printMid(C.mid),w+=this.printExtmap(C.extmaps),w+=this.printRTPRelated(C),w+=this.printPtime(C.ptime),w+=this.printMaxPtime(C.maxPtime),w+=this.printDirection(C.direction),w+=this.printSSRCGroups(C.ssrcGroups),w+=this.printSSRC(C.ssrcs),w+=this.printRTCPMux(C.rtcpMux),w+=this.printRTCPMuxOnly(C.rtcpMuxOnly),w+=this.printRTCPRsize(C.rtcpRsize),w+=this.printMSId(C.msids),w+=this.printImageattr(C.imageattr),w+=this.printRid(C.rids),w+=this.printSimulcast(C.simulcast),w+=this.printSCTPPort(C.sctpPort),w+=this.printMaxMessageSize(C.maxMessageSize),w+=this.printUnrecognized(C.unrecognized),w}printCandidates(E){return E.map(C=>"a=candidate:".concat(C.foundation).concat(c).concat(C.componentId).concat(c).concat(C.transport).concat(c).concat(C.priority).concat(c).concat(C.connectionAddress).concat(c).concat(C.port).concat(c,"typ").concat(c).concat(C.type).concat(C.relAddr?"".concat(c,"raddr").concat(c).concat(C.relAddr):"").concat(C.relPort?"".concat(c,"rport").concat(c).concat(C.relPort):"").concat(Object.keys(C.extension).map(w=>"".concat(c).concat(w).concat(c).concat(C.extension[w])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(E){return E.map(C=>"a=remote-candidates:".concat(C.join(c)).concat(this.eol)).join("")}printEndOfCandidates(E){return E===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(E){if(!E.payloads)return"";const C=E.payloads;let w="";w+=E.rtcpFeedbackWildcards.map(j=>this.printRTCPFeedback("*",j)).join("");for(const j of C)w+=this.printRtpMap(j.payloadType,j.rtpMap),w+=this.printFmtp(j.payloadType,j.fmtp),w+=j.rtcpFeedbacks.map(Q=>this.printRTCPFeedback(j.payloadType,Q)).join("");return w}printFmtp(E,C){if(!C)return"";const w=Object.keys(C.parameters);return w.length===1&&C.parameters[w[0]]===null?"a=fmtp:".concat(E).concat(c).concat(w[0]).concat(this.eol):"a=fmtp:".concat(E).concat(c).concat(Object.keys(C.parameters).map(j=>"".concat(j,"=").concat(C.parameters[j])).join(";")).concat(this.eol)}printRtpMap(E,C){return C?"a=rtpmap:".concat(E).concat(c).concat(C.encodingName,"/").concat(C.clockRate).concat(C.encodingParameters?"/".concat(C.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(E,C){let w="a=rtcp-fb:".concat(E).concat(c),j=C;return j.type==="trr-int"?w+="ttr-int".concat(c).concat(j.interval):(w+="".concat(j.type),j.parameter&&(w+="".concat(c).concat(j.parameter),j.additional&&(w+="".concat(c).concat(j.additional)))),w+this.eol}printPtime(E){return E===void 0?"":"a=ptime:".concat(E).concat(this.eol)}printMaxPtime(E){return E===void 0?"":"a=maxptime:".concat(E).concat(this.eol)}printDirection(E){return E===void 0?"":"a=".concat(E).concat(this.eol)}printSSRC(E){return E.map(C=>Object.keys(C.attributes).map(w=>"a=ssrc:".concat(C.ssrcId.toString(10)).concat(c).concat(w).concat(C.attributes[w]?":".concat(C.attributes[w]):"").concat(this.eol)).join("")).join("")}printRTCPMux(E){return E===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(E){return E===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(E){return E===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(E){if(E===void 0)return"";let C="a=rtcp:".concat(E.port);return E.netType&&(C+="".concat(c).concat(E.netType)),E.addressType&&(C+="".concat(c).concat(E.addressType)),E.address&&(C+="".concat(c).concat(E.address)),C+this.eol}printMSId(E){return E.map(C=>"a=msid:".concat(C.id).concat(C.appdata?"".concat(c).concat(C.appdata):"").concat(this.eol)).join("")}printImageattr(E){return E.map(C=>"a=imageattr:".concat(C).concat(this.eol)).join("")}printRid(E){return E.map(C=>{let w="a=rid:".concat(C.id).concat(c).concat(C.direction);return C.payloads&&(w+="".concat(c,"pt=").concat(C.payloads.join(","))),C.params.length>0&&(w+="".concat(c).concat(C.params.map(j=>j.type==="depend"?"depend=".concat(j.rids.join(",")):"".concat(j.type,"=").concat(j.val)).join(";"))),w+this.eol}).join("")}printSimulcast(E){return E===void 0?"":"a=simulcast:".concat(E).concat(this.eol)}printSCTPPort(E){return E===void 0?"":"a=sctp-port:".concat(E).concat(this.eol)}printMaxMessageSize(E){return E===void 0?"":"a=max-message-size:".concat(E).concat(this.eol)}printMid(E){return E===void 0?"":"a=mid:".concat(E).concat(this.eol)}printSSRCGroups(E){return E.map(C=>"a=ssrc-group:".concat(C.semantic).concat(C.ssrcIds.map(w=>"".concat(c).concat(w.toString(10))).join("")).concat(this.eol)).join("")}}function L(k){return new V().parse(k)}function G(k,E){return new Yt().print(k,E)}}},e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}return n.d=(r,i)=>{for(var o in i)n.o(i,o)&&!n.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:i[o]})},n.o=(r,i)=>Object.prototype.hasOwnProperty.call(r,i),n.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n(8)})();var $e=rF.exports;function iy(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:A("SVC_MODE");if(A("ENABLE_SVC"))return function(e){return e in Yv}(t)?t:Yv.L1T3}function wP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function AP(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?wP(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wP(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function th(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;const{filterRTX:i,filterVideoFec:o,filterAudioFec:s,filterAudioCodec:a,filterVideoCodec:c}=e,{useXR:d}=n;let l=[],u=[],h=[],p=[],S=!1,f=!1;if($e.parse(t).mediaDescriptions.forEach(T=>{r&&r!==T.attributes.direction||(T.media.mediaType!=="video"||S||(u=T.attributes.payloads,p=T.attributes.extmaps,S=!0),T.media.mediaType!=="audio"||f||(l=T.attributes.payloads,h=T.attributes.extmaps,f=!0))}),!p||u.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!h||l.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(u.forEach(T=>{var g;(g=T.rtpMap)!==null&&g!==void 0&&g.clockRate&&(T.rtpMap.clockRate=parseInt(T.rtpMap.clockRate)),d&&T.rtcpFeedbacks.push({type:"rrtr"})}),l.forEach(T=>{var g;(g=T.rtpMap)!==null&&g!==void 0&&g.clockRate&&(T.rtpMap.clockRate=parseInt(T.rtpMap.clockRate)),d&&T.rtcpFeedbacks.push({type:"rrtr"})}),i&&(l=l.filter(T=>{var g;return((g=T.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())!=="rtx"}),u=u.filter(T=>{var g;return((g=T.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())!=="rtx"})),o&&(u=u.filter(T=>{var g;return!/(red)|(ulpfec)|(flexfec)/i.test(((g=T.rtpMap)===null||g===void 0?void 0:g.encodingName)||"")})),s&&(l=l.filter(T=>{var g;return!/(red)|(ulpfec)|(flexfec)/i.test(((g=T.rtpMap)===null||g===void 0?void 0:g.encodingName)||"")})),a&&(a==null?void 0:a.length)>0&&(l=l.filter(T=>{var g;return $(a).call(a,((g=T.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())||"")})),c&&(c==null?void 0:c.length)>0){const T=u.filter(g=>{var y;return $(c).call(c,((y=g.rtpMap)===null||y===void 0?void 0:y.encodingName.toLowerCase())||"")});u=T.concat(i?[]:TC(T,u))}const _=A("UNSUPPORTED_VIDEO_CODEC");return _&&_.length>0&&(u=u.filter(T=>!(T.rtpMap&&$(_).call(_,T.rtpMap.encodingName.toLowerCase())))),{audioCodecs:l,videoCodecs:u,audioExtensions:h,videoExtensions:p}}function Ds(t){const e=$e.parse(t);let n,r;for(const i of e.mediaDescriptions){if(!n){const o=i.attributes.iceUfrag,s=i.attributes.icePwd;if(!o||!s)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:o,icePwd:s}}if(!r){const o=i.attributes.fingerprints;o.length>0&&(r={fingerprints:o})}}if(!r&&e.attributes.fingerprints.length>0&&(r={fingerprints:e.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function iF(t,e){const n=[],r=t.attributes.ssrcGroups.filter(s=>s.semantic==="FID"),i=t.attributes.ssrcGroups.find(s=>s.semantic==="SIM"),o=t.attributes.ssrcs;if(i)i.ssrcIds.forEach(s=>{var a;const c=(a=r.find(d=>d.ssrcIds[0]===s))===null||a===void 0?void 0:a.ssrcIds[1];n.push({ssrcId:s,rtx:e?c:void 0})});else if(r.length>0){const s=r[0].ssrcIds[0],a=r[0].ssrcIds[1];n.push({ssrcId:s,rtx:e?a:void 0})}else{if(o.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function OP(t,e,n){const{cname:r}=t;let i=[];e&&(i=oF(e)),i.length===0&&(i=t.iceParameters.candidates.map(l=>({foundation:l.foundation,componentId:"1",transport:l.protocol,priority:l.priority.toString(),connectionAddress:l.ip,port:l.port.toString(),type:l.type,extension:{}})),m.debug("Using candidates from gateway."));const o={fingerprints:t.dtlsParameters.fingerprints.map(l=>({hashFunction:l.algorithm,fingerprint:l.fingerprint}))},s={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let a;switch(t.dtlsParameters.role){case"server":a="passive";break;case"client":a="active";break;case"auto":a="actpass"}const c=xm(t.rtpCapabilities),d=[];return Array.isArray(n)&&n.length>0&&n.forEach(l=>{d.push({kind:et.VIDEO,ssrcId:l.v,rtx:l.v_rtx,mslabel:"".concat(l.v,"_").concat(l.a)},{kind:et.AUDIO,ssrcId:l.a,mslabel:"".concat(l.v,"_").concat(l.a)})}),{dtlsParameters:o,iceParameters:s,candidates:i,rtpCapabilities:c,setup:a,cname:r,preSSRCs:d}}function oF(t){let e=[];return t.ip&&typeof t.port=="number"&&(e=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],m.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(e.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),m.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))),e}function Ca(t,e,n){const r=[],i=[];return t.forEach(o=>{let{ssrcId:s,rtx:a}=o;const c=zt(8,"track-"),d={ssrcId:s,attributes:AP({label:c,mslabel:n=n||zt(10,""),msid:"".concat(n," ").concat(c)},e&&{cname:e})};if(r.push(d),a!==void 0){const l={ssrcId:a,attributes:AP({label:c,mslabel:n,msid:"".concat(n," ").concat(c)},e&&{cname:e})};r.push(l),i.push({semantic:"FID",ssrcIds:[s,a]})}}),t.length>1&&i.push({semantic:"SIM",ssrcIds:t.map(o=>{let{ssrcId:s}=o;return s})}),{ssrcs:r,ssrcGroups:i}}function Vd(t,e){e instanceof se&&t.attributes.payloads.forEach(n=>{var r;const i=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const o=e._encoderConfig;o&&i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(o.bitrate&&!ce()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o.bitrate))),o.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(o.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(o.sampleRate)),o.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function gC(t){const e=t.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");e!==-1&&t.attributes.unrecognized.splice(e,1)}function SC(t,e){var n;if(!(e instanceof qt&&e._encoderConfig&&e._hints.indexOf(Ht.SCREEN_TRACK)===-1))return;const r=e._encoderConfig;wt().supportMinBitrate&&r.bitrateMin&&t.attributes.payloads.forEach(i=>{var o,s;$(o=["h264","h265","vp8","vp9","av1"]).call(o,((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(r.bitrateMin))}),wt().supportMinBitrate&&!$(n=e._hints).call(n,Ht.LOW_STREAM)&&r.bitrateMax&&t.attributes.payloads.forEach(i=>{var o,s;$(o=["h264","h265","vp8","vp9","av1"]).call(o,((s=i.rtpMap)===null||s===void 0?void 0:s.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(A("X_GOOGLE_START_BITRATE")||Math.floor(r.bitrateMax)))})}function sF(t){if(t.media.mediaType!=="video")return;const e=It();if(e.name!==Pt.SAFARI&&e.os!==Ve.IOS)return;const n=t.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&t.attributes.extmaps.splice(n,1)}function Um(t,e,n){if(!e)return;let r,i;if(t.media.mediaType==="video"?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),e.twcc===!0){const o=r.find(s=>s.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o&&(t.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||t.attributes.extmaps.push({entry:o.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(a,c){return c.filter(d=>!!a.find(l=>l.payloadType===d.payloadType&&!!l.rtcpFeedbacks.find(u=>u.type==="transport-cc")))}(i,t.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(c=>c.type==="transport-cc")||a.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(e.twcc===!1){const o=t.attributes.extmaps.findIndex(s=>s.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o!==-1&&t.attributes.extmaps.splice(o,1),t.attributes.payloads.forEach(s=>{const a=s.rtcpFeedbacks.findIndex(c=>c.type==="transport-cc");a!==-1&&s.rtcpFeedbacks.splice(a,1)})}if(e.remb===!0){const o=r.find(s=>s.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o&&(t.attributes.extmaps.find(a=>a.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||t.attributes.extmaps.push({entry:o.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(a,c){return c.filter(d=>!!a.find(l=>l.payloadType===d.payloadType&&!!l.rtcpFeedbacks.find(u=>u.type==="goog-remb")))}(i,t.attributes.payloads).forEach(a=>{a.rtcpFeedbacks.find(c=>c.type==="goog-remb")||a.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(e.remb===!1){const o=t.attributes.extmaps.findIndex(s=>s.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");o!==-1&&t.attributes.extmaps.splice(o,1),t.attributes.payloads.forEach(s=>{const a=s.rtcpFeedbacks.findIndex(c=>c.type==="goog-remb");a!==-1&&s.rtcpFeedbacks.splice(a,1)})}}function aF(t,e,n){if(ce()||t.media.mediaType!=="video"||!(e instanceof qt)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!A("SIMULCAST")||n==="vp9"&&A("ENABLE_SVC")||e._scalabilityMode===void 0||e._scalabilityMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:e._scalabilityMode.numSpatialLayers,i=t.attributes.ssrcs[0],o=t.attributes.ssrcGroups.find(a=>a.semantic==="FID"&&a.ssrcIds[0]===i.ssrcId),s={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let a=1;a<r;a++)t.attributes.ssrcs.push({ssrcId:i.ssrcId+a,attributes:Se(i.attributes)}),s.ssrcIds.push(i.ssrcId+a),o&&(t.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+a,attributes:Se(i.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+a,o.ssrcIds[1]+a]}));t.attributes.ssrcGroups.unshift(s)}async function cF(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=new RTCPeerConnection;n.addTransceiver("video",{direction:"sendonly"}),n.addTransceiver("audio",{direction:"sendonly"}),n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const r=(await n.createOffer()).sdp,{send:i,recv:o,sendrecv:s}=function(){let a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=arguments.length>2?arguments[2]:void 0;const l=th(d,a,c,"sendonly"),u=th(d,a,c,"recvonly"),h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vi(l,u,"videoExtensions",h,p,S),vi(l,u,"videoCodecs",h,p,S),vi(l,u,"audioExtensions",h,p,S),vi(l,u,"audioCodecs",h,p,S),A("RAISE_H264_BASELINE_PRIORITY")){const f=S.videoCodecs.findIndex(_=>{var T,g;return((T=_.rtpMap)===null||T===void 0?void 0:T.encodingName.toLocaleLowerCase())==="h264"&&((g=_.fmtp)===null||g===void 0?void 0:g.parameters["profile-level-id"])==="42001f"});if(f!==-1){const _=S.videoCodecs.findIndex(T=>{var g;return((g=T.rtpMap)===null||g===void 0?void 0:g.encodingName.toLocaleLowerCase())==="h264"});if(_<f){m.debug("raising H264 baseline profile priority");const T=S.videoCodecs[f];S.videoCodecs.splice(f,1),S.videoCodecs.splice(_,0,T)}_!==-1&&(p.videoCodecs=p.videoCodecs.filter(T=>{var g,y;return!(((g=T.rtpMap)===null||g===void 0?void 0:g.encodingName.toLocaleLowerCase())==="h264"&&((y=T.fmtp)===null||y===void 0?void 0:y.parameters["profile-level-id"])!=="42001f")})),_!==-1&&A("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter(T=>{var g,y;return!(((g=T.rtpMap)===null||g===void 0?void 0:g.encodingName.toLocaleLowerCase())==="h264"&&((y=T.fmtp)===null||y===void 0?void 0:y.parameters["profile-level-id"])!=="42001f")}))}}return{send:h,recv:p,sendrecv:S}}(t,e,r);try{n.close()}catch{}return{send:i,recv:o,sendrecv:s}}function bP(){const t={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},e=th(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vi(t,e,"videoExtensions",n,r,i),vi(t,e,"videoCodecs",n,r,i),vi(t,e,"audioExtensions",n,r,i),vi(t,e,"audioCodecs",n,r,i),A("RAISE_H264_BASELINE_PRIORITY")){const o=i.videoCodecs.findIndex(s=>s.rtpMap&&s.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&s.fmtp&&s.fmtp.parameters["profile-level-id"]==="42001f");if(o!==-1){const s=i.videoCodecs.findIndex(a=>a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(s<o){m.debug("raising H264 baseline profile priority");const a=i.videoCodecs[o];i.videoCodecs.splice(o,1),i.videoCodecs.splice(s,0,a)}s!==-1&&(r.videoCodecs=r.videoCodecs.filter(a=>!(a.rtpMap&&a.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&a.fmtp&&a.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:n,recv:r,sendrecv:i}}function vi(t,e,n,r,i,o){if(n==="videoExtensions"||n==="audioExtensions"){const s=[];return t[n].forEach(a=>{e[n].some((c,d)=>{if(a.entry===c.entry&&a.extensionName===c.extensionName)return s.push(d),!0})?o[n].push(a):r[n].push(a)}),void e[n].forEach((a,c)=>{s.indexOf(c)===-1&&i[n].push(a)})}if(n==="videoCodecs"||n==="audioCodecs"){const s=[];return t[n].forEach(a=>{e[n].some((c,d)=>{if(a.payloadType===c.payloadType&&JSON.stringify(a)===JSON.stringify(c))return s.push(d),!0})?o[n].push(a):r[n].push(a)}),void e[n].forEach((a,c)=>{s.indexOf(c)===-1&&i[n].push(a)})}}function xm(t){const{send:e,recv:n,sendrecv:r}=t;if(!r){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let i,o;return e?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...e.audioCodecs,...r.audioCodecs],i.videoCodecs=[...e.videoCodecs,...r.videoCodecs],i.audioExtensions=[...e.audioExtensions,...r.audioExtensions],i.videoExtensions=[...e.videoExtensions,...r.videoExtensions]):i=r,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...r.audioCodecs],o.videoCodecs=[...n.videoCodecs,...r.videoCodecs],o.audioExtensions=[...n.audioExtensions,...r.audioExtensions],o.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):o=r,{send:i,recv:o}}function Fd(t){t.media.mediaType==="audio"&&t.attributes.payloads.filter(e=>{var n;return((n=e.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"})}function uu(t,e,n,r){let i=[];if(t===et.VIDEO){if(A("H264_PROFILE_LEVEL_ID")&&r==="h264"&&(i=e.videoCodecs.filter(o=>{var s;return $(s=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(s,r)&&o&&o.fmtp&&o.fmtp.parameters["profile-level-id"]===A("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let o=[];const s=[],a=[],c=[];if(n.videoCodecs.forEach(d=>{const l=d.rtpMap&&d.rtpMap.encodingName.toLowerCase()||"";$(l).call(l,r)?o.push(d):$(l).call(l,"vp9")?s.push(d):$(l).call(l,"vp8")?a.push(d):$(l).call(l,"h264")&&c.push(d)}),o.length===0){let d="";s.length!==0?(o=s,d="vp9"):a.length!==0?(o=a,d="vp8"):c.length!==0&&(o=c,d="h264"),m.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(d))}o.length!==0&&(i=e.videoCodecs.filter(d=>o.some(l=>l.payloadType===d.payloadType)))}if(i.length===0&&(m.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),i=e.videoCodecs),A("USE_PUB_RTX")||A("USE_SUB_RTX")){const o=TC(i,e.videoCodecs);i=[...i,...o]}}else i=e.audioCodecs.filter(o=>{var s;return $(s=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(s,r)}),i.length===0&&(m.warning("codec ".concat(r," not included in rtpCapabilities, fallback to opus")),i=e.audioCodecs.filter(o=>{var s;return $(s=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(s,"opus")}));return i}function TC(t,e){const n=t.map(r=>r.payloadType.toString());return e.filter(r=>r.rtpMap&&r.rtpMap.encodingName==="rtx"&&r.fmtp&&r.fmtp.parameters.apt&&$(n).call(n,r.fmtp&&r.fmtp.parameters.apt))}async function Mp(t,e,n){const r=e.toString(),i=lF(r,"offer","remote","exchangeSDP");await t.setRemoteDescription({type:"offer",sdp:r});const o=await t.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let s=o.sdp;s=dF(s,n||{}),i==null||i(s||""),await t.setLocalDescription({type:"answer",sdp:s})}function dF(t,e,n){const r=$e.parse(t),{useXR:i}=e;return r.mediaDescriptions.forEach(o=>{var s;o.attributes.mid&&(Array.isArray(n)&&!$(n).call(n,o.attributes.mid)||(o.media.mediaType==="audio"&&Fd(o),i&&$(s=["audio","video"]).call(s,o.media.mediaType)&&o.attributes.payloads.forEach(a=>{a.rtcpFeedbacks.findIndex(c=>c.type==="rrtr")===-1&&a.rtcpFeedbacks.push({type:"rrtr"})})))}),$e.print(r)}function lF(t,e,n,r){if(A("SDP_LOGGING"))return m.upload("exchanging ".concat(n," ").concat(e," SDP during P2PConnection.").concat(r,`
`),t),e==="offer"?i=>{lF(i,"answer",n==="local"?"remote":"local",r)}:void 0}function io(t,e){return typeof A(t)===e?A(t):void 0}function NP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function us(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?NP(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):NP(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const SS=new Map;class ttt extends oe{get state(){return this._state}set state(e){if(e===this._state)return;const n=this._state;this._state=e,e==="DISCONNECTED"&&this._disconnectedReason?this.emit(en.CONNECTION_STATE_CHANGE,e,n,this._disconnectedReason):this.emit(en.CONNECTION_STATE_CHANGE,e,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){m.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,n){super(),v(this,"store",void 0),v(this,"joinInfo",void 0),v(this,"key",void 0),v(this,"ntpOffset",0),v(this,"signal",void 0),v(this,"role",void 0),v(this,"inChannelInfo",{joinAt:null,duration:0}),v(this,"spec",void 0),v(this,"_state","DISCONNECTED"),v(this,"_statsCollector",void 0),v(this,"_disconnectedReason",void 0),v(this,"isSignalRecover",!1),v(this,"hasChangeBGPAddress",!1),v(this,"trafficStatsInterval",void 0),v(this,"networkQualityInterval",void 0),v(this,"_joinGatewayStartTime",0),v(this,"_signalTimeout",!1),v(this,"_clientRoleOptions",void 0),v(this,"_isProactiveJoin",!1),this.store=e,this.spec=n,this.signal=this.store.useP2P?new IP(us(us({},n),{},{retryConfig:n.websocketRetryConfig}),e):new CQ(us(us({},n),{},{retryConfig:n.websocketRetryConfig}),e),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(e,n,r){this.store.joinGatewayStart(),e.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const i=Date.now();let o=SS.get(e.cname);if(o||(o=new Map,SS.set(e.cname,o)),this._isProactiveJoin=!0,o.has(e.uid)){const d=new P(R.UID_CONFLICT);throw tt.joinGateway(e.sid,{lts:i,succ:!1,ec:d.code,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,d}o.set(e.uid,!0),this.joinInfo=e,this.key=n;let s=0;this.joinGatewayStartTime=i;const a=e.proxyServer;try{m.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(s));const d=e.gatewayAddrs.map(l=>{let{address:u}=l;const[h,p]=u.split(":"),S={host:h,port:p};return e.proxyServer&&(S.proxy=e.proxyServer),S});s=(await this.signal.init(d,r)).uid,m.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(s," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(d){var c;throw m.error("[".concat(this.store.clientId,"] User join failed"),d.toString()),tt.joinGateway(e.sid,{lts:i,succ:!1,ec:((c=d.data)===null||c===void 0?void 0:c.desc)||d.code,errorMsg:d.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!a,signalChannel:"0",preload:e.preload}),this._isProactiveJoin=!1,o.delete(e.uid),this.signal.close(),d}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),m.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(d=>{m.warning("[".concat(this.store.clientId,"] get traffic stats error"),d.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(en.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(en.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(en.NETWORK_QUALITY,{uplinkNetworkQuality:vb(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:vb(this._statsCollector.trafficStats.B_dnq)}):this.emit(en.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),s}async leave(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==kt.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Kt.CONNECTED||await function(r,i){return i===1/0?r:Y.race([r,vX(i)])}(this.signal.request(st.LEAVE,void 0,!0),3e3)}catch(r){m.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==kt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:A("PUB_EXTEND"),twcc:!!A("PUBLISH_TWCC"),rtx:!!A("USE_PUB_RTX")};try{return(await this.signal.request(st.PUBLISH,i,!0))._message}catch(o){if(r&&o.data&&o.data.code===rt.ERR_PUBLISH_REQUEST_INVALID)return m.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),o.toString()),await this.tryUnpubBeforeRepub(e,n),this.publish(e,n,!1);throw o}}async publishDataChannel(e,n,r){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={stream_id:n.streamId,ordered:n.ordered?1:0,max_retrans_times:(i=n.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:n.channelId,metadata:n.metadata};try{await this.signal.request(st.PUBLISH_DATASTREAM,o,!0)}catch(s){if(r&&s.data&&s.data.code===rt.ERR_PUBLISH_REQUEST_INVALID)return m.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),s.toString()),await this.tryUnpubDataChannelBeforeRepub(e,n),this.publishDataChannel(e,n,!1);throw s}}async unpublish(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(st.UNPUBLISH,{stream_id:n,ortc:e},!0)}catch(r){m.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async unpublishDataChannel(e){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Y.all(e.map(n=>this.signal.request(st.UNPUBLISH_DATASTREAM,{channel_id:n},!0)))}catch(n){m.warning("unpublish datachannels warning: ",n)}}async presubscribe(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const i={stream_id:e,stream_type:n,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!A("SUBSCRIBE_TWCC"),rtx:!!A("USE_SUB_RTX")||void 0,extend:A("SUB_EXTEND"),svc:Array.isArray(A("SVC"))&&A("SVC").length!==0?A("SVC"):void 0};try{return await this.signal.request(st.PRE_SUBSCRIBE,i,!0)}catch(o){if(r&&o.data&&o.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return m.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),o.toString()),this.presubscribe(e,n,!1);throw o}}async subscribe(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:e,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!A("SUBSCRIBE_TWCC"),rtx:!!A("USE_SUB_RTX"),extend:A("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(A("SVC"))&&A("SVC").length!==0?A("SVC"):void 0};try{return(await this.signal.request(st.SUBSCRIBE,i,!0))._message}catch(o){if(r&&o.data&&o.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return m.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),o.toString()),await this.tryUnsubBeforeResub(e,n),await this.subscribe(e,n,!1);throw o}}async subscribeDataChannel(e,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:e,stream_id:n.id,channel_id:n.datachannelId};try{return void await this.signal.request(st.SUBSCRIBE_DATASTREAM,i,!0)}catch(o){if(r&&o.data&&o.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return m.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),o.toString()),await this.tryUnsubDataChannelBeforeResub(e,n),await this.subscribeDataChannel(e,n,!1);throw o}}async subscribeAll(e,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!A("USE_SUB_RTX"),twcc:!!A("SUBSCRIBE_TWCC"),svc:Array.isArray(A("SVC"))&&A("SVC").length!==0?A("SVC"):void 0};try{return await this.signal.request(st.SUBSCRIBE_STREAMS,r,!0)}catch(i){if(n&&i.data&&i.data.code===rt.ERR_SUBSCRIBE_REQUEST_INVALID)return m.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw i}}async setVideoProfile(e){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let i=r.frameRate,o=r.width,s=r.height,a=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(a=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(a=!1)),typeof s!="number"&&(s=s.exact||s.ideal||s.max||s.min||0,i||(a=!1)),a?{stream_type:0,width:o,height:s,fps:i,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(e);if(n)return this.signal.request(st.SET_VIDEO_PROFILE,n);m.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,n){try{await this.signal.request(st.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:n},!0)}catch(r){m.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async unsubscribeDataChannel(e,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await Y.all(e.map(r=>this.signal.request(st.UNSUBSCRIBE_DATASTREAM,{stream_id:r,uid:n},!0)))}catch(r){m.warning("unsubscribeDataChannel warning: ",r)}}async massUnsubscribe(e){try{await this.signal.request(st.UNSUBSCRIBE_STREAMS,e,!0)}catch(n){m.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(e){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=e;return{gatewayEstablishParams:await this.signal.request(st.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(st.GATEWAY_INFO)}async renewToken(e){await this.signal.request(st.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=e);let r,i=0;e==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(r=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,await this.signal.request(st.SET_CLIENT_ROLE,{role:e,level:i,delay:r,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,n){await this.signal.request(st.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:n})}async setDefaultRemoteVideoStreamType(e){await this.signal.request(st.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,n){await this.signal.request(st.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:n})}async pickSVCLayer(e,n){await this.signal.request(st.PICK_SVC_LAYER,{stream_id:e,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}async setRTM2Flag(e){await this.signal.request(st.SET_RTM2_FLAG,{rtm2_flag:e})}async sendExtensionMessage(e,n,r){if(this.signal instanceof IP)return this.signal.sendExtensionMessage(e,n,r)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),us({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(st.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=SS.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:nn.username,password:nn.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(us(us({},nn),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const e=await this.signal.request(st.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.ntp_offset!=null&&(this.ntpOffset=e.ntp_offset),e.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&j_(()=>{this.emit(en.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new P(R.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let r=A("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}r&&r.length>128&&(r=void 0);const i=!(ce()||nV(87)||Yb())&&typeof A("ENABLE_PRE_SUB")=="boolean"&&A("ENABLE_PRE_SUB"),o=!Yb()&&io("ENABLE_PREALLOC_PC","boolean"),s=us({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:zr,browser:navigator.userAgent,process_id:A("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:A("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:{enablePublishedUserList:A("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:A("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof A("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?A("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof A("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?A("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof A("ENABLE_USER_LICENSE_CHECK")=="boolean"?A("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:A("USE_PUB_RTX")===!0||A("USE_SUB_RTX")===!0||void 0,disableFEC:A("DISABLE_FEC"),enableNTPReport:!!A("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!A("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!A("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:io("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!A("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!A("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:io("USE_XR","boolean"),enableLossbasedBwe:io("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!A("ENABLE_AUT_CC")||void 0,enableCCFallback:io("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:o,preSubNum:i?io("PRE_SUB_NUM","number"):void 0,enablePubTWCC:io("PUBLISH_TWCC","boolean"),enableSubTWCC:io("SUBSCRIBE_TWCC","boolean"),enablePubRTX:io("USE_PUB_RTX","boolean"),enableSubRTX:io("USE_SUB_RTX","boolean"),enableSubSVC:A("ENABLE_SVC")?A("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(A("SVC"))&&A("SVC").length!==0?A("SVC"):void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(s.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(s.aes_mode=this.joinInfo.aesmode,A("ENCRYPT_AES")?(s.aes_secret=this.joinInfo.aespassword,s.aes_encrypt=!0):s.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(s.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(s.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(s.default_video_stream=this.joinInfo.defaultVideoStream),s}getRejoinMessage(){if(!this.joinInfo)throw new P(R.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(at.WS_RECONNECT_WAITTING_FINISH,e=>{var n;$(n=["tryNext","recover"]).call(n,e)&&this.joinInfo&&tt.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(at.WS_RECONNECT_CREATE_CONNECTION,e=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(at.WS_RECONNECTING,e=>{this.joinInfo&&tt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||sn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",tt.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:2}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(at.WS_CLOSED,e=>{let n;switch(e){case kt.LEAVE:n=sn.LEAVE;break;case kt.UID_BANNED:case kt.IP_BANNED:case kt.CHANNEL_BANNED:case kt.SERVER_ERROR:n=sn.SERVER_ERROR;break;case kt.FALLBACK:n=sn.FALLBACK;break;case kt.LICENSE_MISSING:case kt.LICENSE_EXPIRED:case kt.LICENSE_MINUTES_EXCEEDED:case kt.LICENSE_PERIOD_INVALID:case kt.LICENSE_MULTIPLE_SDK_SERVICE:case kt.LICENSE_ILLEGAL:case kt.TOKEN_EXPIRE:n=e;break;default:n=sn.NETWORK_ERROR}m.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+sn.NETWORK_ERROR)),this.joinInfo&&tt.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===kt.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=e,e!==kt.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(at.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(m.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),tt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void m.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));xt("EVENT_REPORT_DOMAIN",e[1]),xt("EVENT_REPORT_BACKUP_DOMAIN",e[1]),xt("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}}),this.signal.on(Et.ON_UPLINK_STATS,e=>{this._statsCollector.updateUplinkStats(e)}),this.signal.on(at.REQUEST_RECOVER,(e,n,r)=>{if(!this.joinInfo)return r(new P(R.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,cn(this,en.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(at.REQUEST_JOIN_INFO,async e=>{var n;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void e(this.getJoinMessage({ortc:{}}));const{iceParameters:r,dtlsParameters:i,rtpCapabilities:o}=await cn(this,en.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});e(this.getJoinMessage({ortc:{iceParameters:r,dtlsParameters:i,rtpCapabilities:o,version:"2"}}))}),this.signal.on(at.REQUEST_REJOIN_INFO,e=>{e(this.getRejoinMessage())}),this.signal.on(at.REPORT_JOIN_GATEWAY,(e,n)=>{if(!this.joinInfo)return;let r,i="";var o;e instanceof P?(r=((o=e.data)===null||o===void 0?void 0:o.desc)||e.code,i=e.message):r=e,tt.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:r,errorMsg:i,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload}),this._isProactiveJoin=!1}),this.signal.on(at.IS_P2P_DISCONNECTED,e=>{e(qu(this,en.IS_P2P_DISCONNECTED))}),this.signal.on(at.DISCONNECT_P2P,()=>{this.emit(en.DISCONNECT_P2P)}),this.signal.on(at.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(at.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(at.JOIN_RESPONSE,e=>{const n=this.getCurrentGatewayAddress();this.emit(en.JOIN_RESPONSE,e,n)}),this.signal.on(at.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();const e=this.getCurrentGatewayAddress(),n=A("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(e&&n){const r=oF(e);this.emit(en.PRE_CONNECT_PC,{candidates:r,fingerprint:n})}}}),this.signal.on(at.RECOVER_NOTIFICATION,e=>{this.joinInfo&&typeof A("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(A("AP_REQUEST_DETAIL"),";").concat(e))})}async tryUnsubBeforeResub(e,n){try{await this.signal.request(st.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[n]},!0)}catch(r){throw m.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnsubDataChannelBeforeResub(e,n){try{await this.signal.request(st.UNSUBSCRIBE,{stream_id:n.id},!0)}catch(r){throw m.warning("unsubscribe datachannel warning",r),r}}async tryUnpubBeforeRepub(e,n){try{await this.signal.request(st.UNPUBLISH,{stream_id:e,ortc:n},!0)}catch(r){throw m.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryUnpubDataChannelBeforeRepub(e,n){try{await this.signal.request(st.UNPUBLISH_DATASTREAM,{channnel_id:n.channelId},!0)}catch(r){throw m.warning("unpublish datastream warning: ",r),r}}async tryMassUnsubBeforeResub(e){const n={users:e.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(st.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw m.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(e,n){const r={action:e.find(i=>i.stream_type===Nt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(st.CONTROL,r,!0,!0)}catch(i){throw m.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(e,n){const r={action:e.find(i=>i.stream_type===Nt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:n};try{await this.signal.request(st.CONTROL,r,!0,!0)}catch(i){throw m.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(e,n){const r={action:e===et.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(st.CONTROL,r,!0,!0)}catch(i){throw m.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(e,n){const r={action:e===et.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:n};try{await this.signal.request(st.CONTROL,r,!0,!0)}catch(i){throw m.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(e){this.signal.uploadWRTCStats(e)}upload(e,n){this.signal.upload(e,n)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request(st.RESTART_ICE,n,!0)}catch(r){throw m.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,sn.P2P_FAILED)}getCurrentGatewayAddress(){var e,n;if(!A("GATEWAY_WSS_ADDRESS"))return A("USE_CANDIDATE_FROM_AP_DETAIL")&&(e=this.joinInfo)!==null&&e!==void 0&&e.apGatewayAddress?(m.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(n=this.joinInfo)!==null&&n!==void 0&&n.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request(st.SET_PARAMETER,{enablePublishAudioFilter:e})}}let Up=0,TS=0;function Ji(t,e,n,r){return new Y((i,o)=>{e.timeout=e.timeout||A("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),Up+=mo(e.data)):n&&(e.data.size?Up+=e.data.size:e.data instanceof FormData?Up+=pV(e.data):Up+=mo(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,Gn.request(e).then(s=>{typeof s.data=="string"?TS+=mo(s.data):s.data instanceof ArrayBuffer||s.data instanceof Uint8Array?TS+=s.data.byteLength:TS+=mo(JSON.stringify(s.data)),r&&i({data:s.data,headers:s.headers}),i(s.data)}).catch(s=>{Gn.isCancel(s)?o(new P(R.OPERATION_ABORTED,"cancel token canceled")):s.code==="ECONNABORTED"?o(new P(R.NETWORK_TIMEOUT,s.message)):s.response?o(new P(R.NETWORK_RESPONSE_ERROR,s.response.status)):o(new P(R.NETWORK_ERROR,s.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var t;function e(F){var L=0;return function(){return L<F.length?{done:!1,value:F[L++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(F,L,G){return F==Array.prototype||F==Object.prototype||(F[L]=G.value),F},r,i=function(F){F=[typeof globalThis=="object"&&globalThis,F,typeof window=="object"&&window,typeof self=="object"&&self,typeof fd=="object"&&fd];for(var L=0;L<F.length;++L){var G=F[L];if(G&&G.Math==Math)return G}throw Error("Cannot find global object")}(this);function o(F,L){if(L)t:{var G=i;F=F.split(".");for(var k=0;k<F.length-1;k++){var E=F[k];if(!(E in G))break t;G=G[E]}(L=L(k=G[F=F[F.length-1]]))!=k&&L!=null&&n(G,F,{configurable:!0,writable:!0,value:L})}}function s(F){return(F={next:F})[Symbol.iterator]=function(){return this},F}function a(F){var L=typeof Symbol<"u"&&Symbol.iterator&&F[Symbol.iterator];return L?L.call(F):{next:e(F)}}if(o("Symbol",function(F){function L(E,C){this.A=E,n(this,"description",{configurable:!0,writable:!0,value:C})}if(F)return F;L.prototype.toString=function(){return this.A};var G="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",k=0;return function E(C){if(this instanceof E)throw new TypeError("Symbol is not a constructor");return new L(G+(C||"")+"_"+k++,C)}}),o("Symbol.iterator",function(F){if(F)return F;F=Symbol("Symbol.iterator");for(var L="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),G=0;G<L.length;G++){var k=i[L[G]];typeof k=="function"&&typeof k.prototype[F]!="function"&&n(k.prototype,F,{configurable:!0,writable:!0,value:function(){return s(e(this))}})}return F}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var c;t:{var d={};try{d.__proto__={a:!0},c=d.a;break t}catch{}c=!1}r=c?function(F,L){if(F.__proto__=L,F.__proto__!==L)throw new TypeError(F+" is not extensible");return F}:null}var l=r;function u(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(F){if(F.m)throw new TypeError("Generator is already running");F.m=!0}function p(F,L){return F.h=3,{value:L}}function S(F){this.g=new u,this.G=F}function f(F,L,G,k){try{var E=L.call(F.g.j,G);if(!(E instanceof Object))throw new TypeError("Iterator result "+E+" is not an object");if(!E.done)return F.g.m=!1,E;var C=E.value}catch(w){return F.g.j=null,F.g.s(w),_(F)}return F.g.j=null,k.call(F.g,C),_(F)}function _(F){for(;F.g.h;)try{var L=F.G(F.g);if(L)return F.g.m=!1,{value:L.value,done:!1}}catch(G){F.g.v=void 0,F.g.s(G)}if(F.g.m=!1,F.g.l){if(L=F.g.l,F.g.l=null,L.F)throw L.D;return{value:L.return,done:!0}}return{value:void 0,done:!0}}function T(F){this.next=function(L){return F.o(L)},this.throw=function(L){return F.s(L)},this.return=function(L){return function(G,k){h(G.g);var E=G.g.j;return E?f(G,"return"in E?E.return:function(C){return{value:C,done:!0}},k,G.g.return):(G.g.return(k),_(G))}(F,L)},this[Symbol.iterator]=function(){return this}}function g(F,L){return L=new T(new S(L)),l&&F.prototype&&l(L,F.prototype),L}if(u.prototype.o=function(F){this.v=F},u.prototype.s=function(F){this.l={D:F,F:!0},this.h=this.C||this.u},u.prototype.return=function(F){this.l={return:F},this.h=this.u},S.prototype.o=function(F){return h(this.g),this.g.j?f(this,this.g.j.next,F,this.g.o):(this.g.o(F),_(this))},S.prototype.s=function(F){return h(this.g),this.g.j?f(this,this.g.j.throw,F,this.g.o):(this.g.s(F),_(this))},o("Array.prototype.entries",function(F){return F||function(){return function(L,G){L instanceof String&&(L+="");var k=0,E=!1,C={next:function(){if(!E&&k<L.length){var w=k++;return{value:G(w,L[w]),done:!1}}return E=!0,{done:!0,value:void 0}}};return C[Symbol.iterator]=function(){return C},C}(this,function(L,G){return[L,G]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var y=function(F,L){for(var G=0;G<F.length;G++)L(F[G])},I=function(F){return F.replace(/\r?\n|\r/g,`\r
`)},O=function(F,L,G){return L instanceof Blob?(G=G!==void 0?G+"":typeof L.name=="string"?L.name:"blob",L.name===G&&Object.prototype.toString.call(L)!=="[object Blob]"||(L=new File([L],G)),[String(F),L]):[String(F),String(L)]},b=function(F,L){if(F.length<L)throw new TypeError(L+" argument required, but only "+F.length+" present.")},N=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,U=N.FormData,V=N.XMLHttpRequest&&N.XMLHttpRequest.prototype.send,W=N.Request&&N.fetch,lt=N.navigator&&N.navigator.sendBeacon,mt=N.Element&&N.Element.prototype,St=N.Symbol&&Symbol.toStringTag;St&&(Blob.prototype[St]||(Blob.prototype[St]="Blob"),"File"in N&&!File.prototype[St]&&(File.prototype[St]="File"));try{new File([],"")}catch{N.File=function(L,G,k){return L=new Blob(L,k||{}),Object.defineProperties(L,{name:{value:G},lastModified:{value:+(k&&k.lastModified!==void 0?new Date(k.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),St&&Object.defineProperty(L,St,{value:"File"}),L}}var Yt=function(F){return F.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Lt=function(F){this.i=[];var L=this;F&&y(F.elements,function(G){if(G.name&&!G.disabled&&G.type!=="submit"&&G.type!=="button"&&!G.matches("form fieldset[disabled] *"))if(G.type==="file"){var k=G.files&&G.files.length?G.files:[new File([],"",{type:"application/octet-stream"})];y(k,function(E){L.append(G.name,E)})}else G.type==="select-multiple"||G.type==="select-one"?y(G.options,function(E){!E.disabled&&E.selected&&L.append(G.name,E.value)}):G.type==="checkbox"||G.type==="radio"?G.checked&&L.append(G.name,G.value):(k=G.type==="textarea"?I(G.value):G.value,L.append(G.name,k))})};if((t=Lt.prototype).append=function(F,L,G){b(arguments,2),this.i.push(O(F,L,G))},t.delete=function(F){b(arguments,1);var L=[];F=String(F),y(this.i,function(G){G[0]!==F&&L.push(G)}),this.i=L},t.entries=function F(){var L,G=this;return g(F,function(k){if(k.h==1&&(L=0),k.h!=3)return L<G.i.length?k=p(k,G.i[L]):(k.h=0,k=void 0),k;L++,k.h=2})},t.forEach=function(F,L){b(arguments,1);for(var G=a(this),k=G.next();!k.done;k=G.next()){var E=a(k.value);k=E.next().value,E=E.next().value,F.call(L,E,k,this)}},t.get=function(F){b(arguments,1);var L=this.i;F=String(F);for(var G=0;G<L.length;G++)if(L[G][0]===F)return L[G][1];return null},t.getAll=function(F){b(arguments,1);var L=[];return F=String(F),y(this.i,function(G){G[0]===F&&L.push(G[1])}),L},t.has=function(F){b(arguments,1),F=String(F);for(var L=0;L<this.i.length;L++)if(this.i[L][0]===F)return!0;return!1},t.keys=function F(){var L,G,k,E,C=this;return g(F,function(w){if(w.h==1&&(L=a(C),G=L.next()),w.h!=3)return G.done?void(w.h=0):(k=G.value,E=a(k),p(w,E.next().value));G=L.next(),w.h=2})},t.set=function(F,L,G){b(arguments,2),F=String(F);var k=[],E=O(F,L,G),C=!0;y(this.i,function(w){w[0]===F?C&&(C=!k.push(E)):k.push(w)}),C&&k.push(E),this.i=k},t.values=function F(){var L,G,k,E,C=this;return g(F,function(w){if(w.h==1&&(L=a(C),G=L.next()),w.h!=3)return G.done?void(w.h=0):(k=G.value,(E=a(k)).next(),p(w,E.next().value));G=L.next(),w.h=2})},Lt.prototype._asNative=function(){for(var F=new U,L=a(this),G=L.next();!G.done;G=L.next()){var k=a(G.value);G=k.next().value,k=k.next().value,F.append(G,k)}return F},Lt.prototype._blob=function(){var F="----formdata-polyfill-"+Math.random(),L=[],G="--"+F+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(k,E){return typeof k=="string"?L.push(G+Yt(I(E))+`"\r
\r
`+I(k)+`\r
`):L.push(G+Yt(I(E))+'"; filename="'+Yt(k.name)+`"\r
Content-Type: `+(k.type||"application/octet-stream")+`\r
\r
`,k,`\r
`)}),L.push("--"+F+"--"),new Blob(L,{type:"multipart/form-data; boundary="+F})},Lt.prototype[Symbol.iterator]=function(){return this.entries()},Lt.prototype.toString=function(){return"[object FormData]"},mt&&!mt.matches&&(mt.matches=mt.matchesSelector||mt.mozMatchesSelector||mt.msMatchesSelector||mt.oMatchesSelector||mt.webkitMatchesSelector||function(F){for(var L=(F=(this.document||this.ownerDocument).querySelectorAll(F)).length;0<=--L&&F.item(L)!==this;);return-1<L}),St&&(Lt.prototype[St]="FormData"),V){var Ze=N.XMLHttpRequest.prototype.setRequestHeader;N.XMLHttpRequest.prototype.setRequestHeader=function(F,L){Ze.call(this,F,L),F.toLowerCase()==="content-type"&&(this.B=!0)},N.XMLHttpRequest.prototype.send=function(F){F instanceof Lt?(F=F._blob(),this.B||this.setRequestHeader("Content-Type",F.type),V.call(this,F)):V.call(this,F)}}W&&(N.fetch=function(F,L){return L&&L.body&&L.body instanceof Lt&&(L.body=L.body._blob()),W.call(this,F,L)}),lt&&(N.navigator.sendBeacon=function(F,L){return L instanceof Lt&&(L=L._asNative()),lt.call(this,F,L)}),N.FormData=Lt}})();const eh=()=>{const t=A("AREAS");return t.length===0&&t.push(Ot.GLOBAL),zi(t).call(t,(e,n,r)=>{const i=uF(n);return i?r===0?i:"".concat(e,",").concat(i):e},"")},uF=t=>t===Ot.OVERSEA?"".concat(ln.ASIA,",").concat(ln.EUROPE,",").concat(ln.AFRICA,",").concat(ln.NORTH_AMERICA,",").concat(ln.SOUTH_AMERICA,",").concat(ln.OCEANIA):ln[t],ett=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map(n=>{const r=K_[n],i=Object.keys(r);i&&i.map(o=>{o!=="CODE"&&(e[o]=e[o].concat(r[o]))})}),e},Lf={GLOBAL:{ASIA:[Ot.CHINA,Ot.JAPAN,Ot.INDIA,Ot.KOREA,Ot.HKMC],EUROPE:[],NORTH_AMERICA:[Ot.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},xp=Object.keys(Lf[Ot.GLOBAL]),vS=[Ot.CHINA,Ot.NORTH_AMERICA,Ot.EUROPE,Ot.ASIA,Ot.JAPAN,Ot.INDIA,Ot.OCEANIA,Ot.SOUTH_AMERICA,Ot.AFRICA,Ot.KOREA,Ot.HKMC,Ot.US],ntt=function(t,e){let n=[];if($(t).call(t,Ot.GLOBAL)){const o=[Ot.GLOBAL,Ot.OVERSEA],s=Object.keys(K_);if(e===Ot.GLOBAL)throw new P(R.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===Ot.CHINA)n=[Ot.OVERSEA];else if(i=e,$(xp).call(xp,i)){const a=(r=e,Lf[Ot.GLOBAL][r]||[]),c=[...o,e,...a];n=s.filter(d=>!$(c).call(c,d))}else if(function(a){let c=!1;return xp.forEach(d=>{var l;$(l=Lf[Ot.GLOBAL][d]).call(l,a)&&(c=!0)}),c}(e)){const a=function(d){let l;return xp.forEach(u=>{var h;$(h=Lf[Ot.GLOBAL][u]).call(h,d)&&(l=u)}),l}(e),c=[...o,a,e];n=s.filter(d=>!$(c).call(c,d))}else n=t;n=function(a){const c=[];return vS.forEach(d=>{$(a).call(a,d)&&c.push(d)}),c.concat(a.filter(d=>!$(vS).call(vS,d)))}(n)}else n=t;var r,i;return n};function PP(t){var e,n;if(!t&&$(e=A("AREAS")).call(e,Ot.EXTENSIONS))return m.debug("update area from ap : reset"),void vC(PX,!0);if(!$(n=A("AREAS")).call(n,Ot.GLOBAL)||!t)return;let r=K_.EXTENSIONS;r&&(r={CODE:uF(Ot.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},m.debug("update area from ap success: ".concat(t,",config is "),r),xt("AREAS",[Ot.EXTENSIONS],!0),Object.keys(r).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?xt(i,r[i][0]):xt(i,r[i])}))}function vC(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=tt.reportApiInvoke(null,{name:Ne.SET_AREA,options:t,tag:ae.TRACER});try{let r=[];if(typeof t=="string"&&(r=[t]),Array.isArray(t)&&(t.forEach(o=>{if(!$(fb).call(fb,o))throw new P(R.INVALID_PARAMS,"invalid area code")}),r=t),Object.prototype.toString.call(t)==="[object Object]"){const{areaCode:o,excludedArea:s}=t;if(!o)throw new P(R.INVALID_PARAMS,"area code is needed");let a=o;typeof o=="string"&&(a=[o]),r=s?ntt(a,s):a}if(!e){if(bs.AREAS){const o=new P(R.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(o),void m.warning("setArea is prohibited because of config-distribute")}if($(r).call(r,Ot.GLOBAL)&&A("AREAS")===Ot.EXTENSIONS){const o=new P(R.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(o),void m.warning("setArea is prohibited because of ap extensions")}}xt("AREAS",r,e);const i=ett(r);Object.keys(i).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?xt(o,i[o][0]):xt(o,i[o])}),m.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function DP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Vm(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?DP(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):DP(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let yS=1;function rtt(t,e,n,r,i){yS+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:yS,requestId:yS,version:zr,cname:n.cname},s={service_name:e,json_body:JSON.stringify(o)};let a,c,d=t[0];return qi(async()=>{a=Date.now();const l=await Ji(d,{data:s,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-a,l.code!==0){const p=new P(R.UNEXPECTED_RESPONSE,"live streaming ap error, code"+l.code,{retry:!0,responseTime:c});throw m.error(p.toString()),p}const u=JSON.parse(l.json_body);if(u.code!==200){const p=new P(R.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(u.code,", reason: ").concat(u.reason),{code:u.code,responseTime:c});throw m.error(p.toString()),p}if(!u.servers||u.servers.length===0){const p=new P(R.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:u.code,responseTime:c});throw m.error(p.toString()),p}const h=function(p,S){return{addressList:p.servers.map(f=>"wss://".concat(f.address.replace(/\./g,"-"),".").concat(A("WORKER_DOMAIN"),":").concat(f.wss,"?serviceName=").concat(encodeURIComponent(S))),workerToken:p.workerToken,vid:p.vid}}(u,e);return A("LIVE_STREAMING_ADDRESS")&&(h.addressList=A("LIVE_STREAMING_ADDRESS")instanceof Array?A("LIVE_STREAMING_ADDRESS"):[A("LIVE_STREAMING_ADDRESS")]),Vm(Vm({},h),{},{responseTime:c})},(l,u)=>(tt.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(l.addressList),firstSuccess:u===0,responseTime:c,serverIp:t[u%t.length]}),!1),(l,u)=>(tt.apworkerEvent(n.sid,{success:!1,sc:l.data&&l.data.code||200,serviceName:e,responseTime:c,serverIp:t[u%t.length]}),!!(l.code!==R.OPERATION_ABORTED&&l.code!==R.UNEXPECTED_RESPONSE||l.data&&l.data.retry)&&(d=t[(u+1)%t.length],!0)),i)}let RS=1;function kP(t,e,n,r){let{url:i,areaCode:o}=t;const{clientId:s,sid:a}=e,c=Date.now();let d;const[l,u]=RC(e,o,[Te.CHOOSE_SERVER]);let h=ve.networkState;return qi(async()=>{h&&ve.networkState===or.OFFLINE&&ve.onlineWaiter&&await Y.race([ve.onlineWaiter,Je(r&&r.maxRetryTimeout||we.maxRetryTimeout)]),h=ve.networkState;const{data:p,headers:S}=await Ji(i,{data:l,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);d=S.http3==="1"?1:-1,tt.reportResourceTiming(i,a),hF(p,i,e,c,[Te.CHOOSE_SERVER],d);const f=Zu(p,Te.CHOOSE_SERVER);return yC(f),lC(f,i)},p=>(p&&tt.joinChooseServer(a,{lts:c,succ:!0,csAddr:i,opid:u,serverList:p.gatewayAddrs.map(S=>S.address),ec:null,cid:p.cid.toString(),uid:p.uid.toString(),csIp:p.csIp,unilbsServerIds:[Te.CHOOSE_SERVER].toString(),isHttp3:d,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:p.res.detail&&p.res.detail[38]}),!1),p=>p.code!==R.OPERATION_ABORTED&&(p.code===R.CAN_NOT_GET_GATEWAY_SERVER?p.data.retry:(tt.joinChooseServer(a,{lts:c,succ:!1,csAddr:i,serverList:null,opid:u,ec:p.code,csIp:p.data&&p.data.csIp,unilbsServerIds:[Te.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:h}),isHttp3:d,corssRegionTagReq:e.apRequestDetail}),m.warning("[".concat(s||"sid-".concat(a.slice(0,6)),"] Choose server network error, retry"),p),!0)),r)}function LP(t,e,n,r){let i,{url:o,areaCode:s,serviceIds:a}=t;const c=Date.now(),[d,l]=RC(e,s,a);let u;return qi(async()=>{u&&ve.networkState===or.OFFLINE&&ve.onlineWaiter&&await Y.race([ve.onlineWaiter,Je(r&&r.maxRetryTimeout||we.maxRetryTimeout)]),u=ve.networkState;const{data:h,headers:p}=await Ji(o,{data:d,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=p.http3==="1"?1:-1,tt.reportResourceTiming(o,e.sid),hF(h,o,e,c,a,i);const S=Zu(h,Te.CHOOSE_SERVER),f=Zu(h,e.cloudProxyServer==="proxy5"?Te.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Te.CLOUD_PROXY:Te.CLOUD_PROXY_FALLBACK);return yC(S),{gatewayInfo:lC(S,o),proxyInfo:f,url:o}},h=>(h.gatewayInfo&&tt.joinChooseServer(e.sid,{lts:c,succ:!0,csAddr:o,serverList:h.gatewayInfo.gatewayAddrs.map(p=>p.address),ec:null,opid:l,cid:h.gatewayInfo.cid.toString(),uid:h.gatewayInfo.uid.toString(),csIp:h.gatewayInfo.csIp,unilbsServerIds:a.toString(),isHttp3:i,corssRegionTagReq:e.apRequestDetail,corssRegionTagRes:h.gatewayInfo.res.detail&&h.gatewayInfo.res.detail[38]}),h.proxyInfo&&tt.joinWebProxyAP(e.sid,{lts:c,sucess:1,apServerAddr:o,turnServerAddrList:h.proxyInfo.addresses.map(p=>p.ip).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:a.toString()}),!1),h=>h.code!==R.OPERATION_ABORTED&&(h.code===R.CAN_NOT_GET_GATEWAY_SERVER?h.data.retry:(tt.joinWebProxyAP(e.sid,{lts:c,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:h.code,eventType:e.cloudProxyServer,unilbsServerIds:a.toString(),extend:JSON.stringify({networkState:u})}),m.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),h),!0)),r)}const hF=(t,e,n,r,i,o)=>{const{sid:s,clientId:a,cloudProxyServer:c}=n,d=[],l=u=>{u.flag===4096?tt.joinChooseServer(s,{lts:r,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:u.error.message,csIp:u.error.data&&u.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o,corssRegionTagReq:n.apRequestDetail}):u.flag!==1048576&&u.flag!==4194304&&u.flag!==4194310||tt.joinWebProxyAP(s,{lts:r,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:u.error.code,eventType:c,unilbsServerIds:i.toString()})};if(t.response_body.forEach(u=>{const h=u.buffer.code;if(u.uri===23&&h===0&&!u.buffer.edges_services)if(u.buffer.flag===4194310)m.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),u.buffer.edges_services=[];else{const p={error:new P(R.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:u.buffer.flag};d.push(p),l(p)}if(h!==0){const p=Md(h),S={error:new P(R.CAN_NOT_GET_GATEWAY_SERVER,p.desc,{desc:p.desc,retry:p.retry,csIp:t.detail[502]}),flag:u.buffer.flag};u.buffer.flag===4194310?m.warning(S.error.toString()):d.push(S),l(S)}}),d.length)throw m.warning("[".concat(a||"sid-".concat(s.slice(0,6)),"] multi unilbs ").concat(e," failed, ").concat(d.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message,", retry: ").concat(u.error.data.retry)).join(" | "))),new P(R.CAN_NOT_GET_GATEWAY_SERVER,d.map(u=>"flag: ".concat(u.flag,", message: ").concat(u.error.message)).join(" | "),{retry:!!d.find(u=>u.error.data.retry),csIp:t.detail[502],desc:[...new Set(d.map(u=>{var h;return u==null||(h=u.error)===null||h===void 0||(h=h.data)===null||h===void 0?void 0:h.desc}).filter(u=>!!u))]})},yC=t=>{var e,n,r,i;if(t.addresses&&t.addresses.length===0&&t.code===0)throw new P(R.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(A("AP_AREA")&&((r=t.detail)!==null&&r!==void 0&&r[23]&&typeof((i=t.detail)===null||i===void 0?void 0:i[23])=="string"?PP(t.detail[23].toLowerCase()):PP()),(e=t.detail)!==null&&e!==void 0&&e[19]&&typeof((n=t.detail)===null||n===void 0?void 0:n[19])=="string"){const s=t.detail[19],a=s==null?void 0:s.split(";");for(let c=0;c<a.length;c++){var o;const d=Cn(o=a[c]).call(o);t.addresses[c]&&a&&(t.addresses[c].fingerprint=d)}}if(A("GATEWAY_ADDRESS")&&A("GATEWAY_ADDRESS").length>0){m.debug("assign gateway address to",A("GATEWAY_ADDRESS"));const s=A("GATEWAY_ADDRESS").map(a=>{var c,d;const l=(c=(d=t.addresses.find(u=>u.ip===a.ip&&u.port===a.port))===null||d===void 0?void 0:d.fingerprint)!==null&&c!==void 0?c:"";return{ip:a.ip,port:a.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:l}});t.addresses=s}},itt=(t,e)=>{if(t.response_body&&t.response_body.length){const n=t.response_body[0];if(n.buffer.code!==0){const r=Md(n.buffer.code);throw new P(R.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw m.debug("update ticket request received ap response without response body:",e),new P(R.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},RC=(t,e,n)=>{const r=Math.floor(Math.random()*1e12),i={appid:t.appId,client_ts:Date.now(),opid:r,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:Vm(Vm({6:t.stringUid,11:e,12:A("USE_NEW_TOKEN")?"1":void 0,22:e},t.apRequestDetail?{33:t.apRequestDetail}:{}),t.apRTM?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};i.request_bodies.forEach(s=>{t.multiIP&&t.multiIP.gateway_ip&&(s.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))});const o=new FormData;return o.append("request",JSON.stringify(i)),[o,r]},ott=(t,e)=>{const n=Math.floor(Math.random()*1e12),r={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map(o=>({ip:o.ip,port:o.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]};let vd=0;function al(t){return Y.all(t.map(e=>e.then(n=>{throw n},n=>n))).then(e=>{throw e},e=>e)}const nh=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:o}=t,s=0;const a=e;let c,d=0;const l=async()=>{const u=(()=>{const h=s*a,p=h+a;return n.slice(h,p).map(r)})();o&&o.push(...u);try{c=await al(u)}catch(h){if(d+=a,s++,!(d>=n.length))return void await l();i(h)}u.forEach(h=>h.cancel())};return await l(),c},pF=async t=>{let{referenceList:e,asyncMapHandler:n,closeFn:r}=t;const i=e.length;let o=0;const s=async()=>{const a=n(e.shift());try{return await a}catch(c){if(o++,o>=i||r!=null&&r(c))throw c;return s()}};return s()};async function oy(t,e,n,r){return{gatewayInfo:await async function(o,s,a,c){let d=null;const l=[],u=async()=>{const p=A("WEBCS_DOMAIN").slice(0,A("AJAX_REQUEST_CONCURRENT")).map(_=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"),areaCode:eh()})),S=c.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(_=>_.url)}),f=await nh({fragementLength:A("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:_=>(m.debug("[".concat(o.clientId,"] Connect to choose_server:"),_.url),kP(_,o,s,a)),allFailedhandler:_=>{throw c.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_},S),_[0]},promisesCollector:l});return c.recordJoinChannelService({endTs:Date.now(),status:"success"},S),f},h=async()=>{if(await Je(1e3),d!==null)return d;const p=A("WEBCS_DOMAIN_BACKUP_LIST").map(_=>({url:o.proxyServer?"https://".concat(o.proxyServer,"/ap/?url=").concat(_+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_,"/api/v2/transpond/webrtc?v=2"),areaCode:eh()})),S=c.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(_=>_.url)}),f=await nh({fragementLength:A("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:_=>(m.debug("[".concat(o.clientId,"] Connect to backup choose_server:"),_.url),kP(_,o,s,a)),allFailedhandler:_=>{throw c.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_},S),_[0]},promisesCollector:l});return c.recordJoinChannelService({endTs:Date.now(),status:"success"},S),f};try{return d=await al([u(),h()]),l.length&&l.forEach(p=>p.cancel&&typeof p.cancel=="function"&&p.cancel()),d}catch(p){throw p[0]}}(t,e,n,r)}}async function MP(t,e,n,r,i){const o=t.cloudProxyServer;if(o==="disabled"){if(t.useLocalAccessPoint)return await oy(t,e,n,i);if(A("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:h,proxyInfo:p}=await xP(t,e,n,i);if(t.turnServer&&t.turnServer.mode!=="auto")return{gatewayInfo:h};const S=p.map(f=>({turnServerURL:f.address,tcpport:f.tcpport||nn.tcpport,udpport:f.udpport||nn.udpport,username:f.username||nn.username,password:f.password||nn.password,forceturn:!1,security:!0}));if(i.useP2P){var s;const f=(s=t.uid)!==null&&s!==void 0?s:h.uid,_="glb:".concat(f.toString()),T=await Hv(_),g=p.map(y=>({turnServerURL:y.address,tcpport:y.tcpport||nn.tcpport,udpport:y.udpport||nn.udpport,username:_,password:T,forceturn:!1,security:!0}));S.push(...g)}return t.turnServer={mode:"manual",servers:S},{gatewayInfo:h}}return await oy(t,e,n,i)}const{proxyInfo:a,gatewayInfo:c}=await xP(t,e,n,i),d={gatewayInfo:c},l=a.map(h=>({turnServerURL:h.address,tcpport:o==="proxy3"?void 0:h.tcpport?h.tcpport:nn.tcpport,udpport:o==="proxy4"?void 0:h.udpport?h.udpport:nn.udpport,username:h.username||nn.username,password:h.password||nn.password,forceturn:o!=="proxy4",security:o==="proxy5"}));if(i.useP2P){var u;const h=(u=t.uid)!==null&&u!==void 0?u:c.uid,p="glb:".concat(h.toString()),S=await Hv(p),f=a.map(_=>({turnServerURL:_.address,tcpport:o==="proxy3"?void 0:_.tcpport||nn.tcpport,udpport:o==="proxy4"?void 0:_.udpport||nn.udpport,username:p,password:S,forceturn:o!=="proxy4",security:o==="proxy5"}));l.push(...f)}return t.turnServer={mode:"manual",servers:l},m.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(o)),d}async function fF(t,e,n,r,i){const o=A("ACCOUNT_REGISTER").slice(0,A("AJAX_REQUEST_CONCURRENT"));let s=[];s=e.proxyServer?o.map(c=>"https://".concat(e.proxyServer,"/ap/?url=").concat(c+"/api/v1")):o.map(c=>"https://".concat(c,"/api/v1"));const a=i==null?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s});try{const c=await async function(d,l,u,h,p){const S=Date.now(),f={sid:u.sid,opid:10,appid:u.appId,string_uid:l};let _=d[0];const T=await qi(()=>Ji(_+"".concat(_.indexOf("?")===-1?"?":"&","action=stringuid"),{data:f,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(g,y)=>{if(g.code===0){if(g.uid<=0||g.uid>=Math.pow(2,32))throw m.error("Invalid Uint Uid ".concat(l," => ").concat(g.uid),g),tt.reqUserAccount(f.sid,{lts:S,success:!1,serverAddr:_,stringUid:f.string_uid,uid:g.uid,errorCode:R.INVALID_UINT_UID_FROM_STRING_UID,extend:f}),new P(R.INVALID_UINT_UID_FROM_STRING_UID);return tt.reqUserAccount(f.sid,{lts:S,success:!0,serverAddr:_,stringUid:f.string_uid,uid:g.uid,errorCode:null,extend:f}),!1}const I=Md(g.code);return I.retry&&(_=d[(y+1)%d.length]),tt.reqUserAccount(f.sid,{lts:S,success:!1,serverAddr:_,stringUid:f.string_uid,uid:g.uid,errorCode:I.desc,extend:f}),I.retry},(g,y)=>g.code!==R.OPERATION_ABORTED&&(tt.reqUserAccount(f.sid,{lts:S,success:!1,serverAddr:_,stringUid:f.string_uid,uid:null,errorCode:g.code,extend:f}),_=d[(y+1)%d.length],!0),p);if(T.code!==0){const g=Md(T.code);throw new P(R.UNEXPECTED_RESPONSE,g.desc)}return T}(s,t,e,n,r);return i==null||i.recordJoinChannelService({status:"success",endTs:Date.now()},a),c.uid}catch(c){throw i==null||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[c]},a),c}}async function stt(t,e,n){const r=A("ACCOUNT_REGISTER");let i=[];i=e.proxyServer?r.map(o=>"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1")):r.map(o=>"https://".concat(o,"/api/v1"));try{return await pF({referenceList:i,asyncMapHandler:s=>async function(a,c,d,l){const u=Date.now(),h={sid:d.sid,opid:10,appid:d.appId,string_uid:c};try{const p=await Ji(a+"".concat(a.indexOf("?")===-1?"?":"&","action=stringuid"),{data:h,cancelToken:l,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(p.code!==0){const S=Md(p.code);throw new P(R.UNEXPECTED_RESPONSE,"preload sua error:".concat(S.desc),S)}if(p.uid<=0||p.uid>=Math.pow(2,32))throw new P(R.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:u,url:a,req:h,uid:p.uid,elapse:Date.now()-u}}catch(p){throw p}}(s,t,e,n),closeFn:s=>s.code===R.OPERATION_ABORTED||s.code===R.UNEXPECTED_RESPONSE&&!s.data.retry})}catch(o){throw o}}async function att(t,e,n){const r=A("CDS_AP").slice(0,A("AJAX_REQUEST_CONCURRENT")).map(c=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v1"):"https://".concat(c,"/api/v1?action=config")),i=r.map(c=>function(d,l,u,h){const p=It(),S={flag:64,cipher_method:0,features:{device:p.name,system:p.os,system_general:navigator.userAgent,vendor:l.appId,version:zr,cname:l.cname,sid:l.sid,session_id:l.sid,detail:"",proxyServer:l.proxyServer}};return qi(()=>Ji(d,{data:S,timeout:1e3,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,f=>f.code!==R.OPERATION_ABORTED,h)}(c,t,e,n));let o=null,s=null,a={};try{o=await al(i)}catch(c){if(c.code===R.OPERATION_ABORTED)throw c;s=c}if(i.forEach(c=>c.cancel()),tt.reportApiInvoke(t.sid,{name:Ne.REQUEST_CONFIG_DISTRIBUTE,options:{error:s,res:o}}).onSuccess(),o&&o.test_tags)try{a=function(c){if(!c.test_tags)return{};const d=c.test_tags,l=Object.keys(d),u={};return l.forEach(h=>{var p;const S=Cn(p=h.slice(4)).call(p),f=JSON.parse(d[h])[1];u[S]=f}),u}(o)}catch{}return a}async function UP(t,e){const n=A("WEBCS_DOMAIN").concat(A("WEBCS_DOMAIN_BACKUP_LIST")).map(r=>({url:"https://".concat(r,"/api/v2/transpond/webrtc?v=2"),areaCode:eh(),serviceIds:[Te.CHOOSE_SERVER,Te.CLOUD_PROXY_FALLBACK]}));try{return await pF({referenceList:n,asyncMapHandler:i=>async function(o,s,a){let c,{url:d,areaCode:l,serviceIds:u}=o;const h=Date.now(),[p,S]=RC(s,l,u);let f=ve.networkState;try{f&&ve.networkState===or.OFFLINE&&ve.onlineWaiter&&await Y.race([ve.onlineWaiter,Je(we.maxRetryTimeout)]),f=ve.networkState;const{data:_,headers:T}=await Ji(d,{data:p,cancelToken:a,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);c=T.http3==="1"?1:-1,(O=>{const b=[];if(O.response_body.forEach(N=>{const U=N.buffer.code;if(N.uri===23&&U===0&&!N.buffer.edges_services)if(N.buffer.flag===4194310)N.buffer.edges_services=[];else{const V={error:new P(R.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:O.detail[502]}),flag:N.buffer.flag};b.push(V)}if(U!==0){const V=Md(U),W={error:new P(R.CAN_NOT_GET_GATEWAY_SERVER,V.desc,{desc:V.desc,retry:V.retry,csIp:O.detail[502]}),flag:N.buffer.flag};N.buffer.flag===4194310?m.warning(W.error.toString()):b.push(W)}}),b.length)throw new P(R.CAN_NOT_GET_GATEWAY_SERVER,b.map(N=>"flag: ".concat(N.flag,", message: ").concat(N.error.message)).join(" | "),{retry:!!b.find(N=>N.error.data.retry),csIp:O.detail[502],desc:[...new Set(b.map(N=>{var U;return N==null||(U=N.error)===null||U===void 0||(U=U.data)===null||U===void 0?void 0:U.desc}).filter(N=>!!N))]})})(_);const y=Zu(_,Te.CHOOSE_SERVER),I=Zu(_,Te.CLOUD_PROXY_FALLBACK);return yC(y),{gatewayInfo:lC(y,d),proxyInfo:I,opid:S,requestTime:h,url:d,isHttp3:c,elapse:Date.now()-h}}catch(_){throw _}}(i,t,e),closeFn:i=>i.code===R.OPERATION_ABORTED||i.code===R.CAN_NOT_GET_GATEWAY_SERVER&&!i.data.retry})}catch(r){throw r}}async function xP(t,e,n,r){const i=A("PROXY_SERVER_TYPE3"),o=(p,S,f)=>{let _=f||i;return Array.isArray(_)&&(_=S%2==0?i[1]:i[0]),"https://".concat(_,"/ap/?url=").concat(p)};let s=null;const a=[],c=async()=>{const p=A("WEBCS_DOMAIN").slice(0,A("AJAX_REQUEST_CONCURRENT")).map((_,T)=>{let g;return g=t.cloudProxyServer==="disabled"&&t.proxyServer?o("".concat(_,"/api/v2/transpond/webrtc?v=2"),T,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(_,"/api/v2/transpond/webrtc?v=2"):o("".concat(_,"/api/v2/transpond/webrtc?v=2"),T),{url:g,areaCode:eh(),serviceIds:[Te.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Te.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Te.CLOUD_PROXY:Te.CLOUD_PROXY_FALLBACK]}}),S=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(_=>_.url)}),f=await nh({fragementLength:A("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:_=>(m.debug("[".concat(t.clientId,"] Connect to choose_server:"),_.url),LP(_,t,e,n)),allFailedhandler:_=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_},S),_[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},S),f},d=async()=>{if(await Je(1e3),s!==null)return s;const p=A("WEBCS_DOMAIN_BACKUP_LIST").map((_,T)=>{let g;return g=t.cloudProxyServer==="disabled"&&t.proxyServer?o("".concat(_,"/api/v2/transpond/webrtc?v=2"),T,t.proxyServer):t.cloudProxyServer==="disabled"||t.cloudProxyServer==="fallback"?"https://".concat(_,"/api/v2/transpond/webrtc?v=2"):o("".concat(_,"/api/v2/transpond/webrtc?v=2"),T),{url:g,areaCode:eh(),serviceIds:[Te.CHOOSE_SERVER,t.cloudProxyServer==="proxy5"?Te.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Te.CLOUD_PROXY:Te.CLOUD_PROXY_FALLBACK]}}),S=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:p.map(_=>_.url)}),f=await nh({fragementLength:A("FRAGEMENT_LENGTH"),referenceList:p,asyncMapHandler:_=>(m.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),_.url),LP(_,t,e,n)),allFailedhandler:_=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_},S),_[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},S),f};let l,u,h;try{({gatewayInfo:l,proxyInfo:u,url:h}=await al([c(),d()]))}catch(p){throw p[0]}if(a.length&&a.forEach(p=>p.cancel&&typeof p.cancel=="function"&&p.cancel()),!l||!u)throw new P(R.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=h,t.cloudProxyServer!=="disabled"&&Array.isArray(i)&&h){const p=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];$(i).call(i,p)&&(t.proxyServer=p,m.setProxyServer(p),tt.setProxyServer(p))}return s={gatewayInfo:l,proxyInfo:await CV(u,l.uid)},s}async function ctt(t,e,n){const r=A("UAP_AP").slice(0,A("AJAX_REQUEST_CONCURRENT")).map(o=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")),i=r.map(o=>function(s,a,c,d){const l={command:"convergeAllocateEdge",sid:a.sid,appId:a.appId,token:a.token,ts:Date.now(),version:zr,cname:a.cname,uid:a.uid.toString(),requestId:RS,seq:RS};RS+=1;const u={service_name:"tele_channel",json_body:JSON.stringify(l)};return qi(async()=>{const h=await Ji(s,{data:u,cancelToken:c,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(h.code!==0){const S=new P(R.UNEXPECTED_RESPONSE,"cross channel ap error, code"+h.code,{retry:!0});throw m.error(S.toString()),S}const p=JSON.parse(h.json_body);if(p.code!==200){const S=new P(R.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(p.code,", reason: ").concat(p.reason));throw m.error(S.toString()),S}if(!p.servers||p.servers.length===0){const S=new P(R.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw m.error(S.toString()),S}return{vid:p.vid,workerToken:p.workerToken,addressList:(A("CHANNEL_MEDIA_RELAY_SERVERS")||p.servers).map(S=>"wss://".concat(S.address.replace(/\./g,"-"),".").concat(A("WORKER_DOMAIN"),":").concat(S.wss))}},void 0,h=>!!(h.code!==R.OPERATION_ABORTED&&h.code!==R.UNEXPECTED_RESPONSE||h.data&&h.data.retry),d)}(o,t,e,n));try{const o=await al(i);return i.forEach(s=>s.cancel()),o}catch(o){throw o[0]}}async function dtt(t,e,n){let r=null;const i=[],o=async s=>{const a=A(s?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(c=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(c+"/api/v2/transpond/webrtc?v=2"):"https://".concat(c,"/api/v2/transpond/webrtc?v=2"));return s&&(await Je(1e3),r!==null)?r:await nh({fragementLength:A("FRAGEMENT_LENGTH"),referenceList:a,asyncMapHandler:c=>(m.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(s?"backup":""," choose_server:"),c),function(d,l,u,h){const[p]=ott(l,[Te.CHOOSE_SERVER]);let S=ve.networkState;return qi(async()=>{S&&ve.networkState===or.OFFLINE&&ve.onlineWaiter&&await Y.race([ve.onlineWaiter,Je(h&&h.maxRetryTimeout||we.maxRetryTimeout)]),S=ve.networkState;const f=await Ji(d,{data:p,cancelToken:u,headers:{"Content-Type":"multipart/form-data;"}},!0);return itt(f,d)},()=>!1,f=>f.code!==R.OPERATION_ABORTED&&(f.code===R.UPDATE_TICKET_FAILED?f.data.retry:(m.warning("[".concat(l.clientId,"] update ticket network error, retry"),f),!0)),h)}(c,t,e,n)),allFailedhandler:c=>{throw c[0]},promisesCollector:i})};try{return r=await al([o(!1),o(!0)]),i.length&&i.forEach(s=>s.cancel&&typeof s.cancel=="function"&&s.cancel()),r}catch(s){throw s[0]}}function VP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function FP(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?VP(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):VP(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class ltt extends oe{get isSuccess(){return!!this.configs}constructor(){super(),v(this,"configs",void 0),v(this,"joinInfo",void 0),v(this,"cancelToken",void 0),v(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),v(this,"interval",void 0),v(this,"mutex",new pn("config-distribute")),v(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,n){this.joinInfo=e,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),A("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},A("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,tt.reportApiInvoke(null,{options:void 0,name:Ne.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:ae.TRACER}).onSuccess(JSON.stringify(bs))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void m.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const n=await this.mutex.lock();try{e=await att(this.joinInfo,this.cancelToken,this.retryConfig),m.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(r){const i=new P(R.NETWORK_RESPONSE_ERROR,r);m.warning("[config-distribute] ".concat(i.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var n;(n=e)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(qv.UPDATE_BITRATE_LIMIT,e):this.emit(qv.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&FP({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var n;const r=Ph(n=Object.keys(e).filter(o=>/^webrtc_ng_global_parameter/.test(o))).call(n);for(let o=0;o<r.length;o++)for(let s=r.length-1;s>o;s--){const a=r[s];if(typeof e[a].__priority=="number"){const c=e[a].__priority,d=r[s-1];if(typeof e[d].__priority=="number"){if(!(c>e[d].__priority))continue;{const l=a;r[s]=r[s-1],r[s-1]=l}}else{const l=a;r[s]=r[s-1],r[s-1]=l}}}const i={};r.forEach(o=>{const s=e[o],a=s.__expires;Object.keys(s).forEach(c=>{c==="__priority"||c==="__expires"||Object.prototype.hasOwnProperty.call(i,c)||(i[c]=FP({value:s[c]},a&&{expires:a}))})});try{(function(a){try{const c=Date.now();Object.keys(a).forEach(d=>{switch(d){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":case"ENABLE_AG_ADAPTATION":case"FORCE_AG_HIGH_FRAMERATE":case"FORCE_SUPPORT_AG_ADAPTATION":case"ENCODER_CONFIG_LIMIT":case"CAMERA_CAPTURE_CONFIG":case"ENABLE_PRELOAD":if(Object.prototype.hasOwnProperty.call(_e,d)){const{value:l,expires:u}=a[d];if(u&&u<=c)return;bs[d]=l,_e[d]=l,m.debug("Update global parameters from config distribute",d,l)}}})}catch(c){m.error("Error update config immediately: ".concat(a),c.message)}})(i);const o=JSON.stringify(i),s=window.btoa(o);window.localStorage.setItem("websdk_ng_global_parameter",s),m.debug("Caching global parameters ".concat(o))}catch(o){m.error("Error caching global parameters:",o.message)}}}class utt extends oe{constructor(){super(...arguments),v(this,"resultStorage",new Map)}setLocalAudioStats(e,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(e,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(r))}setRemoteAudioStats(e,n){const r=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(e,n){const r=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(e,n,r){if(A("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(e);if(i&&(i.result.push(r),i.result.length>=5)){var o;const s=$(o=i.result).call(o,!0);i.isPrevNormal&&!s&&this.emit("exception",jP[e],e,n),!i.isPrevNormal&&s&&this.emit("exception",jP[e]+2e3,e+"_RECOVER",n),i.isPrevNormal=s,i.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&e.receiveLevel===0)}checkAudioInputLevel(e,n){return n instanceof be&&!n.isActive||!!n.muted||e.sendVolumeLevel!==0}checkFramerateInput(e,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=ar(n._encoderConfig.frameRate));const i=e.captureFrameRate;return!r||!i||!(r>10&&i<5||r<10&&r>=5&&i<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,n){return!!n.muted||e.sendBitrate!==0}checkSendAudioBitrate(e,n){return n instanceof be&&!n.isActive||!!n.muted||e.sendBitrate!==0}checkVideoDecode(e){return e.receiveBitrate===0||e.decodeFrameRate!==0}}const jP={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},un=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};var BP=de(Zr.Object.getOwnPropertySymbols),htt=Bt,ptt=vR.indexOf,ftt=v_,sy=Bu([].indexOf),GP=!!sy&&1/sy([1],1,-0)<0;htt({target:"Array",proto:!0,forced:GP||!ftt("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return GP?sy(this,t,e)||0:ptt(this,t,e)}});var mtt=Ai("Array").indexOf,_tt=Mn,Ett=mtt,CS=Array.prototype,gtt=function(t){var e=t.indexOf;return t===CS||_tt(CS,t)&&e===CS.indexOf?Ett:e},WP=de(gtt);function Stt(t,e){if(t==null)return{};var n,r,i=function(s,a){if(s==null)return{};var c,d,l={},u=gV(s);for(d=0;d<u.length;d++)c=u[d],WP(a).call(a,c)>=0||(l[c]=s[c]);return l}(t,e);if(BP){var o=BP(t);for(r=0;r<o.length;r++)n=o[r],WP(e).call(e,n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function Ei(t){if(Array.isArray(t))return t.map(n=>n);if(!HP(t))return t;const e={};for(const n in t){const r=t[n];HP(r)||Array.isArray(r)?e[n]=Ei(r):e[n]=r}return e}function HP(t){return!(typeof t!="object"||Array.isArray(t)||!t)}class IS{constructor(e){v(this,"input",[]),v(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const yo={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},rh={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:yo,remoteCandidate:yo}},mF={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0},_F={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},EF={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},gF={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function KP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function zP(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?KP(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):KP(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class CC{constructor(e,n){v(this,"onFirstVideoReceived",void 0),v(this,"onFirstVideoDecoded",void 0),v(this,"onFirstAudioReceived",void 0),v(this,"onFirstVideoDecodedTimeout",void 0),v(this,"onFirstAudioDecoded",void 0),v(this,"onSelectedLocalCandidateChanged",void 0),v(this,"onSelectedRemoteCandidateChanged",void 0),v(this,"videoIsReady",!1),v(this,"videoIsReady2",{}),v(this,"pc",void 0),v(this,"options",void 0),v(this,"intervalTimer",void 0),v(this,"stats",Ei(rh)),v(this,"isFirstVideoReceived",{}),v(this,"isFirstVideoDecoded",{}),v(this,"isFirstAudioReceived",{}),v(this,"isFirstAudioDecoded",{}),v(this,"isFirstVideoDecodedTimeout",{}),v(this,"lossRateWindowStats",[]),this.pc=e,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Y(e=>{e({local:zP({},yo),remote:zP({},yo)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,n){this.videoIsReady2[e]=n}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,o=0,s=0,a=0;for(const c of r)e[c].forEach((d,l)=>{if(!this.lossRateWindowStats[n-1][c][l]||!this.lossRateWindowStats[0][c][l])return;const u=this.lossRateWindowStats[n-1][c][l].packets-this.lossRateWindowStats[0][c][l].packets,h=this.lossRateWindowStats[n-1][c][l].packetsLost-this.lossRateWindowStats[0][c][l].packetsLost;c==="videoSend"||c==="audioSend"?(i+=u,s+=h):(o+=u,a+=h),Number.isNaN(u)||Number.isNaN(u)?d.packetLostRate=0:d.packetLostRate=u<=0||h<=0?0:h/(u+h)});e.sendPacketLossRate=i<=0||s<=0?0:s/(i+s),e.recvPacketLossRate=o<=0||a<=0?0:a/(o+a)}}function YP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Ttt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?YP(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):YP(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class vtt extends CC{constructor(){super(...arguments),v(this,"_stats",rh),v(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),n=this.statsResponsesToObjects(e);this._stats=Ei(rh);const r=n.filter(o=>o.type==="ssrc");this.processSSRCStats(r);const i=n.find(o=>o.type==="VideoBwe");i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(n=>{var r;const i=$(r=n.id).call(r,"send");switch("".concat(n.mediaType,"_").concat(i?"send":"recv")){case"video_send":{const o=Ei(_F);o.codec=n.googCodecName,o.adaptionChangeReason="none",n.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(n.googAvgEncodeMs),o.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.firsCount=Number(n.googFirReceived),o.nacksCount=Number(n.googNacksReceived),o.plisCount=Number(n.googPlisReceived),o.frameCount=Number(n.framesEncoded),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=Ei(mF),s=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(o.codec=n.googCodecName,o.targetDelayMs=Number(n.googTargetDelayMs),o.renderDelayMs=Number(n.googRenderDelayMs),o.currentDelayMs=Number(n.googCurrentDelayMs),o.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),o.decodeMs=Number(n.googDecodeMs),o.maxDecodeMs=Number(n.googMaxDecodeMs),o.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},o.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},o.decodeFrameRate=Number(n.googFrameRateDecoded),o.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},o.jitterBufferMs=Number(n.googJitterBufferMs),o.firsCount=Number(n.googFirsSent),o.nacksCount=Number(n.googNacksSent),o.plisCount=Number(n.googPlisSent),o.framesDecodeCount=Number(n.framesDecoded),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),s){const a=s.stats,c=Date.now()-s.lts;o.framesDecodeFreezeTime=a.framesDecodeFreezeTime,o.framesDecodeInterval=a.framesDecodeInterval,o.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(s.lts=Date.now(),o.framesDecodeInterval=c,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):o.framesDecodeCount<s.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:Ttt({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=Ei(gF);o.codec=n.googCodecName,o.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,o.decodingCNG=Number(n.googDecodingCNG),o.decodingCTN=Number(n.googDecodingCTN),o.decodingCTSG=Number(n.googDecodingCTSG),o.decodingNormal=Number(n.googDecodingNormal),o.decodingPLC=Number(n.googDecodingPLC),o.decodingPLCCNG=Number(n.googDecodingPLCCNG),o.expandRate=Number(n.googExpandRate),o.accelerateRate=Number(n.googAccelerateRate),o.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),o.speechExpandRate=Number(n.googSpeechExpandRate),o.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),o.jitterBufferMs=Number(n.googJitterBufferMs),o.jitterMs=Number(n.googJitterReceived),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),o.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=Ei(EF);o.codec=n.googCodecName,o.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,o.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new Y((e,n)=>{this.pc.getStats(e,n)})}statsResponsesToObjects(e){const n=[];return e.result().forEach(r=>{const i={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(o=>{i[o]=r.stat(o)}),n.push(i)}),n}}function $P(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function pa(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?$P(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$P(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class qP extends CC{constructor(){super(...arguments),v(this,"_stats",rh),v(this,"report",void 0),v(this,"lastDecodeVideoReceiverStats",new Map),v(this,"lastVideoFramesRecv",new Map),v(this,"lastVideoFramesSent",new Map),v(this,"lastVideoFramesDecode",new Map),v(this,"lastVideoFramesOutput",new Map),v(this,"lastVideoJBDelay",new Map),v(this,"lastAudioJBDelay",new Map),v(this,"mediaBytesSent",new Map),v(this,"mediaBytesRetransmit",new Map),v(this,"mediaBytesTargetEncode",new Map),v(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ei(rh),this.report.forEach(e=>{switch(e.type){case hr.OUTBOUND:case hr.INBOUND:{const n=e.mediaType||e.kind,r=!n&&"frameWidth"in e,i=!n&&!("frameWidth"in e);e.type===hr.OUTBOUND?n==="audio"||i?this.processAudioOutboundStats(e):(n==="video"||r)&&this.processVideoOutboundStats(e):e.type===hr.INBOUND&&(n==="audio"||i?this.processAudioInboundStats(e):(n==="video"||r)&&this.processVideoInboundStats(e));break}case hr.TRANSPORT:{const n=this.report.get(e.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case hr.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),n={local:pa({},yo),remote:pa({},yo)};return e.forEach(r=>{let i;if(r.type===hr.TRANSPORT&&(i=e.get(r.selectedCandidatePairId)),r.type===hr.CANDIDATE_PAIR&&r.selected&&(i=r),i){const o=(s,a)=>{s.type=a.type,s.id=a.id,a.address&&(s.address=a.address),a.candidateType&&(s.candidateType=a.candidateType),a.port&&(s.port=a.port),a.priority&&(s.priority=a.priority),a.protocol&&(s.protocol=a.protocol),a.relayProtocol&&(s.relayProtocol=a.relayProtocol)};if(i.localCandidateId){const s=e.get(i.localCandidateId);s&&o(n.local,s)}if(i.remoteCandidateId){const s=e.get(i.remoteCandidateId);s&&o(n.remote,s)}}}),n}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{e.currentRoundTripTime&&(n.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const n=this.report.get(e.localCandidateId);n&&this.processCandidateStats(n)}if(e.remoteCandidateId){const n=this.report.get(e.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(e){let n;e.type===hr.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),e.type===hr.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=e.type,n.id=e.id,e.address&&(n.address=e.address),e.candidateType&&(n.candidateType=e.candidateType),e.port&&(n.port=e.port),e.priority&&(n.priority=e.priority),e.protocol&&(n.protocol=e.protocol),e.relayProtocol&&(n.relayProtocol=e.relayProtocol),e.type===hr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(pa({},n),pa({},this.stats.selectedCandidatePair.localCandidate)),e.type===hr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(pa({},n),pa({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let n=this._stats.audioRecv.find(r=>r.ssrc===e.ssrc);n||(n=Ei(gF),this._stats.audioRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.packetsDiscarded=e.packetsDiscarded,n.bytes=e.bytesReceived,n.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),n.receivedFrames||(n.receivedFrames=e.packetsReceived),n.droppedFrames||(n.droppedFrames=e.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof e.concealedSamples=="number"&&(n.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let n=this._stats.videoRecv.find(a=>a.ssrc===e.ssrc);n||(n=Ei(mF),this._stats.videoRecv.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsReceived,n.packetsLost=e.packetsLost,n.bytes=e.bytesReceived,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.framesDecodeCount=e.framesDecoded,n.framesDroppedCount=e.framesDropped,n.totalInterFrameDelay=e.totalInterFrameDelay,n.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,n.totalFreezesDuration=e.totalFreezesDuration;const r=this.lastDecodeVideoReceiverStats.get(n.ssrc),i=this.lastVideoFramesDecode.get(n.ssrc),o=this.lastVideoFramesOutput.get(n.ssrc),s=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const a=n.decodedFrame?n.decodedFrame.width:0,c=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,a,c),this.isFirstVideoDecoded[n.ssrc]=!0}if(r){const a=r.stats,c=s-r.lts;n.framesDecodeFreezeTime=a.framesDecodeFreezeTime,n.framesDecodeInterval=a.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&c>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>a.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(r.lts=Date.now(),n.framesDecodeInterval=c,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):n.framesDecodeCount<a.framesDecodeCount&&(n.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?n.qpSumPerFrame=e.qpSum/e.framesDecoded:n.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}i&&s-i.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-i.count)/((s-i.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:s,rate:n.decodeFrameRate})):i?n.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:s,rate:0}),n.framesDroppedCount&&e.framesReceived&&(o&&s-o.lts>=800?(n.outputFrameRate=Math.round((e.framesReceived-n.framesDroppedCount-o.count)/((s-o.lts)/1e3)),this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:s,rate:Math.max(n.outputFrameRate,0)})):o?n.outputFrameRate=o.rate:this.lastVideoFramesOutput.set(n.ssrc,{count:e.framesReceived-n.framesDroppedCount,lts:s,rate:0})),e.totalDecodeTime&&(n.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(n.framesRateFirefox=e.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:pa({},n),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let n=this._stats.videoSend.find(i=>i.ssrc===e.ssrc);n||(n=Ei(_F),this._stats.videoSend.push(n));const r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{const i=new IS(10);i.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,i)}if(e.retransmittedBytesSent!==void 0){const i=this.mediaBytesRetransmit.get(e.ssrc);if(i)i.add(e.retransmittedBytesSent);else{const o=new IS(10);o.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,o)}}if(e.totalEncodedBytesTarget){const i=this.mediaBytesTargetEncode.get(e.ssrc);if(i)i.add(e.totalEncodedBytesTarget);else{const o=new IS(10);o.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,o)}}if(n.ssrc=e.ssrc,n.bytes=e.bytesSent,n.packets=e.packetsSent,n.firsCount=e.firCount,n.nacksCount=e.nackCount,n.plisCount=e.pliCount,n.frameCount=e.framesEncoded,n.adaptionChangeReason=e.qualityLimitationReason,n.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){const i=this.lastEncoderMs.get(e.ssrc);if(!i||i.lastFrameCount>e.framesEncoded)n.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const o=e.framesEncoded-i.lastFrameCount,s=e.totalEncodeTime-i.lastEncoderTime;n.avgEncodeMs=1e3*s/o}}if(e.framesEncoded&&e.qpSum){const i=this.lastEncoderMs.get(e.ssrc);!i||i.lastFrameCount>e.framesEncoded?n.qpSumPerFrame=e.qpSum/e.framesEncoded:n.qpSumPerFrame=(e.qpSum-i.lastQpSum)/(e.framesEncoded-i.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,n),this.processVideoTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const i=this.findRemoteStatsId(e.ssrc,hr.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,n)}}processAudioOutboundStats(e){let n=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(n||(n=Ei(EF),this._stats.audioSend.push(n)),n.ssrc=e.ssrc,n.packets=e.packetsSent,n.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,n),e.codecId&&(n.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,n),e.remoteId)this.processRemoteInboundStats(e.remoteId,n);else{const r=this.findRemoteStatsId(e.ssrc,hr.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,n)}}findRemoteStatsId(e,n){var r;const i=Array.from(qo(r=this.report).call(r)).find(o=>o.type===n&&o.ssrc===e);return i?i.id:null}processVideoMediaSource(e,n){const r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(n.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,n){const r=this.report.get(e);r&&(n.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,n,r){var i,o,s,a;const c=n?this.report.get(n):void 0,d=(i=c==null?void 0:c.framesSent)!==null&&i!==void 0?i:e.framesSent;if(typeof d!="number")return;let l=(o=c==null?void 0:c.frameWidth)!==null&&o!==void 0?o:e.frameWidth,u=(s=c==null?void 0:c.frameHeight)!==null&&s!==void 0?s:e.frameHeight,h=(a=c==null?void 0:c.framesPerSecond)!==null&&a!==void 0?a:e.framesPerSecond;if(typeof l=="number"&&typeof u=="number"||(l=0,u=0),h==null){const p=Date.now(),S=this.lastVideoFramesSent.get(r.ssrc);S&&p-S.lts>=800?(h=Math.round((d-S.count)/((p-S.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:d,lts:p,rate:h})):S?h=S.rate:this.lastVideoFramesSent.set(r.ssrc,{count:d,lts:p,rate:0})}r.sentFrame={width:l,height:u,frameRate:Math.max(0,h)}}processVideoTrackReceiverStats(e,n,r){var i,o,s,a,c;const d=n?this.report.get(n):void 0,l=(i=d==null?void 0:d.framesReceived)!==null&&i!==void 0?i:e.framesReceived,u=(o=d==null?void 0:d.frameWidth)!==null&&o!==void 0?o:e.frameWidth,h=(s=d==null?void 0:d.frameHeight)!==null&&s!==void 0?s:e.frameHeight,p=(a=d==null?void 0:d.jitterBufferDelay)!==null&&a!==void 0?a:e.jitterBufferDelay,S=(c=d==null?void 0:d.jitterBufferEmittedCount)!==null&&c!==void 0?c:e.jitterBufferEmittedCount;if(typeof l=="number"){const f=this.lastVideoFramesRecv.get(r.ssrc),_=Date.now();r.framesReceivedCount=l;let T=0;f&&_-f.lts>=800?(T=Math.round((l-f.count)/((_-f.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:l,lts:_,rate:T})):f?T=f.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:l,lts:_,rate:0}),r.receivedFrame={width:u||0,height:h||0,frameRate:T||0},r.decodedFrame={width:u||0,height:h||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:u||0,height:h||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(p&&S){const f=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let _=f.jitterBufferMs;const T=S-f.jitterBufferEmittedCount;T>0&&(_=1e3*(p-f.jitterBufferDelay)/T),r.jitterBufferMs=_,r.currentDelayMs=Math.round(_),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:p,jitterBufferEmittedCount:S,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,n,r){var i,o,s,a;const c=n?this.report.get(n):void 0,d=(i=(o=c==null?void 0:c.echoReturnLoss)!==null&&o!==void 0?o:e.echoReturnLoss)!==null&&i!==void 0?i:0,l=(s=(a=c==null?void 0:c.echoReturnLossEnhancement)!==null&&a!==void 0?a:e.echoReturnLossEnhancement)!==null&&s!==void 0?s:0;r.aecReturnLoss=d,r.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(e,n,r){var i,o,s,a,c,d,l;const u=n?this.report.get(n):void 0,h=(i=u==null?void 0:u.removedSamplesForAcceleration)!==null&&i!==void 0?i:e.removedSamplesForAcceleration,p=(o=u==null?void 0:u.totalSamplesReceived)!==null&&o!==void 0?o:e.totalSamplesReceived,S=(s=u==null?void 0:u.jitterBufferDelay)!==null&&s!==void 0?s:e.jitterBufferDelay,f=(a=u==null?void 0:u.jitterBufferEmittedCount)!==null&&a!==void 0?a:e.jitterBufferEmittedCount,_=(c=u==null?void 0:u.audioLevel)!==null&&c!==void 0?c:e==null?void 0:e.audioLevel,T=(d=u==null?void 0:u.totalSamplesDuration)!==null&&d!==void 0?d:e==null?void 0:e.totalSamplesDuration,g=(l=u==null?void 0:u.concealedSamples)!==null&&l!==void 0?l:e.concealedSamples;if(h&&p&&(r.accelerateRate=h/p),S&&f){const I=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let O=I.jitterBufferMs;const b=f-I.jitterBufferEmittedCount;b>0&&(O=1e3*(S-I.jitterBufferDelay)/b),r.jitterBufferMs=Math.round(O),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:S,jitterBufferEmittedCount:f,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=_;let y=1920;T&&p&&(y=p/T/50,r.receivedFrames=Math.round(p/y)),g&&(r.droppedFrames=Math.round(g/y))}processRemoteInboundStats(e,n){const r=this.report.get(e);r&&(n.packetsLost=r.packetsLost,r.roundTripTime&&(n.rttMs=1e3*r.roundTripTime),r.jitter&&(n.jitterMs=1e3*r.jitter),r.timestamp&&(n.timestamp=r.timestamp))}getCodecFromCodecStats(e){const n=this.report.get(e);if(!n)return"";const r=n.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,n=null,r=null;this.mediaBytesSent.forEach(o=>{e+=o.diffMean()}),this.mediaBytesRetransmit.forEach(o=>{n=n===null?o.diffMean():n+o.diffMean()}),this.mediaBytesTargetEncode.forEach(o=>{r=r===null?o.diffMean():r+o.diffMean()});const i=n!==null?e-n:e;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}}class ytt extends CC{updateStats(){return Y.resolve()}}function IC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const o=function(){const s=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return s&&s[0]?Number(s[0].split("/")[1]):null}();return o?o<76?new vtt(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new qP(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):function(s){if(!window.RTCStatsReport)return!1;const a=s.getStats();return!!(a instanceof Y||function(c){return!!c&&(typeof c=="object"||typeof c=="function")&&typeof c.then=="function"}(a))}(t)?new qP(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new ytt(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}let JP=class{get localCapabilities(){return Se(this._localCapabilities)}get rtpCapabilities(){return Se(this._rtpCapabilities)}get candidates(){return Se(this._candidates)}get iceParameters(){return Se(this._iceParameters)}get dtlsParameters(){return Se(this._dtlsParameters)}constructor(t){v(this,"sessionDesc",void 0),v(this,"_localCapabilities",void 0),v(this,"_rtpCapabilities",void 0),v(this,"_candidates",void 0),v(this,"_iceParameters",void 0),v(this,"_dtlsParameters",void 0),v(this,"setup",void 0),v(this,"currentMidIndex",void 0),v(this,"cname","o/i14u9pJrxRKAsu"),v(this,"firefoxSsrcMidMap",new Map),t=Se(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,localCapabilities:o,direction:s,setup:a,videoCodec:c,audioCodec:d}=t;let l;this.setup=a,l=s===Nn.RECEIVE_ONLY?$e.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):$e.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=r,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=o;const u=s===Nn.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,h=s===Nn.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,p=s===Nn.RECEIVE_ONLY?i.send.videoCodecs:uu(et.VIDEO,u,h,c),S=s===Nn.RECEIVE_ONLY?i.send.audioCodecs:uu(et.AUDIO,u,h,d);for(const f of l.mediaDescriptions)f.attributes.iceUfrag=e.iceUfrag,f.attributes.icePwd=e.icePwd,f.attributes.fingerprints=n.fingerprints,f.attributes.candidates=r,f.attributes.setup=this.setup,f.media.mediaType==="application"&&(f.attributes.sctpPort="5000"),f.media.mediaType==="video"&&(f.media.fmts=p.map(_=>_.payloadType.toString(10)),f.attributes.payloads=p,f.attributes.extmaps=u.videoExtensions),f.media.mediaType==="audio"&&(f.media.fmts=S.map(_=>_.payloadType.toString(10)),f.attributes.payloads=S,f.attributes.extmaps=u.audioExtensions,Fd(f));this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return $e.print(this.sessionDesc)}hasMid(t){return Array.isArray(t)?t.every(e=>this.hasMid(e)):this.sessionDesc.mediaDescriptions.some(e=>e.attributes.mid===t)}send(t,e,n,r,i){n=n.replace(/ /g,"-");const{ssrcs:o,ssrcGroups:s}=Ca(e,this.cname,A("SYNC_GROUP")?n:void 0),a=this.findPreloadMediaDesc(o);if(a){if(ce()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){const c=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const c=this.findAvailableMediaIndex(t,o,r);let d;return c===-1?(d=this.createOrRecycleSendMedia(t,o,s,"sendonly",r,i),this.updateBundleMids()):(d=Se(this.sessionDesc.mediaDescriptions[c]),d.attributes.direction="sendonly",d.attributes.ssrcs=o,d.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(d,i)),ce()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,d.attributes.mid),{needExchangeSDP:!0,mid:d.attributes.mid}}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>n.attributes.mid&&t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach(n=>{n.attributes.ssrcs=[]}),this.updateBundleMids()}receive(t,e,n){const r=[];return t.forEach(i=>{const o=i._mediaStreamTrack.kind,s=this.findAvailableRecvMediaIndex(o);let a,c=!1;s===-1?(c=!0,a=this.createOrRecycleRecvMedia(i,[],"recvonly",e,n),this.updateBundleMids()):(a=Se(this.sessionDesc.mediaDescriptions[s]),a.attributes.direction="recvonly"),r.push({mid:a.attributes.mid,needCreateTransceiver:c})}),r}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>t.indexOf(n.attributes.mid)!==-1);if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach(n=>{n.media.port="0",n.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(t){const{foundation:e,protocol:n,address:r,port:i,type:o,relatedAddress:s,relatedPort:a,priority:c}=new RTCIceCandidate(t),d={foundation:e??"",componentId:"1",transport:n??"",priority:c?c+"":"",connectionAddress:r??"",port:i?i+"":"",type:o?o+"":"",relAddr:s??"",relPort:a?a+"":"",extension:{}};this.candidates.some(l=>l.priority===d.priority&&l.connectionAddress===d.connectionAddress&&l.port===d.port)||(this._candidates.push(d),this.sessionDesc.mediaDescriptions.forEach(l=>{l.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(t,e,n,r,i){const o=t._mediaStreamTrack.kind,s=this.rtpCapabilities.recv,a=uu(o,s,this.localCapabilities.send,o===et.AUDIO?i:r),c=o===et.VIDEO?s.videoExtensions:s.audioExtensions,d="".concat(++this.currentMidIndex);let l={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(h=>h.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};l=this.mungRecvMediaDsec(l,t);const u=this.findFirstClosedMedia(o);if(u){const h=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[h]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>$(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="inactive"})}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter(n=>$(t).call(t,n.attributes.mid||""));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach(n=>{n.attributes.direction="recvonly"})}findAvailableMediaIndex(t,e,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(ce()){if(i){const o=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(o||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!o||o!==r.attributes.mid)}return!1}return i&&r.attributes.mid===n})}findAvailableRecvMediaIndex(t){return this.sessionDesc.mediaDescriptions.findIndex(e=>{const n=e.media.mediaType===t&&e.media.port!=="0"&&(e.attributes.direction==="recvonly"||e.attributes.direction==="sendrecv");return e.attributes.mid!=="0"&&e.attributes.mid!=="1"&&n})}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}restartICE(t){t=Se(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd})}createOrRecycleSendMedia(t,e,n,r,i,o){const s=this.rtpCapabilities.send,a=t===et.VIDEO?s.videoCodecs:s.audioCodecs,c=t===et.VIDEO?s.videoExtensions:s.audioExtensions;ce()&&(i="".concat(++this.currentMidIndex));let d={media:{mediaType:t,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(u=>u.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:i}};d=this.mungSendMediaDesc(d,o);const l=this.findFirstClosedMedia(t);if(l){const u=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[u]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}mungRecvMediaDsec(t,e,n){const r=Se(t);return gC(r),Vd(r,e),SC(r,e),sF(r),Um(r,n,this.localCapabilities.send),r}mungSendMediaDesc(t,e){const n=Se(t);return Um(n,e,this.localCapabilities.recv),Fd(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex(r=>r.attributes.mid===t);if(n!==-1){const r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=r}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(e=>{var n;return((n=e.attributes)===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId)===t[0].ssrcId})}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(e=>ce()?e.media.port==="0"&&e.media.mediaType===t:e.media.port==="0")}};const Rtt=["sdp"];var $t;function XP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function hs(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?XP(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):XP(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let QP=($t=class Vc extends TV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[]}set isInRestartIce(e){this._isInRestartIce=e}get isInRestartIce(){return this._isInRestartIce}constructor(e,n,r){super(e,n),v(this,"direction",void 0),v(this,"name",void 0),v(this,"store",void 0),v(this,"spec",void 0),v(this,"peerConnection",void 0),v(this,"initialOffer",void 0),v(this,"transport",void 0),v(this,"statsFilter",void 0),v(this,"localCandidateCount",0),v(this,"_isInRestartIce",!1),v(this,"mutex",new pn("P2PConnection-mutex")),v(this,"onLocalCandidate",void 0),v(this,"remoteSDP",void 0),v(this,"pendingCandidates",[]),v(this,"localCapabilities",void 0),v(this,"isReady",!1),v(this,"restartCnt",0),v(this,"curTurnServerIndex",0),this.store=n,this.spec=e,this.peerConnection=new RTCPeerConnection(Vc.resolvePCConfiguration(e,n.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=r??Nn.SEND_ONLY,this.name=this.direction===Nn.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=IC(this.peerConnection,A("STATS_UPDATE_INTERVAL"),void 0,ce()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(e){try{const n=await cF();if(this.localCapabilities=xm(n),e){const{sdp:r}=e,i=Stt(e,Rtt),o=function(){const l={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},u=th(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},S={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(vi(u,l,"videoExtensions",h,p,S),vi(u,l,"videoCodecs",h,p,S),vi(u,l,"audioExtensions",h,p,S),vi(u,l,"audioCodecs",h,p,S),A("RAISE_H264_BASELINE_PRIORITY")){const f=S.videoCodecs.findIndex(_=>_.rtpMap&&_.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&_.fmtp&&_.fmtp.parameters["profile-level-id"]==="42001f");if(f!==-1){const _=S.videoCodecs.findIndex(T=>T.rtpMap&&T.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(_<f){m.debug("raising H264 baseline profile priority");const T=S.videoCodecs[f];S.videoCodecs.splice(f,1),S.videoCodecs.splice(_,0,T)}_!==-1&&A("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter(T=>!(T.rtpMap&&T.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&T.fmtp&&T.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:h,recv:p,sendrecv:S}}({},{},r);this.remoteSDP=new JP({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const s=await this.peerConnection.createAnswer();if(!s.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const a=Ds(s.sdp);await this.peerConnection.setLocalDescription(s);const c=await bP({},{},s.sdp);this.localCapabilities=xm(c);const d=this.peerConnection.getTransceivers()[0];return d!=null&&d.receiver&&d.receiver.transport&&this.tryBindTransportEvents(d.receiver.transport),hs(hs({},a),{},{sdp:s.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const r=await this.peerConnection.createOffer();if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=Ds(r.sdp);return this.initialOffer=r,hs(hs({},i),{},{sdp:r.sdp})}}catch(n){throw new M(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:n,iceParameters:r,dtlsParameters:i}=e,o=await bP({},{},n);this.remoteSDP=new JP({remoteIceParameters:r,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const s=this.peerConnection.getTransceivers()[0];s!=null&&s.sender&&s.sender.transport&&this.tryBindTransportEvents(s.sender.transport)}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async addRemoteCandidate(e){try{e&&this.pendingCandidates.push(e),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(n=>{this.peerConnection.addIceCandidate(n)}),this.pendingCandidates=[])}catch(n){throw new M(R.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(n.toString()))}}send(e,n,r){var i=this;return Hr(function*(){const o=yield Ct(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=[],a=i.remoteSDP.receive(e,n,r);e.forEach((_,T)=>{if(a[T].needCreateTransceiver){const g=i.peerConnection.addTransceiver(_._mediaStreamTrack,{direction:"sendonly"});s.push(g),_._updateRtpTransceiver(g)}else{const g=i.peerConnection.getTransceivers().find(y=>y.mid===a[T].mid);if(!g)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(a[T].mid));s.push(g),_._updateRtpTransceiver(g)}}),ce()&&A("SIMULCAST")===!0&&(yield Ct(i.applySimulcastForFirefox(s,e)));const c=a.map(_=>_.mid),d=yield Ct(i.peerConnection.createOffer()),l=i.mungSendOfferSDP(d.sdp,e,c),u=$e.parse(l),h=c.map(_=>{const T=u.mediaDescriptions.find(g=>g.attributes.mid===_);if(!T)throw new Error("Cannot extract ssrc from mediaDescription.");return iF(T,A("USE_PUB_RTX"))}),p=s.map((_,T)=>{const g=c[T];return{localSSRC:h[T],id:g}});yield Ct(i.peerConnection.setLocalDescription({type:"offer",sdp:l}));try{yield p}catch(_){const T=i.remoteSDP.toString();throw yield Ct(i.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Ct(i.peerConnection.setRemoteDescription({type:"answer",sdp:T})),yield Ct(i.stopSending(c,!0)),_}yield Ct(i.applySimulcastEncodings(s,e)),yield Ct(i.applySendEncodings(s,e));const S=i.remoteSDP.toString(),f=i.logSDPExchange(l,"offer","local","send");return f==null||f(S),yield Ct(i.setRemoteDescription({type:"answer",sdp:S})),s.map((_,T)=>{const g=c[T];return{localSSRC:h[T],id:g}})}catch(s){throw s instanceof M?s:new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{o()}})()}async stopSending(e,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(c=>e.indexOf(c.mid)!==-1);if(i.length!==e.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(e.length,") when trying to call P2PConnection.stopSending."));i.map(c=>{var d;c.direction="inactive",(d=c.stop)===null||d===void 0||d.call(c)});const o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(e);const a=this.remoteSDP.toString();s==null||s(a),await this.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:s}=this.remoteSDP.send(e,n,r,i);if(s){const c=this.remoteSDP.toString(),d=this.logSDPExchange(c,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:c});const l=await this.peerConnection.createAnswer(),u=this.mungReceiveAnswerSDP(l.sdp,o,e);d==null||d(u||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:u}),m.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else m.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const a=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!a||a.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,mid:a.mid,transceiver:a}}catch(o){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async mockReceive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:s}=this.remoteSDP.send(e,n,r,i);if(s){const a=this.remoteSDP.toString(),c=this.logSDPExchange(a,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:a});const d=await this.peerConnection.createAnswer(),l=this.mungReceiveAnswerSDP(d.sdp,o,e);c==null||c(l||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:l}),m.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else m.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."))}catch(o){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async restartICE(e){try{if(this.store.p2pTransport===ga.Auto&&(this.store.p2pTransport=ga.SdRtn,wt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Vc.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,wt().supportPCSetConfiguration&&this.peerConnection.setConfiguration(Vc.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!e){this.restartCnt++,this.isReady=!1;const n=await this.peerConnection.createOffer({iceRestart:!0});if(!n.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:r}=Ds(n.sdp);return this.store.descriptionStart(),this.direction===Nn.SEND_ONLY&&await this.peerConnection.setLocalDescription(n),r}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(e),this.store.descriptionStart(),this.direction===Nn.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:r}=Ds(n.sdp);return await this.peerConnection.setLocalDescription(n),r}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}close(){var e;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const o=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),s==null||s(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(e,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===e);r.length===1&&(this.isVP8Simulcast(n)?ce()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:hs(hs({},yo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:hs(hs({},yo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e,n;$(e=["connected","completed"]).call(e,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(n=this.onICEConnectionStateChange)===null||n===void 0||n.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=e=>{if(e.candidate){var n;e.candidate.candidate&&((n=this.onLocalCandidate)===null||n===void 0||n.call(this,e.candidate.toJSON())),this.localCandidateCount+=1}else m.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i={iceServers:[]};var o;return e.iceServers?i.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(F_(e.turnServer.servers)?i.iceServers=e.turnServer.servers:(i.iceServers&&i.iceServers.push(...Vc.turnServerConfigToIceServers(e.turnServer.servers,n,r)),A("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&e.turnServer.serversFromGateway&&i.iceServers.push(...Vc.turnServerConfigToIceServers(e.turnServer.serversFromGateway,n,r)),$(o=[ga.Relay,ga.SdRtn]).call(o,n)&&(i.iceTransportPolicy="relay"),A("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(s=>{s.forceturn&&(i.iceTransportPolicy="relay")}))),A("ENABLE_ENCODED_TRANSFORM")&&wt().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),m.debug("P2PConnection p2pTransport is ".concat(n)),i}static turnServerConfigToIceServers(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const i=[],o=e.filter(a=>a.tcpport);m.debug("P2PConnection turnServers is ".concat(o,", current index is ").concat(r));const s=o.length>r?o[r]:o[0];switch(n){case ga.SdRtn:const a=e.filter(d=>{var l;return $(l=d.username).call(l,"glb:")&&d.turnServerURL==d.turnServerURL}),c=a.length>r?a[r]:a[0];c&&(i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turn:".concat(od(c.turnServerURL),":").concat(c.tcpport,"?transport=udp")}),i.push({username:c.username,credential:c.password,credentialType:"password",urls:"turns:".concat(od(c.turnServerURL),":").concat(c.tcpport,"?transport=tcp")}));break;case ga.Relay:s&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(od(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}));break;default:s&&(i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turn:".concat(s.turnServerURL,":").concat(s.tcpport,"?transport=udp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"turns:".concat(od(s.turnServerURL),":").concat(s.tcpport,"?transport=tcp")}),i.push({username:s.username,credential:s.password,credentialType:"password",urls:"stun:".concat(s.turnServerURL,":").concat(s.tcpport)}))}return i}tryBindTransportEvents(e){if(e){this.transport=e,e.onstatechange=()=>{var r;e!=null&&e.state&&((r=this.onDTLSTransportStateChange)===null||r===void 0||r.call(this,e.state))},e.onerror=r=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in r?r.error:r)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const r=e==null?void 0:e.iceTransport.state;var i;r&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,r))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:r,remote:i}=n.getSelectedCandidatePair();m.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:r.type,protocol:r.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var r;if(n||(n=this.peerConnection.getSenders().find(l=>l.track===e._mediaStreamTrack)),!n)return m.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return m.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!wt().supportSetRtpSenderParameters)return m.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},o={};switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(e._encoderConfig){var s;const{bitrateMax:l,frameRate:u,scaleResolutionDownBy:h}=e._encoderConfig;l&&(o.maxBitrate=1e3*l),$(s=e._hints).call(s,Ht.LOW_STREAM)&&(u&&(o.maxFramerate=ar(u)),h&&h>=1&&(o.scaleResolutionDownBy=h))}if(A("DSCP_TYPE")&&Xs()){var a;const l=A("DSCP_TYPE");$(a=["very-low","low","medium","high"]).call(a,l)&&(o.networkPriority=l)}const c=n.getParameters(),d=(r=c.encodings)===null||r===void 0?void 0:r[0];ce()&&!d&&(i.encodings=[o]),d&&Object.assign(d,o),Object.assign(c,i),m.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(c.encodings))),await n.setParameters(c)}async applySendEncodings(e,n){try{if(!wt().supportSetRtpSenderParameters||e.length!==n.length)return;for(let r=0;r<e.length;r++){const i=e[r],o=n[r];o instanceof qt&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,i.sender)}}catch{m.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,r){const i=$e.parse(e);return n.forEach((o,s)=>{const a=r[s],c=i.mediaDescriptions.find(d=>d.attributes.mid===a);c&&(Vd(c,o),aF(c,o,this.store.codec))}),$e.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let c=0;c<e.length;c++){var r,i,o,s,a;const d=e[c],l=n[c];if(l instanceof qt&&!$(r=l._hints).call(r,Ht.LOW_STREAM)&&(i=l._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=l._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(s=l._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((a=l._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1&&this.store.codec==="vp8"){const u={},h={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{rid:"m",active:!0,maxBitrate:h.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h.high}];const p=d.sender.getParameters();await d.sender.setParameters(Object.assign(p,u))}}}async applySimulcastEncodings(e,n){if(!ce()&&e.length===n.length)for(let r=0;r<e.length;r++){const i=n[r];if(i instanceof qt&&this.isVP8Simulcast(i)){const o=e[r],s={},a={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};s.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];const c=o.sender.getParameters();await o.sender.setParameters(Object.assign(c,s))}}}isVP8Simulcast(e){var n,r,i,o,s;return!!(e instanceof qt&&A("SIMULCAST")&&this.store.codec==="vp8"&&!$(n=e._hints).call(n,Ht.LOW_STREAM)&&(r=e._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=e._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=e._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((s=e._scalabilityMode)===null||s===void 0?void 0:s.numSpatialLayers)>1)}logSDPExchange(e,n,r,i){if(A("SDP_LOGGING"))return m.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),e),n==="offer"?o=>{this.logSDPExchange(o,"answer",r==="local"?"remote":"local",i)}:void 0}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(s=>{s.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(e);const o=this.remoteSDP.toString();i==null||i(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async s=>{s.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(e);const o=this.remoteSDP.toString();i==null||i(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}async getRemoteSSRC(e,n){var r,i;if(n=(r=n)!==null&&r!==void 0?r:(i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp){var o;const s=(o=$e.parse(n).mediaDescriptions.find(a=>a.attributes.mid===e))===null||o===void 0?void 0:o.attributes.ssrcs;return s==null?void 0:s[0].ssrcId}}async setRemoteDescription(e){var n;await this.peerConnection.setRemoteDescription(e),$(n=["connected","completed"]).call(n,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(e,n,r){const i=$e.parse(e),o=i.mediaDescriptions.find(s=>s.attributes.mid===n);return o&&r===et.AUDIO&&o.media.mediaType==="audio"&&Fd(o),$e.print(i)}},X($t.prototype,"establish",[ci],Object.getOwnPropertyDescriptor($t.prototype,"establish"),$t.prototype),X($t.prototype,"connect",[ci],Object.getOwnPropertyDescriptor($t.prototype,"connect"),$t.prototype),X($t.prototype,"receive",[ci],Object.getOwnPropertyDescriptor($t.prototype,"receive"),$t.prototype),X($t.prototype,"mockReceive",[ci],Object.getOwnPropertyDescriptor($t.prototype,"mockReceive"),$t.prototype),X($t.prototype,"stopReceiving",[ci],Object.getOwnPropertyDescriptor($t.prototype,"stopReceiving"),$t.prototype),X($t.prototype,"restartICE",[ci],Object.getOwnPropertyDescriptor($t.prototype,"restartICE"),$t.prototype),X($t.prototype,"close",[ci],Object.getOwnPropertyDescriptor($t.prototype,"close"),$t.prototype),X($t.prototype,"updateEncoderConfig",[ci],Object.getOwnPropertyDescriptor($t.prototype,"updateEncoderConfig"),$t.prototype),X($t.prototype,"updateSendParameters",[ci],Object.getOwnPropertyDescriptor($t.prototype,"updateSendParameters"),$t.prototype),X($t.prototype,"replaceTrack",[ci],Object.getOwnPropertyDescriptor($t.prototype,"replaceTrack"),$t.prototype),X($t.prototype,"muteLocal",[ci],Object.getOwnPropertyDescriptor($t.prototype,"muteLocal"),$t.prototype),X($t.prototype,"unmuteLocal",[ci],Object.getOwnPropertyDescriptor($t.prototype,"unmuteLocal"),$t.prototype),$t);function ci(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,o=await i.lock("From P2PConnection.".concat(e));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return await r.apply(this,a)}finally{o()}},n}function ay(t,e){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=ar(e.width),r.height=ar(e.height);const i=ar(e.framerate||15);document.body.append(n),document.body.append(r);let o=t._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const s=r.getContext("2d");if(!s)throw new P(R.UNEXPECTED_ERROR,"can not get canvas context");const a=wt(),c=r.captureStream(a.supportRequestFrame?0:i).getVideoTracks()[0];c.canvas||(c.canvas=r),r.startCapture=()=>{if(!n)return r.stopCapture&&r.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const l=n.videoWidth,u=n.videoHeight/l,h=r.width*u;Math.abs(h-r.height)>=2&&(m.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(h)),r.height=h)}s.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),o!==t._mediaStreamTrack&&(o=t._mediaStreamTrack,n.srcObject=new MediaStream([o]))},r.stopCapture=mC(()=>r.startCapture&&r.startCapture(),i);const d=c.stop;return c.stop=()=>{d.call(c),n&&(n.remove(),n.srcObject=null,n=null),r&&(r.width=0,r.remove(),r.stopCapture&&r.stopCapture(),r.startCapture=void 0,r.stopCapture=void 0,r=null),m.debug("clean low stream renderer")},c}var Mf=function(t){return t[t.HEIGHT=2033]="HEIGHT",t[t.FRAME_RATE=2034]="FRAME_RATE",t[t.WIDTH=2035]="WIDTH",t}(Mf||{}),Ue=function(t){return t[t.FRAME_RATE=2002]="FRAME_RATE",t[t.WIDTH=2003]="WIDTH",t[t.HEIGHT=2004]="HEIGHT",t[t.PACKAGE_LOST=2005]="PACKAGE_LOST",t[t.AVG_ENCODE=2007]="AVG_ENCODE",t[t.NACKS=2009]="NACKS",t[t.PLIS=2010]="PLIS",t[t.FIRS=2011]="FIRS",t[t.BITRATE=2012]="BITRATE",t[t.PACKAGE_RATE=2031]="PACKAGE_RATE",t[t.ADAPTATION=2032]="ADAPTATION",t[t.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",t[t.BANDWIDTH=2061]="BANDWIDTH",t[t.RETRANSMIT=2062]="RETRANSMIT",t[t.TARGET_ENCODED=2064]="TARGET_ENCODED",t[t.TRANSMIT=2066]="TRANSMIT",t[t.FREEZE=2082]="FREEZE",t[t.DISABLED=2095]="DISABLED",t[t.PLAYER_STATUS=2128]="PLAYER_STATUS",t[t.QP_SUM=2143]="QP_SUM",t}(Ue||{}),Ta=function(t){return t[t.BITRATE=2069]="BITRATE",t[t.PACKAGE_LOST=2070]="PACKAGE_LOST",t[t.PACKAGE_RATE=2071]="PACKAGE_RATE",t[t.HEIGHT=2073]="HEIGHT",t[t.FRAME_RATE=2075]="FRAME_RATE",t[t.WIDTH=2077]="WIDTH",t}(Ta||{}),_n=function(t){return t[t.JITTER=-1]="JITTER",t[t.PACKAGE_LOST=2014]="PACKAGE_LOST",t[t.WIDTH=2018]="WIDTH",t[t.HEIGHT=2019]="HEIGHT",t[t.FRAME_RATE=2020]="FRAME_RATE",t[t.JITTER_BUFFER=2023]="JITTER_BUFFER",t[t.CURRENT_DELAY=2024]="CURRENT_DELAY",t[t.NACKS=2026]="NACKS",t[t.PLIS=2027]="PLIS",t[t.FIRS=2028]="FIRS",t[t.BITRATE=2029]="BITRATE",t[t.PACKAGE_RATE=2078]="PACKAGE_RATE",t[t.FREEZE=2084]="FREEZE",t[t.DISABLED=2101]="DISABLED",t[t.PLAYER_STATUS=2129]="PLAYER_STATUS",t[t.QP_SUM=2144]="QP_SUM",t[t.I_FRAME_DELAY=2149]="I_FRAME_DELAY",t}(_n||{}),va=function(t){return t[t.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",t[t.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",t[t.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",t[t.FREEZE_TIME=2109]="FREEZE_TIME",t[t.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",t[t.FREEZE_DURATION=2156]="FREEZE_DURATION",t}(va||{}),SF=function(t){return t[t.PCM_LEVEL=2104]="PCM_LEVEL",t}(SF||{}),Uo=function(t){return t[t.PACKAGE_LOST=-1]="PACKAGE_LOST",t[t.LEVEL=2038]="LEVEL",t[t.BITRATE=2039]="BITRATE",t[t.PACKAGE_RATE=2040]="PACKAGE_RATE",t[t.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",t[t.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",t[t.FREEZE=2081]="FREEZE",t[t.DISABLED=2096]="DISABLED",t}(Uo||{}),li=function(t){return t[t.BITRATE=2044]="BITRATE",t[t.PACKAGE_LOST=2045]="PACKAGE_LOST",t[t.PACKAGE_RATE=2046]="PACKAGE_RATE",t[t.CURRENT_DELAY=2047]="CURRENT_DELAY",t[t.JITTER_BUFFER=2054]="JITTER_BUFFER",t[t.JITTER=2055]="JITTER",t[t.FREEZE=2083]="FREEZE",t[t.DISABLED=2102]="DISABLED",t[t.PCM_LEVEL=2105]="PCM_LEVEL",t[t.PLAYER_STATUS=2130]="PLAYER_STATUS",t[t.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",t}(li||{}),TF=function(t){return t[t.FREEZE_TIME=-1]="FREEZE_TIME",t[t.LEVEL=2043]="LEVEL",t}(TF||{}),jr=function(t){return t[t.RTT=2006]="RTT",t[t.CONN_TYPE=801]="CONN_TYPE",t}(jr||{});const Po=1e3,fa=3;function pt(t,e,n){n!=null&&Number.isFinite(n)&&(t[e]=Math.round(Math.max(0,n)))}function ZP(t){const e={[jr.CONN_TYPE]:0,[jr.RTT]:t.rtt};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;n==="udp"&&(e[jr.CONN_TYPE]=1),n==="tcp"&&(e[jr.CONN_TYPE]=3),n==="tls"&&(e[jr.CONN_TYPE]=4);break}case"srflx":e[jr.CONN_TYPE]=2}return e}function tD(t){let e=0;switch(t){case"none":e=0;break;case"cpu":e=1;break;case"bandwidth":e=2;break;case"other":e=3}return e}class vF extends oe{constructor(e){super(),v(this,"store",void 0),v(this,"uploadWRTCStatsTimer",void 0),v(this,"uploadOutboundDenoiserStatsTimer",void 0),v(this,"uploadExtStatsTimer",void 0),v(this,"uploadExtUsageStatsTimer",void 0),v(this,"uploadInboundExtStatsTimer",void 0),v(this,"requestStats",void 0),v(this,"requestTransportStats",void 0),v(this,"requestLocalMedia",void 0),v(this,"requestRemoteMedia",void 0),v(this,"requestAllTracks",void 0),v(this,"requestVideoIsReady",void 0),v(this,"requestUploadStats",void 0),v(this,"requestUpload",void 0),v(this,"uploadOutboundStarted",!1),v(this,"uploadInboundStarted",!1),v(this,"uploadTransportStarted",!1),v(this,"uploadExtensionUsageStarted",!1),v(this,"lastRecvStats",void 0),v(this,"lastSendStats",void 0),v(this,"lastFullRecvStats",void 0),v(this,"lastFullSendStats",void 0),v(this,"needUploadRenderFreezeTime",!0),this.store=e}uploadWRTCStats(e){if(!this.requestStats||!this.requestUploadStats)return;let n,r;if(this.uploadTransportStarted&&(n=this.requestStats(),this.store.useP2P&&(r=this.requestStats(!0))),!n&&this.uploadOutboundStarted&&(n=this.requestStats()),!r&&this.uploadInboundStarted&&(r=this.requestStats(!0)),n||r){const i={};if(this.uploadTransportStarted&&n){const o=this.getTransportStats(n,r,e);o&&(i.misc=[o])}if(this.uploadOutboundStarted&&n){const o=this.getOutboundStats(n,e?this.lastSendStats:this.lastFullSendStats,e);o&&(i.outbound=[o])}if(this.uploadInboundStarted&&r){const o=this.getInboundStats(r,e?this.lastRecvStats:this.lastFullRecvStats,e);o&&(i.inbound=o)}this.requestUploadStats(i)}this.lastRecvStats=r,this.lastSendStats=n,e||(this.lastFullRecvStats=r,this.lastFullSendStats=n)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;let e=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted)return this.stopUploadWRTCStats();this.uploadWRTCStats(e!==fa),++e===fa+1&&(e=1)},Po)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(e,n,r){if(!this.requestStats)return;if(r)return e.rtt==null?void 0:{addition:{[jr.RTT]:e.rtt,[jr.CONN_TYPE]:void 0}};const i=ZP(e);if(this.store.useP2P){if(n){const o=ZP(n);i[jr.CONN_TYPE]+=o[jr.CONN_TYPE]<<3}i[jr.CONN_TYPE]+=110}else i[jr.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(e,n,r){if(!this.requestUploadStats||!this.requestLocalMedia)return;const i=this.requestLocalMedia();if(!i||i.length===0)return;let o,s,a;return i.forEach(c=>{let[d,{track:l,ssrcs:u}]=c;switch(d){case B.LocalVideoLowTrack:case B.LocalVideoTrack:if(d===B.LocalVideoTrack){const h=function(f,_,T,g,y){const I=_.videoSend.find(W=>W.ssrc===f);if(!I)return;const O={},{sentFrame:b,inputFrame:N}=I;if(N&&b){const W=N.frameRate,lt=b.frameRate;O[Ue.FREEZE]=function(mt,St){let Yt=!0;return Yt=!(mt<=5)&&(mt<=10?St<3:mt<=20?St<4:St<5),Yt}(W,lt)?1:0}if(pt(O,Ue.QP_SUM,I.qpSumPerFrame),y)return O;switch(b&&(pt(O,Ue.HEIGHT,b.height),pt(O,Ue.WIDTH,b.width),pt(O,Ue.FRAME_RATE,b.frameRate)),O[Ue.DISABLED]=g._originMediaStreamTrack&&!g._originMediaStreamTrack.enabled||g._mediaStreamTrack&&!g._mediaStreamTrack.enabled?1:0,I.adaptionChangeReason){case"none":O[Ue.ADAPTATION]=0;break;case"cpu":O[Ue.ADAPTATION]=1;break;case"bandwidth":O[Ue.ADAPTATION]=2;break;case"other":O[Ue.ADAPTATION]=3}let U=0;I.adaptionChangeReason&&(U+=tD(I.adaptionChangeReason)),_.qualityLimitationReason&&(U+=tD(_.qualityLimitationReason)<<3),O[Ue.ADAPTATION]=U,O[Ue.PLAYER_STATUS]=mS[g._player?g._player.videoElementStatus:"uninit"],pt(O,Ue.NACKS,I.nacksCount),pt(O,Ue.PLIS,I.plisCount),pt(O,Ue.FIRS,I.firsCount),pt(O,Ue.AVG_ENCODE,I.avgEncodeMs);const V=T&&T.videoSend.find(W=>W.ssrc===f);if(V){let W=y?Po:Po*fa;V.timestamp&&I.timestamp&&(W=I.timestamp-V.timestamp),V.packets!=null&&I.packets!=null&&pt(O,Ue.PACKAGE_RATE,1e3*(I.packets-V.packets)/W),I.packetsLost!=null&&V.packetsLost!=null&&pt(O,Ue.PACKAGE_LOST,I.packetsLost-V.packetsLost),V.bytes!=null&&I.bytes!=null&&pt(O,Ue.BITRATE,8*(I.bytes-V.bytes)/W)}return O}(u[0].ssrcId,e,n,l,r),p=r?null:function(f,_,T){const g=_.videoSend.find(U=>U.ssrc===f);if(!g)return null;const y={},I=g.inputFrame,O=I&&I.height||T&&T.videoHeight||0,b=I&&I.width||T&&T.videoWidth||0,N=I&&I.frameRate||0;return pt(y,Mf.HEIGHT,O),pt(y,Mf.WIDTH,b),pt(y,Mf.FRAME_RATE,N),y}(u[0].ssrcId,e,l),S=r?null:function(f){const _={};return pt(_,Ue.RETRANSMIT,f.bitrate.retransmit),pt(_,Ue.TARGET_ENCODED,f.bitrate.targetEncoded),pt(_,Ue.ACTUAL_ENCODED,f.bitrate.actualEncoded),pt(_,Ue.TRANSMIT,f.bitrate.transmit),pt(_,Ue.BANDWIDTH,f.sendBandwidth),_}(e);s=Object.assign({},h,p,S)}else a=r?void 0:function(h,p,S){const f=p.videoSend.find(g=>g.ssrc===h);if(!f)return;const _={},T=f.sentFrame;if(T&&(pt(_,Ta.HEIGHT,T.height),pt(_,Ta.WIDTH,T.width),pt(_,Ta.FRAME_RATE,T.frameRate)),S){const g=S.videoSend.find(y=>y.ssrc===h);if(g){let y=Po*fa;g.timestamp&&f.timestamp&&(y=f.timestamp-g.timestamp),g.packets!=null&&f.packets!=null&&pt(_,Ta.PACKAGE_RATE,1e3*(f.packets-g.packets)/y),f.packetsLost!=null&&g.packetsLost!=null&&pt(_,Ta.PACKAGE_LOST,f.packetsLost-g.packetsLost),g.bytes!=null&&f.bytes!=null&&pt(_,Ta.BITRATE,8*(f.bytes-g.bytes)/y)}}return _}(u[0].ssrcId,e,n);break;case B.LocalAudioTrack:o=r?void 0:function(h,p,S,f){const _=p.audioSend.find(O=>O.ssrc===h);if(!_)return;const T={};T[Uo.DISABLED]=f._originMediaStreamTrack&&!f._originMediaStreamTrack.enabled||f._mediaStreamTrack&&!f._mediaStreamTrack.enabled?1:0;const g=100*f._source.getAccurateVolumeLevel(),y=_.inputLevel;if(y!=null){const O=Math.ceil(50*Math.log10(100*y+1));pt(T,Uo.LEVEL,O)}else pt(T,Uo.LEVEL,g);pt(T,SF.PCM_LEVEL,g),pt(T,Uo.AEC_RETURN_LOSS,_.aecReturnLoss),pt(T,Uo.AEC_RETURN_LOSS_ENH,_.aecReturnLossEnhancement),T[Uo.FREEZE]=0;const I=S&&S.audioSend.find(O=>O.ssrc===h);if(I){let O=Po*fa;I.timestamp&&_.timestamp&&(O=_.timestamp-I.timestamp),I.bytes!=null&&_.bytes!=null&&pt(T,Uo.BITRATE,8*(_.bytes-I.bytes)/O),I.packets!=null&&_.packets!=null&&pt(T,Uo.PACKAGE_RATE,1e3*(_.packets-I.packets)/O)}return T}(u[0].ssrcId,e,n,l)}}),{high:s,low:a,audio:o}}getInboundStats(e,n,r){if(!this.requestRemoteMedia)return;const i=this.requestRemoteMedia()||[],o=[];return i.forEach(s=>{let[a,c]=s;const d={peer:a.uid};if(c.has(et.VIDEO)&&a.videoTrack){const l=a._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(a._videoSSRC)||!1,u=a.videoTrack?function(h,p,S,f,_,T,g){var y;const I=p.videoRecv.find(lt=>lt.ssrc===h);if(!I)return;const O={},{receivedFrame:b,outputFrame:N,decodeFrameRate:U}=I,V=S&&S.videoRecv.find(lt=>lt.ssrc===h);if(O[_n.FREEZE]=_&&ih.isRemoteVideoFreeze(f,I,V)?1:0,pt(O,va.FRAME_RATE_DECODE,U),pt(O,_n.QP_SUM,I.qpSumPerFrame),I.framesRateFirefox&&pt(O,_n.FRAME_RATE,I.framesRateFirefox),b&&pt(O,_n.FRAME_RATE,b.frameRate),V){const lt=p.timestamp-S.timestamp||(g?Po:fa*Po);I.packetsLost!=null&&V.packetsLost!=null&&pt(O,_n.PACKAGE_LOST,I.packetsLost-V.packetsLost),V.bytes!=null&&I.bytes!=null&&pt(O,_n.BITRATE,8*(I.bytes-V.bytes)/lt),V.packets!=null&&I.packets!=null&&pt(O,_n.PACKAGE_RATE,1e3*(I.packets-V.packets)/lt)}if(g)return O;b?(pt(O,_n.HEIGHT,b.height),pt(O,_n.WIDTH,b.width)):f&&(pt(O,_n.HEIGHT,f._videoHeight||0),pt(O,_n.WIDTH,f._videoWidth||0)),N&&pt(O,va.FRAME_RATE_OUTPUT,N.frameRate);const W=(y=f._player)===null||y===void 0?void 0:y.rendFrameRate.toFixed(0);if(W&&pt(O,va.FRAME_RATE_RENDER,+W),pt(O,_n.JITTER_BUFFER,I.jitterBufferMs),pt(O,_n.CURRENT_DELAY,I.currentDelayMs),pt(O,_n.FIRS,I.firsCount),pt(O,_n.NACKS,I.nacksCount),pt(O,_n.PLIS,I.plisCount),f){O[_n.DISABLED]=f._originMediaStreamTrack.enabled&&f._mediaStreamTrack.enabled?0:1;const lt=f._player;if(lt){const{freezeTimeCounterList:mt,renderFreezeAccTime:St,videoElementStatus:Yt}=lt;if(mt&&mt.length>0&&pt(O,va.FREEZE_TIME,mt.splice(0,1)[0]),T&&Mo.visibility==="visible"&&Yt===yn.PLAYING&&wt().supportRequestVideoFrameCallback){const Lt=Math.min(6e3,St);lt.renderFreezeAccTime=Math.max(0,St-Lt),pt(O,va.FREEZE_TIME_RENDER,Lt)}if(typeof I.totalFreezesDuration=="number"){const Lt=V&&V.totalFreezesDuration?I.totalFreezesDuration-V.totalFreezesDuration:I.totalFreezesDuration;pt(O,va.FREEZE_DURATION,1e3*Lt)}}}if(O[_n.PLAYER_STATUS]=mS[f._player?f._player.videoElementStatus:"uninit"],V&&I.totalInterFrameDelay!==void 0&&I.totalSquaredInterFrameDelay!==void 0&&V.totalInterFrameDelay!==void 0&&V.totalSquaredInterFrameDelay!==void 0){const lt=I.totalInterFrameDelay-V.totalInterFrameDelay,mt=I.totalSquaredInterFrameDelay-V.totalSquaredInterFrameDelay,St=I.framesDecodeCount-V.framesDecodeCount,Yt=lt/St*1e3,Lt=Math.round(1e3*Math.sqrt((mt-Math.pow(lt,2)/St)/St));!isNaN(Lt)&&Yt+Lt>Math.max(3*Yt,Yt+150)&&(O[_n.I_FRAME_DELAY]=Lt)}return O}(a._videoSSRC,e,n,a.videoTrack,l===!0,this.needUploadRenderFreezeTime,r):void 0;u&&(d.video=u)}if(c.has(et.AUDIO)&&a.audioTrack){const l=a.audioTrack?function(u,h,p,S,f){const _=h.audioRecv.find(V=>V.ssrc===u);if(!_)return;const T={},g=p&&p.audioRecv.find(V=>V.ssrc===u),{receivedFrames:y,droppedFrames:I}=_;var O,b;if(pt(T,li.JITTER,_.jitterMs),y!=null&&I!=null&&(T[li.FREEZE]=(b=I,(O=y)===0||100*b/O>20?1:0)),g){const V=h.timestamp-p.timestamp||(f?Po:Po*fa);_.packets!=null&&g.packets!=null&&pt(T,li.PACKAGE_RATE,1e3*(_.packets-g.packets)/V),g.bytes!=null&&_.bytes!=null&&pt(T,li.BITRATE,8*(_.bytes-g.bytes)/V),_.packetsLost!=null&&g.packetsLost!=null&&pt(T,li.PACKAGE_LOST,_.packetsLost-g.packetsLost)}if(f)return T;const N=100*S._source.getAccurateVolumeLevel(),U=_.outputLevel;if(U!=null){const V=Math.ceil(50*Math.log10(100*U+1));pt(T,TF.LEVEL,V)}if(pt(T,li.PCM_LEVEL,N),S&&(T[li.DISABLED]=S._originMediaStreamTrack.enabled&&S._mediaStreamTrack.enabled?0:1),pt(T,li.JITTER_BUFFER,_.jitterBufferMs),pt(T,li.CURRENT_DELAY,_.jitterBufferMs),T[li.PLAYER_STATUS]=mS[Fn.getPlayerState(S.getTrackId())],g){const V=_.concealedSamples-g.concealedSamples;V>0&&pt(T,li.CONCEALED_SAMPLES,V)}return T}(a._audioSSRC,e,n,a.audioTrack,r):void 0;l&&(d.audio=l)}(d.video||d.audio)&&o.push(d)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,o}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const e=(this.requestAllTracks()||[]).find(n=>n instanceof Mm);if(e&&e._external.getDenoiserStats){const n=e._external.getDenoiserStats();n&&this.requestUpload(Ju.DENOISER_STATS,n)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(e=>{e.getProcessorStats().forEach(n=>{this.requestUpload&&this.requestUpload(n.type,n.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(e=>{let[n,r]=e;r.has(et.VIDEO)&&n.videoTrack&&n.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),r.has(et.AUDIO)&&n.audioTrack&&n.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const e=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const n=Date.now(),r={connectionInterval:A("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:n};let i=[];const o=this.requestAllTracks&&this.requestAllTracks()||[];for(const d of o)!d.muted&&d.enabled&&(i=i.concat(await d.getProcessorUsage()));const s=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[d,l]of s)l.has(et.VIDEO)&&d.videoTrack&&(i=i.concat(await d.videoTrack.getProcessorUsage())),l.has(et.AUDIO)&&d.audioTrack&&(i=i.concat(await d.audioTrack.getProcessorUsage()));if(i.length===0)return;r.details=function(d,l){const u={};for(const{id:f,value:_,level:T,direction:g}of d){var h;const y=(h=l.get(f))!==null&&h!==void 0?h:0,I=_===2?y+A("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:y;var p,S;l.set(f,I),u[f]?(_===2&&(u[f].value=_),T>u[f].level&&(u[f].level=T),g==="remote"&&(u[f].remoteUidCount+=1),u[f].totalTs=(p=l.get(f))!==null&&p!==void 0?p:0):u[f]={value:_,level:T,remoteUidCount:g==="local"?0:1,totalTs:(S=l.get(f))!==null&&S!==void 0?S:0}}return Object.keys(u).map(f=>{const{level:_,value:T,totalTs:g}=u[f];return{id:f,level:_,value:T,totalTs:g}})}(i,e);const a=Date.now(),c=a>n?a:n+1;this.requestUpload&&this.requestUpload(Ju.EXTENSION_USAGE_STATS,{usageStats:r,sendTs:c})},A("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}}class Rs{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(e,n){v(this,"uid",void 0),v(this,"_uintid",void 0),v(this,"_trust_in_room_",!0),v(this,"_trust_audio_enabled_state_",!0),v(this,"_trust_video_enabled_state_",!0),v(this,"_trust_audio_mute_state_",!0),v(this,"_trust_video_mute_state_",!0),v(this,"_audio_muted_",!1),v(this,"_video_muted_",!1),v(this,"_audio_enabled_",!0),v(this,"_video_enabled_",!0),v(this,"_audio_added_",!1),v(this,"_video_added_",!1),v(this,"_is_pre_created",!1),v(this,"_video_pre_subscribed",!1),v(this,"_audio_pre_subscribed",!1),v(this,"_trust_video_stream_added_state_",!0),v(this,"_trust_audio_stream_added_state_",!0),v(this,"_audioTrack",void 0),v(this,"_videoTrack",void 0),v(this,"_dataChannels",[]),v(this,"_audioSSRC",void 0),v(this,"_videoSSRC",void 0),v(this,"_audioOrtc",void 0),v(this,"_videoOrtc",void 0),v(this,"_cname",void 0),v(this,"_rtxSsrcId",void 0),v(this,"_videoMid",void 0),v(this,"_audioMid",void 0),this.uid=e,this._uintid=n}}let Ui=function(t){return t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY",t}({});function Ctt(t,e){var n;let r;switch(e){case B.LocalAudioTrack:r=Nt.Audio;break;case B.LocalVideoTrack:r=$(n=t._hints).call(n,Ht.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case B.LocalVideoLowTrack:r=Nt.Low}return r}function cy(t){const e=wt();if(t.some(n=>n._bypassWebAudio))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!e.webAudioMediaStreamDest)throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function wS(t,e){cy(t);const n=new be;return t.forEach(r=>n.addAudioTrack(r)),n}var eD,nD,rD,iD,oD,sD,aD,cD,dD,lD,uD,Zt;function hD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Vp(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hD(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let nr=(eD=Di(Ui.SEND_ONLY),nD=Di(Ui.SEND_ONLY),rD=Di(),iD=Di(Ui.RECEIVE_ONLY),oD=Di(Ui.RECEIVE_ONLY),sD=Di(Ui.RECEIVE_ONLY),aD=Di(Ui.RECEIVE_ONLY),cD=Di(Ui.RECEIVE_ONLY),dD=Di(Ui.RECEIVE_ONLY),lD=Di(),uD=Di(Ui.RECEIVE_ONLY),Zt=class extends oe{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(ot.StateChange,e,this._state)}constructor(t,e){super(),v(this,"isPlanB",!1),v(this,"store",void 0),v(this,"statsUploader",void 0),v(this,"sendConnection",void 0),v(this,"recvConnection",void 0),v(this,"localTrackMap",new Map),v(this,"remoteUserMap",new Map),v(this,"localDataChannels",[]),v(this,"pendingLocalTracks",[]),v(this,"pendingRemoteTracks",[]),v(this,"statsCollector",void 0),v(this,"dtlsFailedCount",0),v(this,"sendMutex",new pn("P2PChannel2-send-mutex")),v(this,"recvMutex",new pn("P2PChannel2-recv-mutex")),v(this,"_state",bt.Disconnected),v(this,"_restartStates",["disconnected","failed"]),v(this,"reconnectInterval",void 0),v(this,"uploadUnplinkStarted",!1),v(this,"uploadDownlinkStarted",!1),v(this,"uplinkStateUploadInterval",void 0),v(this,"downlinkStatsUploadInterval",void 0),v(this,"handleMuteLocalTrack",async(n,r,i)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==bt.Connected)return void i(new M(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const c=this.filterTobeMutedTracks(n);if(c.length===0)return void r();const d=c.find(p=>p[0]==="videoLowTrack");d&&d[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(c.map(p=>{let[,{id:S}]=p;return S}));let l=!1;var s,a;n.trackMediaType==="video"?l=!((s=this.localTrackMap.get(B.LocalAudioTrack))===null||s===void 0||!s.track._muted):l=((a=this.localTrackMap.get(B.LocalVideoTrack))===null||a===void 0?void 0:a.id)===void 0;const u=this.createMuteMessage(c);await Wt(this,ot.RequestMuteLocal,u);const h=n.trackMediaType==="video"?Ns.MUTE_LOCAL_VIDEO:Ns.MUTE_LOCAL_AUDIO;await Wt(this,ot.RequestP2PMuteLocal,{action:h,message:u,isMuteAll:l}),r()}catch(c){i(c)}finally{o()}}),v(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==bt.Connected)return void i(new M(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const s=this.filterTobeUnmutedTracks(n);if(s.length===0)return void r();await this.sendConnection.unmuteLocal(s.map(d=>{let[,{id:l}]=d;return l}));const a=this.createUnmuteMessage(s),c=n.trackMediaType==="video"?Ns.UNMUTE_LOCAL_VIDEO:Ns.UNMUTE_LOCAL_AUDIO;await Wt(this,ot.RequestP2PMuteLocal,{action:c,message:a}),r()}catch(s){i(s)}finally{o()}}),v(this,"handleUpdateVideoEncoder",async(n,r,i)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const s=this.localTrackMap.get(B.LocalVideoTrack);if(!this.sendConnection||!s||s.track!==n||this.state!==bt.Connected)return void r();const{id:a,track:c}=s;a&&(await this.sendConnection.updateSendParameters(a,c),await this.sendConnection.updateEncoderConfig(a,c),this.emit(ot.UpdateVideoEncoder,c)),r()}catch(s){i(s)}finally{o()}}),v(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const s=this.localTrackMap.get(B.LocalVideoTrack);if(!this.sendConnection||!s||s.track!==n||this.state!==bt.Connected)return void r();const{id:a,track:c}=s;a&&await this.sendConnection.updateSendParameters(a,c),r()}catch(s){i(s)}finally{o()}}),v(this,"handleReplaceTrack",async(n,r,i,o)=>{let s;m.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof o=="boolean"&&o||(s=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var a;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:u}]=l;return n===u});if(!this.sendConnection||!d||d[1].id===void 0||this.state!==bt.Connected)return void r();if(await((a=this.sendConnection)===null||a===void 0?void 0:a.replaceTrack(n,d[1].id)),d[0]===B.LocalVideoTrack&&wt().supportDualStreamEncoding){const l=this.localTrackMap.get(B.LocalVideoLowTrack);if(l){const u=n._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=u,l.track._originMediaStreamTrack=u,await new Y((h,p)=>{this.handleReplaceTrack(l.track,h,p,!0)})}}r()}catch(d){i(d)}finally{var c;(c=s)===null||c===void 0||c()}}),v(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),v(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),v(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),v(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new vF(t),this.bindStatsUploaderEvents(),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(n=>{n&&(n.iceConnectionState!=="disconnected"&&n.iceConnectionState!=="failed"||this.handleDisconnect(n.direction))})},A("ICE_RESTART_INTERVAL"))}async startP2PConnection(t,e){throw new M(R.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t){throw new M(R.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){let n;try{if(e){this.recvConnection&&(m.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),n=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new QP(t,this.store,Nn.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const r=await this.recvConnection.establish(e);return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}{this.state=bt.New,this.sendConnection&&(m.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),n=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new QP(t,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const r=await this.sendConnection.establish();return{iceParameters:r.iceParameters,dtlsParameters:r.dtlsParameters,sdp:r.sdp}}}finally{n&&n()}}async p2pConnect(t){if(!this.sendConnection)throw new M(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=bt.Connected}async addRemoteCandidate(t,e){if(e===Nn.RECEIVE_ONLY){if(!this.sendConnection)throw new M(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(t)}else{if(!this.recvConnection)throw new M(R.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t)}}publish(t,e,n){var r=this;return Hr(function*(){const i=yield Ct(r.sendMutex.lock("From P2PChannel.publish"));try{if(!r.sendConnection||r.state!==bt.Connected){r.throwIfTrackTypeNotMatch(t);const d=t.filter(l=>r.pendingLocalTracks.indexOf(l)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(d))}r.store.pubId=r.store.pubId+1,un.markPublishStart(r.store.clientId,r.store.pubId);const o=r.filterTobePublishedTracks(t,e,n);if(o.length===0)return void(yield Ct(r.tryToUnmuteAudio(t)));o.forEach(d=>{let{track:l,type:u}=d;const h=Date.now();r.store.publish(l.getTrackId(),u===B.LocalAudioTrack?"audio":"video",h)}),r.bindLocalTrackEvents(o);const s=yield Ct(r.sendConnection.send(o.map(d=>{let{track:l}=d;return l}),r.store.codec,r.store.audioCodec)),a=(yield Ct(s.next())).value,c=r.createGatewayPublishMessage(o,a);try{yield c}catch(d){throw s.throw(d),(d==null?void 0:d.code)===R.WS_ABORT&&o.forEach(l=>{let{track:u}=l;r.pendingLocalTracks.indexOf(u)===-1&&r.pendingLocalTracks.push(u)}),r.unbindLocalTrackEvents(o),d}yield Ct(s.next()),o.forEach(d=>{let{type:l}=d;r.statsCollector.addLocalStats(l)}),r.statsUploader.startUploadOutboundStats(),r.assignLocalTracks(o,a),o.forEach(d=>{let{track:l,type:u}=d;const h=Date.now();r.store.publish(l.getTrackId(),u===B.LocalAudioTrack?"audio":"video",void 0,h)}),r.startUploadUplinkState()}finally{i()}})()}async unpublish(t){if(!this.sendConnection||this.state!==bt.Connected)return void(t.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!$(t).call(t,i)));const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(i=>i[0]==="videoLowTrack");n&&n[1].track.close();const r=this.createGatewayUnpublishMessage(e);if(await this.sendConnection.stopSending(e.map(i=>{let[,{id:o}]=i;return o})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(i=>{let[o,{track:s}]=i;return{type:o,track:s}})),e.forEach(i=>{let[o]=i;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===bt.Connected)return n&&n[1].track.close(),r;t.forEach(i=>{const o=this.pendingLocalTracks.indexOf(i);o!==-1&&this.pendingLocalTracks.splice(o,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const t=()=>{const e=[],n=[];Array.from(this.localTrackMap.entries()).forEach(r=>{let[i,{track:o,ssrcs:s}]=r;const a={stream_type:Ctt(o,i),ssrcs:s};o._muted||!o._enabled?e.push(a):n.push(a)}),e.length>0&&e.forEach(r=>{Wt(this,ot.RequestMuteLocal,[r])}),n.length>0&&n.forEach(r=>{Wt(this,ot.RequestUnmuteLocal,[r])})};t(),this.uplinkStateUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(t){return Hr(function*(){throw new M(R.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(m.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await cn(this,ot.RequestRePublish,this.pendingLocalTracks),this.emit(ot.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new M(R.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(t,e,n,r){var i;if(!this.recvConnection)throw new M(R.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(t))!==null&&i!==void 0&&i.has(e))return;const{track:o,mid:s,transceiver:a}=await this.recvConnection.receive(e,[{ssrcId:n}],String(t.uid),r);e===et.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(o):(t._audioTrack=new Td(o,t.uid,t._uintid,this.store),m.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),a&&t._audioTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=n,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(o):(t._videoTrack=new Sd(o,t.uid,t._uintid,this.store),m.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),a&&t._videoTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(t,t._videoTrack));const c=this.remoteUserMap.get(t);c?c.set(e,s):this.remoteUserMap.set(t,new Map([[e,s]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const d=this.pendingRemoteTracks.findIndex(l=>{let{user:u,kind:h}=l;return u.uid===t.uid&&e===h});d!==-1&&(this.pendingRemoteTracks.splice(d,1),this.emit(ot.MediaReconnectEnd,t.uid))}async mockSubscribe(t,e,n,r){if(!this.recvConnection)throw new M(R.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(e,[{ssrcId:n}],String(t.uid),r)}async unsubscribe(t,e,n){const r=this.pendingRemoteTracks.filter(o=>{let{user:s,kind:a}=o;return e!==void 0?s.uid===t.uid&&e===a:s.uid===t.uid});if(r.forEach(o=>{const s=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(s,1)}),this.recvConnection||n||r.forEach(o=>{let{kind:s}=o;var a;if(s===et.AUDIO)(a=t._audioTrack)===null||a===void 0||a._destroy(),t._audioTrack=void 0;else if(s===et.VIDEO){var c;(c=t._videoTrack)===null||c===void 0||c._destroy(),t._videoTrack=void 0}}),!this.recvConnection)return;const i=this.filterTobeUnSubscribedTracks(t,e);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(o=>{let[,{id:s}]=o;return s})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(o=>{let[s,{kind:a}]=o;var c,d;if(a===et.VIDEO&&s._videoSSRC&&((c=this.recvConnection)===null||c===void 0||c.setStatsRemoteVideoIsReady(s._videoSSRC,!1)),a===et.VIDEO)this.unbindRemoteTrackEvents(s._videoTrack),n||((d=s._videoTrack)===null||d===void 0||d._destroy(),s._videoTrack=void 0);else if(a===et.AUDIO){var l;this.unbindRemoteTrackEvents(s._audioTrack),!n&&((l=s._audioTrack)===null||l===void 0||l._destroy(),s._audioTrack=void 0)}}),i.forEach(o=>{let[,{kind:s}]=o;Wt(this,ot.RequestP2PMuteRemote,s)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const t=()=>Array.from(this.remoteUserMap.entries()).forEach(e=>{let[,n]=e;[et.VIDEO,et.AUDIO].forEach(r=>{n.has(r)?Wt(this,ot.RequestP2PUnmuteRemote,r):Wt(this,ot.RequestP2PMuteRemote,r)})});t(),this.downlinkStatsUploadInterval=window.setInterval(()=>{t()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new M(R.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new M(R.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new M(R.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new M(R.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void m.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void m.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const r=e===et.VIDEO?t._videoSSRC:t._audioSSRC;r!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void m.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||m.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(B.LocalAudioTrack);if((e==null?void 0:e.track)instanceof be){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==B.LocalAudioTrack}).filter(r=>{let[i]=r;return!(t&&i===B.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(t&&r===B.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(t,e,n,r,i){if(t){const s=this.localTrackMap.get(B.LocalAudioTrack),a=r?this.localTrackMap.get(B.LocalVideoLowTrack):this.localTrackMap.get(B.LocalVideoTrack);tt.publish(this.store.sessionId,{eventElapse:un.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:s==null?void 0:s.track.getTrackLabel(),videoName:a==null?void 0:a.track.getTrackLabel(),screenshare:(a==null?void 0:a.track._hints.indexOf(Ht.SCREEN_TRACK))!==-1,audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const s=n.find(c=>c instanceof se),a=r?(o=this.localTrackMap.get(B.LocalVideoTrack))===null||o===void 0?void 0:o.track:n.find(c=>c instanceof qt);tt.publish(this.store.sessionId,{eventElapse:un.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:s==null?void 0:s.getTrackLabel(),videoName:a==null?void 0:a.getTrackLabel(),screenshare:(a==null?void 0:a._hints.indexOf(Ht.SCREEN_TRACK))!==-1,audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(t,e,n,r){const i=r===et.VIDEO?n._videoSSRC:n._audioSSRC;i&&tt.subscribe(this.store.sessionId,{succ:t,ec:e,video:r===et.VIDEO,audio:r===et.AUDIO,peerid:n.uid,subscribeRequestid:r===et.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:un.measureFromSubscribeStart(this.store.clientId,i)})}reset(){m.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new pn("P2PChannel2-send-mutex"),this.sendMutex=new pn("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(B.LocalAudioTrack);if((t==null?void 0:t.track)instanceof be){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=bt.Disconnected}getStats(t){var e,n;return t?(n=this.recvConnection)===null||n===void 0?void 0:n.getStats():(e=this.sendConnection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.recvConnection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(B.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(B.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof qt||e&&e.track instanceof se?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(_r(e=this.remoteUserMap).call(e)).find(r=>r.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(B.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Ph(t).call(t,(n,r)=>n.level-r.level),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(m.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=bt.Reconnecting,A("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:r}]=t;switch(n){case B.LocalVideoTrack:$(e=r._hints).call(e,Ht.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case B.LocalAudioTrack:r instanceof be?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case B.LocalVideoLowTrack:}}),this.emit(ot.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(_r(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(e,r)}),this.emit(ot.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),m.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((t instanceof Rs?t.uid:t)===r.uid&&e===i)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t,e){let n,r;if(t===Nn.SEND_ONLY){if(!this.sendConnection)throw new M(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");n=await this.sendMutex.lock("From P2PChannel.restartICE"),r=this.sendConnection}else{if(!this.recvConnection)throw new M(R.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");n=await this.recvMutex.lock("From P2PChannel.restartICE"),r=this.recvConnection}try{if(e){const i=await r.restartICE(e);return r.isInRestartIce=!1,i}{const i=await r.restartICE();if(i){const o=await cn(this,ot.RequestP2PRestartICE,{direction:Nn.RECEIVE_ONLY,iceParameter:i});await r.restartICE(o),r.isInRestartIce=!1}}}finally{n()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(B.LocalVideoTrack),n=this.localTrackMap.get(B.LocalAudioTrack),r=t.videoSend.find(p=>{var S;return p.ssrc===(e==null||(S=e.ssrcs)===null||S===void 0?void 0:S[0].ssrcId)}),i=t.audioSend.find(p=>{var S;return p.ssrc===(n==null||(S=n.ssrcs)===null||S===void 0?void 0:S[0].ssrcId)});if(!r||!i)return 1;const o=Kr(this,ot.NeedSignalRTT),s=r?r.rttMs:void 0,a=i?i.rttMs:void 0,c=s&&a?(s+a)/2:s||a,d=(c&&o?(c+o)/2:c||o)||0,l=100*t.sendPacketLossRate*.7/50+.3*d/1500,u=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,h=e==null?void 0:e.track;if(h&&h._encoderConfig&&h._hints.indexOf(Ht.SCREEN_TRACK)===-1){const p=h._encoderConfig.bitrateMax,S=t.bitrate.actualEncoded;if(p&&S){const f=(1e3*p-S)/(1e3*p);return EV[f<.15?0:f<.3?1:f<.45?2:f<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,s=t.audioRecv.find(S=>S.ssrc===i),a=t.videoRecv.find(S=>S.ssrc===o);if(!s&&!a)return void(e+=1);const c=Kr(this,ot.NeedSignalRTT),d=t.rtt,l=(d&&c?(d+c)/2:d||c)||0,u=s?s.jitterMs:void 0,h=t.recvPacketLossRate;let p=.7*h*100/50+.3*l/1500;u&&(p=.6*h*100/50+.2*l/1500+.2*u/400),e+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new Y((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}filterTobePublishedTracks(t,e,n){const r=[],i=wt(),o=this.getAllTracks();t=rd(t=t.filter(c=>o.indexOf(c)===-1));let s=!1,a=!1;for(const c of t){if(c instanceof qt&&(this.localTrackMap.has(B.LocalVideoTrack)||s?new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:B.LocalVideoTrack}),s=!0),e)){const d=this.getLowVideoTrack(c,n);r.push({track:d,type:B.LocalVideoLowTrack})}if(c instanceof se){const d=this.localTrackMap.get(B.LocalAudioTrack);if(d){if(!(d.track instanceof be))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");d.track.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0)}else if(a){const l=r.find(u=>{let{type:h}=u;return h===B.LocalAudioTrack});if(!(l.track instanceof be))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(c._bypassWebAudio)throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");l.track.addAudioTrack(c)}else{if(!i.webAudioMediaStreamDest||c instanceof be||c._bypassWebAudio)r.push({track:c,type:B.LocalAudioTrack});else{const l=new be;l.addAudioTrack(c),r.push({track:l,type:B.LocalAudioTrack})}a=!0}}}return r}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=rd(t=t.filter(r=>n.indexOf(r)!==-1));for(const r of t){if(r instanceof se){const i=this.localTrackMap.get(B.LocalAudioTrack);if(!i)continue;i.track instanceof be?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(e.push([B.LocalAudioTrack,i]),i.track.close())):e.push([B.LocalAudioTrack,i])}if(r instanceof qt){const i=this.localTrackMap.get(B.LocalVideoTrack);if(!i)continue;e.push([B.LocalVideoTrack,i]);const o=this.localTrackMap.get(B.LocalVideoLowTrack);o&&e.push([B.LocalVideoLowTrack,o])}}return e}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:r}=e;switch(r){case B.LocalVideoTrack:n.addListener(J.GET_STATS,this.handleGetLocalVideoStats),n.addListener(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(J.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(J.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(J.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case B.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case B.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof be?t.trackList.forEach(n=>{n.addListener(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(J.GET_STATS,this.handleGetLocalAudioStats),n.addListener(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(J.GET_STATS,this.handleGetLocalAudioStats),t.addListener(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(J.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:r}]=e;return{track:r,type:n}})),t.forEach(e=>{let{track:n,type:r}=e;switch(r){case B.LocalVideoTrack:n.off(J.GET_STATS,this.handleGetLocalVideoStats),n.off(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(J.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(J.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(J.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case B.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case B.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof be?t.trackList.forEach(e=>{e.off(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(J.GET_STATS,this.handleGetLocalAudioStats),e.off(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(J.GET_STATS,this.handleGetLocalAudioStats),t.off(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(J.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof Sd&&e.addListener(J.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Td&&e.addListener(J.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(J.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(et.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(et.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,r)=>{var i;let o,{track:s,type:a}=n;switch(a){case B.LocalAudioTrack:o=Nt.Audio;break;case B.LocalVideoTrack:o=$(i=s._hints).call(i,Ht.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case B.LocalVideoLowTrack:o=Nt.Low}return{kind:a===B.LocalAudioTrack?et.AUDIO:et.VIDEO,stream_type:o,mid:e[r].id,ssrcs:e[r].localSSRC,isMuted:s.muted||!s.enabled}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let r,[i,{track:o,ssrcs:s,id:a}]=e;switch(i){case B.LocalVideoTrack:r=$(n=o._hints).call(n,Ht.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case B.LocalAudioTrack:r=Nt.Audio;break;case B.LocalVideoLowTrack:r=Nt.Low}return{stream_type:r,ssrcs:s,mid:a}})}assignLocalTracks(t,e){t.forEach((n,r)=>{let{track:i,type:o}=n;this.localTrackMap.set(o,{track:i,id:e[r].id,ssrcs:e[r].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(t.name,".onConnectionStateChange(").concat(e,")")),this.emit(ot.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(t.isInRestartIce=!1),$(n=this._restartStates).call(n,e)&&!t.isInRestartIce&&(e==="disconnected"&&await Je(800),t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="failed"||this.handleDisconnect(t.direction))},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),tt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:ae.TRACER}).onSuccess(),this.emit(ot.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const r=Array.from(_r(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===e);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(gd.FIRST_FRAME_DECODED),tt.firstRemoteFrame(this.store.sessionId,He.FIRST_AUDIO_DECODE,re.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:un.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const r=Array.from(_r(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===e);r&&tt.firstRemoteFrame(this.store.sessionId,He.FIRST_AUDIO_RECEIVED,re.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:un.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,r)=>{this.reportVideoFirstFrameDecoded(e,n,r)},t.onFirstVideoReceived=e=>{var n;const r=Array.from(_r(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===e);r&&tt.firstRemoteFrame(this.store.sessionId,He.FIRST_VIDEO_RECEIVED,re.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:un.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const r=e.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(ot.ConnectionTypeChange,r),m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ps(n))," -> ").concat(JSON.stringify(Ps(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ps(n))," -> ").concat(JSON.stringify(Ps(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.onLocalCandidate=e=>{this.emit(ot.LocalCandidate,{candidate:e,direction:t.direction})}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}async handleDisconnect(t){const e=t===Nn.SEND_ONLY?this.sendConnection:this.recvConnection;e&&!e.isInRestartIce&&(e.isInRestartIce=!0,m.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(e.name,"] start use restartICE")),t===Nn.SEND_ONLY?this.restartICE(t):cn(this,ot.RequestP2PRestartICE,{direction:Nn.SEND_ONLY}))}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(B.LocalAudioTrack);if(t instanceof se&&(n==null?void 0:n.track)instanceof be)return n.track.isActive||e.push([B.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return t===o});if(r&&(e.push(r),r[0]===B.LocalVideoTrack)){const i=this.localTrackMap.get(B.LocalVideoLowTrack);i&&e.push([B.LocalVideoLowTrack,i])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(B.LocalAudioTrack);if(t instanceof se&&(n==null?void 0:n.track)instanceof be)return n.track.isActive&&e.push([B.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return t===o});if(r)if(r[0]===B.LocalVideoTrack){e.push(r);const i=this.localTrackMap.get(B.LocalVideoLowTrack);i&&e.push([B.LocalVideoLowTrack,i])}else e.push(r);return e}createMuteMessage(t){return t.map(e=>{var n;let r,[i,{track:o,ssrcs:s,id:a}]=e;switch(i){case B.LocalAudioTrack:r=Nt.Audio;break;case B.LocalVideoTrack:r=$(n=o._hints).call(n,Ht.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case B.LocalVideoLowTrack:r=Nt.Low}return{stream_type:r,ssrcs:s,mid:a}})}createUnmuteMessage(t){return t.map(e=>{var n;let r,[i,{track:o,ssrcs:s,id:a}]=e;switch(i){case B.LocalAudioTrack:r=Nt.Audio;break;case B.LocalVideoTrack:r=$(n=o._hints).call(n,Ht.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case B.LocalVideoLowTrack:r=Nt.Low}return{stream_type:r,ssrcs:s,mid:a}})}filterTobeUnSubscribedTracks(t,e){const n=[],r=this.remoteUserMap.get(t);if(!r)return n;if(e){const i=r.get(e);if(!i)return n;n.push([t,{kind:e,id:i}])}else Array.from(r.entries()).forEach(i=>{let[o,s]=i;n.push([t,{kind:o,id:s}])});return n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[r,{kind:i,id:o}]=n;switch(i){case et.VIDEO:return void(r._videoSSRC&&e.push({stream_type:et.VIDEO,ssrcId:r._videoSSRC}));case et.AUDIO:return void(r._audioSSRC&&e.push({stream_type:et.AUDIO,ssrcId:r._audioSSRC}))}}),e}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:r}]=e;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(B.LocalVideoTrack),n=this.localTrackMap.get(B.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),n&&t.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return t!=="connected"&&e!=="connected"}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof se){const n=this.filterTobeUnmutedTracks(t[e]);if(n.length===0)continue;const r=this.createUnmuteMessage(n);return void await Wt(this,ot.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(t=>{let[,{ssrcs:e}]=t;return!!e}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.recvConnection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(ot.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(ot.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Je(oC(this.dtlsFailedCount,we)),this.emit(ot.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(B.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof qt)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof qt).length>1)throw new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof se).length>1&&(t.some(e=>e instanceof se&&e._bypassWebAudio)||!wt().webAudioMediaStreamDest))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof qt&&this.pendingLocalTracks.some(n=>n instanceof qt))throw new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof se&&this.pendingLocalTracks.some(n=>n instanceof se)&&(!wt().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof se&&n._bypassWebAudio)))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding,r=Vp(Vp({},{width:160,height:120,framerate:15,bitrate:50}),e);let i;i=n?t._mediaStreamTrack.clone():ay(t,r);const o=zt(8,"track-low-"),s=new qt(i,Vp(Vp({},n&&{scaleResolutionDownBy:Jv(r,t)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return s.on(Ha.TRANSCEIVER_UPDATED,a=>{t._updateRtpTransceiver(a,xd.LOW_STREAM)}),s._hints.push(Ht.LOW_STREAM),t.addListener(J.NEED_CLOSE,()=>{s.close()}),s}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,r){var i;const o=Array.from(_r(i=this.remoteUserMap).call(i)).find(s=>s._videoSSRC===t);if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s=this.store.keyMetrics,a=s.subscribe.find(c=>c.userId===o.uid&&c.type==="video");tt.firstRemoteVideoDecode(this.store.sessionId,He.FIRST_VIDEO_DECODE,re.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:e,videoheight:n,subscribeElapse:un.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:s.requestAPEnd||0,apStart:s.requestAPStart||0,joinGwEnd:s.joinGatewayEnd||0,joinGwStart:s.joinGatewayStart||0,pcEnd:s.peerConnectionEnd||0,pcStart:s.peerConnectionStart||0,subscriberEnd:(a==null?void 0:a.subscribeEnd)||0,subscriberStart:(a==null?void 0:a.subscribeStart)||0,videoAddNotify:(a==null?void 0:a.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const r=this.remoteUserMap.get(t);if(!r)return!1;const i=r.get(e);if(!i)return!1;const o=await this.recvConnection.getRemoteSSRC(i);return o!==void 0&&o!==n}isPreSubScribe(t){return!1}async publishDataChannel(t){throw new M(R.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new M(R.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new M(R.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new M(R.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new M(R.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new M(R.NOT_SUPPORTED)}async preConnect(t){throw new M(R.NOT_SUPPORTED)}getEstablishParams(){throw new M(R.NOT_SUPPORTED)}async reSubscribe(t){throw new M(R.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new M(R.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===B.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,xd.LOW_STREAM):n._updateRtpTransceiver(void 0)})}},X(Zt.prototype,"p2pConnect",[eD],Object.getOwnPropertyDescriptor(Zt.prototype,"p2pConnect"),Zt.prototype),X(Zt.prototype,"unpublish",[nD],Object.getOwnPropertyDescriptor(Zt.prototype,"unpublish"),Zt.prototype),X(Zt.prototype,"unpublishLowStream",[rD],Object.getOwnPropertyDescriptor(Zt.prototype,"unpublishLowStream"),Zt.prototype),X(Zt.prototype,"subscribe",[iD],Object.getOwnPropertyDescriptor(Zt.prototype,"subscribe"),Zt.prototype),X(Zt.prototype,"mockSubscribe",[oD],Object.getOwnPropertyDescriptor(Zt.prototype,"mockSubscribe"),Zt.prototype),X(Zt.prototype,"unsubscribe",[sD],Object.getOwnPropertyDescriptor(Zt.prototype,"unsubscribe"),Zt.prototype),X(Zt.prototype,"muteRemote",[aD],Object.getOwnPropertyDescriptor(Zt.prototype,"muteRemote"),Zt.prototype),X(Zt.prototype,"unmuteRemote",[cD],Object.getOwnPropertyDescriptor(Zt.prototype,"unmuteRemote"),Zt.prototype),X(Zt.prototype,"hasRemoteMediaWithLock",[dD],Object.getOwnPropertyDescriptor(Zt.prototype,"hasRemoteMediaWithLock"),Zt.prototype),X(Zt.prototype,"disconnectForReconnect",[lD],Object.getOwnPropertyDescriptor(Zt.prototype,"disconnectForReconnect"),Zt.prototype),X(Zt.prototype,"remoteMediaSsrcChanged",[uD],Object.getOwnPropertyDescriptor(Zt.prototype,"remoteMediaSsrcChanged"),Zt.prototype),Zt);function Di(t){return function(e,n,r){const i=e[n];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];switch(t){case Ui.SEND_ONLY:{const c=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,s)}finally{c()}}case Ui.RECEIVE_ONLY:{const c=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,s)}finally{c()}}default:{const c=await this.sendMutex.lock("From P2PChannel2.".concat(n)),d=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await i.apply(this,s)}finally{c(),d()}}}},r}}function pD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ma(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?pD(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):pD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class ih{constructor(e){v(this,"store",void 0),v(this,"onStatsException",void 0),v(this,"onUploadPublishDuration",void 0),v(this,"onStatsChanged",void 0),v(this,"localStats",new Map),v(this,"remoteStats",new Map),v(this,"updateStatsInterval",void 0),v(this,"trafficStats",void 0),v(this,"trafficStatsPeerList",[]),v(this,"uplinkStats",void 0),v(this,"exceptionMonitor",void 0),v(this,"p2pChannel",void 0),v(this,"scalabilityMode",Yv.L1T1),v(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=e,this.exceptionMonitor=new utt,this.exceptionMonitor.on("exception",(n,r,i)=>{this.onStatsException&&this.onStatsException(n,r,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(B.LocalAudioTrack)||ma({},Zv)}getLocalVideoTrackStats(){return this.localStats.get(B.LocalVideoTrack)||ma({},ty)}getRemoteAudioTrackStats(e){const n=(o,s)=>{if(!this.trafficStats)return s;const a=this.trafficStats.peer_delay.find(c=>c.peer_uid===o);return a&&(s.publishDuration=a.B_ppad+(Date.now()-this.trafficStats.timestamp)),s},r={};if(e){var i;const o=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.audioStats;o&&(r[e]=n(e,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[s,{audioStats:a}]=o;a&&(r[s]=n(s,a))});return r}getRemoteNetworkQualityStats(e){const n={};if(e){var r;const i=(r=this.remoteStats.get(e))===null||r===void 0?void 0:r.networkStats;i&&(n[e]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[o,{networkStats:s}]=i;s&&(n[o]=s)});return n}getRemoteVideoTrackStats(e){const n=(o,s)=>{if(!this.trafficStats)return s;const a=this.trafficStats.peer_delay.find(c=>c.peer_uid===o);return a&&(s.publishDuration=a.B_ppvd+(Date.now()-this.trafficStats.timestamp)),s},r={};if(e){var i;const o=(i=this.remoteStats.get(e))===null||i===void 0?void 0:i.videoStats;o&&(r[e]=n(e,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[s,{videoStats:a}]=o;a&&(r[s]=n(s,a))});return r}getRTCStats(){let e=0,n=0,r=0,i=0;const o=this.localStats.get(B.LocalAudioTrack);o&&(e+=o.sendBytes,n+=o.sendBitrate);const s=this.localStats.get(B.LocalVideoTrack);s&&(e+=s.sendBytes,n+=s.sendBitrate);const a=this.localStats.get(B.LocalVideoLowTrack);a&&(e+=a.sendBytes,n+=a.sendBitrate),this.remoteStats.forEach(d=>{let{audioStats:l,videoStats:u}=d;l&&(r+=l.receiveBytes,i+=l.receiveBitrate),u&&(r+=u.receiveBytes,i+=u.receiveBitrate)});let c=1;return this.trafficStats&&(c+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:c,SendBitrate:n,SendBytes:e,RecvBytes:r,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),e.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const i=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),o=i!=null&&i.videoSSRC?un.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,s=i!=null&&i.audioSSRC?un.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,o>s?o:s),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&m.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,n,r){if(!e)return!1;const i=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,o=!r||n.framesDecodeCount>r.framesDecodeCount;return i||!o}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach(n=>{let[r,i]=n;switch(r){case B.LocalVideoTrack:case B.LocalVideoLowTrack:{const s=i,a=ma({},ty),c=e.getStats(),d=e.getLocalMedia(r);if(c){const l=c.videoSend.find(u=>u.ssrc===(d==null?void 0:d.ssrcs[0].ssrcId));if(l){const u=e.getLocalVideoSize(),h=e.getEncoderConfig(B.LocalVideoTrack);l.codec!=="H264"&&l.codec!=="H265"&&l.codec!=="VP8"&&l.codec!=="VP9"&&l.codec!=="AV1X"&&l.codec!=="AV1"||(a.codecType=l.codec),a.sendBytes=l.bytes,a.sendBitrate=s?8*Math.max(0,a.sendBytes-s.sendBytes):0,l.inputFrame?(a.captureFrameRate=l.inputFrame.frameRate,a.captureResolutionHeight=l.inputFrame.height,a.captureResolutionWidth=l.inputFrame.width):u&&(a.captureResolutionWidth=u.width,a.captureResolutionHeight=u.height),l.sentFrame?(a.sendFrameRate=l.sentFrame.frameRate,a.sendResolutionHeight=l.sentFrame.height,a.sendResolutionWidth=l.sentFrame.width):u&&(a.sendResolutionWidth=u.width,a.sendResolutionHeight=u.height),l.avgEncodeMs&&(a.encodeDelay=l.avgEncodeMs),h&&h.bitrateMax&&(a.targetSendBitrate=1e3*h.bitrateMax),a.sendPackets=l.packets,a.sendPacketsLost=l.packetsLost,a.sendJitterMs=l.jitterMs,a.sendRttMs=l.rttMs,a.totalDuration=s?s.totalDuration+1:1,a.totalFreezeTime=s?s.totalFreezeTime:0,this.isLocalVideoFreeze(l)&&(a.totalFreezeTime+=1),l.scalabilityMode&&this.scalabilityMode!==l.scalabilityMode&&(m.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(l.scalabilityMode)),this.scalabilityMode=l.scalabilityMode)}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(r,a),((s==null?void 0:s.sendResolutionWidth)!==a.sendResolutionWidth||(s==null?void 0:s.sendResolutionHeight)!==a.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:a.sendResolutionWidth,height:a.sendResolutionHeight})),a&&d&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,d.track,a);break}case B.LocalAudioTrack:{const s=i,a=ma({},Zv),c=e.getStats(),d=e.getLocalMedia(r);if(c){const l=c.audioSend.find(u=>u.ssrc===(d==null?void 0:d.ssrcs[0].ssrcId));if(l){if(l.codec!=="opus"&&l.codec!=="aac"&&l.codec!=="PCMU"&&l.codec!=="PCMA"&&l.codec!=="G722"||(a.codecType=l.codec),l.inputLevel)a.sendVolumeLevel=Math.round(32767*l.inputLevel);else{const u=e.getLocalAudioVolume();u&&(a.sendVolumeLevel=Math.round(32767*u))}a.sendBytes=l.bytes,a.sendPackets=l.packets,a.sendPacketsLost=l.packetsLost,a.sendJitterMs=l.jitterMs,a.sendRttMs=l.rttMs,a.sendBitrate=s?8*Math.max(0,a.sendBytes-s.sendBytes):0}}this.trafficStats&&(a.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(B.LocalAudioTrack,a),a&&d&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,d.track,a);break}}})}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach(n=>{var r,i;let[o,{videoStats:s,audioStats:a,videoPcStats:c}]=n;const d=a,l=s,u=c,h=ma({},kV),p=ma({},LV),S=ma({},GZ),{audioTrack:f,videoTrack:_,audioSSRC:T,videoSSRC:g}=e.getRemoteMedia(o);let y;y=e instanceof nr?e.getStats(!0):e.getStats();const I=(r=y)===null||r===void 0?void 0:r.audioRecv.find(N=>N.ssrc===T),O=(i=y)===null||i===void 0?void 0:i.videoRecv.find(N=>N.ssrc===g),b=this.trafficStats&&this.trafficStats.peer_delay.find(N=>N.peer_uid===o);if(I&&(I.codec!=="opus"&&I.codec!=="aac"&&I.codec!=="PCMU"&&I.codec!=="PCMA"&&I.codec!=="G722"||(h.codecType=I.codec),I.outputLevel?h.receiveLevel=Math.round(32767*I.outputLevel):f&&(h.receiveLevel=Math.round(32767*f.getVolumeLevel())),h.receiveBytes=I.bytes,h.receivePackets=I.packets,h.receivePacketsLost=I.packetsLost,h.receivePacketsDiscarded=I.packetsDiscarded,h.packetLossRate=h.receivePacketsLost/(h.receivePackets+h.receivePacketsLost),h.receiveBitrate=d?8*Math.max(0,h.receiveBytes-d.receiveBytes):0,h.totalDuration=d?d.totalDuration+1:1,h.totalFreezeTime=d?d.totalFreezeTime:0,h.freezeRate=h.totalFreezeTime/h.totalDuration,h.receiveDelay=I.jitterBufferMs,h.totalDuration>10&&ih.isRemoteAudioFreeze(f)&&(h.totalFreezeTime+=1)),O){O.codec!=="H264"&&O.codec!=="H265"&&O.codec!=="VP8"&&O.codec!=="VP9"&&O.codec!=="AV1X"&&O.codec!=="AV1"||(p.codecType=O.codec),p.receiveBytes=O.bytes,p.receiveBitrate=l?8*Math.max(0,p.receiveBytes-l.receiveBytes):0,p.decodeFrameRate=O.decodeFrameRate<0?0:O.decodeFrameRate,p.renderFrameRate=O.decodeFrameRate<0?0:O.decodeFrameRate,O.outputFrame&&(p.renderFrameRate=O.outputFrame.frameRate),O.receivedFrame?(p.receiveFrameRate=O.receivedFrame.frameRate,p.receiveResolutionHeight=O.receivedFrame.height,p.receiveResolutionWidth=O.receivedFrame.width):_&&(p.receiveResolutionHeight=_._videoHeight||0,p.receiveResolutionWidth=_._videoWidth||0),O.framesRateFirefox!==void 0&&(p.receiveFrameRate=Math.round(O.framesRateFirefox)),p.receivePackets=O.packets,p.receivePacketsLost=O.packetsLost,p.packetLossRate=p.receivePacketsLost/(p.receivePackets+p.receivePacketsLost),p.totalDuration=l?l.totalDuration+1:1,p.totalFreezeTime=l?l.totalFreezeTime:0,p.receiveDelay=O.jitterBufferMs||0;const N=!!g&&e.getRemoteVideoIsReady(g);_&&N&&ih.isRemoteVideoFreeze(_,O,u)&&(p.totalFreezeTime+=1),p.freezeRate=p.totalFreezeTime/p.totalDuration}b&&(h.end2EndDelay=b.B_ad,p.end2EndDelay=b.B_vd,h.transportDelay=b.B_ed,p.transportDelay=b.B_ed,h.currentPacketLossRate=b.B_ealr4/100,p.currentPacketLossRate=b.B_evlr4/100,S.uplinkNetworkQuality=b.B_punq?b.B_punq:0,S.downlinkNetworkQuality=b.B_pdnq?b.B_pdnq:0),this.remoteStats.set(o,{audioStats:h,videoStats:p,videoPcStats:O,networkStats:S}),f&&this.exceptionMonitor.setRemoteAudioStats(f,h),_&&this.exceptionMonitor.setRemoteVideoStats(_,p)})}}class yF{constructor(){v(this,"destChannelMediaInfos",new Map),v(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){pb(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){pb(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){W_(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function fD(t){if(!(t instanceof yF))return new P(R.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();if(!e)return new P(R.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new P(R.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}function mD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function _D(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?mD(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}var Gt;function ED(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Fp(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?ED(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ED(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let bl=(Gt=class Kl extends vV{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return $(n=Object.keys(G_)).call(n,e)}))]}constructor(e,n){super(e,n),v(this,"store",void 0),v(this,"peerConnection",void 0),v(this,"remoteSDP",void 0),v(this,"initialOffer",void 0),v(this,"statsFilter",void 0),v(this,"useRTX",!1),v(this,"localCapabilities",void 0),v(this,"localCandidateCount",0),v(this,"allCandidatesReceived",!1),v(this,"establishPromise",void 0),v(this,"mutex",new pn("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(Kl.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=IC(this.peerConnection,A("STATS_UPDATE_INTERVAL"),void 0,ce()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Ds(e.sdp),r=th(e.sdp,{filterRTX:!this.useRTX,filterVideoFec:A("FILTER_VIDEO_FEC"),filterAudioFec:A("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=r,this.initialOffer=e,Fp(Fp({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:e.sdp})}catch(e){throw new M(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async updateRemoteConnect(){}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(r){v(this,"sessionDesc",void 0),v(this,"localCapabilities",void 0),v(this,"rtpCapabilities",void 0),v(this,"candidates",void 0),v(this,"iceParameters",void 0),v(this,"dtlsParameters",void 0),v(this,"setup",void 0),v(this,"currentMidIndex",void 0),v(this,"cname",void 0),r=Se(r);const{iceParameters:i,dtlsParameters:o,candidates:s,rtpCapabilities:a,setup:c,localCapabilities:d,sdkCodec:l,cname:u}=r,h=$e.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=s,this.iceParameters=i,this.dtlsParameters=o,this.setup=c,this.localCapabilities=d,this.cname=u;for(let p=0;p<h.mediaDescriptions.length;p++){const S=h.mediaDescriptions[p];if(S.attributes.iceUfrag=i.iceUfrag,S.attributes.icePwd=i.icePwd,S.attributes.fingerprints=o.fingerprints,S.attributes.candidates=s,S.attributes.setup=c,S.media.mediaType==="video"){S.media.fmts=a.videoCodecs.map(_=>_.payloadType.toString(10));let f=a.videoCodecs.filter(_=>{var T,g;return(T=_.rtpMap)===null||T===void 0?void 0:$(g=T.encodingName.toLowerCase()).call(g,l)});f.length===0&&(f=a.videoCodecs),S.attributes.payloads=f,S.attributes.extmaps=a.videoExtensions}S.media.mediaType==="audio"&&(S.media.fmts=a.audioCodecs.map(f=>f.payloadType.toString(10)),S.attributes.payloads=a.audioCodecs,S.attributes.extmaps=a.audioExtensions),h.mediaDescriptions[p]=this.mungMediaDesc(S)}this.sessionDesc=h,this.currentMidIndex=h.mediaDescriptions.length-1}toString(){return $e.print(this.sessionDesc)}send(r,i,o){const{ssrcs:s,ssrcGroups:a}=Ca(i,this.cname),c=this.sessionDesc.mediaDescriptions.find(u=>r===et.VIDEO?u.media.mediaType==="video":u.media.mediaType==="audio"),d=s[0].attributes.label,l=s[0].attributes.mslabel;return c.attributes.ssrcs=c.attributes.ssrcs.concat(s),c.attributes.ssrcGroups=c.attributes.ssrcGroups.concat(a),{id:d,mslabel:l}}batchSend(r){return r.map(i=>{let{kind:o,ssrcMsg:s}=i;return this.send(o,s,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const o=[],s=[],a=[];i.attributes.ssrcs.forEach(c=>{$(r).call(r,c.attributes.label||"")?a.push(c):o.push(c)}),i.attributes.ssrcGroups.forEach(c=>{var d;$(d=a.map(l=>l.ssrcId)).call(d,c.ssrcIds[0])||s.push(c)}),i.attributes.ssrcs=o,i.attributes.ssrcGroups=s})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(o=>o.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,o){r.forEach((s,a)=>{const c=s._mediaStreamTrack,d=this.sessionDesc.mediaDescriptions.findIndex(u=>u.attributes.mid===c.kind),l=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[d],s);this.sessionDesc.mediaDescriptions[d]=l})}stopReceiving(r){}updateCandidates(r){r===sr.TCP?this.candidates.forEach(i=>{this.candidates.findIndex(o=>o.transport==="tcp"&&o.connectionAddress===i.connectionAddress&&o.port===i.port)===-1&&this.candidates.push(_D(_D({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}):this.candidates=this.candidates.filter(i=>i.transport!=="tcp");for(const i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}restartICE(r){r=Se(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let o=0;o<r;o++)i.push((this.currentMidIndex+o+1).toString(10));return i}mungRecvMediaDsec(r,i){const o=Se(r);return Vd(o,i),SC(o,i),o}updateRecvMedia(r,i){const o=this.sessionDesc.mediaDescriptions.findIndex(s=>s.attributes.mid===r);if(o!==-1){const s=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[o],i);this.sessionDesc.mediaDescriptions[o]=s}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,o){const s=this.sessionDesc.mediaDescriptions.find(c=>r===et.VIDEO?c.attributes.mid==="video":c.attributes.mid==="audio");if(s){const c=s.attributes.ssrcs.find(d=>d.attributes.label===i);var a;c&&(c.attributes.label=o,(a=c.attributes.msid)===null||a===void 0||a.replace(i,o))}}mungMediaDesc(r){const i=Se(r);return gC(i),function(o){const s=o.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");s&&o.attributes.extmaps.splice(o.attributes.extmaps.indexOf(s),1),o.attributes.payloads.forEach(a=>{const c=a.rtcpFeedbacks.findIndex(d=>d.type==="transport-cc");c!==-1&&a.rtcpFeedbacks.splice(c,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const o of i.attributes.ssrcs)if(o.attributes.label===r)return[o]}}(Fp(Fp({},e),{},{rtpCapabilities:e.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const n=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteRTPCapabilities(e,n){throw new M(R.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(e){}send(e,n){var r=this;return Hr(function*(){const i=yield Ct(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=e.map(h=>r.peerConnection.addTrack(h._mediaStreamTrack)),s=yield Ct(r.peerConnection.createOffer()),a=$e.parse(s.sdp),c=e.map(h=>{const p=h._mediaStreamTrack,S=a.mediaDescriptions.find(f=>f.attributes.mid===p.kind);if(!S)throw new Error("Cannot extract ssrc from mediaDescription.");return function(f,_,T){const g=f.attributes.ssrcs.filter(I=>I.attributes.label===_),y=f.attributes.ssrcGroups;if(g.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(y&&g.length>1){const I=y.find(O=>O.ssrcIds.indexOf(g[0].ssrcId)!==-1);return I?[{ssrcId:I.ssrcIds[0],rtx:T?I.ssrcIds[1]:void 0}]:[{ssrcId:g[0].ssrcId}]}return[{ssrcId:g[0].ssrcId}]}(S,p.id,r.useRTX)});let d;try{d=yield c}catch(h){throw o.forEach(p=>{an()&&p.replaceTrack(null),r.peerConnection.removeTrack(p)}),h}const l=r.mungSendOfferSDP(s.sdp,e);r.remoteSDP.receive(e,n,d);const u=r.remoteSDP.toString();return yield Ct(r.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield Ct(r.applySendEncodings(o,e)),yield Ct(r.peerConnection.setRemoteDescription({type:"answer",sdp:u})),e.map((h,p)=>{const S=h._mediaStreamTrack.id;return{localSSRC:c[p],id:S}})}catch(o){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{i()}})()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(o=>{var s;return e.indexOf(((s=o.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(o=>{an()&&o.replaceTrack(null),this.peerConnection.removeTrack(o)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(e);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:o,mslabel:s}=this.remoteSDP.send(e,n,i),a=new Y((l,u)=>{const h=setTimeout(()=>{u(new Error("Cannot receive track, id: ".concat(o)))},1e4),p=S=>{const f=It();if((f.name==="Safari"&&Number(f.version)===11||Dn())&&S.track.id!==o&&S.streams[0].id===s){var _;const T=S.streams[0].getTracks()[0];return(_=this.remoteSDP)===null||_===void 0||_.updateTrackLabel(e,o,S.track.id),this.peerConnection.removeEventListener("track",p),clearTimeout(h),void l(T)}if(S.track.id===o)return this.peerConnection.removeEventListener("track",p),clearTimeout(h),void l(S.track)};this.peerConnection.addEventListener("track",p)}),c=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:c});const d=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(d),{track:await a,id:o}}catch(o){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var i;return e.indexOf(((i=r.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(n.length!==e.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(an()&&r.track)r.track.enabled=!1;else{const i=r.getParameters();i.encodings.forEach(o=>o.active=!1),r.setParameters(i)}})}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(o=>{var s;return e.indexOf(((s=o.track)===null||s===void 0?void 0:s.id)||"")!==-1});if(n.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async o=>{if(an()&&o.track)o.track.enabled=!0;else{const s=o.getParameters();s.encodings.forEach(a=>a.active=!0),await o.setParameters(s)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Hr(function*(){const r=yield Ct(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(wt().supportPCSetConfiguration){const c=n.peerConnection.getConfiguration(),d=e===sr.RELAY?"relay":"all";c.iceTransportPolicy!==d&&(m.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(c.iceTransportPolicy,"] to [").concat(d,"]")),c.iceTransportPolicy=d,n.peerConnection.setConfiguration(c))}else if(e===sr.RELAY)return;e!==sr.RELAY&&n.remoteSDP.updateCandidates(e);const i=yield Ct(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=Ds(i.sdp),{remoteIceParameters:s}=yield o.iceParameters;n.remoteSDP.restartICE(s);const a=n.remoteSDP.toString();yield Ct(n.peerConnection.setLocalDescription(i)),yield Ct(n.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(i){m.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var e;this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(e,n){const r=this.peerConnection.getSenders().filter(i=>{var o;return((o=i.track)===null||o===void 0?void 0:o.id)===e});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const r=this.peerConnection.getSenders().find(i=>{var o;return((o=i.track)===null||o===void 0?void 0:o.id)===n});r&&await r.replaceTrack(e._mediaStreamTrack)}createDataChannels(e,n){throw new M(R.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(e){throw new M(R.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,m.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,m.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},A("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[],sdpSemantics:"plan-b"};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(F_(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...Kl.turnServerConfigToIceServers(e.turnServer.servers)),A("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...Kl.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async updateRtpSenderEncodings(e,n){var r;if(n||(n=this.peerConnection.getSenders().find(d=>{var l;return((l=d.track)===null||l===void 0?void 0:l.id)===e._mediaStreamTrack.id})),!n)return m.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(!wt().supportSetRtpSenderParameters)return m.warn("Browser not support set rtp-sender parameters");const i={},o={};if(e instanceof qt)switch(e._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(A("DSCP_TYPE")&&Xs()){var s;const d=A("DSCP_TYPE");$(s=["very-low","low","medium","high"]).call(s,d)&&(o.networkPriority=d)}const a=n.getParameters(),c=(r=a.encodings)===null||r===void 0?void 0:r[0];c&&Object.assign(c,o),Object.assign(a,i),m.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await n.setParameters(a)}async applySendEncodings(e,n){try{if(!wt().supportSetRtpSenderParameters||e.length!==n.length)return;for(let r=0;r<e.length;r++){const i=e[r],o=n[r];i&&o&&await this.updateRtpSenderEncodings(o,i)}}catch{m.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n){const r=$e.parse(e);return n.forEach((i,o)=>{const s=i._mediaStreamTrack,a=r.mediaDescriptions.find(c=>c.attributes.mid===s.kind);a&&Vd(a,i)}),$e.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,e,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(e).map((o,s)=>{let{id:a,mslabel:c}=o;const{kind:d}=e[s];return new Y((l,u)=>{const h=setTimeout(()=>{u(new Error("Cannot receive track, id: ".concat(a)))},1e4),p=S=>{const f=It();if(f.name==="Safari"&&Number(f.version)===11&&S.track.id!==a&&S.streams[0].id===c){var _;const T=S.streams[0].getTracks()[0];return(_=this.remoteSDP)===null||_===void 0||_.updateTrackLabel(d,a,S.track.id),this.peerConnection.removeEventListener("track",p),clearTimeout(h),void l({track:T,id:a})}if(S.track.id===a)return this.peerConnection.removeEventListener("track",p),clearTimeout(h),void l({track:S.track,id:a})};this.peerConnection.addEventListener("track",p)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await Y.all(n)}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n==null?void 0:n[0].ssrcId}setConfiguration(e){if(wt().supportPCSetConfiguration){const n=Kl.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},X(Gt.prototype,"connect",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"connect"),Gt.prototype),X(Gt.prototype,"stopSending",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"stopSending"),Gt.prototype),X(Gt.prototype,"receive",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"receive"),Gt.prototype),X(Gt.prototype,"stopReceiving",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"stopReceiving"),Gt.prototype),X(Gt.prototype,"muteRemote",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"muteRemote"),Gt.prototype),X(Gt.prototype,"unmuteRemote",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"unmuteRemote"),Gt.prototype),X(Gt.prototype,"muteLocal",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"muteLocal"),Gt.prototype),X(Gt.prototype,"unmuteLocal",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"unmuteLocal"),Gt.prototype),X(Gt.prototype,"close",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"close"),Gt.prototype),X(Gt.prototype,"updateEncoderConfig",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"updateEncoderConfig"),Gt.prototype),X(Gt.prototype,"updateSendParameters",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"updateSendParameters"),Gt.prototype),X(Gt.prototype,"replaceTrack",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"replaceTrack"),Gt.prototype),X(Gt.prototype,"getRemoteSSRC",[Lr],Object.getOwnPropertyDescriptor(Gt.prototype,"getRemoteSSRC"),Gt.prototype),Gt);function Lr(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,o=await i.lock("Locking from P2PConnection.".concat(e));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return await r.apply(this,a)}finally{o()}},n}function gD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ps(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?gD(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Nl="9",SD=4e4;class Itt{get localCapabilities(){return Se(this._localCapabilities)}get rtpCapabilities(){return Se(this._rtpCapabilities)}get candidates(){return Se(this._candidates)}get iceParameters(){return Se(this._iceParameters)}get dtlsParameters(){return Se(this._dtlsParameters)}constructor(e){v(this,"sessionDesc",void 0),v(this,"_localCapabilities",void 0),v(this,"_rtpCapabilities",void 0),v(this,"_candidates",void 0),v(this,"_iceParameters",void 0),v(this,"_dtlsParameters",void 0),v(this,"setup",void 0),v(this,"currentMidIndex",void 0),v(this,"cname",void 0),v(this,"firefoxSsrcMidMap",new Map),e=Se(e);const{iceParameters:n,dtlsParameters:r,candidates:i,rtpCapabilities:o,setup:s,localCapabilities:a,cname:c}=e;this._rtpCapabilities=o,this._candidates=i,this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=a,this.setup=s,this.cname=c,this.sessionDesc=this.updateRemoteRTPCapabilities(o),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(e){const n=this.candidates,r=this.dtlsParameters,i=this.iceParameters,o=this.rtpCapabilities.send;let s=this.sessionDesc.mediaDescriptions.length-1;for(let a=1;a<e;a++){const c=2*a+2e4,d=2*a+SD,{ssrcs:l,ssrcGroups:u}=Ca([{ssrcId:c}],this.cname),{ssrcs:h,ssrcGroups:p}=Ca([{ssrcId:d,rtx:A("USE_SUB_RTX")?d+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Nl,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.videoCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:n,extmaps:o.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:h,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:o.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++s)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Nl,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.audioCodecs.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:n,extmaps:o.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:o.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++s)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return $e.print(this.sessionDesc)}send(e,n,r,i){const{ssrcs:o,ssrcGroups:s}=Ca(n,this.cname,A("SYNC_GROUP")?r:void 0),a=this.findPreloadMediaDesc(o);if(a){if(ce()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,a.attributes.mid),i&&(i.twcc||i.remb)){const c=this.sessionDesc.mediaDescriptions.indexOf(a);return this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(a,i),{mid:a.attributes.mid,needExchangeSDP:!0}}return{mid:a.attributes.mid,needExchangeSDP:!1}}{const c=this.findAvailableMediaIndex(e,o);let d;return c===-1||c===1&&(an()||function(){const l=It();return!(l.name!==Pt.CHROME||!l.osVersion)&&Number(l.version)<=90}())||c===0&&A("USE_SUB_RTX")||HO()?(d=this.createOrRecycleSendMedia(e,o,s,"sendonly",i),this.updateBundleMids()):(d=Se(this.sessionDesc.mediaDescriptions[c]),d.attributes.direction="sendonly",d.attributes.ssrcs=o,d.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[c]=this.mungSendMediaDesc(d,i)),ce()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,d.attributes.mid),{mid:d.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:e,needExchangeSDP:n}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:e.attributes.mid,needExchangeSDP:n}}batchSend(e){const n=e.map(o=>{let{kind:s,ssrcMsg:a,mslabel:c}=o;return this.send(s,a,c)}),r=[];let i=!1;return n.forEach(o=>{let{mid:s,needExchangeSDP:a}=o;a&&(i=!0),r.push(s)}),{mids:r,needExchangeSDP:i}}stopSending(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(r=>{r.attributes.mid==="0"||ce()||HO()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(e){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(e){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e);if(!n)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>$(e).call(e,r.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>$(e).call(e,r.attributes.mid||""));if(n.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="recvonly"})}receive(e,n,r,i){e.forEach((o,s)=>{this.createOrRecycleRecvMedia(o,[],"recvonly",n,r,i[s])}),this.updateBundleMids()}stopReceiving(e){const n=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(n.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(e){const n=this.sessionDesc||$e.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=e;const r=this.rtpCapabilities.send,i=this.localCapabilities.send;for(const o of n.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,o.media.mediaType==="application"&&(o.attributes.sctpPort="5000"),o.media.mediaType==="video"){if(r.videoCodecs.length===0){const s=i.videoCodecs.filter(a=>{var c,d;return(c=a.rtpMap)===null||c===void 0?void 0:$(d=c.encodingName.toLowerCase()).call(d,"vp8")})||[i.videoCodecs[0]];o.media.fmts=s.map(a=>a.payloadType.toString(10)),o.attributes.payloads=s,o.attributes.extmaps=[]}else if(o.media.fmts=r.videoCodecs.map(s=>s.payloadType.toString(10)),o.attributes.payloads=r.videoCodecs,o.attributes.extmaps=r.videoExtensions,A("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:s,ssrcGroups:a}=Ca([{ssrcId:SD,rtx:A("USE_SUB_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=s,o.attributes.ssrcGroups=a}}if(o.media.mediaType==="audio"){if(r.audioCodecs.length===0){const s=i.audioCodecs.filter(a=>{var c,d;return(c=a.rtpMap)===null||c===void 0?void 0:$(d=c.encodingName.toLowerCase()).call(d,"opus")})||[i.audioCodecs[0]];o.media.fmts=s.map(a=>a.payloadType.toString(10)),o.attributes.payloads=s,o.attributes.extmaps=[]}else if(o.media.fmts=r.audioCodecs.map(s=>s.payloadType.toString(10)),o.attributes.payloads=r.audioCodecs,o.attributes.extmaps=r.audioExtensions,Fd(o),A("PRELOAD_MEDIA_COUNT")>0){const{ssrcs:s,ssrcGroups:a}=Ca([{ssrcId:2e4}],this.cname);o.attributes.ssrcs=s,o.attributes.ssrcGroups=a}}}return this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(e){const n=this._candidates.filter(r=>r.transport==="udp");if(e===sr.TCP){if(n.length===0)return;if(A("TCP_CANDIDATE_ONLY")){const r=this._candidates.filter(i=>i.transport==="tcp");n.forEach(i=>{r.findIndex(o=>o.connectionAddress===i.connectionAddress)===-1&&r.push(ps(ps({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),this._candidates=r}else{const r=[];n.forEach(i=>{r.push(ps(ps({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),this._candidates=[...n,...r]}}else if(e===sr.RELAY){if(n.length!==0)return;{const r=this._candidates.filter(i=>i.transport==="tcp");r.forEach(i=>{n.push(ps(ps({},i),{},{foundation:"udpcandidate",priority:Number(i.priority)+1+"",transport:"udp",port:Number(i.port)-90+""}))}),this._candidates=[...n,...r]}}else n.length===0?(this._candidates.filter(r=>r.transport==="tcp").forEach(r=>{n.push(ps(ps({},r),{},{foundation:"udpcandidate",priority:Number(r.priority)+1+"",transport:"udp",port:Number(r.port)-90+""}))}),this._candidates=n):this._candidates=this._candidates.filter(r=>r.transport!=="tcp");for(const r of this.sessionDesc.mediaDescriptions)r.attributes.candidates=this.candidates}restartICE(e){e=Se(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=e.iceUfrag,n.attributes.icePwd=e.icePwd})}predictReceivingMids(e){const n=[];for(let r=0;r<e;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}findAvailableMediaIndex(e,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(ce()){if(i){const o=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(o||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!o||o!==r.attributes.mid)}return!1}return i})}createOrRecycleDataChannel(){for(const r of this.sessionDesc.mediaDescriptions)if(r.media.mediaType==="application")return{mediaDesc:r,needExchangeSDP:!1};this.currentMidIndex+=1;const e="".concat(this.currentMidIndex),n={media:{mediaType:"application",port:Nl,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(e),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(n),{mediaDesc:n,needExchangeSDP:!0}}createOrRecycleRecvMedia(e,n,r,i,o,s){const a=e._mediaStreamTrack.kind,c=this.rtpCapabilities.recv,d=uu(a,c,this.localCapabilities.send,a===et.VIDEO?i:o),l=a===et.VIDEO?c.videoExtensions:c.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let h={media:{mediaType:a,port:Nl,protos:["UDP","TLS","RTP","SAVPF"],fmts:d.map(S=>S.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:d,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};h=this.mungRecvMediaDsec(h,e,s);const p=this.findFirstClosedMedia(a);if(p){const S=this.sessionDesc.mediaDescriptions.indexOf(p);this.sessionDesc.mediaDescriptions[S]=h}else this.sessionDesc.mediaDescriptions.push(h);return h}updateRemoteCodec(e,n,r){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(h=>h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").filter(h=>{var p;return $(p=Object.keys(G_)).call(p,h)}))],o=new Set(n);if(i.every(h=>o.has(h)))return m.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(n)),!1;const s=this._rtpCapabilities.recv.videoCodecs.filter(h=>n.some(p=>{var S;return $(S=h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||"").call(S,p)}));if(s.length===0)return m.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(n)),!1;const a=[...new Set(s.map(h=>h.rtpMap&&h.rtpMap.encodingName.toLowerCase()||""))];let c;if(m.debug("updateRemoteCodec, from ".concat(i," to ").concat(a)),e.length===0)c=this.sessionDesc.mediaDescriptions.filter(h=>h.media.mediaType==="video"&&h.attributes.direction==="recvonly");else if(c=this.sessionDesc.mediaDescriptions.filter(h=>h.attributes.mid&&$(e).call(e,h.attributes.mid)&&h.attributes.direction==="recvonly"),c.length!==e.length)return m.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(e,", codecs: ").concat(n)),!1;if(A("USE_PUB_RTX")||A("USE_SUB_RTX")){const h=TC(s,this.rtpCapabilities.recv.videoCodecs);s.push(...h)}this._rtpCapabilities.recv.videoCodecs=s;const d=this.localCapabilities.send,l=this.rtpCapabilities.recv,u=uu(et.VIDEO,l,d,r);return c.forEach(h=>{const p=u.map(S=>S.payloadType.toString(10));m.debug("updateRemoteCodec mid: ".concat(h.attributes.mid,", from ").concat(h.attributes.payloads," to ").concat(u)),h.attributes.payloads=u,h.media.fmts=p}),!0}createOrRecycleSendMedia(e,n,r,i,o){const s=this.rtpCapabilities.send,a=e===et.VIDEO?s.videoCodecs:s.audioCodecs,c=e===et.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;const d="".concat(this.currentMidIndex);let l={media:{mediaType:e,port:Nl,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.map(h=>h.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:c,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:a,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};l=this.mungSendMediaDesc(l,o);const u=this.findFirstClosedMedia(e);if(u){const h=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[h]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}mungRecvMediaDsec(e,n,r){const i=Se(e);return gC(i),Vd(i,n),SC(i,n),sF(i),Um(i,r,this.localCapabilities.send),i}mungSendMediaDesc(e,n){const r=Se(e);return Um(r,n,this.localCapabilities.recv),Fd(r),r}updateRecvMedia(e,n){const r=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===e);if(r!==-1){const i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=i}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(n=>ce()?n.media.port==="0"&&n.media.mediaType===e:n.media.port==="0")}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(n=>{var r;return((r=n.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}getSSRC(e){var n;return(n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===e))===null||n===void 0?void 0:n.attributes.ssrcs}}function TD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function xo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?TD(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let hu=function(t){return t.BANDWIDTH="bandwidth",t.CPU="cpu",t.NONE="none",t.OTHER="other",t}({});var yd=function(t){return t[t.DOWN=0]="DOWN",t[t.UP=1]="UP",t}(yd||{});const Fm=new Map;function vD(t,e,n,r){let{scale:i}=t;if(i===0&&r===yd.UP||i>=e.length-1&&r===yd.DOWN)return t;let o=xo(xo({},t),{},{scale:r===yd.DOWN?++i:--i});switch(n){case"maintain-framerate":o=xo(xo({},o),e[i].motion);break;case"maintain-resolution":o=xo(xo({},o),e[i].detail);break;case"balanced":o=xo(xo({},o),e[i].balanced)}return o}function RF(t,e){if(e){const n={overUse:0,underUse:0,adaptationList:CF(e)};Fm.set(t,n)}else Fm.delete(t)}function CF(t){const e=xo({},t),{bitrateMax:n,frameRate:r,scaleResolutionDownBy:i,bitrateMin:o}=e,{MIN_FRAME_RATE:s,MAX_THRESHOLD_FRAMERATE:a,MAX_SCALE:c,BITRATE_MIN_THRESHOLD:d,BITRATE_MAX_THRESHOLD:l,BWE_SCALE_UP_THRESHOLD:u,BWE_SCALE_DOWN_THRESHOLD:h,PERF_SCALE_DOWN_THRESHOLD:p,PERF_SCALE_UP_THRESHOLD:S,BALANCE_BITRATE_FACTOR:f,BALANCE_FRAMERATE_FACTOR:_,BALANCE_RESOLUTION_FACTOR:T,MOTION_RESOLUTION_FACTOR:g,MOTION_BITRATE_FACTOR:y,DETAIL_FRAMERATE_FACTOR:I,DETAIL_BITRATE_FACTOR:O}=aC,b=Math.min(e.frameRate,a),N=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(h,1)*n),bwe_up:n,fps_down:Math.round(Math.pow(p,1)*b),fps_up:r},balanced:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:r,bitrateMax:n,bitrateMin:o}}];for(let U=1;U<=c;U++){const V={bwe_up:Math.round(Math.pow(u,U)*n),bwe_down:Math.round(Math.pow(h,U+1)*n),fps_up:Math.round(Math.pow(S,U)*b),fps_down:Math.round(Math.pow(p,U+1)*b)},W={scaleResolutionDownBy:i/Math.pow(T,U),frameRate:Math.max(Math.round(Math.pow(_,U)*r),s),bitrateMax:Math.max(Math.round(Math.pow(f,U)*n),l),bitrateMin:Math.max(Math.round(Math.pow(f,U)*o),d)},lt={scaleResolutionDownBy:i/Math.pow(g,U),frameRate:r,bitrateMax:Math.max(Math.round(Math.pow(y,U)*n),l),bitrateMin:Math.max(Math.round(Math.pow(y,U)*o),d)},mt={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(I,U)*r),s),bitrateMax:Math.max(Math.round(Math.pow(O,U)*n),l),bitrateMin:Math.max(Math.round(Math.pow(O,U)*o),d)};N.push({scale:U,threshold:V,balanced:W,motion:lt,detail:mt})}return N}function wtt(t,e,n,r,i,o){const s=Fm.get(t)||{overUse:0,underUse:0,adaptationList:CF(i)},{adaptationList:a}=s;Fm.set(t,s);const{OVERUSE_TIMES_THRESHOLD:c,UNDERUSE_TIMES_THRESHOLD:d}=aC,{scale:l}=r;let u,h;return typeof e=="number"&&e>0&&function(p,S,f,_){if(S>=f.length)return!1;let{threshold:{fps_down:T}}=f[S];return A("FORCE_AG_HIGH_FRAMERATE")&&_==="maintain-framerate"&&(T=f[0].threshold.fps_down),p<T}(e,l,a,o)&&(s.overUse++,h=hu.CPU,s.overUse>c)||typeof n=="number"&&n>0&&function(p,S,f){if(S>=f.length)return!1;const{threshold:{bwe_down:_}}=f[S];return p<_}(n,l,a)&&(s.overUse++,h=hu.BANDWIDTH,s.overUse>c)?(s.overUse=0,s.underUse=0,u=vD(r,a,o,yd.DOWN),[u,h]):(typeof e=="number"&&e>0&&typeof n=="number"&&n>0&&function(p,S,f,_){if(S===0)return;let{threshold:{fps_up:T}}=f[S];return A("FORCE_AG_HIGH_FRAMERATE")&&_==="maintain-framerate"&&(T=f[1].threshold.fps_up),p>T}(e,l,a,o)&&function(p,S,f){if(S===0)return;const{threshold:{bwe_up:_}}=f[S];return p>_}(n,l,a)&&(s.underUse++,s.underUse>d&&(s.overUse=0,s.underUse=0,u=vD(r,a,o,yd.UP),u.scale===0&&(h=hu.NONE))),[u,h])}function yD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function AS(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?yD(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):yD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Att(t){var e;return!!A("ENABLE_AG_ADAPTATION")&&!!(t instanceof ry||$(e=t._hints).call(e,Ht.CUSTOM_TRACK))&&(!!A("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(n){const r=It();if(r.os!==Ve.IOS||!r.osVersion)return!1;const i=r.osVersion.split(".");return Number(i[0])>=n}(14)&&iV(17,4)||rV(14)&&oV(17,4)))}const jm=new Map;function jp(t,e){const n=jm.get(t);if(n){const{timer:r}=n;window.clearTimeout(r),jm.delete(t)}e.qualityLimitationReason=hu.NONE,RF(t)}var vt;function RD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function oo(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?RD(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):RD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}let ki=(vt=class zl extends vV{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,n;return(e=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(n=n.transport)===null||n===void 0?void 0:n.state)!==null&&e!==void 0?e:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(e=>e.rtpMap&&e.rtpMap.encodingName.toLowerCase()||"").filter(e=>{var n;return $(n=Object.keys(G_)).call(n,e)}))]}constructor(e,n){super(e,n),v(this,"store",void 0),v(this,"peerConnection",void 0),v(this,"id",zt(5,"connection-")),v(this,"remoteSDP",void 0),v(this,"initialOffer",void 0),v(this,"transportEventReceiver",void 0),v(this,"statsFilter",void 0),v(this,"extension",{useXR:A("USE_XR")}),v(this,"localCapabilities",void 0),v(this,"remoteCodecs",void 0),v(this,"localCandidateCount",0),v(this,"allCandidatesReceived",!1),v(this,"isPreallocation",!1),v(this,"preSSRCMap",new Map),v(this,"dataStreamChannelMap",new Map),v(this,"establishPromise",void 0),v(this,"recoveredDataChannelIds",[]),v(this,"currentDataChannelId",1),v(this,"mutex",new pn("P2PConnection-mutex")),v(this,"qualityLimitationReason",hu.NONE),this.store=n,this.peerConnection=new RTCPeerConnection(zl.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=IC(this.peerConnection,A("STATS_UPDATE_INTERVAL"),void 0,ce()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(e){const n=this.preSSRCMap.get(e);if(n!==void 0){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);if(r)return{transceiver:r,track:r.receiver.track,id:n}}}async updateRemoteRTPCapabilities(e,n){if(this.remoteCodecs=n,!this.remoteSDP)return void m.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(n));if(this.remoteSDP.updateRemoteCodec(e,n,this.store.codec)){const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r);const o=this.remoteSDP.toString();i==null||i(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}else m.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Ds(e.sdp),r=await cF({filterRTX:!A("USE_PUB_RTX")&&!A("USE_SUB_RTX"),filterVideoFec:A("FILTER_VIDEO_FEC"),filterAudioFec:A("FILTER_AUDIO_FEC"),filterVideoCodec:A("FILTER_VIDEO_CODEC")},this.extension);return this.localCapabilities=xm(r),this.initialOffer=e,oo(oo({},n),{},{rtpCapabilities:r,offerSDP:e.sdp})}catch(e){throw new M(R.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Itt(oo(oo({},e),{},{localCapabilities:this.localCapabilities})),e.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const n=this.remoteSDP.toString(),r=dF(this.initialOffer.sdp,this.extension),i=this.logSDPExchange(r||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),i==null||i(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n});const o=this.peerConnection.getTransceivers()[0];if(o!=null&&o.receiver&&this.tryBindTransportEvents(o.receiver),A("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(A("PRELOAD_MEDIA_COUNT"));const a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const c=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(c)}const{preSSRCs:s}=e;if(Array.isArray(s)&&s.length>0){const{mids:a}=this.remoteSDP.batchSend(s.map(c=>({kind:c.kind,ssrcMsg:[{ssrcId:c.ssrcId,rtx:c.rtx}],mslabel:c.mslabel})));a.forEach((c,d)=>{this.preSSRCMap.set(s[d].ssrcId,c)}),await Mp(this.peerConnection,this.remoteSDP,this.extension),m.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(n.toString()))}}async updateRemoteConnect(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");const{rtpCapabilities:n}=e;this.remoteSDP.updateRemoteRTPCapabilities(n),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const{preSSRCs:r}=e;if(Array.isArray(r)&&r.length>0){const{mids:i}=this.remoteSDP.batchSend(r.map(o=>Object.assign({},{kind:o.kind,ssrcMsg:[{ssrcId:o.ssrcId,rtx:o.rtx}],mslabel:o.mslabel})));i.forEach((o,s)=>{this.preSSRCMap.set(r[s].ssrcId,o)})}await Mp(this.peerConnection,this.remoteSDP,this.extension),m.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(n.toString()))}}send(e,n,r){var i=this;return Hr(function*(){const o=yield Ct(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=[];e.forEach(f=>{const _=i.peerConnection.addTransceiver(f._mediaStreamTrack,{direction:"sendonly"});s.push(_),f._updateRtpTransceiver(_)}),ce()&&A("SIMULCAST")===!0&&(yield Ct(i.applySimulcastForFirefox(s,e)));const a=yield Ct(i.peerConnection.createOffer()),c=i.remoteSDP.predictReceivingMids(e.length),d=i.mungSendOfferSDP(a.sdp,e,c),l=$e.parse(d),u=c.map(f=>{const _=l.mediaDescriptions.find(T=>T.attributes.mid===f);if(!_)throw new Error("Cannot extract ssrc from mediaDescription.");return iF(_,A("USE_PUB_RTX"))});let h;try{h=yield u}catch(f){h=[],i.remoteSDP.receive(e,n,r,h);const _=i.remoteSDP.toString();throw yield Ct(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield Ct(i.peerConnection.setRemoteDescription({type:"answer",sdp:_})),yield Ct(i.stopSending(c,!0)),f}i.remoteSDP.receive(e,n,r,h);const p=i.remoteSDP.toString(),S=i.logSDPExchange(d,"offer","local","send");return yield Ct(i.peerConnection.setLocalDescription({type:"offer",sdp:d})),yield Ct(i.applySimulcastEncodings(s,e)),yield Ct(i.applySendEncodings(s,e)),S==null||S(p),yield Ct(i.peerConnection.setRemoteDescription({type:"answer",sdp:p})),s.map((f,_)=>{const T=c[_];return{localSSRC:u[_],id:T,transceiver:f}})}catch(s){throw s instanceof M?s:new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(s.toString()))}finally{o()}})()}async createDataChannels(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let r=this.dataStreamChannelMap.get(e);if(r&&r.readyState==="open")m.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const o=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o!="number")throw new Error("create DataChannel error, because cannot get dc id");r=this.peerConnection.createDataChannel("datastream-channel",{id:o,negotiated:!0,ordered:!1,maxRetransmits:A("DATASTREAM_MAX_RETRANSMITS")}),r.binaryType="arraybuffer",this.dataStreamChannelMap.set(e,r)}n.forEach(o=>{o._updateOriginDataChannel(r)});const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const s=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(s),m.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else m.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(r){throw r instanceof M?r:new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(r.toString()))}}async stopDataChannels(e){try{const n=this.dataStreamChannelMap.get(e);return n&&(n.id&&this.recoveredDataChannelIds.push(n.id),n.close()),void this.dataStreamChannelMap.delete(e)}catch(n){throw n instanceof M?n:new M(R.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(n.toString()))}}async stopSending(e,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getTransceivers().filter(c=>e.indexOf(c.mid)!==-1);if(i.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(c=>{var d;jp(this.id+c.mid,this),c.direction="inactive",(d=c.stop)===null||d===void 0||d.call(c)});const o=await this.peerConnection.createOffer(),s=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(e);const a=this.remoteSDP.toString();s==null||s(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(i){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{r&&r()}}async receive(e,n,r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:o,needExchangeSDP:s}=this.remoteSDP.send(e,n,r,i);s&&(await Mp(this.peerConnection,this.remoteSDP,this.extension),m.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP.")));const a=this.peerConnection.getTransceivers().find(c=>c.mid===o);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:o,transceiver:a}}catch(o){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(e);return r&&(await Mp(this.peerConnection,this.remoteSDP,this.extension),m.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),n.map(i=>{const o=this.peerConnection.getTransceivers().find(s=>s.mid===i);if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:i,transceiver:o}})}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");e.forEach(o=>{Array.from(this.preSSRCMap.entries()).some(s=>{let[a,c]=s;if(c===o)return this.preSSRCMap.delete(a),!0})}),this.remoteSDP.stopSending(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();r==null||r(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(s=>{s.direction="inactive"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(e);const o=this.remoteSDP.toString();i==null||i(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(s=>s.mid&&e.indexOf(s.mid)!==-1);if(n.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(s,a)=>{s.direction="sendonly"});const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(e);const o=this.remoteSDP.toString();i==null||i(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new M(R.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(e){var n=this;return Hr(function*(){const r=yield Ct(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(wt().supportPCSetConfiguration){const d=n.peerConnection.getConfiguration(),l=e===sr.RELAY?"relay":"all";d.iceTransportPolicy!==l&&(m.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(d.iceTransportPolicy,"] to [").concat(l,"]")),d.iceTransportPolicy=l,n.peerConnection.setConfiguration(d))}else if(e===sr.RELAY)return;n.remoteSDP.updateCandidates(e);const i=yield Ct(n.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const o=Ds(i.sdp),{remoteIceParameters:s}=yield o.iceParameters;n.remoteSDP.restartICE(s);const a=n.remoteSDP.toString(),c=n.logSDPExchange(i.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield Ct(n.peerConnection.setLocalDescription(i)),c==null||c(a),yield Ct(n.peerConnection.setRemoteDescription({type:"answer",sdp:a}))}catch(i){m.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),i)}finally{r()}})()}close(){var e;this.peerConnection.getTransceivers().forEach(n=>{jp(this.id+n.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return oo(oo({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(r.sdp,[n],[e]);this.remoteSDP.updateRecvMedia(e,n);const o=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),s==null||s(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new M(R.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(e,n){const r=this.peerConnection.getTransceivers().filter(i=>i.mid===e);r.length===1&&(this.isVP8Simulcast(n)?ce()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(e,n){this.statsFilter.setVideoIsReady2(e,n)}async replaceTrack(e,n){const r=this.peerConnection.getTransceivers().find(i=>i.mid===n);r&&await r.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const n=e[0].transport.iceTransport,{local:r,remote:i}=n.getSelectedCandidatePair();return{local:oo(oo({},yo),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:oo(oo({},yo),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;(e=this.onICEConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;(e=this.onConnectionStateChange)===null||e===void 0||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,m.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,m.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},A("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&e.turnServer.mode!=="off"&&(F_(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...zl.turnServerConfigToIceServers(e.turnServer.servers)),A("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...zl.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),A("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),A("ENABLE_ENCODED_TRANSFORM")&&wt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const n=[];return e.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(od(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!A("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(e){const n=e.transport;if(n){this.transportEventReceiver=e,n.onstatechange=()=>{var i;n!=null&&n.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,n.state))},n.onerror=i=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in i?i.error:i)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const i=n==null?void 0:n.iceTransport.state;var o;i&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,i))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:i,remote:o}=r.getSelectedCandidatePair();m.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(e,n){var r,i;if(n||(n=this.peerConnection.getSenders().find(_=>_.track===e._mediaStreamTrack)),!n)return m.warn("[".concat(e.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(e))return m.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!wt().supportSetRtpSenderParameters)return m.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const o={},s={};switch(e._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;case"balanced":o.degradationPreference="balanced"}const a=function(f,_){return f.getTransceivers().find(T=>T.sender.track===_||T.receiver.track===_)}(this.peerConnection,e._mediaStreamTrack),c=YZ(e);if(Att(e)&&a&&n&&c&&this.getLocalVideoStats&&$(r=["vp8","vp9"]).call(r,this.store.codec)){var d;const f=o.degradationPreference||($(d=e._hints).call(d,Ht.CUSTOM_TRACK)?A("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(_,T,g,y,I,O){if(jp(_,g),I(T),y!=="balanced"&&y!=="maintain-framerate"&&y!=="maintain-resolution")return;let b=-1;RF(_,T);const N=window.setInterval(()=>{const V=jm.get(_);if(!A("ENABLE_AG_ADAPTATION")||!V)return jp(_,g),void I(T);const W=O();if(W.sendPackets>0&&W.OutgoingAvailableBandwidth>0){if(b===-1)return void(b=Date.now());if(Date.now()-b<1e3)return;const lt=W.sendFrameRate,mt=W.OutgoingAvailableBandwidth,[St,Yt]=wtt(_,lt,mt,V.adaptationConfig,T,y);Yt&&(g.qualityLimitationReason=Yt),St&&V.adaptationConfig.scale!==St.scale&&(m.debug("[".concat(_,"] applyAdaptation: ").concat(g.qualityLimitationReason,`
           sendFps `).concat(lt,", bwe ").concat(mt,", switch from ").concat(V.adaptationConfig.scale," to ").concat(St.scale," ")),V.adaptationConfig=AS(AS({},V.adaptationConfig),St),I(St))}},A("CHECK_LOCAL_STATS_INTERVAL")),U=AS({},T);jm.set(_,{timer:N,adaptationConfig:U,originConfig:T,adaptationFunc:I}),m.debug("[".concat(_,"] start adaptation, originConfig: ").concat(JSON.stringify(T),", degradationPreference: ").concat(y))})(this.id+a.mid,c,this,f,_=>{n&&this.updateAdaptation(n,_)},this.getLocalVideoStats.bind(this))}if(e._encoderConfig){var l;const{bitrateMax:f,frameRate:_,scaleResolutionDownBy:T}=e._encoderConfig;f&&(s.maxBitrate=1e3*f),($(l=e._hints).call(l,Ht.LOW_STREAM)||e.isUseScaleResolutionDownBy)&&(_&&(s.maxFramerate=ar(_)),T&&T>=1&&(s.scaleResolutionDownBy=T))}const{maxFramerate:u}=A("ENCODER_CONFIG_LIMIT");if(u&&typeof u=="number"&&(s.maxFramerate=s.maxFramerate?Math.min(s.maxFramerate,u):u),A("DSCP_TYPE")&&Xs()){var h;const f=A("DSCP_TYPE");$(h=["very-low","low","medium","high"]).call(h,f)&&(s.networkPriority=f)}const p=n.getParameters(),S=(i=p.encodings)===null||i===void 0?void 0:i[0];ce()&&!S&&(o.encodings=[s]),S&&Object.assign(S,s),Object.assign(p,o),m.debug("[".concat(e.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(p.encodings))),await n.setParameters(p),await async function(f,_,T){try{var g;if(!wt().supportSetRtpSenderParameters||!function(N){return N==="vp9"}(f)||!A("ENABLE_SVC"))return;const y={},I={},O=_.getParameters(),b=(g=O.encodings)===null||g===void 0?void 0:g[0];I.scalabilityMode=iy(T),b&&Object.assign(b,I),Object.assign(O,y),await _.setParameters(O),m.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(O.encodings)))}catch(y){m.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",y)}}(this.store.codec,n,A("SVC_MODE"))}async updateAdaptation(e,n){var r,i;if(!e)return m.debug("[updateAdaptation] no rtpSender found");if(!wt().supportSetRtpSenderParameters)return m.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const o={},{bitrateMax:s,frameRate:a,scaleResolutionDownBy:c}=n;s&&(o.maxBitrate=1e3*s),a&&(o.maxFramerate=ar(a)),c&&c>=1&&$(r=["vp8","vp9"]).call(r,this.store.codec)&&(o.scaleResolutionDownBy=c);const d=e.getParameters(),l=(i=d.encodings)===null||i===void 0?void 0:i[0];l&&Object.assign(l,o),Object.assign(d,{});try{await e.setParameters(d),m.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(d.encodings)))}catch(u){!("transport"in e)||e.transport&&e.transport.state==="connected"?this.peerConnectionState!=="connected"?m.debug("[updateAdaptation] peerConnection not connected}"):m.debug("[updateAdaptation] updateRtpSenderEncodings failed",u):m.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(e,n){try{if(!wt().supportSetRtpSenderParameters||e.length!==n.length)return;for(let r=0;r<e.length;r++){const i=e[r],o=n[r];o instanceof qt&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,i.sender)}}catch{m.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,n,r){const i=$e.parse(e);return n.forEach((o,s)=>{const a=r[s],c=i.mediaDescriptions.find(d=>d.attributes.mid===a);c&&(Vd(c,o),aF(c,o,this.store.codec))}),$e.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,n,r)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,e,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(e,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,e,n)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,n){if(e.length===n.length)for(let c=0;c<e.length;c++){var r,i,o,s,a;const d=e[c],l=n[c];if(l instanceof qt&&!$(r=l._hints).call(r,Ht.LOW_STREAM)&&(i=l._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=l._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(s=l._scalabilityMode)!==null&&s!==void 0&&s.numSpatialLayers&&((a=l._scalabilityMode)===null||a===void 0?void 0:a.numSpatialLayers)>1&&this.store.codec==="vp8"){const u={},h={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};u.encodings=[{rid:"m",active:!0,maxBitrate:h.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:h.high}];const p=d.sender.getParameters();await d.sender.setParameters(Object.assign(p,u))}}}async applySimulcastEncodings(e,n){if(!ce()&&e.length===n.length)for(let r=0;r<e.length;r++){const i=n[r];if(i instanceof qt&&this.isVP8Simulcast(i)){const o=e[r],s={},a={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};s.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:a.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:a.medium,scaleResolutionDownBy:4}];const c=o.sender.getParameters();await o.sender.setParameters(Object.assign(c,s))}}}isVP8Simulcast(e){var n,r,i,o,s;return!!(e instanceof qt&&A("SIMULCAST")&&this.store.codec==="vp8"&&!$(n=e._hints).call(n,Ht.LOW_STREAM)&&(r=e._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((i=e._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=e._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((s=e._scalabilityMode)===null||s===void 0?void 0:s.numSpatialLayers)>1)}logSDPExchange(e,n,r,i){if(A("SDP_LOGGING"))return m.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(i,`
`),e),n==="offer"?o=>{this.logSDPExchange(o,"answer",r==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(e);return n&&n.length!==0?n[0].ssrcId:void 0}setConfiguration(e){if(wt().supportPCSetConfiguration){const n=zl.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}},X(vt.prototype,"updateRemoteRTPCapabilities",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"updateRemoteRTPCapabilities"),vt.prototype),X(vt.prototype,"connect",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"connect"),vt.prototype),X(vt.prototype,"updateRemoteConnect",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"updateRemoteConnect"),vt.prototype),X(vt.prototype,"createDataChannels",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"createDataChannels"),vt.prototype),X(vt.prototype,"receive",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"receive"),vt.prototype),X(vt.prototype,"batchReceive",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"batchReceive"),vt.prototype),X(vt.prototype,"stopReceiving",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"stopReceiving"),vt.prototype),X(vt.prototype,"muteRemote",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"muteRemote"),vt.prototype),X(vt.prototype,"unmuteRemote",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"unmuteRemote"),vt.prototype),X(vt.prototype,"muteLocal",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"muteLocal"),vt.prototype),X(vt.prototype,"unmuteLocal",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"unmuteLocal"),vt.prototype),X(vt.prototype,"close",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"close"),vt.prototype),X(vt.prototype,"updateEncoderConfig",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"updateEncoderConfig"),vt.prototype),X(vt.prototype,"updateSendParameters",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"updateSendParameters"),vt.prototype),X(vt.prototype,"replaceTrack",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"replaceTrack"),vt.prototype),X(vt.prototype,"updateAdaptation",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"updateAdaptation"),vt.prototype),X(vt.prototype,"getRemoteSSRC",[Un],Object.getOwnPropertyDescriptor(vt.prototype,"getRemoteSSRC"),vt.prototype),vt);function Un(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,o=await i.lock("From P2PConnection.".concat(e));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return await r.apply(this,a)}finally{o()}},n}var ft;function CD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function so(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?CD(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):CD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ID(t){var e,n,r,i=2;for(typeof Symbol<"u"&&(n=tC,r=Symbol.iterator);i--;){if(n&&(e=t[n])!=null)return e.call(t);if(r&&(e=t[r])!=null)return new Uf(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function Uf(t){function e(n){if(Object(n)!==n)return Y.reject(new TypeError(n+" is not an object."));var r=n.done;return Y.resolve(n.value).then(function(i){return{value:i,done:r}})}return Uf=function(n){this.s=n,this.n=n.next},Uf.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?Y.resolve({value:n,done:!0}):e(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?Y.reject(n):e(r.apply(this.s,arguments))}},new Uf(t)}let Bp=(ft=class extends oe{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(ot.StateChange,e,this._state)}constructor(t,e){super(),v(this,"isPlanB",void 0),v(this,"store",void 0),v(this,"statsUploader",void 0),v(this,"connection",void 0),v(this,"localTrackMap",new Map),v(this,"remoteUserMap",new Map),v(this,"localDataChannels",[]),v(this,"remoteDataChannelMap",new Map),v(this,"pendingLocalTracks",[]),v(this,"pendingRemoteTracks",[]),v(this,"pendingLocalDataChannels",[]),v(this,"pendingRemoteDataChannels",[]),v(this,"statsCollector",void 0),v(this,"shouldForwardP2PCreation",void 0),v(this,"iceFailedCount",0),v(this,"dtlsFailedCount",0),v(this,"mutex",new pn("P2PChannel-mutex")),v(this,"_state",bt.Disconnected),v(this,"_pcStatsUploadType",A("NEW_ICE_RESTART")?bo.FIRST_CONNECTION:bo.OLD_FIRST_CONNECTION),v(this,"_isInRestartIce",!1),v(this,"_isStartRestartIce",!1),v(this,"_restartStates",["disconnected","failed"]),v(this,"_restartTimer",void 0),v(this,"_isFirstConnected",!0),v(this,"handleMuteLocalTrack",async(n,r,i)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==bt.Connected)return void i(new M(R.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const s=this.filterTobeMutedTracks(n);if(s.length===0)return void r();const a=s.find(d=>d[0]==="videoLowTrack");a&&a[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(s.map(d=>{let[,{id:l}]=d;return l}));const c=this.createMuteMessage(s);await Wt(this,ot.RequestMuteLocal,c),r()}catch(s){i(s)}finally{o()}}),v(this,"handleUnmuteLocalTrack",async(n,r,i)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==bt.Connected)return void i(new M(R.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const s=this.filterTobeUnmutedTracks(n);if(s.length===0)return void r();const a=s.find(d=>d[0]==="videoLowTrack");if(a){const d=a[1];if(d.track._originMediaStreamTrack.stop(),!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding){const l=n._mediaStreamTrack.clone();d.track._mediaStreamTrack=l,d.track._originMediaStreamTrack=l}else{const l=ay(n,qu(this,ot.RequestLowStreamParameter));d.track._mediaStreamTrack=l,d.track._originMediaStreamTrack=l}await new Y((l,u)=>{this.handleReplaceTrack(d.track,l,u,!0)})}await this.connection.unmuteLocal(s.map(d=>{let[,{id:l}]=d;return l}));const c=this.createUnmuteMessage(s);await Wt(this,ot.RequestUnmuteLocal,c),r()}catch(s){i(s)}finally{o()}}),v(this,"handleUpdateVideoEncoder",async(n,r,i)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const s=this.localTrackMap.get(B.LocalVideoTrack);if(!this.connection||!s||s.track!==n||this.state!==bt.Connected)return void r();const{id:a,track:c}=s;await this.connection.updateSendParameters(a,c),await this.connection.updateEncoderConfig(a,c),this.emit(ot.UpdateVideoEncoder,c),r()}catch(s){i(s)}finally{o()}}),v(this,"handleUpdateVideoSendParameters",async(n,r,i)=>{const o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const s=this.localTrackMap.get(B.LocalVideoTrack);if(!this.connection||!s||s.track!==n||this.state!==bt.Connected)return void r();const{id:a,track:c}=s;await this.connection.updateSendParameters(a,c),r()}catch(s){i(s)}finally{o()}}),v(this,"handleReplaceMixingTrack",async(n,r,i,o)=>{if(!this.connection||this.state!==bt.Connected)return void r();const s=wS([n]);let a;m.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(s.getTrackId(),"]")),typeof o=="boolean"&&o||(a=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(n,s),r()}catch(d){i(d)}finally{var c;(c=a)===null||c===void 0||c()}}),v(this,"handleReplaceTrack",async(n,r,i,o)=>{let s;m.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof o=="boolean"&&o||(s=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var a;const d=Array.from(this.localTrackMap.entries()).find(l=>{let[,{track:u}]=l;return n===u});if(!this.connection||!d||this.state!==bt.Connected)return void r();if(await((a=this.connection)===null||a===void 0?void 0:a.replaceTrack(n,d[1].id)),this.isPlanB){const l=d[1];l.id=n._mediaStreamTrack.id,this.localTrackMap.set(d[0],l)}if(d[0]===B.LocalVideoTrack&&!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding){const l=this.localTrackMap.get(B.LocalVideoLowTrack);if(l){const u=n._mediaStreamTrack.clone();l.track._originMediaStreamTrack.stop(),l.track._mediaStreamTrack=u,l.track._originMediaStreamTrack=u,await new Y((h,p)=>{this.handleReplaceTrack(l.track,h,p,!0)})}}r()}catch(d){i(d)}finally{var c;(c=s)===null||c===void 0||c()}}),v(this,"handleGetRTCStats",n=>{n(this.statsCollector.getRTCStats())}),v(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),v(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),v(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),v(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new vF(this.store),this.bindStatsUploaderEvents(),this.isPlanB=!wt().supportUnifiedPlan||A("CHROME_FORCE_PLAN_B")&&Xs(),this.shouldForwardP2PCreation=A("FORWARD_P2P_CREATION")&&wt().supportPCSetConfiguration&&rC(),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new bl({},this.store):new ki({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(t){var e;this.state=bt.New;const n=this.shouldForwardP2PCreation&&((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!n||(n&&this.connection&&(m.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.isPlanB?new bl(t,this.store):new ki(t,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new M(R.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=A("NEW_ICE_RESTART")?bo.FIRST_CONNECTION:bo.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t){if(!this.connection)throw new M(R.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");A("ENABLE_PREALLOC_PC")&&this.state===bt.Connected?await this.connection.updateRemoteConnect(t):(this.store.peerConnectionStart(),await this.connection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=bt.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter(i=>{var o;let[s]=i;return $(o=[B.LocalVideoLowTrack,B.LocalVideoTrack]).call(o,s)}),n=e.map(i=>{let[,{id:o}]=i;return o}),r=e.map(i=>{let[o]=i;return o});if(this.connection instanceof ki){if(tt.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(r),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(t)}),!$(t).call(t,this.store.codec)){const i=["vp9","vp8","h264"].find(o=>$(t).call(t,o));i&&(this.store.codec=i,m.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(n,t)}}async getEstablishParams(){var t;if(this.connection instanceof ki&&this.connection.peerConnectionState!=="closed"&&$(t=[bt.New,bt.Connected]).call(t,this.state))return this.connection.establishPromise}async publishDataChannel(t){if(!this.connection||this.state!==bt.Connected){if(this.state===bt.Disconnected)throw new M(R.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return t.forEach(n=>{var r;$(r=this.pendingLocalDataChannels).call(r,n)||this.pendingLocalDataChannels.push(n)}),[]}const e=this.filterTobePublishedDataChannels(t);return e.length===0?[]:(e.forEach(n=>{const r=Date.now();this.store.publish(n.id.toString(),"datachannel",r)}),await this.connection.createDataChannels(this.store.uid,e),e.forEach(n=>{this.localDataChannels.push(n);const r=Date.now();this.store.publish(n.id+"","datachannel",void 0,r)}),t.map(n=>({streamId:n.id,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:n.metadata,channelId:n._originDataChannelId})))}publish(t,e,n){var r=this;return Hr(function*(){const i=yield Ct(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==bt.Connected){if(r.state===bt.Disconnected)throw new M(R.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(t);const s=t.filter(a=>r.pendingLocalTracks.indexOf(a)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(s))}r.store.pubId=r.store.pubId+1,un.markPublishStart(r.store.clientId,r.store.pubId);const o=r.filterTobePublishedTracks(t,e,n);if(o.length===0)return void(yield Ct(r.tryToUnmuteAudio(t)));yield*Om(ID(r.doPublish(r.connection,o)))}finally{i()}})()}doPublish(t,e){var n=this;return Hr(function*(){e.forEach(u=>{let{track:h,type:p}=u;const S=Date.now();n.store.publish(h.getTrackId(),p===B.LocalAudioTrack?"audio":"video",S)}),n.bindLocalTrackEvents(e);const r=e.map(u=>{let{track:h}=u;return h}),i=yield Ct(t.send(r,n.store.codec,n.store.audioCodec)),o=(yield Ct(i.next())).value,s=n.createGatewayPublishMessage(e,o);let a;try{a=yield s}catch(u){throw i.throw(u),(u==null?void 0:u.code)===R.WS_ABORT&&e.forEach(h=>{let{track:p}=h;n.pendingLocalTracks.indexOf(p)===-1&&n.pendingLocalTracks.push(p)}),n.unbindLocalTrackEvents(e),u}const c=n.mapPubResToRemoteConfig(s,a,r),d=(yield Ct(i.next(c))).value,l=A("ENABLE_VIDEO_SEI");r.forEach(async u=>{const h=u.getRTCRtpTransceiver();h&&l&&(u.trackMediaType===et.VIDEO?await ZZ(h.sender,u):u.trackMediaType===et.AUDIO&&await async function(p){if(!wt().supportWebRTCEncodedTransform)return void m.warning("browser not support audio encoded transform");if(Dp.has(p)||!p.track)return;const S={track:p.track};if(Ws()){if(!p.createEncodedStreams)return void m.warning("browser not support createEncodedStreams() API");let _=null;try{_=p.createEncodedStreams()}catch(g){return void m.error("create audio-encoded-streams error",g&&g.message)}const T=new TransformStream({transform(g,y){S.controller||(S.controller=y),p.track&&p.track.id!==S.track.id&&(m.debug("audio track changed: ".concat(S.track.id," => ").concat(p.track.id)),S.track.removeEventListener("ended",f),S.track=p.track,S.track.addEventListener("ended",f)),y.enqueue(g)}});_.readable.pipeThrough(T).pipeTo(_.writable)}else if(an()){if(typeof RTCRtpScriptTransform>"u")return void m.warning("browser not support RTCRtpScriptTransform");const _=kf(),T=new MessageChannel;await new Y(y=>_.onmessage=I=>{I.data==="registered"&&y(void 0)});const g=new RTCRtpScriptTransform(_,{name:"tx",port:T.port2},[T.port2]);p.transform=g,await new Y(y=>_.onmessage=I=>{I.data==="started"&&y(void 0)}),T.port1.onmessage=y=>{var I;y.data.transformed&&p.track&&((I=p.track)===null||I===void 0?void 0:I.id)!==S.track.id&&(m.debug("audio track changed: ".concat(S.track.id," => ").concat(p.track.id)),S.track.removeEventListener("ended",f),S.track=p.track,S.track.addEventListener("ended",f))},S.worker=_}function f(){if(p.track){if(this.id!==p.track.id)return;p.track.removeEventListener("ended",f)}const _=Dp.get(p);if(_){Dp.delete(p);try{var T,g;(T=_.controller)===null||T===void 0||T.terminate(),(g=_.worker)===null||g===void 0||g.terminate()}catch(y){m.warning(y&&y.message)}}}Dp.set(p,S),p.track.addEventListener("ended",f)}(h.sender))}),e.forEach(u=>{let{type:h}=u;n.statsCollector.addLocalStats(h)}),n.assignLocalTracks(e,d),n.statsUploader.startUploadOutboundStats(),e.forEach(u=>{let{track:h,type:p}=u;const S=Date.now();n.store.publish(h.getTrackId(),p===B.LocalAudioTrack?"audio":"video",void 0,S)})})()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n)return;if(!(n.track instanceof qt))return m.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof ki||this.connection instanceof bl))return m.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:r}=n,i=function(o,s){const a={};return o.height&&o.width&&(a.scaleResolutionDownBy=Jv(o,s)),a.maxFramerate=o.framerate?ar(o.framerate):void 0,a.maxBitrate=o.bitrate?1e3*o.bitrate:void 0,a}(t,r);if(r._encoderConfig||(r._encoderConfig={}),e!==B.LocalVideoLowTrack||!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(r._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{const o=r._originMediaStreamTrack;if(!o.canvas)return m.warn("[".concat(r.getTrackId(),"] no canvas on track"));(function(s,a){const c=s.canvas;a.width&&(c.width=ar(a.width)),a.height&&(c.height=ar(a.height)),a.framerate&&(c.stopCapture&&c.stopCapture(),c.stopCapture=mC(()=>{!c.startCapture&&c.stopCapture&&c.stopCapture(),c.startCapture&&c.startCapture()},ar(a.framerate)))})(o,t)}i.maxBitrate!=null&&(r._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(r._encoderConfig.frameRate&&typeof r._encoderConfig.frameRate=="object"?r._encoderConfig.frameRate.max=i.maxFramerate:r._encoderConfig.frameRate={max:i.maxFramerate}),m.debug("[".concat(r.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(r._encoderConfig))),await this.connection.updateRtpSenderEncodings(r)}publishLowStream(t){var e=this;return Hr(function*(){if(!e.connection||e.state!==bt.Connected)return;const n=yield Ct(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=e.localTrackMap.get(B.LocalVideoTrack);if(!i)throw new M(R.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(B.LocalVideoLowTrack))throw new M(R.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const o=[{track:e.getLowVideoTrack(i.track,t),type:B.LocalVideoLowTrack}];if(yield*Om(ID(e.doPublish(e.connection,o))),i.track.muted||!i.track.enabled){var r;const s=(r=e.localTrackMap.get(B.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;s!==void 0&&(yield Ct(e.connection.muteLocal([s])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(m.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await cn(this,ot.RequestRePublish,this.pendingLocalTracks),this.emit(ot.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(m.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await cn(this,ot.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(t){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:n,kind:r}=this.pendingRemoteTracks[e];(r!==et.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==et.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(t)await cn(this,ot.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:n}of this.pendingRemoteTracks)await this.subscribe(e,n,n===et.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach(e=>{let{user:n}=e;this.emit(ot.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==bt.Connected)return void t.forEach(r=>{const i=this.pendingLocalTracks.indexOf(r);i!==-1&&this.pendingLocalTracks.splice(i,1)});const e=this.filterTobeUnpublishedTracks(t);if(e.length===0)return;const n=e.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==bt.Connected)return void t.forEach(n=>{const r=this.pendingLocalDataChannels.indexOf(n);r!==-1&&this.pendingLocalDataChannels.splice(r,1)});const e=this.filterTobeUnpublishedDataChannels(t);return e.length!==0?(e.forEach(n=>{const r=this.localDataChannels.indexOf(n);r!==-1&&this.localDataChannels.splice(r,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),e.map(n=>n.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==bt.Connected)return;const t=this.localTrackMap.get(B.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[B.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map(r=>{let[,{id:i}]=r;return i})),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map(r=>{let[i,{track:o}]=r;return{type:i,track:o}})),e.forEach(r=>{let[i]=r;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==bt.Connected)throw new M(R.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter(r=>{var i;return!((i=this.remoteDataChannelMap.get(t))!==null&&i!==void 0&&i.get(r.id))});if(n.length!==0)return await this.connection.createDataChannels(t.uid,n),n.forEach(r=>{var i;this.remoteDataChannelMap.has(t)?(i=this.remoteDataChannelMap.get(t))===null||i===void 0||i.set(r.id,r):this.remoteDataChannelMap.set(t,new Map([[r.id,r]]));const o=this.pendingRemoteDataChannels.findIndex(s=>{let{user:a,id:c}=s;return a.uid===t.uid&&c===r.id});o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),n.map(r=>r.id)}async subscribe(t,e,n,r,i){var o;if(!this.connection||this.state!==bt.Connected)throw new M(R.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o=this.remoteUserMap.get(t))!==null&&o!==void 0&&o.has(e))return;let s,a,c;const d=this.connection.getPreMedia(n);if(d)m.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(n,", no need to send sub to gateway.")),c=d.transceiver,s=d.track,a=d.id;else if(i){const h=i.find(S=>{let{stream_type:f}=S;return f===e});if(!h)throw new M(R.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const p=await this.connection.receive(e,h.ssrcs,String(t._uintid),h.attributes);this.connection instanceof ki&&(c=p.transceiver),s=p.track,a=p.id}else{const h=await this.connection.receive(e,[{ssrcId:n,rtx:r}],String(t._uintid),void 0);this.connection instanceof ki&&(c=h.transceiver),s=h.track,a=h.id}e===et.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new Td(s,t.uid,t._uintid,this.store),m.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),c&&t._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new Sd(s,t.uid,t._uintid,this.store),m.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),c&&t._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(t,t._videoTrack)),A("ENABLE_VIDEO_SEI")&&c&&(e==et.VIDEO?await async function(h){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wt().supportWebRTCEncodedTransform)return void m.warning("browser not support video encoded transform");if(!h.track)return;if(Ol.has(h)){const _=Ol.get(h);return void(_&&(_.onSei=p.onSei))}const S={track:h.track,onSei:p.onSei};if(Ws()){if(!h.createEncodedStreams)return void m.warning("browser not support createEncodedStreams() API");let _=null;try{_=h.createEncodedStreams()}catch(g){return void m.error("create video-encoded-streams error",g&&g.message)}const T=new TransformStream({transform(g,y){S.controller||(S.controller=y),h.track&&h.track.id!==S.track.id&&(m.debug("video track changed: ".concat(S.track.id," => ").concat(h.track.id)),S.track.removeEventListener("ended",f),S.track=h.track,S.track.addEventListener("ended",f));const I=function(O){const b=new DataView(O.data);let N=0;for(;N+4<O.data.byteLength;){if(b.getUint8(N+0)===0&&b.getUint8(N+1)===0&&b.getUint8(N+2)===0&&b.getUint8(N+3)===1&&b.getUint8(N+4)===6){let U=N+6,V=0,W=0;for(;(W=b.getUint8(U++))===255;)V+=255;V+=W;const lt=QZ(O.data,U,V);return new Uint8Array(lt)}N++}return null}(g);I&&S.onSei&&S.onSei(I),y.enqueue(g)}});_.readable.pipeThrough(T).pipeTo(_.writable)}else if(an()){if(typeof RTCRtpScriptTransform>"u")return void m.warning("browser not support RTCRtpScriptTransform");const _=kf(),T=new MessageChannel;await new Y(y=>_.onmessage=I=>{I.data==="registered"&&y(void 0)});const g=new RTCRtpScriptTransform(_,{name:"rx",port:T.port2},[T.port2]);h.transform=g,await new Y(y=>_.onmessage=I=>{I.data==="started"&&y(void 0)}),T.port1.onmessage=y=>{var I;y.data.transformed&&h.track&&((I=h.track)===null||I===void 0?void 0:I.id)!==S.track.id?(m.debug("video track changed: ".concat(S.track.id," => ").concat(h.track.id)),S.track.removeEventListener("ended",f),S.track=h.track,S.track.addEventListener("ended",f)):y.data.sei&&S.onSei&&S.onSei(y.data.sei)},S.worker=_}function f(){if(h.track){if(this.id!==h.track.id)return;h.track.removeEventListener("ended",f)}(function(_){const T=Ol.get(_);if(T){Ol.delete(_);try{var g,y;(g=T.controller)===null||g===void 0||g.terminate(),(y=T.worker)===null||y===void 0||y.terminate()}catch(I){m.warning(I&&I.message)}}})(h)}Ol.set(h,S),h.track.addEventListener("ended",f)}(c.receiver,{onSei:h=>{var p;(p=t._videoTrack)===null||p===void 0||p._onSei(h)}}):e==et.AUDIO&&await async function(h){if(!wt().supportWebRTCEncodedTransform)return void m.warning("browser not support audio encoded transform");if(kp.has(h))return;const p={track:h.track};if(Ws()){if(!h.createEncodedStreams)return void m.warning("browser not support createEncodedStreams() API");let f=null;try{f=h.createEncodedStreams()}catch(T){return void m.error("create audio-encoded-streams error",T&&T.message)}const _=new TransformStream({transform(T,g){p.controller||(p.controller=g),h.track&&h.track.id!==p.track.id&&(m.debug("audio track changed: ".concat(p.track.id," => ").concat(h.track.id)),p.track.removeEventListener("ended",S),p.track=h.track,p.track.addEventListener("ended",S)),g.enqueue(T)}});f.readable.pipeThrough(_).pipeTo(f.writable)}else if(an()){if(typeof RTCRtpScriptTransform>"u")return void m.warning("browser not support RTCRtpScriptTransform");const f=kf(),_=new MessageChannel;await new Y(g=>f.onmessage=y=>{y.data==="registered"&&g(void 0)});const T=new RTCRtpScriptTransform(f,{name:"rx",port:_.port2},[_.port2]);h.transform=T,await new Y(g=>f.onmessage=y=>{y.data==="started"&&g(void 0)}),_.port1.onmessage=g=>{var y;g.data.transformed&&h.track&&((y=h.track)===null||y===void 0?void 0:y.id)!==p.track.id&&(m.debug("audio track changed: ".concat(p.track.id," => ").concat(h.track.id)),p.track.removeEventListener("ended",S),p.track=h.track,p.track.addEventListener("ended",S))},p.worker=f}function S(){h.track.removeEventListener("ended",S),function(f){const _=kp.get(f);if(_){kp.delete(f);try{var T,g;(T=_.controller)===null||T===void 0||T.terminate(),(g=_.worker)===null||g===void 0||g.terminate()}catch(y){m.warning(y&&y.message)}}}(h)}kp.set(h,p),h.track.addEventListener("ended",S)}(c.receiver));const l=this.remoteUserMap.get(t);l?l.set(e,a):this.remoteUserMap.set(t,new Map([[e,a]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadInboundStats();const u=this.pendingRemoteTracks.findIndex(h=>{let{user:p,kind:S}=h;return p.uid===t.uid&&e===S});u!==-1&&(this.pendingRemoteTracks.splice(u,1),this.emit(ot.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==bt.Connected)throw new M(R.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter(i=>{var o;let{user:s,mediaType:a}=i;return!((o=this.remoteUserMap.get(s))!==null&&o!==void 0&&o.has(a))});const e=[],n=new Map;t.forEach(i=>{if(!this.connection)return;const o=this.connection.getPreMedia(i.ssrcId);o?n.set(i.ssrcId,o):e.push(i)});const r=await this.connection.batchReceive(e.map(i=>{let{user:o,mediaType:s,ssrcId:a,rtxSsrcId:c}=i;return{kind:s,ssrcMsg:[{ssrcId:a,rtx:c}],mslabel:String(o._uintid)}}));e.forEach((i,o)=>{n.set(i.ssrcId,r[o])}),t.forEach(i=>{let{user:o,mediaType:s,ssrcId:a}=i;const c=n.get(a);if(!c)return void m.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(o.uid," subscribe data,").concat(s,", ").concat(a));const{track:d,id:l,transceiver:u}=c;s===et.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(d):(o._audioTrack=new Td(d,o.uid,o._uintid,this.store),m.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),u&&o._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(d):(o._videoTrack=new Sd(d,o.uid,o._uintid,this.store),m.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),u&&o._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(o,o._videoTrack));const h=this.remoteUserMap.get(o);h?h.set(s,l):this.remoteUserMap.set(o,new Map([[s,l]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadInboundStats();const p=this.pendingRemoteTracks.findIndex(S=>{let{user:f,kind:_}=S;return f.uid===o.uid&&s===_});p!==-1&&(this.pendingRemoteTracks.splice(p,1),this.emit(ot.MediaReconnectEnd,o.uid))})}async unsubscribe(t,e,n){const r=this.pendingRemoteTracks.filter(s=>{let{user:a,kind:c}=s;return e!==void 0?a.uid===t.uid&&e===c:a.uid===t.uid});if(r.forEach(s=>{const a=this.pendingRemoteTracks.indexOf(s);this.pendingRemoteTracks.splice(a,1)}),this.connection&&this.state===bt.Connected||n||r.forEach(s=>{let{kind:a}=s;var c;if(a===et.AUDIO)(c=t._audioTrack)===null||c===void 0||c._destroy(),t._audioTrack=void 0;else if(a===et.VIDEO){var d;(d=t._videoTrack)===null||d===void 0||d._destroy(),t._videoTrack=void 0}}),!this.connection||this.state!==bt.Connected)return;const i=this.filterTobeUnSubscribedTracks(t,e);if(i.length===0)return;await this.connection.stopReceiving(i.map(s=>{let[,{id:a}]=s;return a}));const o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(s=>{let[a,{kind:c}]=s;var d,l;if(c===et.VIDEO&&a._videoSSRC&&((d=this.connection)===null||d===void 0||d.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),c===et.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),n||((l=a._videoTrack)===null||l===void 0||l._destroy(),a._videoTrack=void 0);else if(c===et.AUDIO){var u;this.unbindRemoteTrackEvents(a._audioTrack),!n&&((u=a._audioTrack)===null||u===void 0||u._destroy(),a._audioTrack=void 0)}}),o}async unsubscribeDataChannel(t,e){if(e.forEach(i=>{const o=this.pendingRemoteDataChannels.findIndex(s=>s.id===i.id);o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(n.length===0)return;e.forEach(i=>{i._close()});const r=this.remoteDataChannelMap.get(t);return n.forEach(i=>{r&&r.delete(i.id)}),r&&r.size===0&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map(i=>i.id)}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:i,mediaType:o}of t){const s=this.pendingRemoteTracks.filter(a=>{let{user:c,kind:d}=a;return o!==void 0?c.uid===i.uid&&o===d:c.uid===i.uid});s.forEach(a=>{const c=this.pendingRemoteTracks.indexOf(a);this.pendingRemoteTracks.splice(c,1)}),e=e.concat(s)}if(!this.connection||this.state!==bt.Connected)return void e.forEach(i=>{let{user:o,kind:s}=i;var a;if(s===et.AUDIO)(a=o._audioTrack)===null||a===void 0||a._destroy(),o._audioTrack=void 0;else if(s===et.VIDEO){var c;(c=o._videoTrack)===null||c===void 0||c._destroy(),o._videoTrack=void 0}});const n=zi(t).call(t,(i,o)=>{let{user:s,mediaType:a}=o;const c=this.filterTobeUnSubscribedTracks(s,a);return i.concat(c)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(i=>{let[,{id:o}]=i;return o}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),n.forEach(i=>{let[o,{kind:s}]=i;var a,c;if(s===et.VIDEO&&o._videoSSRC&&((a=this.connection)===null||a===void 0||a.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),s===et.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),(c=o._videoTrack)===null||c===void 0||c._destroy(),o._videoTrack=void 0;else if(s===et.AUDIO){var d;this.unbindRemoteTrackEvents(o._audioTrack),(d=o._audioTrack)===null||d===void 0||d._destroy(),o._audioTrack=void 0}}),r}isPreSubScribe(t){return!this.connection||this.state!==bt.Connected?!1:!!this.connection.getPreMedia(t)}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void m.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void m.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const r=e===et.VIDEO?t._videoSSRC:t._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void m.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."));n.get(e)||m.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."))}getAllTracks(t){const e=this.localTrackMap.get(B.LocalAudioTrack);if((e==null?void 0:e.track)instanceof be){const n=e.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[i]=r;return i!==B.LocalAudioTrack}).filter(r=>{let[i]=r;return!(t&&i===B.LocalVideoLowTrack)}).map(r=>{let[,{track:i}]=r;return i}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(t&&r===B.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,r,i){if(t){const s=this.localTrackMap.get(B.LocalAudioTrack),a=r?this.localTrackMap.get(B.LocalVideoLowTrack):this.localTrackMap.get(B.LocalVideoTrack);tt.publish(this.store.sessionId,{eventElapse:un.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:s==null?void 0:s.track.getTrackLabel(),videoName:a==null?void 0:a.track.getTrackLabel(),screenshare:(a==null?void 0:a.track._hints.indexOf(Ht.SCREEN_TRACK))!==-1,audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const s=n.find(c=>c instanceof se),a=r?(o=this.localTrackMap.get(B.LocalVideoTrack))===null||o===void 0?void 0:o.track:n.find(c=>c instanceof qt);tt.publish(this.store.sessionId,{eventElapse:un.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:s==null?void 0:s.getTrackLabel(),videoName:a==null?void 0:a.getTrackLabel(),screenshare:(a==null?void 0:a._hints.indexOf(Ht.SCREEN_TRACK))!==-1,audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(t,e,n,r){const i=r===et.VIDEO?n._videoSSRC:n._audioSSRC;i&&tt.subscribe(this.store.sessionId,{succ:t,ec:e,video:r===et.VIDEO,audio:r===et.AUDIO,peerid:n.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:un.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){m.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new pn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new bl({},this.store):new ki({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(B.LocalAudioTrack);if((t==null?void 0:t.track)instanceof be){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach(n=>{e.removeAudioTrack(n)})}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=bt.Disconnected}getStats(){var t;return(t=this.connection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return((e=this.connection)===null||e===void 0?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(B.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(B.LocalVideoTrack);if(t)return{width:t.track.videoWidth||0,height:t.track.videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof qt||e&&e.track instanceof se?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(_r(e=this.remoteUserMap).call(e)).find(r=>r.uid===t);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const e=this.localTrackMap.get(B.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Ph(t).call(t,(n,r)=>n.level-r.level),t}async disconnectForReconnect(){this.connection&&(m.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=bt.Reconnecting,A("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&((n=e._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.isPlanB?new bl({},this.store):new ki({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(t=>{var e;let[n,{track:r}]=t;switch(n){case B.LocalVideoTrack:$(e=r._hints).call(e,Ht.LOW_STREAM)?r.close():this.pendingLocalTracks.push(r);break;case B.LocalAudioTrack:r instanceof be?this.pendingLocalTracks=this.pendingLocalTracks.concat(r.trackList):this.pendingLocalTracks.push(r);case B.LocalVideoLowTrack:}}),this.emit(ot.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;Array.from(_r(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(e,r)}),this.emit(ot.MediaReconnectStart,e.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(t=>{this.pendingLocalDataChannels.push(t)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(t=>{let[e,n]=t;Array.from(_r(n).call(n)).forEach(r=>{this.setPendingRemoteDataChannel(e,r)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),m.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:r,id:i}=n;if((t instanceof Rs?t.uid:t)===r.uid&&i===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((t instanceof Rs?t.uid:t)===r.uid&&e===i)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return Hr(function*(){if(!e.connection||e.state!==bt.Connected)return;const n=yield Ct(e.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield Ct(e.connection.restartICE(t));const o=yield Ct(r.next());if(o.done)return;const s=o.value,a=yield s;switch(e.reportPCDisconnectedOrFailed(t),t){case sr.TCP:e._pcStatsUploadType=bo.TCP_RESTART;break;case sr.RELAY:e._pcStatsUploadType=bo.RELAY_RESTART;break;default:e._pcStatsUploadType=bo.OLD_RESTART}e._isInRestartIce=!0,r.next(a)}catch(o){var i;(i=r)===null||i===void 0||i.throw(o)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(B.LocalVideoTrack),n=this.localTrackMap.get(B.LocalAudioTrack),r=t.videoSend.find(p=>p.ssrc===(e==null?void 0:e.ssrcs[0].ssrcId)),i=t.audioSend.find(p=>p.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!r||!i)return 1;const o=Kr(this,ot.NeedSignalRTT),s=r?r.rttMs:void 0,a=i?i.rttMs:void 0,c=s&&a?(s+a)/2:s||a,d=(c&&o?(c+o)/2:c||o)||0,l=100*t.sendPacketLossRate*.7/50+.3*d/1500,u=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,h=e==null?void 0:e.track;if(h&&h._encoderConfig&&h._hints.indexOf(Ht.SCREEN_TRACK)===-1){const p=h._encoderConfig.bitrateMax,S=t.bitrate.actualEncoded;if(p&&S){const f=(1e3*p-S)/(1e3*p);return EV[f<.15?0:f<.3?1:f<.45?2:f<.6?3:4][u]}}return u}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,s=t.audioRecv.find(S=>S.ssrc===i),a=t.videoRecv.find(S=>S.ssrc===o);if(!s&&!a)return void(e+=1);const c=Kr(this,ot.NeedSignalRTT),d=t.rtt,l=(d&&c?(d+c)/2:d||c)||0,u=s?s.jitterMs:void 0,h=t.recvPacketLossRate;let p=.7*h*100/50+.3*l/1500;u&&(p=.6*h*100/50+.2*l/1500+.2*u/400),e+=p<.1?1:p<.17?2:p<.36?3:p<.59?4:5}),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new Y((e,n)=>{this.handleMuteLocalTrack(t,e,n)})}async replaceTrack(t,e){var n;if(m.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(t.getTrackId(),"] to [").concat(e.getTrackId(),"]")),!this.connection||this.state!==bt.Connected)return;const r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:s}]=o;return t===s});if(!r)return;const i=r[0];if(t!==e&&(this.unbindLocalTrackEvents([{track:t,type:i}]),this.bindLocalTrackEvents([{track:e,type:i}]),r[1].track=e),await((n=this.connection)===null||n===void 0?void 0:n.replaceTrack(e,r[1].id)),this.isPlanB){const o=r[1];o.id=e._mediaStreamTrack.id,this.localTrackMap.set(i,o)}if(i===B.LocalVideoTrack&&!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding){const o=this.localTrackMap.get(B.LocalVideoLowTrack);if(o){const s=t._mediaStreamTrack.clone();o.track._originMediaStreamTrack.stop(),o.track._mediaStreamTrack=s,o.track._originMediaStreamTrack=s,await new Y((a,c)=>{this.handleReplaceTrack(o.track,a,c,!0)})}}}filterTobePublishedTracks(t,e,n){const r=[],i=this.getAllTracks();t=rd(t=t.filter(c=>i.indexOf(c)===-1));let o,s=!1;const a=this.localTrackMap.get(B.LocalAudioTrack);for(const c of t){if(c instanceof qt&&(this.localTrackMap.has(B.LocalVideoTrack)||s?new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:c,type:B.LocalVideoTrack}),s=!0),e)){const d=this.getLowVideoTrack(c,n);r.push({track:d,type:B.LocalVideoLowTrack})}if(c instanceof se)if(a){const d=a.track;if(d instanceof be)cy([c]),d.addAudioTrack(c),this.bindLocalAudioTrackEvents(c,!0);else{const l=wS([d,c]);m.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l.getTrackId(),"]")),this.replaceTrack(d,l)}}else o instanceof be?(cy([c]),o.addAudioTrack(c)):o||!c._useAudioElement&&wt().webAudioMediaStreamDest&&!c._bypassWebAudio?o=wS(o?[c,o]:[c]):o=c}return o&&(m.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),r.push({track:o,type:B.LocalAudioTrack})),r}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=rd(t=t.filter(r=>n.indexOf(r)!==-1));for(const r of t){if(r instanceof se){const i=this.localTrackMap.get(B.LocalAudioTrack);if(!i)continue;i.track instanceof be?(i.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),i.track.trackList.length===0&&(e.push([B.LocalAudioTrack,i]),i.track.close())):e.push([B.LocalAudioTrack,i])}if(r instanceof qt){const i=this.localTrackMap.get(B.LocalVideoTrack);if(!i)continue;e.push([B.LocalVideoTrack,i]);const o=this.localTrackMap.get(B.LocalVideoLowTrack);o&&e.push([B.LocalVideoLowTrack,o])}}return e}filterTobePublishedDataChannels(t){return t=(t=rd(t)).filter(e=>this.localDataChannels.findIndex(n=>n.id===e.id)===-1)}filterTobeUnpublishedDataChannels(t){return t=(t=(t=rd(t)).filter(e=>this.localDataChannels.indexOf(e)!==-1)).filter(e=>e._originDataChannel)}bindLocalTrackEvents(t){t.forEach(e=>{let{track:n,type:r}=e;switch(r){case B.LocalVideoTrack:n.addListener(J.GET_STATS,this.handleGetLocalVideoStats),n.addListener(J.GET_RTC_STATS,this.handleGetRTCStats),n.addListener(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(J.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(J.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.addListener(J.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case B.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);case B.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(t,e){t instanceof be?t.trackList.forEach(n=>{n.addListener(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(J.GET_STATS,this.handleGetLocalAudioStats),n.addListener(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.addListener(J.GET_STATS,this.handleGetLocalAudioStats),t.addListener(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||(t.addListener(J.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(J.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map(e=>{let[n,{track:r}]=e;return{track:r,type:n}})),t.forEach(e=>{let{track:n,type:r}=e;switch(r){case B.LocalVideoTrack:n.off(J.GET_STATS,this.handleGetLocalVideoStats),n.off(J.GET_RTC_STATS,this.handleGetRTCStats),n.off(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(J.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(J.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),n.off(J.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case B.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);case B.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(t){t instanceof be?t.trackList.forEach(e=>{e.off(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(J.GET_STATS,this.handleGetLocalAudioStats),e.off(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(t.off(J.GET_STATS,this.handleGetLocalAudioStats),t.off(J.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(J.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(J.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(J.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),t.off(J.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(J.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof Sd&&e.addListener(J.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(t))}),e instanceof Td&&e.addListener(J.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(t))})}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(J.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(t=>{let[e,n]=t;n.has(et.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(et.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)})}createGatewayPublishMessage(t,e){return t.map((n,r)=>{var i;let o,s,{track:a,type:c}=n;switch(c){case B.LocalAudioTrack:o=Nt.Audio,s={dtx:a instanceof Mm&&a._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case B.LocalVideoTrack:o=$(i=a._hints).call(i,Ht.SCREEN_TRACK)?Nt.Screen:Nt.High,s=so(so({},Tb(a)),{},{codec:this.store.codec,svc_mode:iy()});break;case B.LocalVideoLowTrack:o=Nt.Low,s=so(so({},Tb(a)),{},{codec:this.store.codec,svc_mode:iy()})}return{stream_type:o,attributes:s,ssrcs:e[r]}})}createGatewayUnpublishMessage(t){return t.map(e=>{var n;let r,[i,{track:o,ssrcs:s,id:a}]=e;switch(i){case B.LocalVideoTrack:r=$(n=o._hints).call(n,Ht.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case B.LocalAudioTrack:r=Nt.Audio;break;case B.LocalVideoLowTrack:r=Nt.Low}return{stream_type:r,ssrcs:s,mid:a}})}assignLocalTracks(t,e){t.forEach((n,r)=>{let{track:i,type:o}=n;this.localTrackMap.set(o,{track:i,id:e[r].id,ssrcs:e[r].localSSRC})})}withdrawLocalTracks(t){t.forEach(e=>{let[n]=e;this.localTrackMap.delete(n)})}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(ot.PeerConnectionStateChange,e),e!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),e==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),A("NEW_ICE_RESTART")){var n;if($(n=this._restartStates).call(n,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const r=s=>{(t.iceConnectionState==="disconnected"||t.iceConnectionState==="checking"||t.iceConnectionState==="failed")&&(m.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(s)),Kr(this,ot.QueryClientConnectionState)==="CONNECTED"&&this.emit(ot.RequestRestartICE,s))},i=()=>{t.iceConnectionState!=="disconnected"&&t.iceConnectionState!=="checking"&&t.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),m.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(ot.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},o=A("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(A("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&wt().supportPCSetConfiguration)r(sr.RELAY),this._restartTimer=window.setTimeout(i,o);else if(ce())r(sr.UDP),this._restartTimer=window.setTimeout(i,4e3);else{if(r(sr.TCP),wt().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{r(sr.RELAY),this._restartTimer=window.setTimeout(i,o)},o));this._restartTimer=window.setTimeout(i,o)}},800))}}else{if(e==="disconnected"&&t.iceConnectionState==="disconnected")return setTimeout(()=>{t.iceConnectionState==="disconnected"&&A("ICE_RESTART")&&Kr(this,ot.QueryClientConnectionState)==="CONNECTED"&&this.emit(ot.RequestRestartICE)},800),void setTimeout(()=>{t.peerConnectionState==="disconnected"&&(m.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(ot.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);e==="failed"&&(m.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(ot.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=e=>{e!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),tt.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:ae.TRACER}).onSuccess(),this.emit(ot.IceConnectionStateChange,e)},t.onICETransportStateChange=e=>{m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},t.onDTLSTransportStateChange=e=>{m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},t.onDTLSTransportError=e=>{m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},t.onFirstAudioDecoded=e=>{var n;const r=Array.from(_r(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===e);var i;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(i=r.audioTrack)===null||i===void 0||i.emit(gd.FIRST_FRAME_DECODED),tt.firstRemoteFrame(this.store.sessionId,He.FIRST_AUDIO_DECODE,re.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:un.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=e=>{var n;const r=Array.from(_r(n=this.remoteUserMap).call(n)).find(i=>i._audioSSRC===e);r&&tt.firstRemoteFrame(this.store.sessionId,He.FIRST_AUDIO_RECEIVED,re.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:un.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(e,n,r)=>{this.reportVideoFirstFrameDecoded(e,n,r)},t.onFirstVideoReceived=e=>{var n;const r=Array.from(_r(n=this.remoteUserMap).call(n)).find(i=>i._videoSSRC===e);r&&tt.firstRemoteFrame(this.store.sessionId,He.FIRST_VIDEO_RECEIVED,re.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:un.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(e,n)=>{const r=e.candidateType==="relay",i=n.candidateType==="relay";n.candidateType!=="unknown"&&r===i||this.emit(ot.ConnectionTypeChange,r),m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Ps(n))," -> ").concat(JSON.stringify(Ps(e)),")"))},t.onSelectedRemoteCandidateChanged=(e,n)=>{m.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Ps(n))," -> ").concat(JSON.stringify(Ps(e)),")"))},t.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)},t.getLocalVideoStats=()=>{const e=this.statsCollector.getLocalVideoTrackStats(),n=this.statsCollector.getRTCStats();return so(so({},e),n)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}filterTobeMutedTracks(t){const e=[];if(this.getAllTracks().indexOf(t)===-1)return e;const n=this.localTrackMap.get(B.LocalAudioTrack);if(t instanceof se&&(n==null?void 0:n.track)instanceof be)return n.track.isActive||e.push([B.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return t===o});if(r&&(e.push(r),r[0]===B.LocalVideoTrack)){const i=this.localTrackMap.get(B.LocalVideoLowTrack);i&&e.push([B.LocalVideoLowTrack,i])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(B.LocalAudioTrack);if(t instanceof se&&(n==null?void 0:n.track)instanceof be)return n.track.isActive&&e.push([B.LocalAudioTrack,n]),e;const r=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return t===o});if(r)if(r[0]===B.LocalVideoTrack){e.push(r);const i=this.localTrackMap.get(B.LocalVideoLowTrack);i&&e.push([B.LocalVideoLowTrack,i])}else e.push(r);return e}createMuteMessage(t){return t.map(e=>{var n;let r,[i,{track:o,ssrcs:s,id:a}]=e;switch(i){case B.LocalAudioTrack:r=Nt.Audio;break;case B.LocalVideoTrack:r=$(n=o._hints).call(n,Ht.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case B.LocalVideoLowTrack:r=Nt.Low}return{stream_type:r,ssrcs:s,mid:a}})}createUnmuteMessage(t){return t.map(e=>{var n;let r,[i,{track:o,ssrcs:s,id:a}]=e;switch(i){case B.LocalAudioTrack:r=Nt.Audio;break;case B.LocalVideoTrack:r=$(n=o._hints).call(n,Ht.SCREEN_TRACK)?Nt.Screen:Nt.High;break;case B.LocalVideoLowTrack:r=Nt.Low}return{stream_type:r,ssrcs:s,mid:a}})}filterTobeUnSubscribedTracks(t,e){const n=[],r=this.remoteUserMap.get(t);if(!r)return n;if(e){const i=r.get(e);if(!i)return n;n.push([t,{kind:e,id:i}])}else Array.from(r.entries()).forEach(i=>{let[o,s]=i;n.push([t,{kind:o,id:s}])});return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach(r=>{var i;(i=this.remoteDataChannelMap.get(t))!==null&&i!==void 0&&i.has(r.id)&&n.push(r)}),n}createUnsubscribeMessage(t){const e=[];return t.forEach(n=>{let[r,{kind:i,id:o}]=n;switch(i){case et.VIDEO:return void(r._videoSSRC&&e.push({stream_type:et.VIDEO,ssrcId:r._videoSSRC}));case et.AUDIO:return void(r._audioSSRC&&e.push({stream_type:et.AUDIO,ssrcId:r._audioSSRC}))}}),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach(n=>{let[r,{kind:i}]=n;if(e.has(r)){let o=e.get(r);i===et.VIDEO?o|=xe.Video:o|=xe.Audio,e.set(r,o)}else i===et.VIDEO?e.set(r,xe.Video):e.set(r,xe.Audio)}),{users:Array.from(e.entries()).map(n=>{let[r,i]=n;return{stream_id:r.uid,stream_type:i}})}}withdrawRemoteTracks(t){t.forEach(e=>{let[n,{kind:r}]=e;const i=this.remoteUserMap.get(n);i&&(i.delete(r),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(t){const e=this.localTrackMap.get(B.LocalVideoTrack),n=this.localTrackMap.get(B.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),n&&t.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(t,e,n){return t.map((r,i)=>{var o;let{stream_type:s}=r;const a=(o=e.find(c=>{let{stream_type:d}=c;return s===d}))===null||o===void 0?void 0:o.attributes;if(a&&A("DISABLE_SCREEN_SHARE_REMB")){const c=n[i]._hints;($(c).call(c,Ht.SCREEN_TRACK)||$(c).call(c,Ht.SCREEN_LOW_TRACK))&&(a.remb=!1,m.debug("disable remb for screen share, hints:",c))}return a})}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof se){var e;const r=this.filterTobeUnmutedTracks(t[n]);if(r.length===0)continue;await((e=this.connection)===null||e===void 0?void 0:e.unmuteLocal(r.map(o=>{let[,{id:s}]=o;return s})));const i=this.createUnmuteMessage(r);return void await Wt(this,ot.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!((e=this.connection)===null||e===void 0||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(ot.RequestUpload,t,e),this.statsUploader.requestUploadStats=t=>this.emit(ot.RequestUploadStats,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Je(oC(this.dtlsFailedCount,we)),this.emit(ot.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await cn(this,ot.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(ot.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(B.LocalVideoTrack)||this.pendingLocalTracks.some(t=>t instanceof qt)}throwIfTrackTypeNotMatch(t){if(t.filter(e=>e instanceof qt).length>1)throw new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter(e=>e instanceof se).length>1&&(t.some(e=>e instanceof se&&e._bypassWebAudio)||!wt().webAudioMediaStreamDest))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof qt&&this.pendingLocalTracks.some(n=>n instanceof qt))throw new M(R.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof se&&this.pendingLocalTracks.some(n=>n instanceof se)&&(!wt().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof se&&n._bypassWebAudio)))throw new M(R.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){var n;const r=!A("DISABLE_DUAL_STREAM_USE_ENCODING")&&wt().supportDualStreamEncoding,i=so(so({},{width:160,height:120,framerate:15,bitrate:50}),e);let o;o=r?t._mediaStreamTrack.clone():ay(t,i);const s=zt(8,"track-low-"),a=new qt(o,so(so({},r&&{scaleResolutionDownBy:Jv(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,s);return a.on(Ha.TRANSCEIVER_UPDATED,c=>{t._updateRtpTransceiver(c,xd.LOW_STREAM)}),a._hints.push(Ht.LOW_STREAM),$(n=t._hints).call(n,Ht.SCREEN_TRACK)&&a._hints.push(Ht.SCREEN_LOW_TRACK),t.on("sei-to-send",c=>{a.emit("sei-to-send",c)}),t.addListener(J.NEED_CLOSE,()=>{a.close()}),a}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof ki){var i,o,s,a;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:d,dtlsTransportState:l,peerConnectionState:u}=this.connection,{local:h,remote:p}=await this.connection.getSelectedCandidatePair();tt.pcStats(this.store.sessionId,{startTime:c,eventElapse:t-c||0,iceconnectionsate:d,dtlsstate:l,connectionstate:u,intSucc:e?1:2,error:r,selectedLocalCandidateProtocol:(i=h==null?void 0:h.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(o=h.candidateType)!==null&&o!==void 0?o:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:(s=p.protocol)!==null&&s!==void 0?s:"",selectedRemoteCandidateType:(a=p.candidateType)!==null&&a!==void 0?a:"",selectedRemoteCandidateAddress:"".concat(p.address,":").concat(p.port),restartCnt:n,preallocation:this.connection.isPreallocation})}}reportVideoFirstFrameDecoded(t,e,n,r){var i;const o=Array.from(_r(i=this.remoteUserMap).call(i)).find(s=>s._videoSSRC===t);if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const s=this.store.keyMetrics,a=s.subscribe.find(c=>c.userId===o.uid&&c.type==="video");tt.firstRemoteVideoDecode(this.store.sessionId,He.FIRST_VIDEO_DECODE,re.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:e,videoheight:n,subscribeElapse:un.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:s.requestAPEnd||0,apStart:s.requestAPStart||0,joinGwEnd:s.joinGatewayEnd||0,joinGwStart:s.joinGatewayStart||0,pcEnd:s.peerConnectionEnd||0,pcStart:s.peerConnectionStart||0,subscriberEnd:(a==null?void 0:a.subscribeEnd)||0,subscriberStart:(a==null?void 0:a.subscribeStart)||0,videoAddNotify:(a==null?void 0:a.streamAdded)||0,state:r?1:0,firstFrame:(a==null?void 0:a.firstFrame)||0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(t);if(!r)return!1;const i=r.get(e);if(!i)return!1;const o=await this.connection.getRemoteSSRC(i);return o!==void 0&&o!==n}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(t=>{let[e,{track:n}]=t;e===B.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,xd.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(t){this.connection&&this.connection instanceof ki&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===bo.TCP_RESTART&&t===sr.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,bo.DISCONNECTED_OR_FAILED)))}},X(ft.prototype,"startP2PConnection",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"startP2PConnection"),ft.prototype),X(ft.prototype,"connect",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"connect"),ft.prototype),X(ft.prototype,"updateRemoteRTPCapabilities",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"updateRemoteRTPCapabilities"),ft.prototype),X(ft.prototype,"publishDataChannel",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"publishDataChannel"),ft.prototype),X(ft.prototype,"unpublish",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"unpublish"),ft.prototype),X(ft.prototype,"unpublishDataChannel",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"unpublishDataChannel"),ft.prototype),X(ft.prototype,"unpublishLowStream",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"unpublishLowStream"),ft.prototype),X(ft.prototype,"subscribeDataChannel",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"subscribeDataChannel"),ft.prototype),X(ft.prototype,"subscribe",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"subscribe"),ft.prototype),X(ft.prototype,"massSubscribe",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"massSubscribe"),ft.prototype),X(ft.prototype,"unsubscribe",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"unsubscribe"),ft.prototype),X(ft.prototype,"unsubscribeDataChannel",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"unsubscribeDataChannel"),ft.prototype),X(ft.prototype,"massUnsubscribe",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"massUnsubscribe"),ft.prototype),X(ft.prototype,"muteRemote",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"muteRemote"),ft.prototype),X(ft.prototype,"unmuteRemote",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"unmuteRemote"),ft.prototype),X(ft.prototype,"hasRemoteMediaWithLock",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"hasRemoteMediaWithLock"),ft.prototype),X(ft.prototype,"disconnectForReconnect",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"disconnectForReconnect"),ft.prototype),X(ft.prototype,"updateBitrateLimit",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"updateBitrateLimit"),ft.prototype),X(ft.prototype,"remoteMediaSsrcChanged",[Tn],Object.getOwnPropertyDescriptor(ft.prototype,"remoteMediaSsrcChanged"),ft.prototype),ft);function Tn(t,e,n){const r=t[e];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const i=this.mutex,o=await i.lock("From P2PChannel.".concat(e));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return await r.apply(this,a)}finally{o()}},n}const IF={};function Pl(t){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&m.debug("install service ".concat(t.name)),IF[t.name]=t}function Yl(t){const e=IF[t];if(!e)throw new M(R.INVALID_OPERATION,"".concat(t," not found, please use AgoraRTC.use(").concat(t,"Service) to load it first"));return e}function wD(t,e){return Yl("DataStream").create(t,e)}function AD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function OD(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?AD(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):AD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Ott=Date.now(),btt=20,dy=new Map,xf=new Map;async function wF(t){const e=dy.get(t),n=Array.isArray(e)&&e[e.length-1],r=xf.get(t);if(!n)return void(r.isSyncing=!1);const i={uid:n.uid,payload:n.payload};r.firstRecvTs===0&&(r.firstRecvTs=n.recvTs,r.firstSendTs=n.sendTs);const o=n.sendTs-r.firstSendTs,s=o-(Date.now()-r.firstRecvTs);s>0&&(r.firstRecvTs=Date.now()-o);let a=n.mediaDelay+s;a<=0?(e.pop(),AF(n.context,i),a=0):a=Math.min(a,btt),setTimeout(()=>e.length&&wF(t),a)}function AF(t,e){t.safeEmit(gt.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function Ntt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return AF(n,{uid:t.uid,payload:t.payload});const r="".concat(n.id,"-").concat(t.uid),i=dy.get(r)||[],o=i.findIndex(d=>t.sendTs>=d.sendTs),s=OD(OD({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});o===-1?i.push(s):i.splice(o,0,s),dy.set(r,i);let a=!1;var c;xf.has(r)?a=!((c=xf.get(r))===null||c===void 0||!c.isSyncing):xf.set(r,{isSyncing:a,firstRecvTs:0,firstSendTs:0}),a||wF(r)}const Ptt=It().name;function bD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ND(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?bD(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bD(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const Rd="websdk_ng_cache_parameter",Dtt=A("MAX_PRELOAD_ASYNC_LENGTH"),ktt=1e4,Ia=new Map,wa=[];let OS=null,bS=0,NS=0;const Gp=new Map,Ltt=function(t,e){const n=[];let r=0;const i=async()=>{const o=n.shift();o&&await o(),n.length>0&&r<e?i():r--};return async function(){for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return new Y(async(c,d)=>{n.push(async()=>{try{const l=await t(...s);c(l)}catch(l){d(l)}}),r<e&&(r++,i())})}}(OF,Dtt),PS=Gn.CancelToken.source();async function OF(t,e,n,r,i,o){try{if(!A("ENABLE_PRELOAD"))return;if(!wt().supportWebCrypto)return void Qs(()=>{m.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!n&&n!==null)throw new M(R.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Ke(n,"token",1,2047),Ke(t,"appid",1,2047),W_(e),r&&H_(r);const s=id();m.debug("preload channel ".concat(e,", uid is ").concat(r));const a={appId:t,cname:e,token:n||t,uid:typeof r!="string"?r:null,sid:s,proxyServer:i};let c,d;typeof r=="string"?(a.stringUid=r,[d,c]=await Y.all([stt(r,{sid:s,appId:t},PS.token),UP(ND(ND({},a),{},{token:n||t,uid:0}),PS.token)]),a.uid=d.uid,c.gatewayInfo.uid=a.uid,c.gatewayInfo.res.uid=a.uid):(o&&(a.stringUid=o),c=await UP(a,PS.token));const l={sid:s,appId:t,cname:e,token:n||t,uid:a.stringUid||r,intUid:a.uid||c.gatewayInfo.uid,stringUid:a.stringUid,ts:Date.now(),sua:d,ap:c};await async function(u){let h;try{u.uid&&bF({appId:u.appId,cname:u.cname,token:u.token,uid:u.uid,stringUid:u.stringUid});const p=DF(u),S=await async function(_,T){try{const g=await window.crypto.subtle.importKey("raw",hV(T),"AES-GCM",!1,["encrypt"]),y=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},g,La(window.btoa(JSON.stringify(_))));return Hs(new Uint8Array(y))}catch{return}}(u,u.token||u.appId);if(!S)return;h=PF(Rd);const f=h?JSON.parse(h):[];f.push({[p]:S}),f.length>A("AP_CACHE_NUM")&&f.shift(),Bm(Rd,JSON.stringify(f))}catch(p){m.warn("Error caching server parameters:",p.message),Bm(Rd,"")}}(l),bS++}catch(s){throw NS++,function(a){OS||(OS=window.setTimeout(()=>{let d="";Gp.forEach((l,u)=>{d+="".concat(u,": ").concat(l," ;")}),tt.reportApiInvoke(null,{name:Ne.PRELOAD,options:{success:bS,failed:NS,err:d}}).onError(a),bS=0,NS=0,Gp.clear(),OS=null},ktt));const c=Gp.get(a.code)||0;Gp.set(a.code,c+1)}(s),s}}async function PD(t){try{if(A("AP_REQUEST_DETAIL"))return;const e=bF(t);if(!e||t.cloudProxyServer!=="disabled")return;const n=await async function(r,i){try{const o=await window.crypto.subtle.importKey("raw",hV(i),"AES-GCM",!1,["decrypt"]),s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o,La(r));return JSON.parse(window.atob(Hs(new Uint8Array(s))))}catch{return}}(e,t.token||t.appId);if(!n||!function(r,i){return r.cname===i.cname&&r.appId===i.appId&&r.token===i.token?i.stringUid?r.stringUid===i.stringUid:typeof i.uid=="number"?r.uid===i.uid:r.uid==i.uid:!1}(n,t))return;if(n&&Date.now()-n.ts<A("AP_CACHE_LIFETIME"))return n}catch(e){m.warn("Error get preloadInfo",e.message)}}function bF(t){let e;try{if(e=PF(Rd),!e)return;const n=JSON.parse(e),r=DF(t),i=function(s,a){for(let c=s.length-1;c>=0;c--)if(a(s[c]))return c;return-1}(n,s=>r in s);if(i===-1)return;const o=n.splice(i,1)[0];return Bm(Rd,JSON.stringify(n)),o[r]}catch(n){m.warn("Error delete preload info: ".concat(e),n.message),Bm(Rd,"")}}function wC(t){if(t){let e=Ia.get(t);e&&(window.clearTimeout(e),e=null,Ia.delete(t)),$(wa).call(wa,t)||t.cloudProxyServer!=="disabled"||wa.push(t)}if(Ia.size<A("AP_CACHE_NUM")&&wa.length>0){const e=wa.shift();Ia.set(e,window.setTimeout(async()=>{const{appId:n,cname:r,token:i,stringUid:o,uid:s,proxyServer:a}=e;try{await Ltt(n,r,i,s,a,o),Ia.has(e)&&wC(e)}catch(c){m.warn("update preload failed",c.message),NF(e)}},A("AP_UPDATE_INTERVAL")))}}function NF(t){const e=wa.indexOf(t);e!==-1&&wa.splice(e,1);let n=Ia.get(t);n&&(window.clearTimeout(n),n=null,Ia.delete(t),wC())}function DD(t,e){const n=t.sua,r=t.ap;e&&n&&tt.reqUserAccount(t.sid,{lts:n.requestTime,elapse:n.elapse,success:!0,serverAddr:n.url,stringUid:e,uid:t.intUid,errorCode:null,extend:n.req}),tt.reportResourceTiming(t.ap.url,t.sid),tt.joinWebProxyAP(t.sid,{lts:r.requestTime,elapse:r.elapse,sucess:1,apServerAddr:r.url,turnServerAddrList:r.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[Te.CHOOSE_SERVER,Te.CLOUD_PROXY_FALLBACK].toString()}),tt.joinChooseServer(t.sid,{lts:r.requestTime,elapse:r.elapse,succ:!0,csAddr:r.url,opid:r.opid,serverList:r.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:r.gatewayInfo.cid.toString(),uid:r.gatewayInfo.uid.toString(),csIp:r.gatewayInfo.csIp,unilbsServerIds:[Te.CHOOSE_SERVER].toString(),isHttp3:r.isHttp3})}function PF(t){return window.atob(window.localStorage.getItem(t)||"")}function Bm(t,e){window.localStorage.setItem(t,window.btoa(e))}function DF(t){let e="".concat(t.appId,"_").concat(t.cname);return typeof t.uid=="string"&&(e+="_s_".concat(t.uid)),typeof t.uid=="number"&&(e+="_".concat(t.uid)),t.token&&(e+="_".concat(t.token)),fV(e)}function Mtt(t){let e=function(){const n=Vtt.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let i=n.appId;i!==void 0&&(ge(r,10),fs(r,i));let o=n.cid;o!==void 0&&(ge(r,16),ge(r,o));let s=n.cname;s!==void 0&&(ge(r,26),fs(r,s));let a=n.deviceId;a!==void 0&&(ge(r,34),fs(r,a));let c=n.elapse;c!==void 0&&(ge(r,40),ms(r,c));let d=n.fileSize;d!==void 0&&(ge(r,48),ms(r,Pc(d)));let l=n.height;l!==void 0&&(ge(r,56),ms(r,Pc(l)));let u=n.jpg;u!==void 0&&(ge(r,66),ge(r,u.length),kD(r,u));let h=n.networkType;h!==void 0&&(ge(r,72),ms(r,Pc(h)));let p=n.osType;p!==void 0&&(ge(r,80),ms(r,Pc(p)));let S=n.requestId;S!==void 0&&(ge(r,90),fs(r,S));let f=n.sdkVersion;f!==void 0&&(ge(r,98),fs(r,f));let _=n.sequence;_!==void 0&&(ge(r,104),ms(r,Pc(_)));let T=n.sid;T!==void 0&&(ge(r,114),fs(r,T));let g=n.timestamp;g!==void 0&&(ge(r,120),ms(r,g));let y=n.uid;y!==void 0&&(ge(r,128),ge(r,y));let I=n.vid;I!==void 0&&(ge(r,136),ge(r,I));let O=n.width;O!==void 0&&(ge(r,144),ms(r,Pc(O)));let b=n.service;b!==void 0&&(ge(r,152),ge(r,b));let N=n.callbackData;N!==void 0&&(ge(r,162),ge(r,N.length),kD(r,N));let U=n.ticket;U!==void 0&&(ge(r,170),fs(r,U));let V=n.vendorConfigs;V!==void 0&&(ge(r,178),fs(r,V))}(t,e),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(e)}function Utt(t){return function(n){let r={};t:for(;!Ftt(n);){let i=$l(n);switch(i>>>3){case 0:break t;case 1:r.code=$l(n);break;case 2:r.msg=LD(n,$l(n));break;case 3:r.requestId=LD(n,$l(n));break;case 4:r.timestamp=jtt(n,!1);break;default:xtt(n,7&i)}}return r}({bytes:e=t,offset:0,limit:e.length});var e}function xtt(t,e){switch(e){case 0:for(;128&hi(t););break;case 2:DS(t,$l(t));break;case 5:DS(t,4);break;case 1:DS(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function Pc(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let Vtt=[];function DS(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function Ftt(t){return t.offset>=t.limit}function z_(t,e){let n=t.bytes,r=t.offset,i=t.limit,o=r+e;if(o>n.length){let s=new Uint8Array(2*o);s.set(n),t.bytes=s}return t.offset=o,o>i&&(t.limit=o),r}function kF(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function kD(t,e){let n=z_(t,e.length);t.bytes.set(e,n)}function LD(t,e){let n=kF(t,e),r=String.fromCharCode,i=t.bytes,o="",s="";for(let a=0;a<e;a++){let c,d,l,u,h=i[a+n];128&h?(224&h)==192?a+1>=e?s+=o:(c=i[a+n+1],(192&c)!=128?s+=o:(u=(31&h)<<6|63&c,u<128?s+=o:(s+=r(u),a++))):(240&h)==224?a+2>=e?s+=o:(c=i[a+n+1],d=i[a+n+2],(49344&(c|d<<8))!=32896?s+=o:(u=(15&h)<<12|(63&c)<<6|63&d,u<2048||u>=55296&&u<=57343?s+=o:(s+=r(u),a+=2))):(248&h)==240?a+3>=e?s+=o:(c=i[a+n+1],d=i[a+n+2],l=i[a+n+3],(12632256&(c|d<<8|l<<16))!=8421504?s+=o:(u=(7&h)<<18|(63&c)<<12|(63&d)<<6|63&l,u<65536||u>1114111?s+=o:(u-=65536,s+=r(55296+(u>>10),56320+(1023&u)),a+=3))):s+=o:s+=r(h)}return s}function fs(t,e){let n=e.length,r=0;for(let s=0;s<n;s++){let a=e.charCodeAt(s);a>=55296&&a<=56319&&s+1<n&&(a=(a<<10)+e.charCodeAt(++s)-56613888),r+=a<128?1:a<2048?2:a<65536?3:4}ge(t,r);let i=z_(t,r),o=t.bytes;for(let s=0;s<n;s++){let a=e.charCodeAt(s);a>=55296&&a<=56319&&s+1<n&&(a=(a<<10)+e.charCodeAt(++s)-56613888),a<128?o[i++]=a:(a<2048?o[i++]=a>>6&31|192:(a<65536?o[i++]=a>>12&15|224:(o[i++]=a>>18&7|240,o[i++]=a>>12&63|128),o[i++]=a>>6&63|128),o[i++]=63&a|128)}}function hi(t){return t.bytes[kF(t,1)]}function MD(t,e){let n=z_(t,1);t.bytes[n]=e}function $l(t){let e,n=0,r=0;do e=hi(t),n<32&&(r|=(127&e)<<n),n+=7;while(128&e);return r}function ge(t,e){for(e>>>=0;e>=128;)MD(t,127&e|128),e>>>=7;MD(t,e)}function jtt(t,e){let n,r=0,i=0,o=0;return n=hi(t),r=127&n,128&n&&(n=hi(t),r|=(127&n)<<7,128&n&&(n=hi(t),r|=(127&n)<<14,128&n&&(n=hi(t),r|=(127&n)<<21,128&n&&(n=hi(t),i=127&n,128&n&&(n=hi(t),i|=(127&n)<<7,128&n&&(n=hi(t),i|=(127&n)<<14,128&n&&(n=hi(t),i|=(127&n)<<21,128&n&&(n=hi(t),o=127&n,128&n&&(n=hi(t),o|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|o<<24,unsigned:e}}function ms(t,e){let n=e.low>>>0,r=(e.low>>>28|e.high<<4)>>>0,i=e.high>>>24,o=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,s=z_(t,o),a=t.bytes;switch(o){case 10:a[s+9]=i>>>7&1;case 9:a[s+8]=o!==9?128|i:127&i;case 8:a[s+7]=o!==8?r>>>21|128:r>>>21&127;case 7:a[s+6]=o!==7?r>>>14|128:r>>>14&127;case 6:a[s+5]=o!==6?r>>>7|128:r>>>7&127;case 5:a[s+4]=o!==5?128|r:127&r;case 4:a[s+3]=o!==4?n>>>21|128:n>>>21&127;case 3:a[s+2]=o!==3?n>>>14|128:n>>>14&127;case 2:a[s+1]=o!==2?n>>>7|128:n>>>7&127;case 1:a[s]=o!==1?128|n:127&n}}const UD={},xD={},Gm=4294967296,Btt=Gm*Gm,VD=Btt/2;LF(0,!0);const FD=LF(0),Gtt=oh(0,-2147483648,!1),Wtt=oh(-1,2147483647,!1);function LF(t,e){let n,r,i;return e?(i=0<=(t>>>=0)&&t<256)&&(r=xD[t],r)?r:(n=oh(t,0,!0),i&&(xD[t]=n),n):(i=-128<=(t|=0)&&t<128)&&(r=UD[t],r)?r:(n=oh(t,t<0?-1:0,!1),i&&(UD[t]=n),n)}function oh(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function Htt(t,e){if(isNaN(t))return FD;{if(t<=-VD)return Gtt;if(t+1>=VD)return Wtt}return t<0?FD:oh(t%Gm|0,t/Gm|0,e)}function jD(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}class AC extends oe{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Mi.CONNECTION_STATE_CHANGE,e,n)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(e){var n;super(),v(this,"name","AgoraRTCImageModeration"),v(this,"_connectionState",Ur.CONNECTING),v(this,"_sequence",0),v(this,"_moderationStartTime",void 0),v(this,"_workerConnection",void 0),v(this,"_workerMessageLengthLimit",void 0),v(this,"_qualityRatio",void 0),v(this,"_connectInfo",void 0),v(this,"_cancelTokenSource",Gn.CancelToken.source()),v(this,"_retryConfig",void 0),v(this,"_moderationInterval",void 0),v(this,"_moderationTimer",null),v(this,"_moderationMode",1),v(this,"_quality",1),v(this,"_qualityTimer",null),v(this,"_ticket",void 0),v(this,"_moderationIntervalMinimum",void 0),v(this,"_uploadFailedNum",0),v(this,"_uploadNum",0),v(this,"_uploadTimer",null),v(this,"_extraInfo",void 0),v(this,"_vendor",""),v(this,"_encoder",new TextEncoder),v(this,"_moderationId",void 0),v(this,"inspectImage",()=>{if(this.connectionState!==Ur.CONNECTED)throw new P(R.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===Ur.CONNECTED?this.requestToInspectImage():m.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=zt(5,"image-moderation-"),this._workerMessageLengthLimit=A("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=A("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),this._qualityRatio=A("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Qu("worker-"+this._moderationId,we),this.on(Mi.STATE_CHANGE,(r,i)=>{m.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Rc[r]," ").concat(i||""))}),this.handleWorkerEvents()}async init(e,n){this.emit(Mi.STATE_CHANGE,Rc.CONNECT_AP),this._connectInfo=e;const r=this._cancelTokenSource.token;return this._retryConfig=n,new Y((i,o)=>{this.on(Mi.CONNECTION_STATE_CHANGE,(s,a)=>{s===Ur.CONNECTED&&i()}),this.requestAP(e,r,n).then(s=>{this.connectWorker(s)}).catch(s=>{o(s)})})}updateConfig(e){var n;this._moderationInterval=(n=e.interval)!==null&&n!==void 0?n:1e3,e.extraInfo&&(this._extraInfo=this._encoder.encode(e.extraInfo)),e.vendor&&(this._vendor=e.vendor),m.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===Ur.CONNECTED&&this.inspectImage()}async requestAP(e,n,r){const i=A("WEBCS_DOMAIN").map(c=>"https://".concat(c,"/api/v1")),o=await function(c,d,l,u){let{appId:h,areaCode:p,cname:S,sid:f,token:_,uid:T}=d;vd++;const g="moderation_plugin",y={service_name:g,json_body:JSON.stringify({appId:h,areaCode:p,cname:S,command:"allocateEdge",requestId:vd,seq:vd,sid:f,appToken:_,ts:Date.now(),uid:T+""})};let I,O,b=c[0];return qi(async()=>{I=Date.now();const N=await Ji(b,{data:y,cancelToken:l,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(O=Date.now()-I,N.code!==0){const W=new P(R.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+N.code,{retry:!0,responseTime:O});throw m.error(W.toString()),W}const U=JSON.parse(N.json_body);if(U.code!==200){const W=new P(R.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(U.code,", reason: ").concat(U.reason),{code:U.code,responseTime:O});throw m.error(W.toString()),W}if(!U.servers||!Array.isArray(U.servers)||U.servers.length===0){const W=new P(R.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:U.code,responseTime:O});throw m.error(W.toString()),W}if(!U.servers.some(W=>!!W.wss)){const W=new P(R.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:U.code,responseTime:O});throw m.error(W.toString()),W}const V=A("IMAGE_MODERATION_WORKER_HOST");return{addressList:U.servers.map(W=>{let{address:lt,wss:mt}=W;if(lt&&mt)return"wss://".concat(lt.replace(/\./g,"-"),".").concat(V,":").concat(mt,"/moderation")}).filter(W=>!!W),workerToken:U.workerToken,vid:U.vid,ticket:U.appTicket,responseTime:O}},(N,U)=>(tt.apworkerEvent(f,{success:!0,sc:200,serviceName:g,responseDetail:JSON.stringify(N.addressList),firstSuccess:U===0,responseTime:O,serverIp:c[U%c.length]}),!1),(N,U)=>(tt.apworkerEvent(f,{success:!1,sc:N.data&&N.data.code||200,serviceName:g,responseTime:O,serverIp:c[U%c.length]}),!!(N.code!==R.OPERATION_ABORTED&&N.code!==R.UNEXPECTED_RESPONSE||N.data&&N.data.retry)&&(b=c[(U+1)%c.length],!0)),u)}(i,e,n,r);this.emit(Mi.STATE_CHANGE,Rc.AP_CONNECTED);const{addressList:s,ticket:a}=o;return this._ticket=a,s}async connectWorker(e){this.emit(Mi.STATE_CHANGE,Rc.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(dt.CONNECTED,async()=>{this.emit(Mi.STATE_CHANGE,Rc.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=Ur.CONNECTED}),this._workerConnection.on(dt.CLOSED,()=>{this.connectionState=Ur.CLOSED}),this._workerConnection.on(dt.FAILED,()=>{this.connectionState=Ur.CLOSED}),this._workerConnection.on(dt.RECONNECTING,()=>{this.connectionState=this.connectionState===Ur.CONNECTED?Ur.RECONNECTING:Ur.CONNECTING}),this._workerConnection.on(dt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const n=Utt(new Uint8Array(e.data));A("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&m.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,m.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{tt.reportApiInvoke(this._connectInfo.sid||null,{name:Ne.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:ae.TRACER}).onError(new P(R.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},A("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else m.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(dt.WILL_RECONNECT,(e,n,r)=>{e==="recover"&&r(e),r("tryNext")}),this._workerConnection.on(dt.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=Kr(this,Mi.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(A("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&m.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(e,n);this._workerConnection.sendMessage(r,!0,!0)}else A("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&m.debug("Only the track being published can be inspected")}async generateRequestData(e,n){let{appId:r,cname:i,cid:o,vid:s,sid:a,uid:c}=n;const d=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),u=await JV(l,r,i),h=this._sequence+"-"+o+"-"+c+"-"+d+"-"+zt(12,""),p={appId:r,cid:o,cname:i,deviceId:"",elapse:AC.intToLong(Number(d-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:u,networkType:6,osType:7,requestId:h,sdkVersion:"4.22.1",sequence:this._sequence,sid:a,timestamp:Htt(d),uid:c,vid:s,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete p.callbackData;const S=Mtt(p);if(S.byteLength<this._workerMessageLengthLimit){if(A("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const f=function(_){for(var T=1;T<arguments.length;T++){var g=arguments[T]!=null?arguments[T]:{};T%2?jD(Object(g),!0).forEach(function(y){v(_,y,g[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(g)):jD(Object(g)).forEach(function(y){Object.defineProperty(_,y,Object.getOwnPropertyDescriptor(g,y))})}return _}({},p);delete f.jpg,m.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(f))}return S}{const f=this.quality*this._qualityRatio;return this.quality=f,await this.generateRequestData(e,{appId:r,cname:i,cid:o,vid:s,sid:a,uid:c})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Gn.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=Ur.CLOSED,this.emit(Mi.STATE_CHANGE,Rc.CLOSED)}}function MF(t){if(Vt(t.interval,"interval",1e3,1/0),t&&t.extraInfo&&t.extraInfo.length>1024)throw new P(R.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(t&&t.vendor&&t.vendor.length>1024)throw new P(R.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Ktt={name:"ImageModeration",create:function(t){let{config:e}=t;return MF(e),new AC(e)}};var BD,GD,WD,HD,KD,zD,YD,$D,qD,JD,XD,QD,ZD,t1,e1,n1,r1,i1,o1,s1,a1,c1,d1,l1,u1,h1,p1,f1,m1,_1,E1,g1,S1,T1,v1,y1,R1,C1,I1,w1,q;function A1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function pi(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?A1(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A1(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}pn.setLogger(m);let ztt=(BD=it(),GD=it({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof ad))return[e];e=[e]}return e.map(n=>n?Object(n).toString():"null")}}),WD=it({argsMap:(t,e)=>(e||(e=[]),Array.isArray(e)||e.trackMediaType!==ol.DATA?(Array.isArray(e)||(e=[e]),e.map(n=>n.getTrackId())):[e.getChannelId()])}),HD=it({argsMap:(t,e,n,r)=>[typeof e=="object"?e.uid:e,n,r]}),KD=it({argsMap:(t,e,n)=>[e,n]}),zD=it({argsMap:(t,e)=>e.map(n=>{let{user:r,mediaType:i}=n;return[r==null?void 0:r.uid,i]})}),YD=it({argsMap:(t,e,n,r)=>[typeof e=="object"?e.uid:e,n,r]}),$D=it({argsMap:(t,e)=>e.map(n=>{let{user:r,mediaType:i}=n;return{uid:r==null?void 0:r.uid,mediaType:i}})}),qD=it(),JD=it(),XD=it(),QD=it(),ZD=it(),t1=it(),e1=it(),n1=it(),r1=it(),i1=it(),o1=it(),s1=it(),a1=it(),c1=it(),d1=it({argsMap:(t,e)=>[e]}),l1=it(),u1=it(),h1=it(),p1=it(),f1=it(),m1=it(),_1=it(),E1=it(),g1=it({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),S1=it(),T1=it(),v1=it(),y1=it(),R1=it(),C1=it(),I1=it({reportResult:!0}),w1=it(),q=class extends oe{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return((t=this._config)===null||t===void 0?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t){let e;if(super(),v(this,"store",void 0),v(this,"_uid",void 0),v(this,"_channelName",void 0),v(this,"_uintUid",void 0),v(this,"_users",[]),v(this,"_config",void 0),v(this,"_clientId",void 0),v(this,"_appId",void 0),v(this,"_sessionId",null),v(this,"_key",void 0),v(this,"_rtmConfig",{}),v(this,"_joinInfo",void 0),v(this,"_gateway",void 0),v(this,"_statsCollector",void 0),v(this,"_configDistribute",void 0),v(this,"_leaveMutex",new pn("client-leave")),v(this,"_publishMutex",new pn("client-publish")),v(this,"_renewTokenMutex",new pn("client-renewtoken")),v(this,"_subscribeMutex",new pn("client-subscribe")),v(this,"_encryptionMode","none"),v(this,"_encryptionSecret",null),v(this,"_encryptionSalt",null),v(this,"_encryptDataStream",!1),v(this,"_encryptDataStreamKey",null),v(this,"_encryptDataStreamIv",null),v(this,"_proxyServer",void 0),v(this,"_turnServer",{servers:[],mode:"auto"}),v(this,"_cloudProxyServerMode","disabled"),v(this,"_isDualStreamEnabled",!1),v(this,"_defaultStreamFallbackType",void 0),v(this,"_lowStreamParameter",void 0),v(this,"_streamFallbackTypeCacheMap",new Map),v(this,"_remoteStreamTypeCacheMap",new Map),v(this,"_axiosCancelSource",Gn.CancelToken.source()),v(this,"_audioVolumeIndicationInterval",void 0),v(this,"_networkQualityInterval",void 0),v(this,"_userOfflineTimeout",void 0),v(this,"_streamRemovedTimeout",void 0),v(this,"_liveTranscodeStreamingClient",void 0),v(this,"_liveRawStreamingClient",void 0),v(this,"_channelMediaRelayClient",void 0),v(this,"_networkQualitySensitivity","normal"),v(this,"_p2pChannel",void 0),v(this,"_useLocalAccessPoint",!1),v(this,"_setLocalAPVersion",void 0),v(this,"_joinAndNotLeaveYet",!1),v(this,"_numberOfJoinCount",0),v(this,"_remoteDefaultVideoStreamType",void 0),v(this,"_inspect",void 0),v(this,"_moderation",void 0),v(this,"_license",void 0),v(this,"_pendingPublishedUsers",[]),v(this,"ntpAlignErrorCount",0),v(this,"remoteInboundOffset",0),v(this,"_handleLocalTrackEnable",(n,r,i)=>{this.publish(n,!1).then(r).catch(i)}),v(this,"_handleLocalTrackDisable",(n,r,i)=>{this.unpublish(n).then(r).catch(i)}),v(this,"_handleUserOnline",n=>{if(A("BLOCK_LOCAL_CLIENT")&&la(n.uid,this.channelName))return void m.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&m.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const r=this._users.find(i=>i.uid===n.uid);if(r)r._trust_in_room_=!0,r._is_pre_created&&(r._is_pre_created=!1,this.safeEmit(gt.USER_JOINED,r));else{const i=new Rs(n.uid,n.uint_id||n.uid);this._users.push(i),m.debug("[".concat(this._clientId,"] user online"),n.uid),this.safeEmit(gt.USER_JOINED,i)}}),v(this,"_handleUserOffline",n=>{if(A("BLOCK_LOCAL_CLIENT")&&la(n.uid,this.channelName))return;const r=this._users.find(i=>i.uid===n.uid);r&&(this._handleRemoveStream(n),this._handleRemoveDataChannels(n),r._audio_pre_subscribed||r._video_pre_subscribed?r._is_pre_created=!0:Pm(this._users,r),this._remoteStreamTypeCacheMap.delete(r.uid),this._streamFallbackTypeCacheMap.delete(r.uid),m.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.safeEmit(gt.USER_LEAVED,r,n.reason))}),v(this,"_handleAddAudioOrVideoStream",(n,r,i,o,s,a,c)=>{if(A("BLOCK_LOCAL_CLIENT")&&la(r,this.channelName))return;const d=this._users.find(u=>u.uid===r);if(!d)return void m.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));m.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(d.uid,n,void 0,void 0,void 0,Date.now());const l=n==="audio"?d.hasAudio:d.hasVideo;d._uintid||(d._uintid=s||r),n==="audio"?d._trust_audio_stream_added_state_=!0:d._trust_video_stream_added_state_=!0,n==="audio"?(d._audio_added_=!0,i!==void 0&&(d._audioSSRC=i),o!==void 0&&(d._cname=o),a&&(d._audioOrtc=a)):(d._video_added_=!0,i!==void 0&&(d._videoSSRC=i),o!==void 0&&(d._cname=o),c!==void 0&&(d._rtxSsrcId=c),a&&(d._videoOrtc=a)),(n==="audio"?d.hasAudio:d.hasVideo)&&!l&&(m.info("[".concat(this._clientId,"] remote user ").concat(d.uid," published ").concat(n)),this.safeEmit(gt.USER_PUBLISHED,d,n)),n==="video"?tt.onGatewayStream(this._sessionId,He.ON_ADD_VIDEO_STREAM,re.ON_ADD_VIDEO_STREAM,{peer:s||r,ssrc:d._videoSSRC}):tt.onGatewayStream(this._sessionId,He.ON_ADD_AUDIO_STREAM,re.ON_ADD_AUDIO_STREAM,{peer:s||r,ssrc:d._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(d,n,i).then(u=>{if(u&&(m.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(d.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof Bp))return this._p2pChannel.unsubscribe(d,n,!0).then(()=>this._subscribe(d,n,!0).catch(h=>{m.error("[".concat(this._clientId,"] resubscribe error"),h.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(d,n)&&(m.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(d.uid," after reconnect.")),this._subscribe(d,n,!0).catch(u=>{m.error("[".concat(this._clientId,"] resubscribe error"),u.toString())}))}),v(this,"_handleRemoveStream",n=>{if(A("BLOCK_LOCAL_CLIENT")&&la(n.uid,this.channelName))return;const r=this._users.find(o=>o.uid===n.uid);if(!r)return void m.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));m.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let i=()=>{};r.hasAudio&&r.hasVideo?i=()=>{m.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(gt.USER_UNPUBLISHED,r,"audio"),m.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(gt.USER_UNPUBLISHED,r,"video")}:r.hasVideo?i=()=>{m.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(gt.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(i=()=>{m.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(gt.USER_UNPUBLISHED,r,"audio")}),r._video_pre_subscribed||r._audio_pre_subscribed||(r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel instanceof Bp&&this._p2pChannel.unsubscribe(r).then(o=>{if(o)return this._gateway.unsubscribe(o,r.uid)}),r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0),tt.onGatewayStream(this._sessionId,He.ON_REMOVE_STREAM,re.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),i()}),v(this,"_handleSetStreamLocalEnable",(n,r,i)=>{if(A("BLOCK_LOCAL_CLIENT")&&la(r,this.channelName))return;const o=this._users.find(c=>c.uid===r);if(!o)return void m.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));m.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(i?"enabled":"disabled"," with uid ").concat(r));const s=n==="audio"?o.hasAudio:o.hasVideo;if(n==="audio"){o._trust_audio_enabled_state_=!0;const c=o._audio_enabled_;if(o._audio_enabled_=i,o._audio_enabled_===c)return;{const d=o._audio_enabled_?"enable-local-audio":"disable-local-audio";m.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r,", msg: ").concat(d)),this.safeEmit(gt.USER_INFO_UPDATED,r,d)}}else{o._trust_video_enabled_state_=!0;const c=o._video_enabled_;if(o._video_enabled_=i,o._video_enabled_===c)return;{const d=o._video_enabled_?"enable-local-video":"disable-local-video";m.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(d)),this.safeEmit(gt.USER_INFO_UPDATED,r,d)}}const a=n==="audio"?o.hasAudio:o.hasVideo;return s!==a?!s&&a?(m.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(n)),void this.safeEmit(gt.USER_PUBLISHED,o,n)):(n==="video"&&o._videoTrack&&o._videoTrack._destroy(),n==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,n),m.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(n)),void this.safeEmit(gt.USER_UNPUBLISHED,o,n)):void 0}),v(this,"_handleMuteStream",(n,r,i)=>{if(A("BLOCK_LOCAL_CLIENT")&&la(n,this.channelName))return;m.debug("[".concat(this._clientId,"] receive mute message"),n,r,i);const o=this._users.find(c=>c.uid===n);if(!o)return void m.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));const s=r==="audio"?o.hasAudio:o.hasVideo;if(r==="audio"){o._trust_audio_mute_state_=!0;const c=o._audio_muted_;if(o._audio_muted_=i,o._audio_muted_===c)return;{const d=o._audio_muted_?"mute-audio":"unmute-audio";m.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(d)),this.safeEmit(gt.USER_INFO_UPDATED,n,d)}}else{o._trust_video_mute_state_=!0;const c=o._video_muted_;if(o._video_muted_=i,o._video_muted_===c)return;{const d=o._video_muted_?"mute-video":"unmute-video";m.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(d)),this.safeEmit(gt.USER_INFO_UPDATED,n,d)}}const a=r==="audio"?o.hasAudio:o.hasVideo;if(s!==a){if(!s&&a)return(r==="audio"?o._audioSSRC:o._videoSSRC)?(m.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(r)),void this.safeEmit(gt.USER_PUBLISHED,o,r)):void m.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(r," unmute message  before add stream message, ").concat(r," SSRC doesn't exist yet."));r==="video"&&o._videoTrack&&!o._video_pre_subscribed&&o._videoTrack._destroy(),r==="audio"&&o._audioTrack,this._p2pChannel.muteRemote(o,r),m.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(r)),this.safeEmit(gt.USER_UNPUBLISHED,o,r)}}),v(this,"_handleP2PLost",async n=>{m.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():m.warning("[".concat(this._clientId,"] P2PLost stream not found"),n)}),v(this,"_handleTokenWillExpire",()=>{m.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(gt.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),v(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),m.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),v(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(gt.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(gt.NETWORK_QUALITY,n)}),v(this,"_handleP2PAddAudioOrVideoStream",(n,r,i,o)=>{const s=this._users.find(c=>c.uid===r);if(!s)return void m.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));m.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(s.uid,n,void 0,void 0,void 0,Date.now());const a=n==="audio"?s.hasAudio:s.hasVideo;n==="audio"?s._trust_audio_stream_added_state_=!0:s._trust_video_stream_added_state_=!0,n==="audio"?(s._audio_added_=!0,i!==void 0&&(s._audioSSRC=i),o!==void 0&&(s._audioMid=o)):(s._video_added_=!0,i!==void 0&&(s._videoSSRC=i),o!==void 0&&(s._videoMid=o)),(n==="audio"?s.hasAudio:s.hasVideo)&&!a&&(m.info("[".concat(this._clientId,"] remote user ").concat(s.uid," published ").concat(n)),this.safeEmit(gt.USER_PUBLISHED,s,n)),this._p2pChannel.hasPendingRemoteMedia(s,n)&&(m.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(s.uid," after reconnect.")),this._subscribe(s,n,!0).catch(c=>{m.error("[".concat(this._clientId,"] resubscribe error"),c.toString())}))}),this._config=t,this._clientId=zt(5,"client-"),this.store=new CX(t.codec,t.audioCodec,t.mode,this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),m.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(zr," build: ").concat(cC,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{qO(t.clientRoleOptions),e=Object.assign({},t.clientRoleOptions)}catch(n){m.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new ih(this.store),this._statsCollector.onStatsException=(n,r,i)=>{m.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(r,", uid: ").concat(i)),this.safeEmit(gt.EXCEPTION,{code:n,msg:r,uid:i})},this._statsCollector.onUploadPublishDuration=(n,r,i,o)=>{const s=this._users.find(a=>a.uid===n);s&&tt.peerPublishStatus(this._sessionId,{subscribeElapse:o,audioPublishDuration:r,videoPublishDuration:i,peer:s._uintid})},this.store.useP2P=t.mode==="p2p",this._gateway=new ttt(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||we,httpRetryConfig:t.httpRetryConfig||we,forceWaitGatewayResponse:t.forceWaitGatewayResponse===void 0||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:e}),this._configDistribute=new ltt,this.store.useP2P?(this._p2pChannel=new nr(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new Bp(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,r,i){let o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],s=arguments.length>6&&arguments[6]!==void 0&&arguments[6];xt("JOIN_GATEWAY_USE_443PORT_ONLY",o),xt("JOIN_GATEWAY_USE_DUAL_DOMAIN",s);const a=this._gateway.signal.websocket;return a instanceof dC&&(a.use443PortOnly=o,a.tryDoubleDomain=s),async function(c,d,l){Sp.get(c)||Sp.set(c,[]),Tp.get(c)||Tp.set(c,d),to.get(c)||to.set(c,0);const u=Sp.get(c),h=Tp.get(c);if(!u||!h)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(to.get(c)===h){const T=Yu();u.push(T),await T.promise}to.set(c,to.get(c)+1);for(var p=arguments.length,S=new Array(p>3?p-3:0),f=3;f<p;f++)S[f-3]=arguments[f];const _=await l(...S);return to.set(c,to.get(c)-1),to.get(c)===h-1&&u.length>0&&(u[0].resolve(),u.shift()),to.get(c)===0&&(Sp.set(c,[]),Tp.set(c,0),to.set(c,0)),_}("client.join",A("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,r,i)}async join(t,e,n,r,i){const o=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const s=(yp||yp||(yp=(window.location.protocol.split(":")[0]||"").toUpperCase(),yp))==="HTTPS",a=nb()?window.isSecureContext:"Browser Not Support";(!nb()&&!s||!window.isSecureContext)&&m.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),m.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),tt.setAppId(t);try{if(!n&&n!==null)throw new P(R.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Ke(n,"token",1,2047),Ke(t,"appid",1,2047),W_(e),r&&H_(r),i&&Ke(i,"optionalInfo",1,2047)}catch(f){throw tt.reportApiInvoke(id(),{name:Ne.JOIN,options:[t,e,n,r],states:{isHttps:s,isSecureContext:a},tag:ae.TRACER}).onError(f),f}if(this._leaveMutex.isLocked&&(m.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),m.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const f=new P(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw tt.reportApiInvoke(id(),{name:Ne.JOIN,options:[t,e,n,r],states:{isHttps:s,isSecureContext:a},tag:ae.TRACER}).onError(f),f}this._gateway.state="CONNECTING";const c=await PD({appId:t,cname:e,uid:r,stringUid:typeof r=="string"?r:void 0,token:n||t,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new P(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const d=(c==null?void 0:c.sid)||id();m.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(o)),this._sessionId||(this._sessionId=d,this.store.sessionId=this._sessionId);const l=tt.reportApiInvoke(d,{name:Ne.JOIN,options:[t,e,n,r],states:{isHttps:s,isSecureContext:a},tag:ae.TRACER}),u=pi(pi(pi({},this._rtmConfig),{},{clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!c},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:A("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(u.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(u.stringUid=r,this._uintUid?(u.uid=this._uintUid,this._uintUid=void 0):u.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(u.aesmode=this._encryptionMode,u.aespassword=await(async f=>{const _=function(I){const O=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),b=new Uint8Array(new ArrayBuffer(O.length));for(let N=0;N<O.length;N+=1)b[N]=O.charCodeAt(N);return b}(),T=await window.crypto.subtle.importKey("spki",_,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),g=iC(f),y=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},T,g);return function(I){let O="";for(let b=0;b<I.length;b+=1)O+=String.fromCharCode(I[b]);return window.btoa(O)}(new Uint8Array(y))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new P(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(u.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const f=new TextEncoder,_=A("USE_PURE_ENCRYPTION_MASTER_KEY")?f.encode(u.appId+this._encryptionSecret+this._encryptionSecret):f.encode(u.appId+u.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(T,g,y){const I=await window.crypto.subtle.importKey("raw",g,"PBKDF2",!1,["deriveBits","deriveKey"]),O=T==="aes-128-gcm2"?128:256,b=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:ib,hash:"SHA-256",salt:y},I,O+IX);return new Uint8Array(b).subarray(O/8)}(this._encryptionMode,_,La(this._encryptionSalt)),this._encryptDataStreamKey=await async function(T,g,y){const I=await window.crypto.subtle.importKey("raw",g,"PBKDF2",!1,["deriveBits","deriveKey"]),O=T==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:ib,hash:"SHA-256",salt:y},I,{name:"AES-GCM",length:O},!0,["encrypt","decrypt"])}(this._encryptionMode,_,La(this._encryptionSalt))}else a?m.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):m.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,m.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:e,appId:t,stringUid:u.stringUid});const h=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&h===this._sessionId&&tt.joinChannelTimeout(this._sessionId,5)},5e3);try{var p;let f;const _=u.cloudProxyServer;if($(p=["proxy3","proxy4","proxy5"]).call(p,_)){const O=A("PROXY_SERVER_TYPE3");Array.isArray(O)?u.proxyServer=O[0]:u.proxyServer=O}if(tt.setProxyServer(u.proxyServer),m.setProxyServer(u.proxyServer),this.store.requestAPStart(),c){if(m.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(u.stringUid?", ".concat(u.stringUid," => ").concat(c.intUid):""," ")),u.stringUid&&!u.uid&&(u.uid=c.intUid),f={gatewayInfo:c.ap.gatewayInfo},A("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&u.turnServer.mode==="auto")if(c.ap.proxyInfo.addresses.length===0)m.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const O=(await CV(c.ap.proxyInfo,c.ap.gatewayInfo.uid)).map(b=>({turnServerURL:b.address,tcpport:b.tcpport||nn.tcpport,udpport:b.udpport||nn.udpport,username:b.username||nn.username,password:b.password||nn.password,forceturn:!1,security:!0}));u.turnServer={mode:"manual",servers:O}}DD(c,u.stringUid)}else{if(u.stringUid&&!u.uid){let O;[O,f]=await Y.all([fF(u.stringUid,u,this._axiosCancelSource.token,this._config.httpRetryConfig||we,this.store),MP(u,this._axiosCancelSource.token,this._config.httpRetryConfig||we,!0,this.store)]),m.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(u.stringUid," => ").concat(O)),u.uid=O,f.gatewayInfo.uid=O,f.gatewayInfo.res.uid=O}else f=await MP(u,this._axiosCancelSource.token,this._config.httpRetryConfig||we,!0,this.store);if(!this._joinAndNotLeaveYet)throw new P(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(u,this._axiosCancelSource.token),this._configDistribute.on(qv.UPDATE_BITRATE_LIMIT,O=>{this._p2pChannel.updateBitrateLimit(O)})},0),this._key=n||t;const T=f.gatewayInfo,g=u.uid?u.uid:T.uid;this._joinInfo=pi(pi({},u),{},{cid:T.cid,uid:g,vid:T.vid,apResponse:T.res,apGatewayAddress:T.apGatewayAddress,uni_lbs_ip:T.uni_lbs_ip,gatewayAddrs:T.gatewayAddrs}),this.store.intUid=g;const y=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new P(R.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l.onSuccess(y),this._appId=t,this._channelName=u.cname,this._uid=y,this.store.uid=y,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(an()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const I=u.stringUid?"string uid: ".concat(u.stringUid,",uid: ").concat(u.uid):"uid: ".concat(this._uid);return m.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(I)),setTimeout(()=>{m.startUpload()},5e3),this.store.joinEnd(),S=this,$(Ra).call(Ra,S)||Ra.push(S),this._cloudProxyServerMode==="disabled"&&wt().supportWebCrypto&&A("ENABLE_PRELOAD")&&wC(this._joinInfo),y}catch(f){const _=Array.isArray(f)?f[0]:f;throw _&&_.code===R.OPERATION_ABORTED?m.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),_):m.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),_),_.code!==R.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),l.onError(_),_}var S}_joinGateway(){if(!this._joinInfo||!this._key)throw new P(R.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!A("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){m.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(an()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const n=Ra.indexOf(e);n!==-1&&Ra.splice(n,1)}(this),this._statsCollector.stopUpdateStats();const t=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return m.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave(this.connectionState!=="CONNECTED"),m.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(t)){if(!(t instanceof ad))return this._publishDataChannel(t);t=[t]}if(t.length===0)throw new P(R.INVALID_PARAMS,"param list is empty");const n=t;if(this._gateway.role==="audience")throw new P(R.INVALID_OPERATION,"audience can not publish stream");for(const i of n){if(!(i instanceof ad))throw new P(R.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&e)throw new P(R.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}m.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))));const r=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach(i=>{const o=this._configDistribute.getBitrateLimit();i instanceof qt&&o&&i.setBitrateLimit(o.uplink)});try{await this._publishHighStream(n),m.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw m.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{r()}}async _publishDataChannel(t){Vt(t.id,"id",0,65535,!0),Wo(t.ordered,"ordered"),Ke(t.metadata,"metadata",0,512),m.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===t.id)!==-1)throw new P(R.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new P(R.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&A("FORCE_TURN")&&!A("TURN_ENABLE_TCP")&&!A("TURN_ENABLE_UDP"))throw new P(R.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=function(i){return wD(i,!1)}(t),r=await this._p2pChannel.publishDataChannel([n]);if(r.length>0){if(typeof n._originDataChannelId!="number")throw m.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new P(R.CREATE_DATACHANNEL_ERROR);try{await Y.all(r.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await n._waitTillOpen()}catch(i){if(i.code!==R.DISCONNECT_P2P)throw i}}return m.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(n){throw m.error("[".concat(this._clientId,"] publish datachannels error"),n.toString()),n}finally{e()}}async unpublish(t){if(!this._joinInfo||this._uid===void 0)throw new P(R.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof ad))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);m.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(r=>"".concat(r.getTrackId()," "))," "));const n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof nr){const r=await this._p2pChannel.unpublish(e);r&&await this._gateway.sendExtensionMessage(me.UNPUBLISH,{unpubMsg:r},!0)}else{const r=await this._p2pChannel.unpublish(e);r&&await this._gateway.unpublish(r,this._uid),m.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(i=>"".concat(i.getTrackId()))))}}catch(r){throw m.error("[".concat(this._clientId,"] unpublish error"),r.toString()),r}finally{n&&n()}}async _unpublishDataChannel(t){t!==void 0&&t.length!==0||(t=this._p2pChannel.getAllDataChannels()),m.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map(n=>"".concat(n.id," "))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),m.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map(r=>"".concat(r.id))))}catch(n){throw m.error("[".concat(this._clientId,"] unpublish dataChannel error"),n.toString()),n}finally{e&&e()}}async subscribe(t,e,n){if(!(t instanceof Rs)){const r=this.remoteUsers.find(i=>i.uid===t);if(!r)throw new P(R.INVALID_REMOTE_USER,"user is not in the channel");t=r}return e==="datachannel"?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async presubscribe(t,e){if(De(e,"mediaType",["audio","video"]),this._p2pChannel instanceof nr)throw new P(R.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new P(R.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const n=e===et.AUDIO,r=e===et.VIDEO,i=await this._subscribeMutex.lock();try{const{ssrcId:o,ortc:s,rtxSsrcId:a,cname:c,uint_id:d}=await this._gateway.presubscribe(t,e,!0);if(o==null)throw new P(R.UNEXPECTED_RESPONSE,"no ssrc id");let l=this._users.find(h=>h.uid===t);l||(l=new Rs(t,d||t),l._is_pre_created=!0,this._users.push(l)),c&&(l._cname=c),l._uintid||(l._uintid=d||t),n&&(l._audioSSRC=o,l._audio_pre_subscribed=!0,s&&(l._audioOrtc=s)),r&&(l._videoSSRC=o,l._video_pre_subscribed=!0,s&&(l._videoOrtc=s),a!=null&&(l._rtxSsrcId=a)),m.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o)),await this._p2pChannel.subscribe(l,e,o,a,s);const u=n?l._audioTrack:l._videoTrack;if(!u)throw new P(R.UNEXPECTED_ERROR,"can not find remote track in user");return n&&(l._trust_audio_stream_added_state_=!0,l._audio_added_=!0),r&&(l._trust_video_stream_added_state_=!0,l._video_added_=!0),u}catch(o){throw m.error("[".concat(this._clientId,"] presub user ").concat(t," error"),o),o}finally{i()}}async _subscribeDataChannel(t,e){var n;if(Vt(e,"channelId",0,65535,!0),!this._joinInfo)throw new P(R.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(a=>a===t))throw m.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new P(R.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&t._dataChannels.length===0)throw m.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new P(R.INVALID_REMOTE_USER,"user is not published");const i=(n=t._dataChannels)===null||n===void 0?void 0:n.find(a=>a.id===e);if(!i)throw m.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new P(R.REMOTE_USER_IS_NOT_PUBLISHED);const o=await this._subscribeMutex.lock();m.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const a=await this._p2pChannel.subscribeDataChannel(t,[i]);if(a&&$(a).call(a,i.id))try{var s;if(typeof i._originDataChannelId!="number")throw m.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new P(R.CREATE_DATACHANNEL_ERROR);const c={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:(s=i.metadata)!==null&&s!==void 0?s:""};await this._gateway.subscribeDataChannel(t.uid,c,!0),await i._waitTillOpen()}catch(c){if((c==null?void 0:c.code)!==R.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[i]),c;await this._p2pChannel.unsubscribeDataChannel(t,[i]),this._p2pChannel.setPendingRemoteDataChannel(t,i.id)}return m.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),i}finally{o()}}async _p2pSubscribe(t,e,n){if(De(e,"mediaType",["audio","video"]),!this._joinInfo)throw new P(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(o=>o===t)){const o=new P(R.INVALID_REMOTE_USER,"user is not in the channel");throw m.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),o}if(!t.hasAudio&&!t.hasVideo){const o=new P(R.INVALID_REMOTE_USER,"user is not published");throw m.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),o}if(!n&&(e==="audio"&&!t.hasAudio||e==="video"&&!t.hasVideo)){const o=new P(R.REMOTE_USER_IS_NOT_PUBLISHED);throw m.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),o}const i=await this._subscribeMutex.lock();m.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const s=e==="audio"?t._audioSSRC:t._videoSSRC,a=e==="audio"?t._audioMid:t._videoMid;this.store.subscribe(t.uid,e,Date.now()),this._p2pChannel instanceof nr&&await this._p2pChannel.subscribe(t,e,s,a)}catch(s){throw s}m.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(s=>{m.warning("[".concat(this._clientId,"] auto set fallback failed"),s)});const o=e==="audio"?t._audioTrack:t._videoTrack;if(!o)throw new P(R.UNEXPECTED_ERROR,"can not find remote track in user object");return o}catch(o){throw m.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),o),o}finally{i()}}async _subscribe(t,e,n){if(this._p2pChannel instanceof nr)return this._p2pSubscribe(t,e);if(De(e,"mediaType",["audio","video"]),!this._joinInfo)throw new P(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(d=>d===t)){const d=new P(R.INVALID_REMOTE_USER,"user is not in the channel");throw m.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),d}if(!t.hasAudio&&!t.hasVideo){const d=new P(R.INVALID_REMOTE_USER,"user is not published");throw m.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),d}if(!(n||(e!=="audio"||t.hasAudio&&t._audioSSRC!==void 0)&&(e!=="video"||t.hasVideo&&t._videoSSRC!==void 0))){const d=new P(R.REMOTE_USER_IS_NOT_PUBLISHED);throw m.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),d}let i=e==="audio"?t._audioSSRC:t._videoSSRC,o=e==="audio"?t._audioOrtc:t._videoOrtc,s=e==="video"?t._rtxSsrcId:void 0,a={stream_type:e==="audio"?et.AUDIO:et.VIDEO,ssrcId:i};const c=await this._subscribeMutex.lock();m.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const l=e==="audio"?t._audioSSRC:t._videoSSRC;l!==void 0&&l!==i&&(i=l,o=e==="audio"?t._audioOrtc:t._videoOrtc,s=e==="video"?t._rtxSsrcId:void 0,a={stream_type:e==="audio"?et.AUDIO:et.VIDEO,ssrcId:i}),un.markSubscribeStart(this.store.clientId,i),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,i,s,o);try{this._p2pChannel.isPreSubScribe(i)||await this._gateway.subscribe(t.uid,a,!0)}catch(u){if((u==null?void 0:u.code)!==R.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),u;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(l){throw this._p2pChannel.reportSubscribeEvent(!1,l==null?void 0:l.code,t,e),l}m.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch(l=>{m.warning("[".concat(this._clientId,"] auto set fallback failed"),l)});const d=e==="audio"?t._audioTrack:t._videoTrack;if(!d)throw new P(R.UNEXPECTED_ERROR,"can not find remote track in user object");return d}catch(d){throw m.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),d),d}finally{c()}}async massSubscribe(t){if(Fo(t,"subscribeList"),!this._joinInfo)throw new P(R.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,r=await this._subscribeMutex.lock();m.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map(a=>{let{user:c,mediaType:d}=a;return"user: ".concat(c==null?void 0:c.uid,", mediaType: ").concat(d)}).join("; ")));const i=(t=[...t]).map(a=>{let{user:c,mediaType:d}=a;return{user:c,mediaType:d}}),o=await this._p2pChannel.globalLock();try{var s;for(let c=t.length-1;c>=0;c--){const d=t[c],{user:l,mediaType:u}=d;if(De(u,"mediaType",["audio","video"]),!l){const f=new P(R.INVALID_PARAMS,"user property does not exist in subscribeList item");throw m.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),f}if(!this._users.find(f=>f===l)){const f=new P(R.INVALID_REMOTE_USER,"user is not in the channel");m.error("[".concat(this._clientId,"] can not massSubscribe ").concat(l.uid,", this user is not in the channel")),i[c].error=f,t.splice(c,1);continue}if(u==="audio"&&(!l.hasAudio||l._audioSSRC===void 0)||u==="video"&&(!l.hasVideo||l._videoSSRC===void 0)){const f=new P(R.REMOTE_USER_IS_NOT_PUBLISHED);m.error("[".concat(this._clientId,"] can not subscribe ").concat(l.uid," with mediaType ").concat(u,", remote user is not published")),i[c].error=f,t.splice(c,1);continue}const p=xe.Video|xe.LwoVideo,S=n.get(l);if(S){if(u==="video"?S&p:S&xe.Audio){t.splice(c,1),m.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(l.uid,", mediaType:").concat(u," twice"));continue}n.set(l,S|(u==="video"?p:xe.Audio))}else n.set(l,u==="video"?p:xe.Audio)}for(let c=t.length-1;c>=0;c--){const d=t[c],{user:l,mediaType:u}=d,h=xe.Video|xe.LwoVideo;if(this._p2pChannel.hasRemoteMedia(l,u)){await this._p2pChannel.unmuteRemoteNoLock(l,u);const p=n.get(l);n.set(l,u==="video"?p^h:p^xe.Audio),t.splice(c,1)}}this.store.massSubscribe(t.map(c=>({userId:c.user.uid,type:c.mediaType})),e);let a=zi(s=Array.from(n.entries())).call(s,(c,d)=>{let[l,u]=d;if(u===0)return c;const h={stream_id:l.uid,stream_type:u};return u&xe.Audio&&(h.audio_ssrc=l._audioSSRC),u&xe.Video&&(h.video_ssrc=l._videoSSRC),c.push(h),c},[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map(d=>{let{user:l,mediaType:u}=d;return{user:l,mediaType:u,ssrcId:u===et.VIDEO?l._videoSSRC:l._audioSSRC,rtxSsrcId:u===et.VIDEO?l._rtxSsrcId:void 0}}));const c=new Map;if(a=a.filter(d=>d.video_ssrc&&!this._p2pChannel.isPreSubScribe(d.video_ssrc)||d.audio_ssrc&&!this._p2pChannel.isPreSubScribe(d.audio_ssrc)||!d.video_ssrc&&!d.audio_ssrc),a.length>0){const d=await this._gateway.subscribeAll(a,!0);((d==null?void 0:d.users)||[]).forEach(l=>{let{stream_id:u,video_error_code:h,audio_error_code:p,error_code:S}=l;(h||p||S)&&c.set(u,{video_error_code:h,audio_error_code:p,error_code:S})})}if(Array.from(c.entries()).length>0){const d=[];Array.from(c.entries()).forEach(l=>{let[u,h]=l;const p=this.remoteUsers.find(S=>S.uid===u);if(p){let S;h.error_code||h.video_error_code&&h.audio_error_code?S=void 0:h.video_error_code?S=et.VIDEO:h.audio_error_code&&(S=et.AUDIO),d.push({user:p,mediaType:S})}}),d.length>0&&await this._p2pChannel.massUnsubscribeNoLock(d)}for(const d of i){const l=c.get(d.user.uid);if(l){const u=l.error_code||d.mediaType==="audio"&&l.audio_error_code||d.mediaType==="video"&&l.video_error_code;if(u){const h=Xu(u);m.error("user:".concat(d.user.uid," mediaType:").concat(d.mediaType," has massSubscribe error ").concat(h.desc)),d.error=new P(R.SUBSCRIBE_FAILED,"code ".concat(u,": ").concat(h.desc))}}d.error||(d.mediaType==="video"?d.track=d.user.videoTrack:d.track=d.user.audioTrack)}return this.store.massSubscribe(i.filter(d=>!d.error).map(d=>({userId:d.user.uid,type:d.mediaType})),void 0,Date.now()),i.forEach(d=>{var l;tt.subscribe(this.store.sessionId,{succ:!!d.error,ec:((l=d.error)===null||l===void 0?void 0:l.code)||null,video:d.mediaType===et.VIDEO,audio:d.mediaType===et.AUDIO,peerid:d.user.uid,subscribeRequestid:d.mediaType===et.VIDEO?d.user._videoSSRC:d.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e),preSsrc:this._p2pChannel.isPreSubScribe(d.user._videoSSRC)},!0)}),m.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map(d=>{let{user:l,mediaType:u}=d;return"user: ".concat(l==null?void 0:l.uid,", mediaType: ").concat(u)}).join("; "))),i}catch(c){throw await this._p2pChannel.massUnsubscribeNoLock(t),c}}finally{o(),r()}}async unsubscribe(t,e,n){if(!(t instanceof Rs)){const o=this.remoteUsers.find(s=>s.uid===t);if(!o)throw new P(R.INVALID_REMOTE_USER,"user is not in the channel");t=o}if(e||this.store.useP2P){if(e==="datachannel")return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&De(e,"mediaType",["audio","video"]),!this._joinInfo)throw new P(R.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(o=>o===t)){const o=new P(R.INVALID_REMOTE_USER,"user is not in the channel");throw m.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),o}m.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const i=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof nr)await this._p2pChannel.unsubscribe(t,e);else{const o=await this._p2pChannel.unsubscribe(t,e);o&&await this._gateway.unsubscribe(o,t.uid),e&&e!=="audio"||(t._audio_pre_subscribed=!1),e&&e!=="video"||(t._video_pre_subscribed=!1),t._is_pre_created&&Pm(this._users,t),m.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(o){if(o.code===R.DISCONNECT_P2P)return void m.warning("disconnecting p2p, abort unsubscribe request.");throw m.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),o.toString()),o}finally{i()}}async _unsubscribeDataChannel(t,e){if(e&&Vt(e,"id",0,65535,!0),!this._joinInfo)throw new P(R.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(i=>i===t)){const i=new P(R.INVALID_REMOTE_USER,"user is not in the channel");throw m.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),i}let r;if(typeof e=="number"){const i=t._dataChannels.find(o=>o.id===e);i&&(r=[i])}else r=t._dataChannels;if(r===void 0){const i=new P(R.REMOTE_USER_IS_NOT_PUBLISHED);throw m.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),i}m.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(r.map(i=>i.id)));try{const i=await this._p2pChannel.unsubscribeDataChannel(t,r);i&&await this._gateway.unsubscribeDataChannel(i,t.uid),m.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(i))}catch(i){if(i.code===R.DISCONNECT_P2P)return void m.warning("disconnecting p2p, abort unsubscribe request.");throw m.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),i.toString()),i}}async massUnsubscribe(t){if(Fo(t,"unsubscribeList"),!this._joinInfo)throw new P(R.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");m.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map(n=>{let{user:r,mediaType:i}=n;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(i,";")}).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:r,mediaType:i}=t[n];if(!r){const a=new P(R.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw m.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),a}if(De(i,"mediaType",["video","audio",void 0]),!this._users.find(a=>a===r)){m.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),t.splice(n,1);continue}const s=xe.Video|xe.LwoVideo;if(e.has(r)){const a=e.get(r);let c;switch(i){case"video":c=a&s;break;case"audio":c=a&xe.Audio;break;default:c=a&(xe.Audio|s)}if(c){m.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),t.splice(n,1);continue}i?i==="audio"?e.set(r,a|xe.Audio):i==="video"&&e.set(r,a|s):e.set(r,a|xe.Audio|s)}else i?i==="audio"?e.set(r,xe.Audio):i==="video"&&e.set(r,s):e.set(r,xe.Audio|s)}try{const n=await this._p2pChannel.massUnsubscribe(t);n&&await this._gateway.massUnsubscribe(n),m.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map(r=>{let{user:i,mediaType:o}=r;return"user: ".concat(i==null?void 0:i.uid,", mediaType: ").concat(o,";")}).join()))}catch(n){if(n.code===R.DISCONNECT_P2P)return void m.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw m.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}async setLowStreamParameter(t){(function(n){if(!n)throw new M(R.INVALID_PARAMS);ne(n.width)||Fg(n.width,"streamParameter.width"),ne(n.height)||Fg(n.height,"streamParameter.height"),ne(n.framerate)||Fg(n.framerate,"streamParameter.framerate"),ne(n.bitrate)||Vt(n.bitrate,"streamParameter.bitrate")})(t),(!t.width&&t.height||t.width&&!t.height)&&m.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),m.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,B.LocalVideoLowTrack)}async enableDualStream(){if(!wt().supportDualStream)throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new P(R.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new P(R.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),m.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new P(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(B.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,tt.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),m.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(n){De(n,"role",["audience","host"])}(t),e&&qO(e),this.mode==="rtc"||this.mode==="p2p")throw m.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new P(R.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(e&&e.level&&t==="host")throw new P(R.INVALID_OPERATION,"host mode can not set audience latency level");if(t==="audience"&&this._p2pChannel.hasLocalMedia())throw new P(R.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(t,e),this._config.role=t,m.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}getRemoteInboundOffset(){var t;const e=(t=this._p2pChannel.getStats())===null||t===void 0?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(Ke(t,"proxyServer"),!e){if(this.connectionState!=="DISCONNECTED")throw new P(R.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new P(R.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,tt.setProxyServer(this._proxyServer),m.setProxyServer(this._proxyServer),m.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if(this.connectionState!=="DISCONNECTED")throw new P(R.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new P(R.INVALID_OPERATION,"You have already set the proxy")}if(F_(t))return this._turnServer={servers:t,mode:"original-manual"},void m.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map(n=>n.urls).join(","),"."));t.forEach(n=>uV(n)),this._turnServer={servers:t,mode:"manual"},m.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if(this.connectionState!=="DISCONNECTED")throw new P(R.INVALID_OPERATION,"you should set license before join channel");if(Ke(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new P(R.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,m.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if(this.connectionState!=="DISCONNECTED")throw new P(R.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new P(R.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(t===void 0&&(t=3),t){case 1:case 2:throw new P(R.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new P(R.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,m.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new P(R.INVALID_OPERATION,"Stop proxy server after leave channel");tt.setProxyServer(),m.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",m.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new P(R.INVALID_PARAMS,"accessPoints is required.");Fo(t.accessPoints.serverList,"accessPoints.serverList"),Ke(t.accessPoints.domain,"accessPoints.domain");const e=(h,p)=>{Vt(h,p,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new P(R.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");A("CLOSE_AFB_FOR_LOCAL_AP")&&(xt("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),xt("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=t.accessPoints.domain,o=t.accessPoints.serverList.map(h=>r.test(h)?"".concat(h.replace(/\./g,"-"),".").concat(i):h),s=o.map(h=>"".concat(h,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,xt("WEBCS_DOMAIN",s),xt("WEBCS_DOMAIN_BACKUP_LIST",s),xt("GATEWAY_DOMAINS",[i]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Fo(t.report.hostname,"report.hostname"),xt("EVENT_REPORT_DOMAIN",t.report.hostname[0]),xt("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(xt("EVENT_REPORT_DOMAIN",o[0]),xt("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let a=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),a=t.report.port),xt("STATS_COLLECTOR_PORT",a),t.report?xt("ENABLE_EVENT_REPORT",!0):xt("ENABLE_EVENT_REPORT",!1);let c="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Fo(t.log.hostname,"log.hostname"),c=t.log.hostname[0]):c=o[0];let d=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),d=t.log.port),xt("LOG_UPLOAD_SERVER","".concat(c,":").concat(d));let l=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Fo(t.cds.hostname,"cds.hostname"),l=t.cds.hostname):l=o;let u=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),u=t.cds.port),xt("CDS_AP",l.map(h=>"".concat(h,":").concat(u))),t.cds?xt("ENABLE_CONFIG_DISTRIBUTE",!0):xt("ENABLE_CONFIG_DISTRIBUTE",!1),m.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(Fo(t,"serverList"),Ke(e,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new P(R.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(e):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,xt("WEBCS_DOMAIN",t),xt("WEBCS_DOMAIN_BACKUP_LIST",t),xt("GATEWAY_DOMAINS",[e]),xt("EVENT_REPORT_DOMAIN",t[0]),xt("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),xt("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),m.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(De(t,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw m.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else m.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){De(e,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout(()=>{const n=this._users.find(r=>r.uid===t);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw m.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}m.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){De(e,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(n){throw m.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}m.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n,r){(function(o){De(o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(t),Ke(e,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if($(i).call(i,t)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new P(R.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new P(R.INVALID_PARAMS,"current encrypt mode does not need salt");if(r){if(Wo(r,"encryptDataStream"),!$(i).call(i,t))throw new P(R.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(e)||m.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=Hs(n))}async renewToken(t){if(Ke(t,"token",1,2047),!this._key||!this._joinInfo)throw new P(R.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(A("USE_NEW_TOKEN")){m.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await dtt(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||we);m.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:r})}else m.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});m.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=e,this._joinInfo.token=e,m.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?m.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(gt.VOLUME_INDICATOR,t)},A("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if(this.codec!=="h264")throw new P(R.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new P(R.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new P(R.LIVE_STREAMING_TASK_CONFLICT);const n=e?zo.TRANSCODE:zo.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(zo.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(t));if(!e.length)throw new P(R.INVALID_PARAMS,"can not find live streaming url to stop");await Y.all(e.map(n=>n&&n.stopLiveStreamingTask(t)))}async startChannelMediaRelay(t){fD(t),await this._createChannelMediaRelayClient().startChannelMediaRelay(t)}async updateChannelMediaRelay(t){fD(t),await this._createChannelMediaRelayClient().updateChannelMediaRelay(t)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}async sendStreamMessage(t){var e;let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new P(R.INVALID_OPERATION,"can not send data stream, not joined");if((typeof t=="string"||t instanceof Uint8Array)&&(t={payload:t}),typeof t.payload=="string"){const i=new TextEncoder;t.payload=i.encode(t.payload)}let r=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&$(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)&&(r=!0,t.payload=await async function(i,o,s){var a;const c=zi(a=Array.from(s)).call(a,(f,_)=>f+_,0),d={serverTs:0,seq:wX++,length:s.length,checkSum:c},l=new Uint8Array(eb(c,2)),u=new ArrayBuffer(yc),h=new DataView(u);h.setUint32(0,d.serverTs),h.setUint16(4,d.seq),h.setUint16(6,d.length),h.setUint16(8,d.checkSum);const p=16-s.length%16;s=XO(s,new Uint8Array(p));const S=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:rb,additionalData:l},o,s);return XO(new Uint8Array(u),new Uint8Array(S))}(this._encryptDataStreamIv,this._encryptDataStreamKey,t.payload)),new Blob([t.payload]).size>1024)throw new P(R.INVALID_PARAMS,r?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(st.DATA_STREAM,{payload:Hs(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-Ott},!n)}sendMetadata(t){if(!this._joinInfo)throw new P(R.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new P(R.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(st.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Hs(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(OX),!this._joinInfo)throw new P(R.INVALID_OPERATION,"can not send custom report, not joined");await tt.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){De(e.spatialLayer,"spatialLayer",[0,1,2,3]),De(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(n){throw m.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}async setRTMConfig(t){const{apRTM:e=!1,rtmFlag:n}=t;if(Wo(e,"apRTM"),Vt(n,"rtmFlag",0),this._rtmConfig.apRTM=e,this._rtmConfig.rtmFlag=n,m.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(t)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=e,this._joinInfo.rtmFlag=n,this._gateway.setRTM2Flag(n)}_reset(){if(m.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Gn.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&NF(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&tt.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach(e=>e._close()),t._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new pn("client-publish"),this._subscribeMutex=new pn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(t,e){var n;const r=t||id();t?m.debug("[".concat(this._clientId,"] new Session ").concat(r)):m.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(r));const i=t?"":this._sessionId||"";this._sessionId=r,this.store.sessionId=r,tt.addSid(r);const o={lts:new Date().getTime(),mode:this.mode,buildFormat:2,stringUid:(e==null?void 0:e.stringUid)||((n=this._joinInfo)===null||n===void 0?void 0:n.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};tt.sessionInit(this._sessionId,pi({cname:e.channel,appid:e.appId},o)),this._joinInfo&&(this._joinInfo.sid=r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=r)}async _publishHighStream(t){if(!this._joinInfo||this._uid===void 0)throw new P(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&A("FORCE_TURN")&&!A("TURN_ENABLE_TCP")&&!A("TURN_ENABLE_UDP"))throw new P(R.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");m.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(this._p2pChannel instanceof nr){const r=(await n.next()).value;if(r){try{await this._gateway.sendExtensionMessage(me.PUBLISH,r,!0)}catch(i){throw n.throw(i),i}await n.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const r=(await n.next()).value;if(r){var e;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(o){if(o.code!==R.DISCONNECT_P2P)throw n.throw(o),o}await n.next(((e=i)===null||e===void 0?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const i of t)i instanceof qt&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,t),(n==null?void 0:n.code)===R.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new P(R.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new P(R.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));m.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var e;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(o){if(o.code!==R.DISCONNECT_P2P)throw n.throw(o),o}n.next(((e=i)===null||e===void 0?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===R.WS_ABORT)return;throw n}}_createLiveStreamingClient(t){const e=()=>{if(!this._joinInfo||!this._appId)return new P(R.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const n=(r={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},Yl("LiveStreaming").create(r));var r;return n.onLiveStreamError=(i,o)=>{tt.reportApiInvoke(this._sessionId,{name:Ne.ON_LIVE_STREAM_ERROR,options:[i,o],tag:ae.TRACER}).onSuccess(),this.safeEmit(gt.LIVE_STREAMING_ERROR,i,o)},n.onLiveStreamWarning=(i,o)=>{tt.reportApiInvoke(this._sessionId,{name:Ne.ON_LIVE_STREAM_WARNING,options:[i,o],tag:ae.TRACER}).onSuccess(),this.safeEmit(gt.LIVE_STREAMING_WARNING,i,o)},n.on($v.REQUEST_WORKER_MANAGER_LIST,(i,o,s)=>{if(!this._joinInfo)return s(new P(R.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(a,c,d,l){const u=A("UAP_AP").slice(0,A("AJAX_REQUEST_CONCURRENT")).map(h=>c.proxyServer?"https://".concat(c.proxyServer,"/ap/?url=").concat(h+"/api/v1?action=uap"):"https://".concat(h,"/api/v1?action=uap"));return await rtt(u,a,c,d,l)})(i,this._joinInfo,this._axiosCancelSource.token,we).then(o).catch(s)}),n};return t===zo.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||e(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||e(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new P(R.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:n}=this.getLocalVideoStats(),r=(t={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:e,height:n}},Yl("ChannelMediaRelay").create(t));r.on("state",i=>{i===$n.RELAY_STATE_FAILURE&&r&&r.dispose(),this.safeEmit(gt.CHANNEL_MEDIA_RELAY_STATE,i)}),r.on("event",i=>{this.safeEmit(gt.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=r,this._statsCollector.onStatsChanged=(i,o)=>{var s;i==="resolution"&&((s=this._channelMediaRelayClient)===null||s===void 0||s.setVideoProfile(o))}}var t;return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:r}=t,i=[];if(e){const o=[];this._users.forEach(s=>{s._dataChannels.forEach(a=>{n.every(c=>c.uid!==s._uintid||c.stream_id!==a.id)&&o.push({uid:s._uintid,stream_id:a.id,ordered:a.ordered,max_retrans_times:a.maxRetransmits,metadata:a.metadata})})}),o.length>0&&this._handleUpdateDataChannel({added:[],deleted:o})}Array.isArray(n)&&n.length>0&&n.forEach(o=>{const{uid:s,stream_id:a,ordered:c,max_retrans_times:d,metadata:l}=o,u=this._users.find(h=>h._uintid===s);if(!u)return void m.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(m.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(s)),$(i).call(i,u)||i.push(u),u._uintid||(u._uintid=s),u._dataChannels.findIndex(h=>h.id===o.stream_id)===-1){const h={id:a,ordered:!!c,maxRetransmits:d,metadata:l},p=function(S){return wD(S,!0)}(h);u._dataChannels.push(p),m.info("[".concat(this._clientId,"] remote user ").concat(u.uid," published datachannel")),e||this.safeEmit(gt.USER_PUBLISHED,u,"datachannel",h)}this._p2pChannel.hasPendingRemoteDataChannel(u,o.stream_id)&&(m.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(u.uid," after reconnect.")),this._subscribeDataChannel(u,o.stream_id).catch(h=>{m.error("[".concat(this._clientId,"] resubscribe datachannel error"),h.toString())}))}),e&&(this.safeEmit(gt.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(r)&&r.length>0&&r.forEach(o=>{const{uid:s,stream_id:a}=o,c=this._users.find(l=>l._uintid===s);if(!c)return void m.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const d=c._dataChannels.find(l=>l.id===o.stream_id);d&&(m.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(s)),this._p2pChannel.unsubscribeDataChannel(c,[d]).then(l=>{if(c._dataChannels=c._dataChannels.filter(u=>u!==d),l)return this._gateway.unsubscribeDataChannel(l,c.uid)}),m.info("[".concat(this._clientId,"] remote user ").concat(s," unpublished datachannel ,id:").concat(d.id)),this.safeEmit(gt.USER_UNPUBLISHED,c,"datachannel",d._config))})}_handleRemoveDataChannels(t){const e=this._users.find(n=>n.uid===t.uid);if(e){if(e._dataChannels!==void 0&&e._dataChannels.length>0){m.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{m.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach(r=>{this.safeEmit(gt.USER_UNPUBLISHED,e,"datachannel",r._config)})};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then(r=>{if(r)return this._gateway.unsubscribeDataChannel(r,e.uid)}),n()}}else m.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(en.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(en.CONNECTION_STATE_CHANGE,(t,e,n)=>{var r;if(n===kt.FALLBACK)return;const i=()=>{this.safeEmit(gt.CONNECTION_STATE_CHANGE,t,e,n)};if(tt.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Ne.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:ae.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),m.info("[".concat(this._clientId,"] connection state change: ").concat(e," -> ").concat(t)),t==="DISCONNECTED")return this._reset(),void i();if(t==="RECONNECTING")this._users.forEach(s=>{s._trust_in_room_=!1,s._trust_audio_enabled_state_=!1,s._trust_video_enabled_state_=!1,s._trust_audio_mute_state_=!1,s._trust_video_mute_state_=!1,s._trust_audio_stream_added_state_=!1,s._trust_video_stream_added_state_=!1,s._is_pre_created||(s._audio_pre_subscribed||(s._audioSSRC=void 0,s._audioOrtc=void 0),s._video_pre_subscribed||(s._videoSSRC=void 0,s._videoOrtc=void 0,s._rtxSsrcId=void 0),s._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(t==="CONNECTED"){var o;this._streamFallbackTypeCacheMap.forEach((s,a)=>{this._gateway.setStreamFallbackOption(a,s).catch(c=>{m.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),c)})}),this._remoteStreamTypeCacheMap.forEach((s,a)=>{this._gateway.setRemoteVideoStreamType(a,s).catch(c=>{m.warning("[".concat(this._clientId,"] auto set remote stream type failed"),c)})}),this._remoteDefaultVideoStreamType!==void 0&&((o=this._joinInfo)===null||o===void 0?void 0:o.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{m.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(s=>{m.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(s))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(s=>!s._trust_in_room_).forEach(s=>{m.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(s.uid)),this._handleUserOffline({uid:s.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(s=>{s._trust_audio_mute_state_||(m.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(s.uid)),this._handleMuteStream(s.uid,et.AUDIO,!1)),s._trust_video_mute_state_||(m.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(s.uid)),this._handleMuteStream(s.uid,et.VIDEO,!1)),s._trust_audio_enabled_state_||(m.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(s.uid)),this._handleSetStreamLocalEnable("audio",s.uid,!0)),s._trust_video_enabled_state_||(m.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(s.uid)),this._handleSetStreamLocalEnable("video",s.uid,!0)),s._trust_video_stream_added_state_||(m.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(s.uid)),this._handleResetAddStream(s,"video")),s._trust_audio_stream_added_state_||(m.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(s.uid)),this._handleResetAddStream(s,"audio")),s._video_added_||s._audio_added_||(m.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(s.uid)),this._handleRemoveStream({uid:s.uid,uint_id:s._uintid}))}))},1e3))}i()}),this._gateway.on(en.REQUEST_NEW_GATEWAY_LIST,async(t,e)=>{if(!this._joinInfo)return e(new P(R.UNEXPECTED_ERROR,"can not recover, no join info"));try{let n;const r=await PD(pi(pi({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));r?(n=r.ap,DD(r),this._joinInfo.preload=!0):(n=await oy(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||we,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip);const i=[];n.gatewayInfo.gatewayAddrs.forEach(o=>{let{address:s}=o;const[a,c]=s.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:a,port:c}):i.push({host:a,port:c})}),t(i)}catch(n){e(n)}}),this._gateway.on(en.NETWORK_QUALITY,t=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(gt.NETWORK_QUALITY,t)}),this._gateway.on(en.STREAM_TYPE_CHANGE,(t,e)=>{this.safeEmit(gt.STREAM_TYPE_CHANGED,t,e),tt.reportApiInvoke(this._sessionId,{name:Ne.STREAM_TYPE_CHANGE,options:[t,e],tag:ae.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))}),this._gateway.on(en.IS_P2P_DISCONNECTED,t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)}),this._gateway.on(en.REQUEST_P2P_CONNECTION_PARAMS,async(t,e,n)=>{try{let r=await this._p2pChannel.getEstablishParams();A("ENABLE_PREALLOC_PC")&&r||(r=await this._p2pChannel.startP2PConnection(t)),e(r)}catch(r){n(r)}}),this._gateway.on(en.JOIN_RESPONSE,(t,e)=>{if(this.store.useP2P)return;const n=OP(t.ortc,e,t.attributes.userAttributes.preSubSsrcs);this._p2pChannel.connect(n)}),this._gateway.on(en.PRE_CONNECT_PC,async t=>{const{candidates:e,fingerprint:n}=t;if(this._joinInfo&&e.length>0&&!this._p2pChannel.isPlanB){var r;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});const{cert:i,cid:o}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(i),icePwd:"".concat(o,"_").concat(i)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(r=A("FINGERPRINT"))!==null&&r!==void 0?r:n}]},candidates:e,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Et.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Et.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Et.ON_ADD_AUDIO_STREAM,t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc)),this._gateway.signal.on(Et.ON_ADD_VIDEO_STREAM,t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId)),this._gateway.signal.on(Et.ON_REMOTE_DATASTREAM_UPDATE,t=>{this._handleUpdateDataChannel(t)}),this._gateway.signal.on(Et.ON_REMOTE_FULL_DATASTREAM_INFO,t=>{this._handleUpdateDataChannel({added:t.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Et.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Et.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Et.MUTE_AUDIO,t=>this._handleMuteStream(t.uid,et.AUDIO,!0)),this._gateway.signal.on(Et.UNMUTE_AUDIO,t=>this._handleMuteStream(t.uid,et.AUDIO,!1)),this._gateway.signal.on(Et.MUTE_VIDEO,t=>this._handleMuteStream(t.uid,et.VIDEO,!0)),this._gateway.signal.on(Et.UNMUTE_VIDEO,t=>this._handleMuteStream(t.uid,et.VIDEO,!1)),this._gateway.signal.on(Et.RECEIVE_METADATA,t=>{const e=La(t.metadata);this.safeEmit(gt.RECEIVE_METADATA,t.uid,e)}),this._gateway.signal.on(Et.ON_DATA_STREAM,async t=>{var e;if(!t)return;let n=La(t.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&$(e=["aes-128-gcm2","aes-256-gcm2"]).call(e,this._encryptionMode)){if(t.payload.length<yc)throw new P(R.UNEXPECTED_RESPONSE,"payload length ".concat(t.payload.length," is less than header length ").concat(yc));n=await async function(o,s,a){const c=a.subarray(0,yc),d=c.slice(8,yc),l=(d[0]<<8)+d[1],u=(c[6]<<8)+c[7],h=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o,tagLength:rb,additionalData:new Uint8Array(eb(l,2))},s,a.subarray(yc));return new Uint8Array(h).subarray(0,u)}(this._encryptDataStreamIv,this._encryptDataStreamKey,n)}let r=0;if(t.ordered||t.syncWithAudio){const i=this._p2pChannel.getStats(),o=this.remoteUsers.find(a=>a.uid===t.uid),s=i==null?void 0:i.audioRecv.find(a=>a.ssrc===(o==null?void 0:o._audioSSRC));r=s==null?void 0:s.jitterBufferMs}r==null&&(r=0),Ntt(pi(pi({},t),{},{payload:n}),r,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Et.ON_CRYPT_ERROR,()=>{Qs(()=>{m.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(gt.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Et.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Et.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{m.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,kt.TOKEN_EXPIRE),this.safeEmit(gt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Et.ON_STREAM_FALLBACK_UPDATE,t=>{m.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(gt.STREAM_FALLBACK,t.stream_id,t.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Et.ON_PUBLISH_STREAM,t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),m.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))}),this._gateway.signal.on(Et.ENABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)}),this._gateway.signal.on(Et.DISABLE_LOCAL_VIDEO,t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)}),this._gateway.signal.on(at.REQUEST_TIMEOUT,(t,e)=>{if(this._joinInfo)switch(t){case st.PUBLISH:{if(!e)return;const i=e.ortc;if(i){var n,r;const o=i.some(c=>{let{stream_type:d}=c;return d===Nt.Audio}),s=i.some(c=>{let{stream_type:d}=c;return d!==Nt.Audio}),a=i.some(c=>{let{stream_type:d}=c;return d===Nt.Screen||d===Nt.ScreenLow});e.state==="offer"&&tt.publish(this._joinInfo.sid,{eventElapse:un.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:R.TIMEOUT,audio:o,video:s,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:a,audioName:o?(n=i.find(c=>{let{stream_type:d}=c;return d===Nt.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0,videoName:s?(r=i.find(c=>{let{stream_type:d}=c;return d!==Nt.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0})}break}case st.SUBSCRIBE:e&&tt.subscribe(this._joinInfo.sid,{succ:!1,ec:R.TIMEOUT,audio:e.stream_type===et.AUDIO,video:e.stream_type===et.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:un.measureFromSubscribeStart(this.store.clientId,e.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(e.ssrcId)})}}),this._gateway.signal.on(Et.ON_P2P_OK,t=>{this.uid,this._uid}),this._gateway.signal.on(Et.ON_PUBLISHED_USER_LIST,t=>{if(t==null||!t.users)return;A("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter(r=>!la(r.string_id||r.stream_id,this.channelName)));const e=[],n=[];for(const r of t.users){let i=this._users.find(l=>l._uintid===r.stream_id);i?i._trust_in_room_=!0:(i=new Rs(r.string_id||r.stream_id,r.stream_id),this._users.push(i),this.getListeners(gt.PUBLISHED_USER_LIST).length===0&&(m.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(gt.USER_JOINED,i)));const o=xe.Audio&r.stream_type,s=(xe.Video|xe.LwoVideo)&r.stream_type,a=(65280&r.stream_type)!=0,c=o&&i.hasAudio,d=s&&i.hasVideo;s&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=r.video_ssrc,i._rtxSsrcId=r.video_rtx),o&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=r.audio_ssrc),o&&!c&&this.getListeners(gt.PUBLISHED_USER_LIST).length===0&&(m.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(gt.USER_PUBLISHED,i,"audio")),s&&!d&&this.getListeners(gt.PUBLISHED_USER_LIST).length===0&&(m.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(gt.USER_PUBLISHED,i,"video")),(o&&!c||s&&!d||a)&&e.push(i),s&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&n.push({user:i,mediaType:"video"}),o&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&n.push({user:i,mediaType:"audio"})}n.length>0&&(m.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{m.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(gt.PUBLISHED_USER_LIST).length>0?A("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(m.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map(r=>r.uid).join(", "))),this.safeEmit(gt.PUBLISHED_USER_LIST,e)):m.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map(r=>r.uid).join(", ")))}),this._gateway.signal.on(Et.ON_RTP_CAPABILITY_CHANGE,t=>{const{video_codec:e}=t;this._p2pChannel instanceof Bp&&this._p2pChannel.updateRemoteRTPCapabilities(e.map(n=>n.toLowerCase()).filter(n=>{var r;return $(r=Object.keys(G_)).call(r,n)}))})}_handleP2PEvents(){this._gateway.signal.on(Et.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(me.PUBLISH,(t,e,n)=>{const{uid:r}=t;t.forEach(i=>{const{kind:o,ssrcs:s,mid:a,isMuted:c}=i;this._handleP2PAddAudioOrVideoStream(o,r,s[0].ssrcId,a);const d=this._users.find(l=>l.uid===r);return d&&this._p2pChannel instanceof nr?this._p2pChannel.mockSubscribe(d,o,s[0].ssrcId,a).then(()=>{e()}).catch(n):e(),this._handleMuteStream(r,o,!!c)})}),this._gateway.signal.on(me.CALL,async(t,e,n)=>{if(this._p2pChannel instanceof nr)try{var r;e(await this._p2pChannel.startP2P({turnServer:(r=this._joinInfo)===null||r===void 0?void 0:r.turnServer},t))}catch(i){n(i)}}),this._gateway.signal.on(at.P2P_CONNECTION,async t=>{this._p2pChannel instanceof nr&&await this._p2pChannel.p2pConnect(t)}),this._gateway.signal.on(me.UNPUBLISH,async(t,e,n)=>{if(this._p2pChannel instanceof nr){const{unpubMsg:r,uid:i}=t,o=this._users.find(s=>s.uid===i);if(!o)return m.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void e();try{r.forEach(async s=>{let{stream_type:a}=s;const c=a===Nt.Audio?et.AUDIO:et.VIDEO;await this._p2pChannel.unsubscribe(o,c),this._handleMuteStream(i,c,!0)}),e()}catch(s){n(s)}}}),this._gateway.signal.on(me.CONTROL,async(t,e)=>{const{action:n}=t;switch(n){case Ns.MUTE_LOCAL_VIDEO:this._handleMuteStream(e,et.VIDEO,!0);break;case Ns.MUTE_LOCAL_AUDIO:this._handleMuteStream(e,et.AUDIO,!0);break;case Ns.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",e),this._handleMuteStream(e,et.VIDEO,!1);break;case Ns.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",e),this._handleMuteStream(e,et.AUDIO,!1)}}),this._gateway.signal.on(me.RESTART_ICE,async(t,e,n)=>{if(this._p2pChannel instanceof nr)try{const{direction:r,iceParameter:i}=t;r!==Nn.SEND_ONLY||i?e(await this._p2pChannel.restartICE(r,i)):(this._p2pChannel.handleDisconnect(r),e())}catch(r){n(r)}}),this._gateway.signal.on(me.CANDIDATE,t=>{if(this._p2pChannel instanceof nr){const{candidate:e,direction:n}=t;this._p2pChannel.addRemoteCandidate(e,n)}}),this._p2pChannel.on(ot.RequestP2PRestartICE,async(t,e,n)=>{try{const{direction:r}=t;e(await this._gateway.sendExtensionMessage(me.RESTART_ICE,t,r===Nn.SEND_ONLY))}catch(r){n(r)}}),this._p2pChannel.on(ot.LocalCandidate,t=>{this._gateway.sendExtensionMessage(me.CANDIDATE,JSON.stringify(t),!0)}),this._p2pChannel.on(ot.RequestP2PMuteLocal,async(t,e,n)=>{try{await this._gateway.sendExtensionMessage(me.CONTROL,t,!0),e()}catch(r){n(r)}}),this._p2pChannel.on(ot.RequestP2PUnmuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===R.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(ot.RequestP2PMuteRemote,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===R.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(ot.StateChange,(t,e)=>{e===bt.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(ot.RequestMuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===R.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(ot.RequestUnmuteLocal,async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(r){r.code===R.DISCONNECT_P2P?e():n(r)}else e()}),this._p2pChannel.on(ot.RequestRePublish,(t,e,n)=>{this.publish(t,!1).then(e).catch(n)}),this._p2pChannel.on(ot.RequestRePublishDataChannel,(t,e,n)=>{Y.all(t.map(async r=>{const i=await this._p2pChannel.publishDataChannel([r]);try{i.forEach(o=>{this._uid&&this._gateway.publishDataChannel(this._uid,o,!0)})}catch(o){if(o.code!==R.DISCONNECT_P2P)throw o}})).then(e).catch(n)}),this._p2pChannel.on(ot.RequestReSubscribe,async(t,e,n)=>{try{for(const{user:r,kind:i}of t)i===et.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");e()}catch(r){n(r)}}),this._p2pChannel.on(ot.RequestUpload,(t,e)=>{this._gateway.upload(t,e)}),this._p2pChannel.on(ot.RequestUploadStats,t=>{this._gateway.uploadWRTCStats(t)}),this._p2pChannel.on(ot.MediaReconnectStart,t=>{this.safeEmit(gt.MEDIA_RECONNECT_START,t)}),this._p2pChannel.on(ot.MediaReconnectEnd,t=>{this.safeEmit(gt.MEDIA_RECONNECT_END,t)}),this._p2pChannel.on(ot.NeedSignalRTT,t=>{t(this._gateway.getSignalRTT())}),this._p2pChannel.on(ot.RequestRestartICE,async t=>{if(this._p2pChannel instanceof nr)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(s){return void e.throw(s)}const{iceParameters:o}=function(s){const a=s.iceParameters;return{iceParameters:{iceUfrag:a.iceUfrag,icePwd:a.icePwd}}}(i);await e.next({remoteIceParameters:o})}),this._p2pChannel.on(ot.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(ot.RequestReconnectPC,async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(t=this._joinInfo)===null||t===void 0?void 0:t.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:r}),s=OP(i,o);await this._p2pChannel.connect(s),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(ot.RequestUnpublishForReconnectPC,async(t,e,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(t,this._uid),e()):n()}),this._p2pChannel.on(ot.P2PLost,()=>{this.safeEmit(gt.P2P_LOST,this.store.uid)}),this._p2pChannel.on(ot.UpdateVideoEncoder,t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)}),this._p2pChannel.on(ot.ConnectionTypeChange,t=>{this.safeEmit(gt.IS_USING_CLOUD_PROXY,t)}),this._p2pChannel.on(ot.RequestLowStreamParameter,t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(ot.QueryClientConnectionState,t=>{t(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new P(R.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new P(R.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const n=(e={config:t},Yl("ContentInspect").create(e));this._inspect=n,this.handleVideoInspectEvents(n);const{appId:r,cname:i,sid:o,token:s,uid:a,cid:c,vid:d}=this._joinInfo;await n.init({appId:r,areaCode:"",cname:i,sid:o,token:s,uid:a,cid:c,vid:d?Number(d):0},we)}catch(n){throw Array.isArray(n)?n[0]:n}var e}handleVideoInspectEvents(t){t.on(Be.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(gt.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===di.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(gt.CONTENT_INSPECT_ERROR,new P(R.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}}),t.on(Be.INSPECT_RESULT,(e,n)=>{var r;if((n==null?void 0:n.code)===R.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return m.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.safeEmit(gt.CONTENT_INSPECT_RESULT,e,n)}),t.on(Be.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new P(R.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Wo(t,"enabled"),t){if(!e)throw new P(R.INVALID_PARAMS,"config is required");if(MF(e),!this._joinInfo)throw new P(R.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(e);else{const r=(n={config:e},Yl("ImageModeration").create(n));this._moderation=r,this.handleImageModerationEvents(r);const{appId:i,cname:o,sid:s,token:a,uid:c,cid:d,vid:l}=this._joinInfo;await r.init({appId:i,areaCode:"",cname:o,sid:s,token:a,uid:c,cid:d,vid:l?Number(l):0},we)}}catch(r){throw Array.isArray(r)?r[0]:r}}else{var n;if(!this._moderation)throw new P(R.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(r){throw Array.isArray(r)?r[0]:r}}}handleImageModerationEvents(t){t.on(Mi.CONNECTION_STATE_CHANGE,(e,n)=>{if(this.safeEmit(gt.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===Ur.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new P(R.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}}),t.on(Mi.CLIENT_LOCAL_VIDEO_TRACK,e=>{e(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}setP2PTransport(t){if(function(e){De(e,"transport",["default","auto","relay","sd-rtn"])}(t),this.mode!=="p2p")throw new P(R.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=t,m.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(t))}getJoinChannelServiceRecords(){return m.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Wo(t,"enabled"),xt("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}},X(q.prototype,"leave",[BD],Object.getOwnPropertyDescriptor(q.prototype,"leave"),q.prototype),X(q.prototype,"publish",[GD],Object.getOwnPropertyDescriptor(q.prototype,"publish"),q.prototype),X(q.prototype,"unpublish",[WD],Object.getOwnPropertyDescriptor(q.prototype,"unpublish"),q.prototype),X(q.prototype,"subscribe",[HD],Object.getOwnPropertyDescriptor(q.prototype,"subscribe"),q.prototype),X(q.prototype,"presubscribe",[KD],Object.getOwnPropertyDescriptor(q.prototype,"presubscribe"),q.prototype),X(q.prototype,"massSubscribe",[zD],Object.getOwnPropertyDescriptor(q.prototype,"massSubscribe"),q.prototype),X(q.prototype,"unsubscribe",[YD],Object.getOwnPropertyDescriptor(q.prototype,"unsubscribe"),q.prototype),X(q.prototype,"massUnsubscribe",[$D],Object.getOwnPropertyDescriptor(q.prototype,"massUnsubscribe"),q.prototype),X(q.prototype,"setLowStreamParameter",[qD],Object.getOwnPropertyDescriptor(q.prototype,"setLowStreamParameter"),q.prototype),X(q.prototype,"enableDualStream",[JD],Object.getOwnPropertyDescriptor(q.prototype,"enableDualStream"),q.prototype),X(q.prototype,"disableDualStream",[XD],Object.getOwnPropertyDescriptor(q.prototype,"disableDualStream"),q.prototype),X(q.prototype,"setClientRole",[QD],Object.getOwnPropertyDescriptor(q.prototype,"setClientRole"),q.prototype),X(q.prototype,"setProxyServer",[ZD],Object.getOwnPropertyDescriptor(q.prototype,"setProxyServer"),q.prototype),X(q.prototype,"setTurnServer",[t1],Object.getOwnPropertyDescriptor(q.prototype,"setTurnServer"),q.prototype),X(q.prototype,"setLicense",[e1],Object.getOwnPropertyDescriptor(q.prototype,"setLicense"),q.prototype),X(q.prototype,"startProxyServer",[n1],Object.getOwnPropertyDescriptor(q.prototype,"startProxyServer"),q.prototype),X(q.prototype,"stopProxyServer",[r1],Object.getOwnPropertyDescriptor(q.prototype,"stopProxyServer"),q.prototype),X(q.prototype,"setLocalAccessPointsV2",[i1],Object.getOwnPropertyDescriptor(q.prototype,"setLocalAccessPointsV2"),q.prototype),X(q.prototype,"setLocalAccessPoints",[o1],Object.getOwnPropertyDescriptor(q.prototype,"setLocalAccessPoints"),q.prototype),X(q.prototype,"setRemoteDefaultVideoStreamType",[s1],Object.getOwnPropertyDescriptor(q.prototype,"setRemoteDefaultVideoStreamType"),q.prototype),X(q.prototype,"setRemoteVideoStreamType",[a1],Object.getOwnPropertyDescriptor(q.prototype,"setRemoteVideoStreamType"),q.prototype),X(q.prototype,"setStreamFallbackOption",[c1],Object.getOwnPropertyDescriptor(q.prototype,"setStreamFallbackOption"),q.prototype),X(q.prototype,"setEncryptionConfig",[d1],Object.getOwnPropertyDescriptor(q.prototype,"setEncryptionConfig"),q.prototype),X(q.prototype,"renewToken",[l1],Object.getOwnPropertyDescriptor(q.prototype,"renewToken"),q.prototype),X(q.prototype,"enableAudioVolumeIndicator",[u1],Object.getOwnPropertyDescriptor(q.prototype,"enableAudioVolumeIndicator"),q.prototype),X(q.prototype,"startLiveStreaming",[h1],Object.getOwnPropertyDescriptor(q.prototype,"startLiveStreaming"),q.prototype),X(q.prototype,"setLiveTranscoding",[p1],Object.getOwnPropertyDescriptor(q.prototype,"setLiveTranscoding"),q.prototype),X(q.prototype,"stopLiveStreaming",[f1],Object.getOwnPropertyDescriptor(q.prototype,"stopLiveStreaming"),q.prototype),X(q.prototype,"startChannelMediaRelay",[m1],Object.getOwnPropertyDescriptor(q.prototype,"startChannelMediaRelay"),q.prototype),X(q.prototype,"updateChannelMediaRelay",[_1],Object.getOwnPropertyDescriptor(q.prototype,"updateChannelMediaRelay"),q.prototype),X(q.prototype,"stopChannelMediaRelay",[E1],Object.getOwnPropertyDescriptor(q.prototype,"stopChannelMediaRelay"),q.prototype),X(q.prototype,"sendCustomReportMessage",[g1],Object.getOwnPropertyDescriptor(q.prototype,"sendCustomReportMessage"),q.prototype),X(q.prototype,"pickSVCLayer",[S1],Object.getOwnPropertyDescriptor(q.prototype,"pickSVCLayer"),q.prototype),X(q.prototype,"setRTMConfig",[T1],Object.getOwnPropertyDescriptor(q.prototype,"setRTMConfig"),q.prototype),X(q.prototype,"enableContentInspect",[v1],Object.getOwnPropertyDescriptor(q.prototype,"enableContentInspect"),q.prototype),X(q.prototype,"disableContentInspect",[y1],Object.getOwnPropertyDescriptor(q.prototype,"disableContentInspect"),q.prototype),X(q.prototype,"setImageModeration",[R1],Object.getOwnPropertyDescriptor(q.prototype,"setImageModeration"),q.prototype),X(q.prototype,"setP2PTransport",[C1],Object.getOwnPropertyDescriptor(q.prototype,"setP2PTransport"),q.prototype),X(q.prototype,"getJoinChannelServiceRecords",[I1],Object.getOwnPropertyDescriptor(q.prototype,"getJoinChannelServiceRecords"),q.prototype),X(q.prototype,"setPublishAudioFilterEnabled",[w1],Object.getOwnPropertyDescriptor(q.prototype,"setPublishAudioFilterEnabled"),q.prototype),q);class sh{constructor(e,n){v(this,"id",0),v(this,"element",void 0),v(this,"peerPair",void 0),v(this,"context",void 0),v(this,"audioPlayerElement",void 0),v(this,"audioTrack",void 0),sh.count+=1,this.id=sh.count,this.element=e,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const n=document.createElement("audio");n.srcObject=new MediaStream([e.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const e=async(r,i)=>{const o=i==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(o),r.iceGatheringState==="complete"?r.localDescription:new Y(s=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&s(r.localDescription)}})},n=async(r,i)=>await r.setRemoteDescription(i);try{const r=await e(this.peerPair[0],"offer");await n(this.peerPair[1],r);const i=await e(this.peerPair[1],"answer");await n(this.peerPair[0],i)}catch(r){throw new P(R.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let n;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(n)}catch(i){throw new P(R.LOCAL_AEC_ERROR,i.toString()).print()}if(!n)throw new P(R.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,n=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){m.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(e=>{e.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var O1,Wp;v(sh,"count",0);const Ytt=window.AudioContext||window.webkitAudioContext,$tt=new(O1=it({report:tt}),X((Wp=class{constructor(){v(this,"units",[]),v(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return m.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Ytt);let e=this.units.find(n=>n&&n.getElement()===t);return e||(e=new sh(t,this.context),this.units.push(e)),e.startEchoCancellation(),m.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return It().name!==Pt.SAFARI}}).prototype,"processExternalMediaAEC",[O1],Object.getOwnPropertyDescriptor(Wp.prototype,"processExternalMediaAEC"),Wp.prototype),Wp);function b1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function N1(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?b1(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b1(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const kS=window||document;function UF(t){let e=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!kS)return;const n=he._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const r=i=>{if(!(i&&i.blockedURI&&(he.onSecurityPolicyViolation||he.getListeners(ho.SECURITY_POLICY_VIOLATION).length>0)))return;const o=i.blockedURI;A("CSP_DETECTED_HOSTNAME_LIST").some(s=>$(o).call(o,s))&&(he.onSecurityPolicyViolation&&typeof he.onSecurityPolicyViolation=="function"&&he.onSecurityPolicyViolation(i),he.getListeners(ho.SECURITY_POLICY_VIOLATION).length>0&&he.safeEmit(ho.SECURITY_POLICY_VIOLATION,i))};n&&kS.removeEventListener("securitypolicyviolation",n),(e||t&&typeof t=="function"||he.getListeners(ho.SECURITY_POLICY_VIOLATION).length>0)&&kS.addEventListener("securitypolicyviolation",r),he._cspEventHandlerPointer=r}var qtt=Mn,Jtt=xx,P1=RegExp.prototype,Xtt=function(t){return t===P1||qtt(P1,t)?Jtt(t):t.flags},vn=de(Xtt);function cl(t){let e=t.length;for(;--e>=0;)t[e]=0}const OC=256,xF=286,pu=30,fu=15,ly=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Vf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Qtt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),D1=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Bo=new Array(576);cl(Bo);const mu=new Array(60);cl(mu);const ah=new Array(512);cl(ah);const ch=new Array(256);cl(ch);const bC=new Array(29);cl(bC);const Wm=new Array(pu);function LS(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let k1,L1,M1;function MS(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}cl(Wm);const VF=t=>t<256?ah[t]:ah[256+(t>>>7)],dh=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},Tr=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,dh(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},po=(t,e,n)=>{Tr(t,n[2*e],n[2*e+1])},FF=(t,e)=>{let n=0;do n|=1&t,t>>>=1,n<<=1;while(--e>0);return n>>>1},jF=(t,e,n)=>{const r=new Array(16);let i,o,s=0;for(i=1;i<=fu;i++)s=s+n[i-1]<<1,r[i]=s;for(o=0;o<=e;o++){let a=t[2*o+1];a!==0&&(t[2*o]=FF(r[a]++,a))}},BF=t=>{let e;for(e=0;e<xF;e++)t.dyn_ltree[2*e]=0;for(e=0;e<pu;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},GF=t=>{t.bi_valid>8?dh(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},U1=(t,e,n,r)=>{const i=2*e,o=2*n;return t[i]<t[o]||t[i]===t[o]&&r[e]<=r[n]},US=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&U1(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!U1(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},x1=(t,e,n)=>{let r,i,o,s,a=0;if(t.sym_next!==0)do r=255&t.pending_buf[t.sym_buf+a++],r+=(255&t.pending_buf[t.sym_buf+a++])<<8,i=t.pending_buf[t.sym_buf+a++],r===0?po(t,i,e):(o=ch[i],po(t,o+OC+1,e),s=ly[o],s!==0&&(i-=bC[o],Tr(t,i,s)),r--,o=VF(r),po(t,o,n),s=Vf[o],s!==0&&(r-=Wm[o],Tr(t,r,s)));while(a<t.sym_next);po(t,256,e)},xS=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.elems;let s,a,c,d=-1;for(t.heap_len=0,t.heap_max=573,s=0;s<o;s++)n[2*s]!==0?(t.heap[++t.heap_len]=d=s,t.depth[s]=0):n[2*s+1]=0;for(;t.heap_len<2;)c=t.heap[++t.heap_len]=d<2?++d:0,n[2*c]=1,t.depth[c]=0,t.opt_len--,i&&(t.static_len-=r[2*c+1]);for(e.max_code=d,s=t.heap_len>>1;s>=1;s--)US(t,n,s);c=o;do s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],US(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=a,n[2*c]=n[2*s]+n[2*a],t.depth[c]=(t.depth[s]>=t.depth[a]?t.depth[s]:t.depth[a])+1,n[2*s+1]=n[2*a+1]=c,t.heap[1]=c++,US(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((l,u)=>{const h=u.dyn_tree,p=u.max_code,S=u.stat_desc.static_tree,f=u.stat_desc.has_stree,_=u.stat_desc.extra_bits,T=u.stat_desc.extra_base,g=u.stat_desc.max_length;let y,I,O,b,N,U,V=0;for(b=0;b<=fu;b++)l.bl_count[b]=0;for(h[2*l.heap[l.heap_max]+1]=0,y=l.heap_max+1;y<573;y++)I=l.heap[y],b=h[2*h[2*I+1]+1]+1,b>g&&(b=g,V++),h[2*I+1]=b,I>p||(l.bl_count[b]++,N=0,I>=T&&(N=_[I-T]),U=h[2*I],l.opt_len+=U*(b+N),f&&(l.static_len+=U*(S[2*I+1]+N)));if(V!==0){do{for(b=g-1;l.bl_count[b]===0;)b--;l.bl_count[b]--,l.bl_count[b+1]+=2,l.bl_count[g]--,V-=2}while(V>0);for(b=g;b!==0;b--)for(I=l.bl_count[b];I!==0;)O=l.heap[--y],O>p||(h[2*O+1]!==b&&(l.opt_len+=(b-h[2*O+1])*h[2*O],h[2*O+1]=b),I--)}})(t,e),jF(n,d,t.bl_count)},V1=(t,e,n)=>{let r,i,o=-1,s=e[1],a=0,c=7,d=4;for(s===0&&(c=138,d=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=s,s=e[2*(r+1)+1],++a<c&&i===s||(a<d?t.bl_tree[2*i]+=a:i!==0?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,o=i,s===0?(c=138,d=3):i===s?(c=6,d=3):(c=7,d=4))},F1=(t,e,n)=>{let r,i,o=-1,s=e[1],a=0,c=7,d=4;for(s===0&&(c=138,d=3),r=0;r<=n;r++)if(i=s,s=e[2*(r+1)+1],!(++a<c&&i===s)){if(a<d)do po(t,i,t.bl_tree);while(--a!=0);else i!==0?(i!==o&&(po(t,i,t.bl_tree),a--),po(t,16,t.bl_tree),Tr(t,a-3,2)):a<=10?(po(t,17,t.bl_tree),Tr(t,a-3,3)):(po(t,18,t.bl_tree),Tr(t,a-11,7));a=0,o=i,s===0?(c=138,d=3):i===s?(c=6,d=3):(c=7,d=4)}};let j1=!1;const WF=(t,e,n,r)=>{Tr(t,0+(r?1:0),3),GF(t),dh(t,n),dh(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var Ztt=t=>{j1||((()=>{let e,n,r,i,o;const s=new Array(16);for(r=0,i=0;i<28;i++)for(bC[i]=r,e=0;e<1<<ly[i];e++)ch[r++]=i;for(ch[r-1]=i,o=0,i=0;i<16;i++)for(Wm[i]=o,e=0;e<1<<Vf[i];e++)ah[o++]=i;for(o>>=7;i<pu;i++)for(Wm[i]=o<<7,e=0;e<1<<Vf[i]-7;e++)ah[256+o++]=i;for(n=0;n<=fu;n++)s[n]=0;for(e=0;e<=143;)Bo[2*e+1]=8,e++,s[8]++;for(;e<=255;)Bo[2*e+1]=9,e++,s[9]++;for(;e<=279;)Bo[2*e+1]=7,e++,s[7]++;for(;e<=287;)Bo[2*e+1]=8,e++,s[8]++;for(jF(Bo,287,s),e=0;e<pu;e++)mu[2*e+1]=5,mu[2*e]=FF(e,5);k1=new LS(Bo,ly,257,xF,fu),L1=new LS(mu,Vf,0,pu,fu),M1=new LS(new Array(0),Qtt,0,19,7)})(),j1=!0),t.l_desc=new MS(t.dyn_ltree,k1),t.d_desc=new MS(t.dyn_dtree,L1),t.bl_desc=new MS(t.bl_tree,M1),t.bi_buf=0,t.bi_valid=0,BF(t)},tet=(t,e,n,r)=>{let i,o,s=0;t.level>0?(t.strm.data_type===2&&(t.strm.data_type=(a=>{let c,d=4093624447;for(c=0;c<=31;c++,d>>>=1)if(1&d&&a.dyn_ltree[2*c]!==0)return 0;if(a.dyn_ltree[18]!==0||a.dyn_ltree[20]!==0||a.dyn_ltree[26]!==0)return 1;for(c=32;c<OC;c++)if(a.dyn_ltree[2*c]!==0)return 1;return 0})(t)),xS(t,t.l_desc),xS(t,t.d_desc),s=(a=>{let c;for(V1(a,a.dyn_ltree,a.l_desc.max_code),V1(a,a.dyn_dtree,a.d_desc.max_code),xS(a,a.bl_desc),c=18;c>=3&&a.bl_tree[2*D1[c]+1]===0;c--);return a.opt_len+=3*(c+1)+5+5+4,c})(t),i=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=i&&(i=o)):i=o=n+5,n+4<=i&&e!==-1?WF(t,e,n,r):t.strategy===4||o===i?(Tr(t,2+(r?1:0),3),x1(t,Bo,mu)):(Tr(t,4+(r?1:0),3),((a,c,d,l)=>{let u;for(Tr(a,c-257,5),Tr(a,d-1,5),Tr(a,l-4,4),u=0;u<l;u++)Tr(a,a.bl_tree[2*D1[u]+1],3);F1(a,a.dyn_ltree,c-1),F1(a,a.dyn_dtree,d-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,s+1),x1(t,t.dyn_ltree,t.dyn_dtree)),BF(t),r&&GF(t)},eet=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,e===0?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(ch[n]+OC+1)]++,t.dyn_dtree[2*VF(e)]++),t.sym_next===t.sym_end),net=t=>{Tr(t,2,3),po(t,256,Bo),(e=>{e.bi_valid===16?(dh(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(t)},ret={_tr_init:Ztt,_tr_stored_block:WF,_tr_flush_block:tet,_tr_tally:eet,_tr_align:net},lh=(t,e,n,r)=>{let i=65535&t|0,o=t>>>16&65535|0,s=0;for(;n!==0;){s=n>2e3?2e3:n,n-=s;do i=i+e[r++]|0,o=o+i|0;while(--s);i%=65521,o%=65521}return i|o<<16|0};const iet=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var On=(t,e,n,r)=>{const i=iet,o=r+n;t^=-1;for(let s=r;s<o;s++)t=t>>>8^i[255&(t^e[s])];return-1^t},ic={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},dl={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:oet,_tr_stored_block:uy,_tr_flush_block:set,_tr_tally:Ks,_tr_align:aet}=ret,{Z_NO_FLUSH:zs,Z_PARTIAL_FLUSH:cet,Z_FULL_FLUSH:det,Z_FINISH:gi,Z_BLOCK:B1,Z_OK:Vn,Z_STREAM_END:G1,Z_STREAM_ERROR:So,Z_DATA_ERROR:uet,Z_BUF_ERROR:VS,Z_DEFAULT_COMPRESSION:het,Z_FILTERED:pet,Z_HUFFMAN_ONLY:Hp,Z_RLE:fet,Z_FIXED:met,Z_DEFAULT_STRATEGY:_et,Z_UNKNOWN:Eet,Z_DEFLATED:Y_}=dl,hy=286,get=30,Tet=19,vet=2*hy+1,yet=15,Ua=258,To=262,jd=42,xa=113,ql=666,Va=(t,e)=>(t.msg=ic[e],e),W1=t=>2*t-(t>4?9:0),Cs=t=>{let e=t.length;for(;--e>=0;)t[e]=0},Ret=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do n=t.head[--r],t.head[r]=n>=i?n-i:0;while(--e);e=i,r=e;do n=t.prev[--r],t.prev[r]=n>=i?n-i:0;while(--e)};let Ys=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const Vr=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},Br=(t,e)=>{set(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Vr(t.strm)},le=(t,e)=>{t.pending_buf[t.pending++]=e},Dl=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},py=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=lh(t.adler,e,i,n):t.state.wrap===2&&(t.adler=On(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},HF=(t,e)=>{let n,r,i=t.max_chain_length,o=t.strstart,s=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-To?t.strstart-(t.w_size-To):0,d=t.window,l=t.w_mask,u=t.prev,h=t.strstart+Ua;let p=d[o+s-1],S=d[o+s];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do if(n=e,d[n+s]===S&&d[n+s-1]===p&&d[n]===d[o]&&d[++n]===d[o+1]){o+=2,n++;do;while(d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&o<h);if(r=Ua-(h-o),o=h-Ua,r>s){if(t.match_start=e,s=r,r>=a)break;p=d[o+s-1],S=d[o+s]}}while((e=u[e&l])>c&&--i!=0);return s<=t.lookahead?s:t.lookahead},Bd=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-To)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),Ret(t),r+=e),t.strm.avail_in===0)break;if(n=py(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=Ys(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=Ys(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<To&&t.strm.avail_in!==0)},KF=(t,e)=>{let n,r,i,o=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,s=0,a=t.strm.avail_in;do{if(n=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i||(i=t.strm.avail_out-i,r=t.strstart-t.block_start,n>r+t.strm.avail_in&&(n=r+t.strm.avail_in),n>i&&(n=i),n<o&&(n===0&&e!==gi||e===zs||n!==r+t.strm.avail_in)))break;s=e===gi&&n===r+t.strm.avail_in?1:0,uy(t,0,0,s),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,Vr(t.strm),r&&(r>n&&(r=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+r),t.strm.next_out),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r,t.block_start+=r,n-=r),n&&(py(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(s===0);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),s?4:e!==zs&&e!==gi&&t.strm.avail_in===0&&t.strstart===t.block_start?2:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(py(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,o=i>t.w_size?t.w_size:i,r=t.strstart-t.block_start,(r>=o||(r||e===gi)&&e!==zs&&t.strm.avail_in===0&&r<=i)&&(n=r>i?i:r,s=e===gi&&t.strm.avail_in===0&&n===r?1:0,uy(t,t.block_start,n,s),t.block_start+=n,Vr(t.strm)),s?3:1)},FS=(t,e)=>{let n,r;for(;;){if(t.lookahead<To){if(Bd(t),t.lookahead<To&&e===zs)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=Ys(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-To&&(t.match_length=HF(t,n)),t.match_length>=3)if(r=Ks(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do t.strstart++,t.ins_h=Ys(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Ys(t,t.ins_h,t.window[t.strstart+1]);else r=Ks(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Br(t,!1),t.strm.avail_out===0))return 1}return t.insert=t.strstart<2?t.strstart:2,e===gi?(Br(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Br(t,!1),t.strm.avail_out===0)?1:2},Dc=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<To){if(Bd(t),t.lookahead<To&&e===zs)return 1;if(t.lookahead===0)break}if(n=0,t.lookahead>=3&&(t.ins_h=Ys(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-To&&(t.match_length=HF(t,n),t.match_length<=5&&(t.strategy===pet||t.match_length===3&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,r=Ks(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=Ys(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(Br(t,!1),t.strm.avail_out===0))return 1}else if(t.match_available){if(r=Ks(t,0,t.window[t.strstart-1]),r&&Br(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Ks(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===gi?(Br(t,!0),t.strm.avail_out===0?3:4):t.sym_next&&(Br(t,!1),t.strm.avail_out===0)?1:2};function ao(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const Jl=[new ao(0,0,0,0,KF),new ao(4,4,8,4,FS),new ao(4,5,16,8,FS),new ao(4,6,32,32,FS),new ao(4,4,16,16,Dc),new ao(8,16,32,32,Dc),new ao(8,16,128,128,Dc),new ao(8,32,128,256,Dc),new ao(32,128,258,1024,Dc),new ao(32,258,258,4096,Dc)];function Cet(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Y_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*vet),this.dyn_dtree=new Uint16Array(2*(2*get+1)),this.bl_tree=new Uint16Array(2*(2*Tet+1)),Cs(this.dyn_ltree),Cs(this.dyn_dtree),Cs(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(yet+1),this.heap=new Uint16Array(2*hy+1),Cs(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*hy+1),Cs(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const uh=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==jd&&e.status!==57&&e.status!==69&&e.status!==73&&e.status!==91&&e.status!==103&&e.status!==xa&&e.status!==ql?1:0},zF=t=>{if(uh(t))return Va(t,So);t.total_in=t.total_out=0,t.data_type=Eet;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap===2?57:e.wrap?jd:xa,t.adler=e.wrap===2?0:1,e.last_flush=-2,oet(e),Vn},YF=t=>{const e=zF(t);return e===Vn&&(n=>{n.window_size=2*n.w_size,Cs(n.head),n.max_lazy_match=Jl[n.level].max_lazy,n.good_match=Jl[n.level].good_length,n.nice_match=Jl[n.level].nice_length,n.max_chain_length=Jl[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0})(t.state),e},H1=(t,e,n,r,i,o)=>{if(!t)return So;let s=1;if(e===het&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),i<1||i>9||n!==Y_||r<8||r>15||e<0||e>9||o<0||o>met||r===8&&s!==1)return Va(t,So);r===8&&(r=9);const a=new Cet;return t.state=a,a.strm=t,a.status=jd,a.wrap=s,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=o,a.method=n,YF(t)};var Iet=(t,e)=>{if(uh(t)||e>B1||e<0)return t?Va(t,So):So;const n=t.state;if(!t.output||t.avail_in!==0&&!t.input||n.status===ql&&e!==gi)return Va(t,t.avail_out===0?VS:So);const r=n.last_flush;if(n.last_flush=e,n.pending!==0){if(Vr(t),t.avail_out===0)return n.last_flush=-1,Vn}else if(t.avail_in===0&&W1(e)<=W1(r)&&e!==gi)return Va(t,VS);if(n.status===ql&&t.avail_in!==0)return Va(t,VS);if(n.status===jd&&n.wrap===0&&(n.status=xa),n.status===jd){let i=Y_+(n.w_bits-8<<4)<<8,o=-1;if(o=n.strategy>=Hp||n.level<2?0:n.level<6?1:n.level===6?2:3,i|=o<<6,n.strstart!==0&&(i|=32),i+=31-i%31,Dl(n,i),n.strstart!==0&&(Dl(n,t.adler>>>16),Dl(n,65535&t.adler)),t.adler=1,n.status=xa,Vr(t),n.pending!==0)return n.last_flush=-1,Vn}if(n.status===57){if(t.adler=0,le(n,31),le(n,139),le(n,8),n.gzhead)le(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),le(n,255&n.gzhead.time),le(n,n.gzhead.time>>8&255),le(n,n.gzhead.time>>16&255),le(n,n.gzhead.time>>24&255),le(n,n.level===9?2:n.strategy>=Hp||n.level<2?4:0),le(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(le(n,255&n.gzhead.extra.length),le(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=On(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(le(n,0),le(n,0),le(n,0),le(n,0),le(n,0),le(n,n.level===9?2:n.strategy>=Hp||n.level<2?4:0),le(n,3),n.status=xa,Vr(t),n.pending!==0)return n.last_flush=-1,Vn}if(n.status===69){if(n.gzhead.extra){let i=n.pending,o=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+o>n.pending_buf_size;){let a=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>i&&(t.adler=On(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex+=a,Vr(t),n.pending!==0)return n.last_flush=-1,Vn;i=0,o-=a}let s=new Uint8Array(n.gzhead.extra);n.pending_buf.set(s.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending+=o,n.gzhead.hcrc&&n.pending>i&&(t.adler=On(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=73}if(n.status===73){if(n.gzhead.name){let i,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(t.adler=On(t.adler,n.pending_buf,n.pending-o,o)),Vr(t),n.pending!==0)return n.last_flush=-1,Vn;o=0}i=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,le(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>o&&(t.adler=On(t.adler,n.pending_buf,n.pending-o,o)),n.gzindex=0}n.status=91}if(n.status===91){if(n.gzhead.comment){let i,o=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>o&&(t.adler=On(t.adler,n.pending_buf,n.pending-o,o)),Vr(t),n.pending!==0)return n.last_flush=-1,Vn;o=0}i=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,le(n,i)}while(i!==0);n.gzhead.hcrc&&n.pending>o&&(t.adler=On(t.adler,n.pending_buf,n.pending-o,o))}n.status=103}if(n.status===103){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Vr(t),n.pending!==0))return n.last_flush=-1,Vn;le(n,255&t.adler),le(n,t.adler>>8&255),t.adler=0}if(n.status=xa,Vr(t),n.pending!==0)return n.last_flush=-1,Vn}if(t.avail_in!==0||n.lookahead!==0||e!==zs&&n.status!==ql){let i=n.level===0?KF(n,e):n.strategy===Hp?((o,s)=>{let a;for(;;){if(o.lookahead===0&&(Bd(o),o.lookahead===0)){if(s===zs)return 1;break}if(o.match_length=0,a=Ks(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,a&&(Br(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,s===gi?(Br(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(Br(o,!1),o.strm.avail_out===0)?1:2})(n,e):n.strategy===fet?((o,s)=>{let a,c,d,l;const u=o.window;for(;;){if(o.lookahead<=Ua){if(Bd(o),o.lookahead<=Ua&&s===zs)return 1;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(d=o.strstart-1,c=u[d],c===u[++d]&&c===u[++d]&&c===u[++d])){l=o.strstart+Ua;do;while(c===u[++d]&&c===u[++d]&&c===u[++d]&&c===u[++d]&&c===u[++d]&&c===u[++d]&&c===u[++d]&&c===u[++d]&&d<l);o.match_length=Ua-(l-d),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(a=Ks(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(a=Ks(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),a&&(Br(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,s===gi?(Br(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(Br(o,!1),o.strm.avail_out===0)?1:2})(n,e):Jl[n.level].func(n,e);if(i!==3&&i!==4||(n.status=ql),i===1||i===3)return t.avail_out===0&&(n.last_flush=-1),Vn;if(i===2&&(e===cet?aet(n):e!==B1&&(uy(n,0,0,!1),e===det&&(Cs(n.head),n.lookahead===0&&(n.strstart=0,n.block_start=0,n.insert=0))),Vr(t),t.avail_out===0))return n.last_flush=-1,Vn}return e!==gi?Vn:n.wrap<=0?G1:(n.wrap===2?(le(n,255&t.adler),le(n,t.adler>>8&255),le(n,t.adler>>16&255),le(n,t.adler>>24&255),le(n,255&t.total_in),le(n,t.total_in>>8&255),le(n,t.total_in>>16&255),le(n,t.total_in>>24&255)):(Dl(n,t.adler>>>16),Dl(n,65535&t.adler)),Vr(t),n.wrap>0&&(n.wrap=-n.wrap),n.pending!==0?Vn:G1)},wet=(t,e)=>{let n=e.length;if(uh(t))return So;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==jd||r.lookahead)return So;if(i===1&&(t.adler=lh(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&(Cs(r.head),r.strstart=0,r.block_start=0,r.insert=0);let c=new Uint8Array(r.w_size);c.set(e.subarray(n-r.w_size,n),0),e=c,n=r.w_size}const o=t.avail_in,s=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,Bd(r);r.lookahead>=3;){let c=r.strstart,d=r.lookahead-2;do r.ins_h=Ys(r,r.ins_h,r.window[c+3-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++;while(--d);r.strstart=c,r.lookahead=2,Bd(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=s,t.input=a,t.avail_in=o,r.wrap=i,Vn},_u={deflateInit:(t,e)=>H1(t,e,Y_,15,8,_et),deflateInit2:H1,deflateReset:YF,deflateResetKeep:zF,deflateSetHeader:(t,e)=>uh(t)||t.state.wrap!==2?So:(t.state.gzhead=e,Vn),deflate:Iet,deflateEnd:t=>{if(uh(t))return So;const e=t.state.status;return t.state=null,e===xa?Va(t,uet):Vn},deflateSetDictionary:wet,deflateInfo:"pako deflate (from Nodeca project)"};const Aet=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var $_={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Aet(n,r)&&(t[r]=n[r])}}return t},flattenChunks:t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,o=t.length;r<o;r++){let s=t[r];n.set(s,i),i+=s.length}return n}};let $F=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{$F=!1}const hh=new Uint8Array(256);for(let t=0;t<256;t++)hh[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;hh[254]=hh[254]=1;var ph={string2buf:t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,o,s=t.length,a=0;for(i=0;i<s;i++)n=t.charCodeAt(i),(64512&n)==55296&&i+1<s&&(r=t.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),o=0,i=0;o<a;i++)n=t.charCodeAt(i),(64512&n)==55296&&i+1<s&&(r=t.charCodeAt(i+1),(64512&r)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[o++]=n:n<2048?(e[o++]=192|n>>>6,e[o++]=128|63&n):n<65536?(e[o++]=224|n>>>12,e[o++]=128|n>>>6&63,e[o++]=128|63&n):(e[o++]=240|n>>>18,e[o++]=128|n>>>12&63,e[o++]=128|n>>>6&63,e[o++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const o=new Array(2*n);for(i=0,r=0;r<n;){let s=t[r++];if(s<128){o[i++]=s;continue}let a=hh[s];if(a>4)o[i++]=65533,r+=a-1;else{for(s&=a===2?31:a===3?15:7;a>1&&r<n;)s=s<<6|63&t[r++],a--;a>1?o[i++]=65533:s<65536?o[i++]=s:(s-=65536,o[i++]=55296|s>>10&1023,o[i++]=56320|1023&s)}}return((s,a)=>{if(a<65534&&s.subarray&&$F)return String.fromCharCode.apply(null,s.length===a?s:s.subarray(0,a));let c="";for(let d=0;d<a;d++)c+=String.fromCharCode(s[d]);return c})(o,i)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(192&t[n])==128;)n--;return n<0||n===0?e:n+hh[t[n]]>e?n:e}},qF=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const JF=Object.prototype.toString,{Z_NO_FLUSH:Oet,Z_SYNC_FLUSH:bet,Z_FULL_FLUSH:Net,Z_FINISH:Pet,Z_OK:Hm,Z_STREAM_END:Det,Z_DEFAULT_COMPRESSION:ket,Z_DEFAULT_STRATEGY:Let,Z_DEFLATED:Met}=dl;function Eu(t){this.options=$_.assign({level:ket,method:Met,chunkSize:16384,windowBits:15,memLevel:8,strategy:Let},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qF,this.strm.avail_out=0;let n=_u.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Hm)throw new Error(ic[n]);if(e.header&&_u.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(r=typeof e.dictionary=="string"?ph.string2buf(e.dictionary):JF.call(e.dictionary)==="[object ArrayBuffer]"?new Uint8Array(e.dictionary):e.dictionary,n=_u.deflateSetDictionary(this.strm,r),n!==Hm)throw new Error(ic[n]);this._dict_set=!0}}function jS(t,e){const n=new Eu(e);if(n.push(t,!0),n.err)throw n.msg||ic[n.err];return n.result}Eu.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=e===~~e?e:e===!0?Pet:Oet,typeof t=="string"?n.input=ph.string2buf(t):JF.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(o===bet||o===Net)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=_u.deflate(n,o),i===Det)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=_u.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Hm;if(n.avail_out!==0){if(o>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(n.avail_in===0)break}else this.onData(n.output)}return!0},Eu.prototype.onData=function(t){this.chunks.push(t)},Eu.prototype.onEnd=function(t){t===Hm&&(this.result=$_.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Uet={Deflate:Eu,deflate:jS,deflateRaw:function(t,e){return(e=e||{}).raw=!0,jS(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,jS(t,e)},constants:dl};const Kp=16209;var xet=function(t,e){let n,r,i,o,s,a,c,d,l,u,h,p,S,f,_,T,g,y,I,O,b,N,U,V;const W=t.state;n=t.next_in,U=t.input,r=n+(t.avail_in-5),i=t.next_out,V=t.output,o=i-(e-t.avail_out),s=i+(t.avail_out-257),a=W.dmax,c=W.wsize,d=W.whave,l=W.wnext,u=W.window,h=W.hold,p=W.bits,S=W.lencode,f=W.distcode,_=(1<<W.lenbits)-1,T=(1<<W.distbits)-1;t:do{p<15&&(h+=U[n++]<<p,p+=8,h+=U[n++]<<p,p+=8),g=S[h&_];e:for(;;){if(y=g>>>24,h>>>=y,p-=y,y=g>>>16&255,y===0)V[i++]=65535&g;else{if(!(16&y)){if(!(64&y)){g=S[(65535&g)+(h&(1<<y)-1)];continue e}if(32&y){W.mode=16191;break t}t.msg="invalid literal/length code",W.mode=Kp;break t}I=65535&g,y&=15,y&&(p<y&&(h+=U[n++]<<p,p+=8),I+=h&(1<<y)-1,h>>>=y,p-=y),p<15&&(h+=U[n++]<<p,p+=8,h+=U[n++]<<p,p+=8),g=f[h&T];n:for(;;){if(y=g>>>24,h>>>=y,p-=y,y=g>>>16&255,!(16&y)){if(!(64&y)){g=f[(65535&g)+(h&(1<<y)-1)];continue n}t.msg="invalid distance code",W.mode=Kp;break t}if(O=65535&g,y&=15,p<y&&(h+=U[n++]<<p,p+=8,p<y&&(h+=U[n++]<<p,p+=8)),O+=h&(1<<y)-1,O>a){t.msg="invalid distance too far back",W.mode=Kp;break t}if(h>>>=y,p-=y,y=i-o,O>y){if(y=O-y,y>d&&W.sane){t.msg="invalid distance too far back",W.mode=Kp;break t}if(b=0,N=u,l===0){if(b+=c-y,y<I){I-=y;do V[i++]=u[b++];while(--y);b=i-O,N=V}}else if(l<y){if(b+=c+l-y,y-=l,y<I){I-=y;do V[i++]=u[b++];while(--y);if(b=0,l<I){y=l,I-=y;do V[i++]=u[b++];while(--y);b=i-O,N=V}}}else if(b+=l-y,y<I){I-=y;do V[i++]=u[b++];while(--y);b=i-O,N=V}for(;I>2;)V[i++]=N[b++],V[i++]=N[b++],V[i++]=N[b++],I-=3;I&&(V[i++]=N[b++],I>1&&(V[i++]=N[b++]))}else{b=i-O;do V[i++]=V[b++],V[i++]=V[b++],V[i++]=V[b++],I-=3;while(I>2);I&&(V[i++]=V[b++],I>1&&(V[i++]=V[b++]))}break}}break}}while(n<r&&i<s);I=p>>3,n-=I,p-=I<<3,h&=(1<<p)-1,t.next_in=n,t.next_out=i,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=i<s?s-i+257:257-(i-s),W.hold=h,W.bits=p};const zp=15,Vet=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Fet=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),jet=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Bet=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var gu=(t,e,n,r,i,o,s,a)=>{const c=a.bits;let d,l,u,h,p,S,f=0,_=0,T=0,g=0,y=0,I=0,O=0,b=0,N=0,U=0,V=null;const W=new Uint16Array(16),lt=new Uint16Array(16);let mt,St,Yt,Lt=null;for(f=0;f<=zp;f++)W[f]=0;for(_=0;_<r;_++)W[e[n+_]]++;for(y=c,g=zp;g>=1&&W[g]===0;g--);if(y>g&&(y=g),g===0)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(T=1;T<g&&W[T]===0;T++);for(y<T&&(y=T),b=1,f=1;f<=zp;f++)if(b<<=1,b-=W[f],b<0)return-1;if(b>0&&(t===0||g!==1))return-1;for(lt[1]=0,f=1;f<zp;f++)lt[f+1]=lt[f]+W[f];for(_=0;_<r;_++)e[n+_]!==0&&(s[lt[e[n+_]]++]=_);if(t===0?(V=Lt=s,S=20):t===1?(V=Vet,Lt=Fet,S=257):(V=jet,Lt=Bet,S=0),U=0,_=0,f=T,p=o,I=y,O=0,u=-1,N=1<<y,h=N-1,t===1&&N>852||t===2&&N>592)return 1;for(;;){mt=f-O,s[_]+1<S?(St=0,Yt=s[_]):s[_]>=S?(St=Lt[s[_]-S],Yt=V[s[_]-S]):(St=96,Yt=0),d=1<<f-O,l=1<<I,T=l;do l-=d,i[p+(U>>O)+l]=mt<<24|St<<16|Yt|0;while(l!==0);for(d=1<<f-1;U&d;)d>>=1;if(d!==0?(U&=d-1,U+=d):U=0,_++,--W[f]==0){if(f===g)break;f=e[n+s[_]]}if(f>y&&(U&h)!==u){for(O===0&&(O=y),p+=T,I=f-O,b=1<<I;I+O<g&&(b-=W[I+O],!(b<=0));)I++,b<<=1;if(N+=1<<I,t===1&&N>852||t===2&&N>592)return 1;u=U&h,i[u]=y<<24|I<<16|p-o|0}}return U!==0&&(i[p+U]=f-O<<24|64<<16|0),a.bits=y,0};const{Z_FINISH:K1,Z_BLOCK:Get,Z_TREES:Yp,Z_OK:Ka,Z_STREAM_END:Wet,Z_NEED_DICT:Het,Z_STREAM_ERROR:Si,Z_DATA_ERROR:XF,Z_MEM_ERROR:QF,Z_BUF_ERROR:Ket,Z_DEFLATED:z1}=dl,q_=16180,Km=16190,Do=16191,BS=16192,GS=16194,$p=16199,qp=16200,WS=16206,je=16209,Y1=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function zet(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const za=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<q_||e.mode>16211?1:0},ZF=t=>{if(za(t))return Si;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=q_,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,Ka},tj=t=>{if(za(t))return Si;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,ZF(t)},ej=(t,e)=>{let n;if(za(t))return Si;const r=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?Si:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,tj(t))},$1=(t,e)=>{if(!t)return Si;const n=new zet;t.state=n,n.strm=t,n.window=null,n.mode=q_;const r=ej(t,e);return r!==Ka&&(t.state=null),r};let HS,KS,q1=!0;const Yet=t=>{if(q1){HS=new Int32Array(512),KS=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(gu(1,t.lens,0,288,HS,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;gu(2,t.lens,0,32,KS,0,t.work,{bits:5}),q1=!1}t.lencode=HS,t.lenbits=9,t.distcode=KS,t.distbits=5},nj=(t,e,n,r)=>{let i;const o=t.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),r>=o.wsize?(o.window.set(e.subarray(n-o.wsize,n),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>r&&(i=r),o.window.set(e.subarray(n-r,n-r+i),o.wnext),(r-=i)?(o.window.set(e.subarray(n-r,n),0),o.wnext=r,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var $et=(t,e)=>{let n,r,i,o,s,a,c,d,l,u,h,p,S,f,_,T,g,y,I,O,b,N,U=0;const V=new Uint8Array(4);let W,lt;const mt=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(za(t)||!t.output||!t.input&&t.avail_in!==0)return Si;n=t.state,n.mode===Do&&(n.mode=BS),s=t.next_out,i=t.output,c=t.avail_out,o=t.next_in,r=t.input,a=t.avail_in,d=n.hold,l=n.bits,u=a,h=c,N=Ka;t:for(;;)switch(n.mode){case q_:if(n.wrap===0){n.mode=BS;break}for(;l<16;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}if(2&n.wrap&&d===35615){n.wbits===0&&(n.wbits=15),n.check=0,V[0]=255&d,V[1]=d>>>8&255,n.check=On(n.check,V,2,0),d=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&d)<<8)+(d>>8))%31){t.msg="incorrect header check",n.mode=je;break}if((15&d)!==z1){t.msg="unknown compression method",n.mode=je;break}if(d>>>=4,l-=4,b=8+(15&d),n.wbits===0&&(n.wbits=b),b>15||b>n.wbits){t.msg="invalid window size",n.mode=je;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&d?16189:Do,d=0,l=0;break;case 16181:for(;l<16;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}if(n.flags=d,(255&vn(n))!==z1){t.msg="unknown compression method",n.mode=je;break}if(57344&vn(n)){t.msg="unknown header flags set",n.mode=je;break}n.head&&(n.head.text=d>>8&1),512&vn(n)&&4&n.wrap&&(V[0]=255&d,V[1]=d>>>8&255,n.check=On(n.check,V,2,0)),d=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}n.head&&(n.head.time=d),512&vn(n)&&4&n.wrap&&(V[0]=255&d,V[1]=d>>>8&255,V[2]=d>>>16&255,V[3]=d>>>24&255,n.check=On(n.check,V,4,0)),d=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}n.head&&(n.head.xflags=255&d,n.head.os=d>>8),512&vn(n)&&4&n.wrap&&(V[0]=255&d,V[1]=d>>>8&255,n.check=On(n.check,V,2,0)),d=0,l=0,n.mode=16184;case 16184:if(1024&vn(n)){for(;l<16;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}n.length=d,n.head&&(n.head.extra_len=d),512&vn(n)&&4&n.wrap&&(V[0]=255&d,V[1]=d>>>8&255,n.check=On(n.check,V,2,0)),d=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&vn(n)&&(p=n.length,p>a&&(p=a),p&&(n.head&&(b=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(o,o+p),b)),512&vn(n)&&4&n.wrap&&(n.check=On(n.check,r,p,o)),a-=p,o+=p,n.length-=p),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&vn(n)){if(a===0)break t;p=0;do b=r[o+p++],n.head&&b&&n.length<65536&&(n.head.name+=String.fromCharCode(b));while(b&&p<a);if(512&vn(n)&&4&n.wrap&&(n.check=On(n.check,r,p,o)),a-=p,o+=p,b)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&vn(n)){if(a===0)break t;p=0;do b=r[o+p++],n.head&&b&&n.length<65536&&(n.head.comment+=String.fromCharCode(b));while(b&&p<a);if(512&vn(n)&&4&n.wrap&&(n.check=On(n.check,r,p,o)),a-=p,o+=p,b)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&vn(n)){for(;l<16;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}if(4&n.wrap&&d!==(65535&n.check)){t.msg="header crc mismatch",n.mode=je;break}d=0,l=0}n.head&&(n.head.hcrc=vn(n)>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Do;break;case 16189:for(;l<32;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}t.adler=n.check=Y1(d),d=0,l=0,n.mode=Km;case Km:if(n.havedict===0)return t.next_out=s,t.avail_out=c,t.next_in=o,t.avail_in=a,n.hold=d,n.bits=l,Het;t.adler=n.check=1,n.mode=Do;case Do:if(e===Get||e===Yp)break t;case BS:if(n.last){d>>>=7&l,l-=7&l,n.mode=WS;break}for(;l<3;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}switch(n.last=1&d,d>>>=1,l-=1,3&d){case 0:n.mode=16193;break;case 1:if(Yet(n),n.mode=$p,e===Yp){d>>>=2,l-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=je}d>>>=2,l-=2;break;case 16193:for(d>>>=7&l,l-=7&l;l<32;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}if((65535&d)!=(d>>>16^65535)){t.msg="invalid stored block lengths",n.mode=je;break}if(n.length=65535&d,d=0,l=0,n.mode=GS,e===Yp)break t;case GS:n.mode=16195;case 16195:if(p=n.length,p){if(p>a&&(p=a),p>c&&(p=c),p===0)break t;i.set(r.subarray(o,o+p),s),a-=p,o+=p,c-=p,s+=p,n.length-=p;break}n.mode=Do;break;case 16196:for(;l<14;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}if(n.nlen=257+(31&d),d>>>=5,l-=5,n.ndist=1+(31&d),d>>>=5,l-=5,n.ncode=4+(15&d),d>>>=4,l-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=je;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}n.lens[mt[n.have++]]=7&d,d>>>=3,l-=3}for(;n.have<19;)n.lens[mt[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,W={bits:n.lenbits},N=gu(0,n.lens,0,19,n.lencode,0,n.work,W),n.lenbits=W.bits,N){t.msg="invalid code lengths set",n.mode=je;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;U=n.lencode[d&(1<<n.lenbits)-1],_=U>>>24,T=U>>>16&255,g=65535&U,!(_<=l);){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}if(g<16)d>>>=_,l-=_,n.lens[n.have++]=g;else{if(g===16){for(lt=_+2;l<lt;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}if(d>>>=_,l-=_,n.have===0){t.msg="invalid bit length repeat",n.mode=je;break}b=n.lens[n.have-1],p=3+(3&d),d>>>=2,l-=2}else if(g===17){for(lt=_+3;l<lt;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}d>>>=_,l-=_,b=0,p=3+(7&d),d>>>=3,l-=3}else{for(lt=_+7;l<lt;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}d>>>=_,l-=_,b=0,p=11+(127&d),d>>>=7,l-=7}if(n.have+p>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=je;break}for(;p--;)n.lens[n.have++]=b}}if(n.mode===je)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=je;break}if(n.lenbits=9,W={bits:n.lenbits},N=gu(1,n.lens,0,n.nlen,n.lencode,0,n.work,W),n.lenbits=W.bits,N){t.msg="invalid literal/lengths set",n.mode=je;break}if(n.distbits=6,n.distcode=n.distdyn,W={bits:n.distbits},N=gu(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,W),n.distbits=W.bits,N){t.msg="invalid distances set",n.mode=je;break}if(n.mode=$p,e===Yp)break t;case $p:n.mode=qp;case qp:if(a>=6&&c>=258){t.next_out=s,t.avail_out=c,t.next_in=o,t.avail_in=a,n.hold=d,n.bits=l,xet(t,h),s=t.next_out,i=t.output,c=t.avail_out,o=t.next_in,r=t.input,a=t.avail_in,d=n.hold,l=n.bits,n.mode===Do&&(n.back=-1);break}for(n.back=0;U=n.lencode[d&(1<<n.lenbits)-1],_=U>>>24,T=U>>>16&255,g=65535&U,!(_<=l);){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}if(T&&!(240&T)){for(y=_,I=T,O=g;U=n.lencode[O+((d&(1<<y+I)-1)>>y)],_=U>>>24,T=U>>>16&255,g=65535&U,!(y+_<=l);){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}d>>>=y,l-=y,n.back+=y}if(d>>>=_,l-=_,n.back+=_,n.length=g,T===0){n.mode=16205;break}if(32&T){n.back=-1,n.mode=Do;break}if(64&T){t.msg="invalid literal/length code",n.mode=je;break}n.extra=15&T,n.mode=16201;case 16201:if(n.extra){for(lt=n.extra;l<lt;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}n.length+=d&(1<<n.extra)-1,d>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;U=n.distcode[d&(1<<n.distbits)-1],_=U>>>24,T=U>>>16&255,g=65535&U,!(_<=l);){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}if(!(240&T)){for(y=_,I=T,O=g;U=n.distcode[O+((d&(1<<y+I)-1)>>y)],_=U>>>24,T=U>>>16&255,g=65535&U,!(y+_<=l);){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}d>>>=y,l-=y,n.back+=y}if(d>>>=_,l-=_,n.back+=_,64&T){t.msg="invalid distance code",n.mode=je;break}n.offset=g,n.extra=15&T,n.mode=16203;case 16203:if(n.extra){for(lt=n.extra;l<lt;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}n.offset+=d&(1<<n.extra)-1,d>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=je;break}n.mode=16204;case 16204:if(c===0)break t;if(p=h-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=je;break}p>n.wnext?(p-=n.wnext,S=n.wsize-p):S=n.wnext-p,p>n.length&&(p=n.length),f=n.window}else f=i,S=s-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do i[s++]=f[S++];while(--p);n.length===0&&(n.mode=qp);break;case 16205:if(c===0)break t;i[s++]=n.length,c--,n.mode=qp;break;case WS:if(n.wrap){for(;l<32;){if(a===0)break t;a--,d|=r[o++]<<l,l+=8}if(h-=c,t.total_out+=h,n.total+=h,4&n.wrap&&h&&(t.adler=n.check=vn(n)?On(n.check,i,h,s-h):lh(n.check,i,h,s-h)),h=c,4&n.wrap&&(vn(n)?d:Y1(d))!==n.check){t.msg="incorrect data check",n.mode=je;break}d=0,l=0}n.mode=16207;case 16207:if(n.wrap&&vn(n)){for(;l<32;){if(a===0)break t;a--,d+=r[o++]<<l,l+=8}if(4&n.wrap&&d!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=je;break}d=0,l=0}n.mode=16208;case 16208:N=Wet;break t;case je:N=XF;break t;case 16210:return QF;default:return Si}return t.next_out=s,t.avail_out=c,t.next_in=o,t.avail_in=a,n.hold=d,n.bits=l,(n.wsize||h!==t.avail_out&&n.mode<je&&(n.mode<WS||e!==K1))&&nj(t,t.output,t.next_out,h-t.avail_out),u-=t.avail_in,h-=t.avail_out,t.total_in+=u,t.total_out+=h,n.total+=h,4&n.wrap&&h&&(t.adler=n.check=vn(n)?On(n.check,i,h,t.next_out-h):lh(n.check,i,h,t.next_out-h)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Do?128:0)+(n.mode===$p||n.mode===GS?256:0),(u===0&&h===0||e===K1)&&N===Ka&&(N=Ket),N},Go={inflateReset:tj,inflateReset2:ej,inflateResetKeep:ZF,inflateInit:t=>$1(t,15),inflateInit2:$1,inflate:$et,inflateEnd:t=>{if(za(t))return Si;let e=t.state;return e.window&&(e.window=null),t.state=null,Ka},inflateGetHeader:(t,e)=>{if(za(t))return Si;const n=t.state;return 2&n.wrap?(n.head=e,e.done=!1,Ka):Si},inflateSetDictionary:(t,e)=>{const n=e.length;let r,i,o;return za(t)?Si:(r=t.state,r.wrap!==0&&r.mode!==Km?Si:r.mode===Km&&(i=1,i=lh(i,e,n,0),i!==r.check)?XF:(o=nj(t,e,n,n),o?(r.mode=16210,QF):(r.havedict=1,Ka)))},inflateInfo:"pako inflate (from Nodeca project)"},qet=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const rj=Object.prototype.toString,{Z_NO_FLUSH:Jet,Z_FINISH:Xet,Z_OK:Su,Z_STREAM_END:zS,Z_NEED_DICT:YS,Z_STREAM_ERROR:Qet,Z_DATA_ERROR:J1,Z_MEM_ERROR:Zet}=dl;function Tu(t){this.options=$_.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&!(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qF,this.strm.avail_out=0;let n=Go.inflateInit2(this.strm,e.windowBits);if(n!==Su)throw new Error(ic[n]);if(this.header=new qet,Go.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=ph.string2buf(e.dictionary):rj.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Go.inflateSetDictionary(this.strm,e.dictionary),n!==Su)))throw new Error(ic[n])}function $S(t,e){const n=new Tu(e);if(n.push(t),n.err)throw n.msg||ic[n.err];return n.result}Tu.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let o,s,a;if(this.ended)return!1;for(s=e===~~e?e:e===!0?Xet:Jet,rj.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),o=Go.inflate(n,s),o===YS&&i&&(o=Go.inflateSetDictionary(n,i),o===Su?o=Go.inflate(n,s):o===J1&&(o=YS));n.avail_in>0&&o===zS&&n.state.wrap>0&&t[n.next_in]!==0;)Go.inflateReset(n),o=Go.inflate(n,s);switch(o){case Qet:case J1:case YS:case Zet:return this.onEnd(o),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(n.avail_out===0||o===zS))if(this.options.to==="string"){let c=ph.utf8border(n.output,n.next_out),d=n.next_out-c,l=ph.buf2string(n.output,c);n.next_out=d,n.avail_out=r-d,d&&n.output.set(n.output.subarray(c,c+d),0),this.onData(l)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(o!==Su||a!==0){if(o===zS)return o=Go.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(n.avail_in===0)break}}return!0},Tu.prototype.onData=function(t){this.chunks.push(t)},Tu.prototype.onEnd=function(t){t===Su&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=$_.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var tnt={Inflate:Tu,inflate:$S,inflateRaw:function(t,e){return(e=e||{}).raw=!0,$S(t,e)},ungzip:$S,constants:dl};const{Deflate:Pnt,deflate:ent,deflateRaw:Dnt,gzip:knt}=Uet,{Inflate:Lnt,inflate:nnt,inflateRaw:Mnt,ungzip:Unt}=tnt;var rnt=ent,int=nnt,ij=function(t){return t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE",t}(ij||{});class ont{constructor(){v(this,"_sequence",0),v(this,"_startTime",Date.now()),v(this,"isUseOneByte",!0)}get startTime(){const e=Date.now()-this._startTime;return e<Math.pow(2,16)?e:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(e){const n={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:e};if(e.byteLength>128){const a=new Uint8Array(4);a.set([1,0,0,0]);const c={id:0,length:4,data:a.buffer},d={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[c]};n.commonPacketHeader.extension=1,n.extension=d,n.payload=this.compress(e),n.commonPacketHeader.length=8+(n.extension.length+2)+n.payload.byteLength}else n.commonPacketHeader.length=8+n.payload.byteLength;A("SHOW_DATASTREAM2_LOG")&&m.debug("send data header: ".concat(JSON.stringify(n.commonPacketHeader)));const r=new ArrayBuffer(n.commonPacketHeader.length),i=new Uint8Array(r),o=new DataView(r);let s=0;if(o.setUint16(s,n.commonPacketHeader.extension<<15|n.commonPacketHeader.reserved<<14|n.commonPacketHeader.length,!0),s+=2,o.setUint32(s,n.commonPacketHeader.sequence,!0),s+=4,o.setUint16(s,n.commonStreamHeader,!0),s+=2,n.extension){const a=this.serializeExtension(n.extension);i.set(new Uint8Array(a),s),s+=a.byteLength}if(i.set(new Uint8Array(n.payload),s),s+=n.payload.byteLength,s!==n.commonPacketHeader.length)throw Error("serialize error!");return r}deserialize(e){if(e.byteLength<4)return new ArrayBuffer(0);const n=new DataView(e);let r=0;const i=n.getUint16(r,!0);r+=2;const o={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:n.getUint16(r+2,!0)<<16|n.getUint16(r,!0)};let s,a;if(r+=4,A("SHOW_DATASTREAM2_LOG")&&m.debug("receive data header: ".concat(JSON.stringify(o))),n.getUint16(r,!0),r+=2,o.extension){a=this.deserializeExtension(e.slice(r)),r+=2+a.length,s=e.slice(r);let c=!1;if(a.datas.length>0){const d=a.datas.find(l=>l.id===0);d&&(c=(1&new DataView(d.data).getUint32(0,!0))==1)}s=c?this.decompress(s):s}else s=e.slice(8);return s}serializeExtension(e){const{profile:n,length:r,datas:i}=e,o=new ArrayBuffer(r+2),s=new Uint8Array(o),a=new DataView(o);let c=0;if(a.setUint8(c++,n),a.setUint8(c++,r),i.forEach(d=>{n?(a.setUint8(c++,d.id),a.setUint8(c++,d.length),s.set(new Uint8Array(d.data),c),c+=d.data.byteLength):(a.setUint8(c++,d.id|d.length<<4),s.set(new Uint8Array(d.data),c),c+=d.data.byteLength)}),c!==r+2)throw Error("serialize extension error, is ".concat(c,"!==").concat(r+2));return o}deserializeExtension(e){const n=new DataView(e);let r=0;const i=n.getUint8(r);r++;const o=n.getUint8(r);r++;const s=i===ij.TWO_BYTE,a=[],c=new DataView(e,2);let d=0;for(;d<o;){let l=0,u=0,h=new ArrayBuffer(0);s?(l=c.getUint8(d),d++,u=c.getUint8(d),d++):(l=15&c.getUint8(d),u=c.getUint8(d)>>4,d++),u>0&&(h=c.buffer.slice(d+2,d+2+u),d+=h.byteLength),a.push({id:l,length:u,data:h})}if(d!==o)throw Error("parse error");return{profile:i,length:o,datas:a}}decompress(e){return int(new Uint8Array(e))}compress(e){return rnt(new Uint8Array(e))}}const snt={name:"DataStream",create:(t,e)=>{const n=e?new JZ(t):new XZ(t);return n.useDataStream(new ont),n}};class ant extends oe{constructor(e,n,r){super(),v(this,"ws",void 0),v(this,"requestId",1),v(this,"heartBeatTimer",void 0),v(this,"joinInfo",void 0),v(this,"clientId",void 0),v(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),v(this,"onClose",i=>{this.emit("close"),this.dispose()}),v(this,"onMessage",i=>{const o=JSON.parse(i.data);if(!o||o.command!=="serverResponse"||!o.requestId)return o&&o.command==="serverStatus"&&o.serverStatus&&o.serverStatus.command?(this.emit("status",o.serverStatus),void this.emit(o.serverStatus.command,o.serverStatus)):void 0;this.emit("req_".concat(o.requestId),o)}),this.joinInfo=e,this.clientId=n,this.ws=new Qu("cross-channel-".concat(this.clientId),r),this.ws.on(dt.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(dt.CONNECTED,this.onOpen),this.ws.on(dt.ON_MESSAGE,this.onMessage),this.ws.on(dt.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(e){const n=this.requestId++;return e.requestId=n,e.seq=n,this.ws.sendMessage(e),n}waitStatus(e){return new Y((n,r)=>{const i=window.setTimeout(()=>{r(new P(R.TIMEOUT,"wait status timeout, status: ".concat(e)))},5e3);this.once(e,o=>{window.clearTimeout(i),o.state&&o.state!==0?r(new P(R.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),r(new P(R.WS_ABORT))})})}async request(e){if(this.ws.state==="closed")throw new P(R.WS_DISCONNECT);const n=()=>new Y((s,a)=>{this.ws.once(dt.CLOSED,()=>a(new P(R.WS_ABORT))),this.ws.once(dt.CONNECTED,s)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(e),i=new Y((s,a)=>{const c=()=>{a(new P(R.WS_ABORT))};this.ws.once(dt.RECONNECTING,c),this.ws.once(dt.CLOSED,c),this.once("req_".concat(r),s),Je(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(dt.RECONNECTING,c),this.ws.off(dt.CLOSED,c),a(new P(R.TIMEOUT,"cross channel ws request timeout"))})}),o=await i;if(!o||o.code!==200)throw new P(R.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(o)));return o}async connect(e){this.ws.removeAllListeners(dt.REQUEST_NEW_URLS),this.ws.on(dt.REQUEST_NEW_URLS,n=>{n(e)}),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const n=this.requestId++;return e.requestId=n,this.ws.sendMessage(e),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class cnt extends oe{set state(e){e!==this._state&&(e!==$n.RELAY_STATE_FAILURE&&(this.errorCode=Uc.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,n,r,i,o){super(),v(this,"joinInfo",void 0),v(this,"sid",void 0),v(this,"clientId",void 0),v(this,"cancelToken",Gn.CancelToken.source()),v(this,"workerToken",void 0),v(this,"requestId",0),v(this,"signal",void 0),v(this,"prevChannelMediaConfig",void 0),v(this,"httpRetryConfig",void 0),v(this,"_resolution",void 0),v(this,"_state",$n.RELAY_STATE_IDLE),v(this,"errorCode",Uc.RELAY_OK),v(this,"onStatus",s=>{m.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(s))),s&&s.command&&(s.command==="onAudioPacketReceived"&&this.emit("event",ko.PACKET_RECEIVED_AUDIO_FROM_SRC),s.command==="onVideoPacketReceived"&&this.emit("event",ko.PACKET_RECEIVED_VIDEO_FROM_SRC),s.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=Uc.SRC_TOKEN_EXPIRED,this.state=$n.RELAY_STATE_FAILURE),s.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=Uc.DEST_TOKEN_EXPIRED,this.state=$n.RELAY_STATE_FAILURE))}),v(this,"onReconnect",async()=>{m.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",ko.NETWORK_DISCONNECTED),this.state=$n.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(s=>{this.state!==$n.RELAY_STATE_IDLE&&(m.error("auto restart channel media relay failed",s.toString()),this.errorCode=Uc.SERVER_CONNECTION_LOST,this.state=$n.RELAY_STATE_FAILURE)})}),this.joinInfo=e,this.clientId=n,this.sid=id(),this.signal=new ant(this.joinInfo,this.clientId,r),this.httpRetryConfig=i,this._resolution=o}async startChannelMediaRelay(e){if(this.state!==$n.RELAY_STATE_IDLE)throw new P(R.INVALID_OPERATION);this.state=$n.RELAY_STATE_CONNECTING,await this.connect(),m.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new P(R.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new P(R.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new P(R.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==$n.RELAY_STATE_RUNNING)throw new P(R.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==$n.RELAY_STATE_RUNNING)throw new P(R.INVALID_OPERATION);const n=this.genMessage(An.SetVideoProfile);await this.signal.request(n),m.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),m.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=$n.RELAY_STATE_IDLE,this.dispose()}dispose(){m.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Gn.CancelToken.source(),this.state=$n.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await ctt(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",ko.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const n=this.genMessage(An.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),m.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(An.SetSdkProfile,e);await this.signal.request(r),m.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(An.SetSourceChannel,e);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",ko.PACKET_JOINED_SRC_CHANNEL),m.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const o=this.genMessage(An.SetSourceUserId,e);await this.signal.request(o),m.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const s=this.genMessage(An.SetDestChannel,e);await this.signal.request(s),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",ko.PACKET_JOINED_DEST_CHANNEL),m.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const a=this.genMessage(An.StartPacketTransfer,e);await this.signal.request(a),this.emit("event",ko.PACKET_SENT_TO_DEST_CHANNEL),this.state=$n.RELAY_STATE_RUNNING,m.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const n=this.genMessage(An.UpdateDestChannel,e);await this.signal.request(n),this.emit("event",ko.PACKET_UPDATE_DEST_CHANNEL),m.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(An.StopPacketTransfer);await this.signal.request(e),m.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,n){const r=[],i=[],o=[];this.requestId+=1;const s={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:zr,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};s.sdkVersion==="4.22.1"&&(s.sdkVersion="0.0.1");let a=null,c=null;switch(e){case An.SetSdkProfile:return s.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s;case An.SetSourceChannel:if(c=n&&n.getSrcChannelMediaInfo(),!c)throw new P(R.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceChannel",uid:"0",channelName:c.channelName,token:c.token||this.joinInfo.appId},s;case An.SetSourceUserId:if(c=n&&n.getSrcChannelMediaInfo(),!c)throw new P(R.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceUserId",uid:c.uid+""},s;case An.SetDestChannel:if(a=n&&n.getDestChannelMediaInfo(),!a)throw new P(R.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(d=>{r.push(d.channelName),i.push(d.uid+""),o.push(d.token||this.joinInfo.appId)}),s.clientRequest={command:"SetDestChannel",channelName:r,uid:i,token:o},s;case An.StartPacketTransfer:return s.clientRequest={command:"StartPacketTransfer"},s;case An.Reconnect:return s.clientRequest={command:"Reconnect"},s;case An.StopPacketTransfer:return s.clientRequest={command:"StopPacketTransfer"},s;case An.UpdateDestChannel:if(a=n&&n.getDestChannelMediaInfo(),!a)throw new P(R.UNEXPECTED_ERROR,"can not find dest config");return a.forEach(d=>{r.push(d.channelName),i.push(d.uid+""),o.push(d.token||this.joinInfo.appId)}),s.clientRequest={command:"UpdateDestChannel",channelName:r,uid:i,token:o},s;case An.SetVideoProfile:s.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return s}}const dnt={name:"ChannelMediaRelay",create:function(t){return new cnt(t.joinInfo,t.clientId,t.websocketRetryConfig||we,t.httpRetryConfig||we,t.resolution)}};function X1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function kl(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?X1(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):X1(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class lnt extends oe{constructor(e,n,r,i){super(),v(this,"spec",void 0),v(this,"token",void 0),v(this,"websocket",void 0),v(this,"pingpongTimer",void 0),v(this,"reconnectMode","retry"),v(this,"serviceMode",void 0),v(this,"reqId",0),v(this,"commandReqId",0),v(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),v(this,"handleWebSocketMessage",o=>{if(!o.data)return;const s=JSON.parse(o.data);s.requestId?this.emit("@".concat(s.requestId,"-").concat(s.sid),s):(tt.workerEvent(this.spec.sid,{actionType:"status",serverCode:s.code,workerType:this.serviceMode===zo.TRANSCODE?1:2}),this.emit(ys.PUBLISH_STREAM_STATUS,s))}),this.spec=n,this.token=e,this.serviceMode=i,this.websocket=new Qu("live-streaming",r),this.websocket.on(dt.CONNECTED,this.handleWebSocketOpen),this.websocket.on(dt.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(dt.REQUEST_NEW_URLS,(o,s)=>{cn(this,ys.REQUEST_NEW_ADDRESS).then(o).catch(s)}),this.websocket.on(dt.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(e){return this.websocket.init(e)}async request(e,n,r,i){this.reqId+=1,e==="request"&&(this.commandReqId+=1);const o=this.commandReqId,s=this.reqId;if(!s||!this.websocket)throw new P(R.UNEXPECTED_ERROR);const a=kl({command:e,sdkVersion:zr==="4.22.1"?"0.0.1":zr,seq:s,requestId:s,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new P(R.WS_DISCONNECT);const c=()=>new Y((h,p)=>{this.websocket.once(dt.CLOSED,()=>p(new P(R.WS_ABORT))),this.websocket.once(dt.CONNECTED,h)});this.websocket.state!=="connected"&&await c(),a.clientRequest&&(a.clientRequest.workerToken=this.token);const d=new Y((h,p)=>{const S=()=>{p(new P(R.WS_ABORT))};this.websocket.once(dt.RECONNECTING,S),this.websocket.once(dt.CLOSED,S),this.once("@".concat(s,"-").concat(this.spec.sid),f=>{h(f)})});i&&tt.workerEvent(this.spec.sid,kl(kl({},i),{},{requestId:o,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(a);let u=null;try{u=await d}catch(h){if(this.websocket.state==="closed")throw h;return await c(),await this.request(e,n,r)}return i&&tt.workerEvent(this.spec.sid,kl(kl({},i),{},{requestId:o,actionType:"response",payload:JSON.stringify(u.serverResponse),serverCode:u.code,success:u.code===200,responseTime:Date.now()-l})),u.code!==200&&this.handleResponseError(u),u}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e=zr==="4.22.1"?"0.0.1":zr;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Oe.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void m.warning("live stream response already exists stream");case Oe.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Oe.LIVE_STREAM_RESPONSE_BAD_STREAM:case Oe.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new P(R.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Oe.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(e.serverResponse.command==="UnpublishStream")return;throw new P(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Oe.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new P(R.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Oe.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new P(R.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ys.WARNING,n,e.serverResponse.url)}case Oe.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new P(R.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ys.WARNING,n,e.serverResponse.url)}case Oe.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new P(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Oe.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new P(R.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Oe.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new P(R.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ys.WARNING,n,e.serverResponse.url)}case Oe.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new P(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Oe.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new P(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Oe.LIVE_STREAM_RESPONSE_WORKER_LOST:case Oe.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(e.serverResponse.command==="UnpublishStream")return;throw new P(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Oe.ERROR_FAIL_SEND_MESSAGE:if(e.serverResponse.command==="UnpublishStream")return;if(e.serverResponse.command==="UpdateTranscoding"||e.serverResponse.command==="ControlStream")return new P(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new P(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Oe.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Oe.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Oe.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Oe.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new P(R.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(B_)},6e3)}}function Q1(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function Yn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Q1(Object(n),!0).forEach(function(r){v(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Q1(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}class unt extends oe{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:we,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:we;super(),v(this,"onLiveStreamWarning",void 0),v(this,"onLiveStreamError",void 0),v(this,"spec",void 0),v(this,"retryTimeout",1e4),v(this,"connection",void 0),v(this,"httpRetryConfig",void 0),v(this,"wsRetryConfig",void 0),v(this,"streamingTasks",new Map),v(this,"isStartingStreamingTask",!1),v(this,"taskMutex",new pn("live-streaming")),v(this,"cancelToken",Gn.CancelToken.source()),v(this,"transcodingConfig",void 0),v(this,"uapResponse",void 0),v(this,"lastTaskId",1),v(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(e){const n=Yn(Yn({},fQ),e);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(m.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(s=>Yn(Yn(Yn({},pQ),s),{},{zOrder:s.zOrder?s.zOrder+1:1}))),function(s){ne(s.width)||Vt(s.width,"config.width",0,1e4),ne(s.height)||Vt(s.height,"config.height",0,1e4),ne(s.videoBitrate)||Vt(s.videoBitrate,"config.videoBitrate",1,1e6),ne(s.videoFrameRate)||Vt(s.videoFrameRate,"config.videoFrameRate"),ne(s.lowLatency)||Wo(s.lowLatency,"config.lowLatency"),ne(s.audioSampleRate)||De(s.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ne(s.audioBitrate)||Vt(s.audioBitrate,"config.audioBitrate",1,128),ne(s.audioChannels)||De(s.audioChannels,"config.audioChannels",[1,2,3,4,5]),ne(s.videoGop)||Vt(s.videoGop,"config.videoGop"),ne(s.videoCodecProfile)||De(s.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ne(s.userCount)||Vt(s.userCount,"config.userCount",0,17),ne(s.backgroundColor)||Vt(s.backgroundColor,"config.backgroundColor",0,16777215),ne(s.userConfigExtraInfo)||Ke(s.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),s.transcodingUsers&&!ne(s.transcodingUsers)&&(Fo(s.transcodingUsers,"config.transcodingUsers"),s.transcodingUsers.forEach((a,c)=>{H_(a.uid),ne(a.x)||Vt(a.x,"transcodingUser[".concat(c,"].x"),0,1e4),ne(a.y)||Vt(a.y,"transcodingUser[".concat(c,"].y"),0,1e4),ne(a.width)||Vt(a.width,"transcodingUser[".concat(c,"].width"),0,1e4),ne(a.height)||Vt(a.height,"transcodingUser[".concat(c,"].height"),0,1e4),ne(a.zOrder)||Vt(a.zOrder-1,"transcodingUser[".concat(c,"].zOrder"),0,100),ne(a.alpha)||Vt(a.alpha,"transcodingUser[".concat(c,"].alpha"),0,1,!1)})),ne(s.watermark)||qg(s.watermark,"watermark"),ne(s.backgroundImage)||qg(s.backgroundImage,"backgroundImage"),s.images&&!ne(s.images)&&(Fo(s.images,"config.images"),s.images.forEach((a,c)=>{qg(a,"images[".concat(c,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(s=>Yn(Yn(Yn({},$g),s),{},{zOrder:255}))),n.backgroundImage&&(r.push(Yn(Yn(Yn({},$g),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(Yn(Yn(Yn({},$g),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(s=>Yn({},s)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const i=(n.userConfigs||[]).map(s=>typeof s.uid=="number"?Y.resolve(s.uid):fF(s.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await Y.all(i)).forEach((s,a)=>{n.userConfigs&&n.userConfigs[a]&&(n.userConfigs[a].uid=s)}),this.transcodingConfig=n,this.connection)try{var o;const s=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(qo(o=this.streamingTasks).call(o)).map(a=>a.taskId).join("#")});m.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(s.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(s){if(!s.data||!s.data.retry)throw s;s.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(a=>{m.warning("[".concat(this.spec.clientId,"] live streaming receive error"),s.toString(),"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,s).then(()=>{m.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(a.url," success"))}).catch(c=>{m.error("[".concat(this.spec.clientId,"] live streaming republish failed"),a.url,c.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,c)})})}}async startLiveStreamingTask(e,n,r){if(!this.transcodingConfig&&n===zo.TRANSCODE)throw new P(R.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};m.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(n));const o=await this.taskMutex.lock();if(!this.connection&&r)return void o();if(this.streamingTasks.get(e)&&!r)return o(),new P(R.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(a){throw o(),a}switch(n){case zo.TRANSCODE:i.transcodingConfig=Yn({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const s=this.lastTaskId++;try{const a=new Y((d,l)=>{Je(this.retryTimeout).then(()=>{if(r)return l(r);const u=this.statusError.get(e);return u?(this.statusError.delete(e),l(u)):void 0})}),c=await Y.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:n===zo.TRANSCODE?1:2,requestByUser:!r,tid:s.toString()}),a]);this.isStartingStreamingTask=!1,m.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(c.code)),this.streamingTasks.set(e,{clientRequest:i,mode:n,url:e,taskId:s}),o()}catch(a){if(o(),this.isStartingStreamingTask=!1,!a.data||!a.data.retry||r)throw a;return a.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,n,a)):await this.startLiveStreamingTask(e,n,a)}}stopLiveStreamingTask(e){return new Y((n,r)=>{const i=this.streamingTasks.get(e);if(!i||!this.connection)return new P(R.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const o=i.mode;i.abortTask=()=>{m.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),n()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:e,command:"UnPublishStream",workerType:o===zo.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(s=>{m.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(s.code)),this.streamingTasks.delete(e),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),n()}).catch(r)})}resetAllTask(){var e;const n=Array.from(qo(e=this.streamingTasks).call(e));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Gn.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new P(R.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await cn(this,$v.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=n,this.connection=new lnt(n.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(ys.WARNING,(r,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,r)),this.connection.on(ys.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(ys.REQUEST_NEW_ADDRESS,(r,i)=>{if(!this.connection)return i(new P(R.UNEXPECTED_ERROR,"can not get new live streaming address list"));cn(this,$v.REQUEST_WORKER_MANAGER_LIST,e).then(o=>{this.uapResponse=o,r(o.addressList)}).catch(i)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(e){const n=e.serverStatus&&e.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),i=e.reason;switch(e.code){case Oe.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Oe.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Oe.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Oe.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const s=new P(R.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(r)return m.error(s.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,s);if(!this.isStartingStreamingTask)return;this.statusError.set(n,s)}case Oe.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const s=new P(R.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,s)}case Oe.LIVE_STREAM_RESPONSE_WORKER_LOST:case Oe.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var o;if(!this.connection)return;this.connection.tryNextAddress();const s=Array.from(qo(o=this.streamingTasks).call(o));for(const a of s)a.abortTask?a.abortTask():(m.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",a.url),this.startLiveStreamingTask(a.url,a.mode,new P(R.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then(()=>{m.debug("[".concat(this.spec.clientId,"] republish live stream success"),a.url)}).catch(c=>{m.error(c.toString()),this.onLiveStreamError&&this.onLiveStreamError(a.url,c)}));return}}}hasUrl(e){return this.streamingTasks.has(e)}}const hnt={name:"LiveStreaming",create:function(t){return new unt(t.joinInfo,t.websocketRetryConfig||we,t.httpRetryConfig||we)}};function pnt(t){let e=Z1();return function(n,r){let i=n.appId;i!==void 0&&(Dt(r,10),lo(r,i));let o=n.cid;o!==void 0&&(Dt(r,16),Dt(r,o));let s=n.cname;s!==void 0&&(Dt(r,26),lo(r,s));let a=n.deviceId;a!==void 0&&(Dt(r,34),lo(r,a));let c=n.elapse;c!==void 0&&(Dt(r,40),_s(r,c));let d=n.fileSize;d!==void 0&&(Dt(r,48),_s(r,kc(d)));let l=n.height;l!==void 0&&(Dt(r,56),_s(r,kc(l)));let u=n.jpg;u!==void 0&&(Dt(r,66),Dt(r,u.length),function(Ze,F){let L=ll(Ze,F.length);Ze.bytes.set(F,L)}(r,u));let h=n.networkType;h!==void 0&&(Dt(r,72),_s(r,kc(h)));let p=n.osType;p!==void 0&&(Dt(r,80),_s(r,kc(p)));let S=n.requestId;S!==void 0&&(Dt(r,90),lo(r,S));let f=n.sdkVersion;f!==void 0&&(Dt(r,98),lo(r,f));let _=n.sequence;_!==void 0&&(Dt(r,104),_s(r,kc(_)));let T=n.sid;T!==void 0&&(Dt(r,114),lo(r,T));let g=n.timestamp;g!==void 0&&(Dt(r,120),_s(r,g));let y=n.uid;y!==void 0&&(Dt(r,128),Dt(r,y));let I=n.vid;I!==void 0&&(Dt(r,136),Dt(r,I));let O=n.width;O!==void 0&&(Dt(r,144),_s(r,kc(O)));let b=n.service;b!==void 0&&(Dt(r,152),Dt(r,b));let N=n.callbackData;N!==void 0&&(Dt(r,162),lo(r,N));let U=n.jpgEncryption;U!==void 0&&(Dt(r,168),Dt(r,U));let V=n.requestType;V!==void 0&&(Dt(r,176),Dt(r,V));let W=n.scorePorn;W!==void 0&&(Dt(r,185),XS(r,W));let lt=n.scoreSexy;lt!==void 0&&(Dt(r,193),XS(r,lt));let mt=n.scoreNeutral;mt!==void 0&&(Dt(r,201),XS(r,mt));let St=n.scene;St!==void 0&&(Dt(r,208),Dt(r,St));let Yt=n.ossFilePrefix;Yt!==void 0&&(Dt(r,218),lo(r,Yt));let Lt=n.serviceVendor;if(Lt!==void 0)for(let Ze of Lt){Dt(r,226);let F=Z1();_nt(Ze,F),Dt(r,F.limit),Tnt(r,F),Snt(F)}}(t,e),function(n){let r=n.bytes,i=n.limit;return r.length===i?r:r.subarray(0,i)}(e)}function fnt(t){return function(n){let r={};t:for(;!aj(n);){let i=fo(n);switch(i>>>3){case 0:break t;case 1:r.code=fo(n);break;case 2:r.msg=cj(n,fo(n));break;case 3:{let o=Ent(n);r.data=mnt(n),n.limit=o;break}default:oj(n,7&i)}}return r}({bytes:e=t,offset:0,limit:e.length});var e}function mnt(t){let e={};t:for(;!aj(t);){let n=fo(t);switch(n>>>3){case 0:break t;case 1:e.requestId=cj(t,fo(t));break;case 2:e.requestType=fo(t)>>>0;break;case 3:e.scorePorn=JS(t);break;case 4:e.scoreSexy=JS(t);break;case 5:e.scoreNeutral=JS(t);break;case 6:e.requestScene=fo(t)>>>0;break;case 7:e.scene=fo(t)>>>0;break;default:oj(t,7&n)}}return e}function _nt(t,e){let n=t.service;n!==void 0&&(Dt(e,8),Dt(e,n));let r=t.vendor;r!==void 0&&(Dt(e,16),Dt(e,r));let i=t.token;i!==void 0&&(Dt(e,26),lo(e,i));let o=t.callbackUrl;o!==void 0&&(Dt(e,34),lo(e,o))}function Ent(t){let e=fo(t),n=t.limit;return t.limit=t.offset+e,n}function oj(t,e){switch(e){case 0:for(;128&dj(t););break;case 2:qS(t,fo(t));break;case 5:qS(t,4);break;case 1:qS(t,8);break;default:throw new Error("Unimplemented type: "+e)}}let gnt=new Float32Array(1);new Uint8Array(gnt.buffer);let NC=new Float64Array(1),qn=new Uint8Array(NC.buffer);function kc(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let sj=[];function Z1(){const t=sj.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function Snt(t){sj.push(t)}function qS(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function aj(t){return t.offset>=t.limit}function ll(t,e){let n=t.bytes,r=t.offset,i=t.limit,o=r+e;if(o>n.length){let s=new Uint8Array(2*o);s.set(n),t.bytes=s}return t.offset=o,o>i&&(t.limit=o),r}function PC(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function cj(t,e){let n=PC(t,e),r=String.fromCharCode,i=t.bytes,o="",s="";for(let a=0;a<e;a++){let c,d,l,u,h=i[a+n];128&h?(224&h)==192?a+1>=e?s+=o:(c=i[a+n+1],(192&c)!=128?s+=o:(u=(31&h)<<6|63&c,u<128?s+=o:(s+=r(u),a++))):(240&h)==224?a+2>=e?s+=o:(c=i[a+n+1],d=i[a+n+2],(49344&(c|d<<8))!=32896?s+=o:(u=(15&h)<<12|(63&c)<<6|63&d,u<2048||u>=55296&&u<=57343?s+=o:(s+=r(u),a+=2))):(248&h)==240?a+3>=e?s+=o:(c=i[a+n+1],d=i[a+n+2],l=i[a+n+3],(12632256&(c|d<<8|l<<16))!=8421504?s+=o:(u=(7&h)<<18|(63&c)<<12|(63&d)<<6|63&l,u<65536||u>1114111?s+=o:(u-=65536,s+=r(55296+(u>>10),56320+(1023&u)),a+=3))):s+=o:s+=r(h)}return s}function lo(t,e){let n=e.length,r=0;for(let s=0;s<n;s++){let a=e.charCodeAt(s);a>=55296&&a<=56319&&s+1<n&&(a=(a<<10)+e.charCodeAt(++s)-56613888),r+=a<128?1:a<2048?2:a<65536?3:4}Dt(t,r);let i=ll(t,r),o=t.bytes;for(let s=0;s<n;s++){let a=e.charCodeAt(s);a>=55296&&a<=56319&&s+1<n&&(a=(a<<10)+e.charCodeAt(++s)-56613888),a<128?o[i++]=a:(a<2048?o[i++]=a>>6&31|192:(a<65536?o[i++]=a>>12&15|224:(o[i++]=a>>18&7|240,o[i++]=a>>12&63|128),o[i++]=a>>6&63|128),o[i++]=63&a|128)}}function Tnt(t,e){let n=ll(t,e.limit),r=t.bytes,i=e.bytes;for(let o=0,s=e.limit;o<s;o++)r[o+n]=i[o]}function dj(t){return t.bytes[PC(t,1)]}function tk(t,e){let n=ll(t,1);t.bytes[n]=e}function JS(t){let e=PC(t,8),n=t.bytes;return qn[0]=n[e++],qn[1]=n[e++],qn[2]=n[e++],qn[3]=n[e++],qn[4]=n[e++],qn[5]=n[e++],qn[6]=n[e++],qn[7]=n[e++],NC[0]}function XS(t,e){let n=ll(t,8),r=t.bytes;NC[0]=e,r[n++]=qn[0],r[n++]=qn[1],r[n++]=qn[2],r[n++]=qn[3],r[n++]=qn[4],r[n++]=qn[5],r[n++]=qn[6],r[n++]=qn[7]}function fo(t){let e,n=0,r=0;do e=dj(t),n<32&&(r|=(127&e)<<n),n+=7;while(128&e);return r}function Dt(t,e){for(e>>>=0;e>=128;)tk(t,127&e|128),e>>>=7;tk(t,e)}function _s(t,e){let n=e.low>>>0,r=(e.low>>>28|e.high<<4)>>>0,i=e.high>>>24,o=i===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,s=ll(t,o),a=t.bytes;switch(o){case 10:a[s+9]=i>>>7&1;case 9:a[s+8]=o!==9?128|i:127&i;case 8:a[s+7]=o!==8?r>>>21|128:r>>>21&127;case 7:a[s+6]=o!==7?r>>>14|128:r>>>14&127;case 6:a[s+5]=o!==6?r>>>7|128:r>>>7&127;case 5:a[s+4]=o!==5?128|r:127&r;case 4:a[s+3]=o!==4?n>>>21|128:n>>>21&127;case 3:a[s+2]=o!==3?n>>>14|128:n>>>14&127;case 2:a[s+1]=o!==2?n>>>7|128:n>>>7&127;case 1:a[s]=o!==1?128|n:127&n}}function ek(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}const vnt=new Map([["moderation",1],["supervise",2]]);function nk(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}class ynt extends oe{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const n=this._connectionState;this._connectionState=e,this.emit(Be.CONNECTION_STATE_CHANGE,n,e)}get inspectType(){return this._inspectType}set inspectType(e){var n;this._inspectMode=zi(n=e.map(r=>vnt.get(r)||0)).call(n,(r,i)=>r+i),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(e){super(),v(this,"name","AgoraRTCVideoContentInspect"),v(this,"_connectionState",di.CONNECTING),v(this,"_innerConnectionState",void 0),v(this,"sequence",0),v(this,"inspectStartTime",void 0),v(this,"workerManagerConnection",void 0),v(this,"workerConnection",void 0),v(this,"workerMessageLengthLimit",void 0),v(this,"inspectIntervalMinimum",void 0),v(this,"qualityRatio",void 0),v(this,"_connectInfo",void 0),v(this,"_cancelTokenSource",Gn.CancelToken.source()),v(this,"_retryConfig",void 0),v(this,"wmSequence",0),v(this,"inspectInterval",void 0),v(this,"inspectTimer",null),v(this,"ossFilePrefix",void 0),v(this,"extraInfo",void 0),v(this,"_inspectType",void 0),v(this,"_inspectMode",void 0),v(this,"_quality",1),v(this,"qualityTimer",null),v(this,"_inspectId",void 0),v(this,"_needWorkUrlOnly",!1),v(this,"inspectImage",()=>{if(this.connectionState!==di.CONNECTED)throw new P(R.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===di.CONNECTED?this.requestToInspectImage():m.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=zt(5,"inspect-"),this.workerMessageLengthLimit=A("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=A("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=A("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Qu("worker-manager-"+this._inspectId,we),this.on(Be.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,m.debug("[".concat(this._inspectId,"] Inspect operation :").concat(ri[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new Qu("worker-"+this._inspectId,we),this.handleWorkerEvents()}async init(e,n){this.emit(Be.STATE_CHANGE,ri.CONNECT_AP),this._connectInfo=e;const r=this._cancelTokenSource.token;return this._retryConfig=n,new Y((i,o)=>{this.on(Be.CONNECTION_STATE_CHANGE,(s,a)=>{a===di.CONNECTED&&i()}),this.requestAP(e,r,n).then(s=>{this.connectWorkerManager(s)}).catch(s=>{o(s)})})}async requestAP(e,n,r){const i=A("WEBCS_DOMAIN").map(a=>"https://".concat(a,"/api/v1")),o=await function(a,c,d,l){let{appId:u,areaCode:h,cname:p,sid:S,token:f,uid:_}=c;vd++;const T="image_moderation_api",g={service_name:T,json_body:JSON.stringify({appId:u,areaCode:h,cname:p,command:"allocateEdge",requestId:vd,seq:vd,sid:S,token:f,ts:Date.now(),uid:_+""})};let y,I,O=a[0];return qi(async()=>{y=Date.now();const b=await Ji(O,{data:g,cancelToken:d,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(I=Date.now()-y,b.code!==0){const W=new P(R.UNEXPECTED_RESPONSE,"image inspect ap error, code"+b.code,{retry:!0,responseTime:I});throw m.error(W.toString()),W}const N=JSON.parse(b.json_body);if(N.code!==200){const W=new P(R.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(N.code,", reason: ").concat(N.reason),{code:N.code,responseTime:I});throw m.error(W.toString()),W}if(!N.servers||!Array.isArray(N.servers)||N.servers.length===0){const W=new P(R.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:N.code,responseTime:I});throw m.error(W.toString()),W}const U=A("VIDEO_INSPECT_WORKER_MANAGER_HOST"),V=A("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:N.servers.map(W=>{let{address:lt,wss:mt}=W;if(lt&&mt)return"wss://".concat(lt.replace(/\./g,"-"),".").concat(U,":").concat(V||mt)}).filter(W=>!!W),workerToken:N.workerToken,vid:N.vid,responseTime:I}},(b,N)=>(tt.apworkerEvent(S,{success:!0,sc:200,serviceName:T,responseDetail:JSON.stringify(b.addressList),firstSuccess:N===0,responseTime:I,serverIp:a[N%a.length]}),!1),(b,N)=>(tt.apworkerEvent(S,{success:!1,sc:b.data&&b.data.code||200,serviceName:T,responseTime:I,serverIp:a[N%a.length]}),!!(b.code!==R.OPERATION_ABORTED&&b.code!==R.UNEXPECTED_RESPONSE||b.data&&b.data.retry)&&(O=a[(N+1)%a.length],!0)),l)}(i,e,n,r);this.emit(Be.STATE_CHANGE,ri.AP_CONNECTED);const{addressList:s}=o;return this.wmSequence++,s}async connectWorkerManager(e){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Be.STATE_CHANGE,ri.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(dt.CONNECTED,async()=>{this.emit(Be.STATE_CHANGE,ri.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.22.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(dt.CLOSED,()=>{this._innerConnectionState<ri.GET_WORKER_MANAGER_RESPONSE&&m.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(dt.FAILED,()=>{this._innerConnectionState<ri.GET_WORKER_MANAGER_RESPONSE&&m.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(dt.RECONNECTING,()=>{this._innerConnectionState<ri.GET_WORKER_MANAGER_RESPONSE&&m.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(dt.ON_MESSAGE,async e=>{this.emit(Be.STATE_CHANGE,ri.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(e.data);if(r.code!==200)throw m.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new P(R.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw m.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new P(R.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const i=A("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,o=n.replace(/:\d+\/?$/,":".concat(i));this.emit(Be.STATE_CHANGE,ri.CONNECT_WORKER,o),this._needWorkUrlOnly?this.emit(Be.REQUEST_NEW_WORKER_URL,o):await this.connectWorker(o)}}),this.workerManagerConnection.on(dt.WILL_RECONNECT,(e,n,r)=>{r(e)}),this.workerManagerConnection.on(dt.REQUEST_NEW_URLS,(e,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(n)})}handleWorkerEvents(){this.workerConnection.on(dt.CONNECTED,async()=>{this.emit(Be.STATE_CHANGE,ri.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=di.CONNECTED}),this.workerConnection.on(dt.ON_MESSAGE,async e=>{if(e.data instanceof ArrayBuffer){const r=fnt(new Uint8Array(e.data));if(A("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&m.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Be.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const i={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},o=zi(n=Object.keys(i)).call(n,(a,c)=>i[a]>i[c]?a:c,"porn"),s=Object.keys(i).find(a=>a===o);this.emit(Be.INSPECT_RESULT,s)}else this.emit(Be.INSPECT_RESULT,void 0,new P(R.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Be.INSPECT_RESULT,void 0,new P(R.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else m.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Be.INSPECT_RESULT,void 0,new P(R.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(dt.CLOSED,()=>{this.connectionState=di.CLOSED}),this.workerConnection.on(dt.FAILED,()=>{this.connectionState=di.CLOSED}),this.workerConnection.on(dt.RECONNECTING,()=>{this.connectionState=this.connectionState===di.CONNECTED?di.RECONNECTING:di.CONNECTING}),this.workerConnection.on(dt.WILL_RECONNECT,(e,n,r)=>{e==="recover"&&r(e),r("tryNext")}),this.workerConnection.on(dt.REQUEST_NEW_URLS,(e,n)=>{this.workerManagerConnection.close(),this.once(Be.REQUEST_NEW_WORKER_URL,r=>{e([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}async requestToInspectImage(){this.sequence++;const e=Kr(this,Be.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(Be.INSPECT_RESULT,void 0,new P(R.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(e,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Be.INSPECT_RESULT,void 0,new P(R.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,n){let{appId:r,cname:i,cid:o,vid:s,sid:a,uid:c}=n;const d=Date.now(),l=await e.getCurrentFrameImage("image/jpeg",this.quality),u=await JV(l,r,i),h=this.sequence+"-"+o+"-"+c+"-"+d+"-"+zt(12,""),p={appId:r,cid:o,cname:i,deviceId:"",elapse:nk(Number(d-this.inspectStartTime)),fileSize:u.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:u,networkType:6,osType:7,requestId:h,sdkVersion:"4.22.1",sequence:this.sequence,sid:a,timestamp:nk(d),uid:c,vid:s,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete p.callbackData,this.ossFilePrefix===void 0&&delete p.ossFilePrefix;const S=pnt(p);if(S.byteLength<this.workerMessageLengthLimit){if(A("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const f=function(_){for(var T=1;T<arguments.length;T++){var g=arguments[T]!=null?arguments[T]:{};T%2?ek(Object(g),!0).forEach(function(y){v(_,y,g[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(g)):ek(Object(g)).forEach(function(y){Object.defineProperty(_,y,Object.getOwnPropertyDescriptor(g,y))})}return _}({},p);delete f.jpg,m.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(f))}return S}{const f=this.quality*this.qualityRatio;return this.quality=f,await this.generateRequestData(e,{appId:r,cname:i,cid:o,vid:s,sid:a,uid:c})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Gn.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=di.CLOSED,this.emit(Be.STATE_CHANGE,ri.CLOSED)}}const Rnt={name:"ContentInspect",create:function(t){let{config:e}=t;return function(n){if(!n)throw new P(R.INVALID_PARAMS,"inspectConfig is necessary.");if(!n.inspectType||!Array.isArray(n.inspectType))throw new P(R.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const r=[...new Set(n.inspectType)];r.forEach(i=>{var o;if(!$(o=["supervise","moderation"]).call(o,i))throw new P(R.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),n.inspectType=r}if(n&&n.extraInfo&&n.extraInfo.length>1024)throw new P(R.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(e),new ynt(e)}};xt("PROCESS_ID","process-".concat(zt(8,""),"-").concat(zt(4,""),"-").concat(zt(4,""),"-").concat(zt(4,""),"-").concat(zt(12,""))),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void m.error("Error loading sdk config",e.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();m.debug("Loading global parameters from cache",e),Object.keys(e).forEach(r=>{if(Object.prototype.hasOwnProperty.call(_e,r)){const{value:i,expires:o}=e[r];if(o&&o<=n)return;bs[r]=i,_e[r]=i}})}catch(e){m.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(bs.AREAS)&&bs.AREAS.length>0&&vC(bs.AREAS,!0);const rk=(t,e,n)=>{m.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),xt(t,e,n)};Pl(dnt,!1),Pl(hnt,!1),Pl(Ktt,!1),Pl(Rnt,!1),Pl(snt,!1);const he=function(t){const e=new oe,n=t,r={getListeners:e.getListeners.bind(e),on:(i,o)=>(function(s,a){s===ho.SECURITY_POLICY_VIOLATION&&UF(a,!0)}(i,o),e.on.bind(e)(i,o)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return N1(N1({},n),r)}({__TRACK_LIST__:xc,VERSION:zr,BUILD:cC,ESM_BUNDLER:!1,ESM:!0,UMD:!1,DEV:!1,setParameter:rk,getParameter:A,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;const n=await async function(r){let i;return wt().supportUnifiedPlan?(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"}),i=(await r.createOffer()).sdp):i=(await r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(e);if(!n)return t;e.close(),e=null,t=function(r){const i={video:[],audio:[]};return r.match(/ VP8/i)&&i.video.push("VP8"),r.match(/ VP9/i)&&i.video.push("VP9"),r.match(/ AV1/i)&&i.video.push("AV1"),r.match(/ H264/i)&&i.video.push("H264"),r.match(/ H265/i)&&i.video.push("H265"),r.match(/ opus/i)&&i.audio.push("OPUS"),r.match(/ PCMU/i)&&i.audio.push("PCMU"),r.match(/ PCMA/i)&&i.audio.push("PCMA"),r.match(/ G722/i)&&i.audio.push("G722"),i}(n)}catch(e){throw new P(R.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return t},checkSystemRequirements:function(){const t=tt.reportApiInvoke(null,{name:Ne.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:ae.TRACER});let e=!1;try{const o=window.RTCPeerConnection,s=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,a=window.WebSocket;e=!!(o&&s&&a),e&&rC()&&nV(75)&&new o().close()}catch(o){return m.error("check system requirement failed: ",o),!1}let n=!1;const r=It();r.name===Pt.CHROME&&Number(r.version)>=58&&(Fi.engine.name!=="WebKit"||function(){const o=It();if(Nm()){if(o.os===Ve.MAC_OS)return!0;if(o.os===Ve.IOS){const s=Fi.os.version&&Fi.os.version.split(".");if(s&&Number(s[0])===14&&s[1]&&Number(s[1])>=3||s&&Number(s[0])>14)return!0}}return!1}())&&(n=!0),(r.name===Pt.FIREFOX&&Number(r.version)>=56||r.name===Pt.OPERA&&Number(r.version)>=45||r.name===Pt.SAFARI&&Number(r.version)>=11||r.name==="WebKit"&&(Dn()||Ri())&&r.osVersion&&Number(r.osVersion.split(".")[0])>=11||sV()||It().name===Pt.QQ)&&(n=!0),m.debug("checkSystemRequirements, api:",e,"browser",n);const i=e&&n;return t.onSuccess(i),i},getDevices:function(t){return Cr.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return Cr.getRecordingDevices(t)},getCameras:function(t){return Cr.getCamerasDevices(t)},getElectronScreenSources:jV,getPlaybackDevices:function(t){return Cr.getSpeakers(t)},createClient:function(){var t;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const n=tt.reportApiInvoke(null,{name:Ne.CREATE_CLIENT,options:[e],tag:ae.TRACER});try{(function(r){De(r.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),De(r.mode,"config.mode",["rtc","live","p2p"]),r.audioCodec!==void 0&&De(r.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),r.proxyServer!==void 0&&Ke(r.proxyServer,"config.proxyServer",1,1e4),r.turnServer!==void 0&&uV(r.turnServer),r.httpRetryConfig!==void 0&&$O(r.httpRetryConfig),r.websocketRetryConfig!==void 0&&$O(r.websocketRetryConfig)})(e)}catch(r){throw n.onError(r),r}return(iV(16,0)||oV(16,0))&&(e.codec==="vp9"&&(e.codec="vp8",m.debug("browser not support vp9, force use vp8")),xt("UNSUPPORTED_VIDEO_CODEC",["vp9"])),e.audioCodec===void 0&&(e.audioCodec="opus"),n.onSuccess(),new ztt(pi(pi({forceWaitGatewayResponse:!0},e),{},{role:$(t=["rtc","p2p"]).call(t,e.mode)?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=A("CAMERA_CAPTURE_CONFIG"),n=tt.reportApiInvoke(null,{tag:ae.TRACER,name:Ne.CREATE_CAM_VIDEO_TRACK,options:[te({},t),e]});e&&(t.encoderConfig=e);const r=Lm(t),i=zt(8,"track-cam-");let o=null;m.info("start create camera video track with config",JSON.stringify(t),"trackId",i);try{o=(await Sr({video:r},i)).getVideoTracks()[0]||null}catch(a){throw n.onError(a),a}if(!o){const a=new M(R.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(a),a.throw(m)}t.optimizationMode&&gS(i,o,t,_o(t.encoderConfig));const s=new ry(o,t,r,t.scalabiltyMode?Pp(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return n.onSuccess(s.getTrackId()),m.info("create camera video success, trackId:",i),s},createCustomVideoTrack:function(t){const e=tt.reportApiInvoke(null,{tag:ae.TRACER,name:Ne.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),n=new qt(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?Pp(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,zt(8,"track-cus-"),[Ht.CUSTOM_TRACK]);return e.onSuccess(n.getTrackId()),m.info("create custom video track success with config",t,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=tt.reportApiInvoke(null,{tag:ae.TRACER,name:Ne.CREATE_SCREEN_VIDEO_TRACK,options:[te({},t),e]});t.encoderConfig?typeof t.encoderConfig=="string"||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const r=function(l){const u={};l.screenSourceType&&(u.mediaSource=l.screenSourceType),l.extensionId&&Ws()&&(u.extensionId=l.extensionId);const{displaySurface:h,selfBrowserSurface:p,surfaceSwitching:S,systemAudio:f}=l;(Bv(107)||GO(107)||WO(93))&&(h&&(De(h,"displaySurface",["browser","window","monitor"]),u.displaySurface=h),p?(De(p,"selfBrowserSurface",["exclude","include"]),u.selfBrowserSurface=p):u.selfBrowserSurface="include",S&&(De(S,"surfaceSwitching",["exclude","include"]),u.surfaceSwitching=S)),(Bv(105)||GO(105)||WO(91))&&f&&(De(f,"systemAudio",["exclude","include"]),u.systemAudio=f),l.electronScreenSourceId&&(u.sourceId=l.electronScreenSourceId);const _=l.encoderConfig?fS(l.encoderConfig):null;return u.mandatory={chromeMediaSource:"desktop",maxWidth:_?_.width:void 0,maxHeight:_?_.height:void 0},_&&(_.frameRate&&(typeof _.frameRate=="number"?(u.mandatory.maxFrameRate=_.frameRate,u.mandatory.minFrameRate=_.frameRate):(u.mandatory.maxFrameRate=_.frameRate.max||_.frameRate.ideal||_.frameRate.exact||void 0,u.mandatory.minFrameRate=_.frameRate.min||_.frameRate.ideal||_.frameRate.exact||void 0),u.frameRate=_.frameRate),_.width&&(u.width=_.width),_.height&&(u.height=_.height)),u}(t),i=zt(8,"track-scr-v-");let o=null,s=null;const a=wt();if(!a.supportShareAudio&&e==="enable"){const l=new M(R.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(l),l.throw(m)}m.info("start create screen video track with config",t,"withAudio",e,"trackId",i);try{const l=await Sr({screen:r,screenAudio:e==="auto"?a.supportShareAudio:e==="enable"},i);o=l.getVideoTracks()[0]||null,s=l.getAudioTracks()[0]||null}catch(l){throw n.onError(l),l}if(!o){const l=new M(R.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(l),l.throw(m)}if(!s&&e==="enable"){o&&o.stop();const l=new M(R.SHARE_AUDIO_NOT_ALLOWED);return n.onError(l),l.throw(m)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(gS(i,o,t,t.encoderConfig&&fS(t.encoderConfig)||void 0),t.encoderConfig&&typeof t.encoderConfig!="string"&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const c=new qt(o,t.encoderConfig?fS(t.encoderConfig):{},t.scalabiltyMode?Pp(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i,[Ht.SCREEN_TRACK]);if(!s)return n.onSuccess(c.getTrackId()),m.info("create screen video track success","video:",c.getTrackId()),c;const d=new se(s,void 0,zt(8,"track-scr-a-"),!1);return n.onSuccess([c.getTrackId(),d.getTrackId()]),m.info("create screen video track success","video:",c.getTrackId(),"audio:",d.getTrackId()),[c,d]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=A("CAMERA_CAPTURE_CONFIG"),r=tt.reportApiInvoke(null,{tag:ae.TRACER,name:Ne.CREATE_MIC_AND_CAM_TRACKS,options:[t,e,n]});n&&(e.encoderConfig=n);const i=Lm(e),o=Xb(t),s=zt(8,"track-mic-"),a=zt(8,"track-cam-");let c=null,d=null;m.info("start create camera video track(".concat(a,") and microphone audio track(").concat(s,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const h=await Sr({audio:o,video:i},"".concat(s,"-").concat(a));c=h.getAudioTracks()[0],d=h.getVideoTracks()[0]}catch(h){throw r.onError(h),h}if(!c||!d){const h=new M(R.UNEXPECTED_ERROR,"can not find tracks in media stream");return r.onError(h),h.throw(m)}e.optimizationMode&&gS(a,d,e,_o(e.encoderConfig));const l=new Mm(c,t,o,s),u=new ry(d,e,i,e.scalabiltyMode?Pp(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a);return r.onSuccess([l.getTrackId(),u.getTrackId()]),m.info("create camera video track(".concat(a,") and microphone audio track(").concat(s,") success")),[l,u]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=tt.reportApiInvoke(null,{tag:ae.TRACER,name:Ne.CREATE_MIC_AUDIO_TRACK,options:[t]}),n=Xb(t),r=zt(8,"track-mic-");let i=null;m.info("start create microphone audio track with config",JSON.stringify(t),"trackId",r);try{i=(await Sr({audio:n},r)).getAudioTracks()[0]||null}catch(s){throw e.onError(s),s}if(!i){const s=new M(R.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(s),s.throw(m)}const o=new Mm(i,t,n,r);return e.onSuccess(o.getTrackId()),m.info("create microphone audio track success, trackId:",r),o},createCustomAudioTrack:function(t){const e=tt.reportApiInvoke(null,{tag:ae.TRACER,name:Ne.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),n=new se(t.mediaStreamTrack,t.encoderConfig?km(t.encoderConfig):{},zt(8,"track-cus-"),!1);return m.info("create custom audio track success with config",t,"trackId",n.getTrackId()),e.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:r}=t;let{source:i}=t;const o={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(e=File.name)!==null&&e!==void 0?e:"File":i,cacheOnlineFile:n,encoderConfig:r},s=tt.reportApiInvoke(null,{tag:ae.TRACER,name:Ne.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(A("DISABLE_WEBAUDIO"))throw new M(R.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const a=zt(8,"track-buf-");m.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",a);const c=i;if(!(i instanceof AudioBuffer))try{i=await async function(u,h){let p=null;if(typeof u=="string"){const f=MN.get(u);if(f)return m.debug("use cached audio resource: ",u),f;try{p=(await qi(()=>Gn.get(u,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(_){throw new M(R.FETCH_AUDIO_FILE_FAILED,_.toString())}}else p=await new Y((_,T)=>{const g=new FileReader;g.onload=y=>{y.target?_(y.target.result):T(new M(R.READ_LOCAL_AUDIO_FILE_ERROR))},g.onerror=()=>{T(new M(R.READ_LOCAL_AUDIO_FILE_ERROR))},g.readAsArrayBuffer(u)});const S=await function(f){const _=sl();return new Y((T,g)=>{_.decodeAudioData(f,y=>{T(y)},y=>{g(new M(R.DECODE_AUDIO_FILE_FAILED,y.toString()))})})}(p);return typeof u=="string"&&h&&MN.set(u,S),S}(i,n)}catch(u){return s.onError(u),u.throw(m)}const d=new qZ(i),l=new $Z(c,d,r?km(r):{},a);return m.info("create buffer source audio track success, trackId:",a),s.onSuccess(l.getTrackId()),l},setAppType:function(t){if(m.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw m.debug("Invalid appType"),new P(R.INVALID_PARAMS,"invalid app type",t);xt("APP_TYPE",Math.floor(t))},setLogLevel:function(t){m.setLogLevel(t)},enableLogUpload:function(){A("USE_NEW_LOG")?xt("UPLOAD_LOG",!0):m.enableLogUpload()},disableLogUpload:function(){A("USE_NEW_LOG")?xt("UPLOAD_LOG",!1):m.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new yF},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=tt.reportApiInvoke(null,{tag:ae.TRACER,name:Ne.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof se||t instanceof Td)){const c=new P(R.INVALID_TRACK,"the parameter is not a audio track");return n.onError(c),c.throw()}e&&e<1e3&&(e=1e3);const r=t instanceof se?t.getTrackLabel():"remote_track",i=t.getVolumeLevel();let o=i,s=i;const a=Date.now();return new Y(c=>{const d=setInterval(()=>{const l=t.getVolumeLevel();o=l>o?l:o,s=l<s?l:s;const u=o-s>1e-4,h=Date.now()-a;if(u||h>e){clearInterval(d);const p=u,S={duration:h,deviceLabel:r,maxVolumeLevel:o,result:p};m.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(S))),n.onSuccess(S),c(p)}},200)})},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=tt.reportApiInvoke(null,{tag:ae.TRACER,name:Ne.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof qt||t instanceof Sd)){const u=new P(R.INVALID_TRACK,"the parameter is not a video track");return n.onError(u),u.throw()}e&&e<1e3&&(e=1e3);const r=t instanceof qt?t.getTrackLabel():"remote_track",i=t.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(an()||Nm())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([i]),o.play();const s=document.createElement("canvas");s.width=160,s.height=120;let a=0,c=0;try{const u=Date.now();a=await function(h,p,S,f){let _,T=0,g=null;return new Y((y,I)=>{function O(){T>f&&_&&(_(),y(T));const b=S.getContext("2d");if(!b){const V=new P(R.UNEXPECTED_ERROR,"can not get canvas 2d context.");return m.error(V.toString()),void I(V)}b.drawImage(h,0,0,160,120);const N=b.getImageData(0,0,S.width,S.height),U=Math.floor(N.data.length/3);if(g){for(let V=0;V<U;V+=3)if(N.data[V]!==g[V])return T+=1,void(g=N.data);g=N.data}else g=N.data}setTimeout(()=>{_&&(_(),y(T))},p),_=mC(()=>{O()},30)})}(o,e,s,4),c=Date.now()-u}catch(u){throw n.onError(u),u}Ptt===Pt.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;const d=a>4,l={duration:c,changedPicNum:a,deviceLabel:r,result:d};return m.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(l))),n.onSuccess(l),d},setArea:vC,audioElementPlayCenter:Fn,resumeAudioContext:function(){Fn.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(t){$tt.processExternalMediaAEC(t)},registerExtensions:function(t){const e=A("PLUGIN_INFO")||[];t.forEach(n=>{"name"in n&&!$(e).call(e,n.name)&&e.push(n.name);const r=n;r.__registered__=!0,r.logger.hookLog=m.extLog,r.reporter.hookApiInvoke=tt.extApiInvoke,r.parameters&&Object.keys(r.parameters).forEach(i=>{r.parameters[i]=A(i)})}),rk("PLUGIN_INFO",e)},ChannelMediaRelayError:Uc,ChannelMediaRelayEvent:ko,ChannelMediaRelayState:$n,RemoteStreamFallbackType:BZ,RemoteStreamType:jZ,ConnectionDisconnectedReason:kt,AudienceLatencyLevelType:TX,AREAS:Ot,preload:async function(t,e,n,r){return OF(t,e,n,r)}});Object.defineProperties(he,{onAudioAutoplayFailed:{get:()=>mr.onAudioAutoplayFailed,set:t=>{mr.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>mr.onAutoplayFailed,set:t=>{mr.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>he._onSecurityPolicyViolation,set(t){he._onSecurityPolicyViolation=t,UF(t)}},__CLIENT_LIST__:{get:()=>A("SHOW_GLOBAL_CLIENT_LIST")?Ra:[]}}),Cr.on(Ma.CAMERA_DEVICE_CHANGED,t=>{m.info("camera device changed",JSON.stringify(t)),he.onCameraChanged&&he.onCameraChanged(t),he.safeEmit(ho.CAMERA_CHANGED,t)}),Cr.on(Ma.RECORDING_DEVICE_CHANGED,t=>{m.info("microphone device changed",JSON.stringify(t)),he.onMicrophoneChanged&&he.onMicrophoneChanged(t),he.safeEmit(ho.MICROPHONE_CHANGED,t)}),Cr.on(Ma.PLAYOUT_DEVICE_CHANGED,t=>{m.debug("playout device changed",JSON.stringify(t)),he.onPlaybackDeviceChanged&&he.onPlaybackDeviceChanged(t),he.safeEmit(ho.PLAYBACK_DEVICE_CHANGED,t)}),Fn.onAutoplayFailed=()=>{m.info("detect audio element autoplay failed"),mr.onAudioAutoplayFailed&&mr.onAudioAutoplayFailed()},Ut.on("autoplay-failed",()=>{m.info("detect webaudio autoplay failed"),mr.onAudioAutoplayFailed&&mr.onAudioAutoplayFailed(),he.safeEmit(ho.AUTOPLAY_FAILED)}),Ut.on(Ye.STATE_CHANGE,(t,e)=>{m.info("audio context state changed: ".concat(e," => ").concat(t)),he.onAudioContextStateChanged&&he.onAudioContextStateChanged(t,e),he.safeEmit(ho.AUDIO_CONTEXT_STATE_CHANGED,t,e)}),ve.on(nd.NETWORK_STATE_CHANGE,(t,e)=>{m.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))}),window&&(window.__ARTC__=he);const Cnt="3707331405c84570a88786ab16502a71",Int="007eJxTYLD+tWtmX/rXgLVOW533yW78IHIwxqSdf4JQkv23uYbKdzkUGIzNDcyNjQ1NDEyTLUxMzQ0SLSzMLcwSkwzNTA2MEs0NX4f8SWsIZGS4MdOJlZEBAkF8FoaS1OISBgYAFykeoQ==",wnt=()=>{const[t,e]=z.useState(null),[n,r]=z.useState(!1),[i,o]=z.useState("");z.useEffect(()=>((()=>{const l=he.createClient({mode:"rtc",codec:"vp8"});e(l),l.on("user-published",a),l.on("user-unpublished",c)})(),()=>{t&&(t.leave(),t.off("user-published",a),t.off("user-unpublished",c))}),[]);const s=async()=>{if(i===""){alert("Please enter a channel name");return}try{await t.join(Cnt,i,Int,null),console.log(`Joined channel: ${i}`);const[d,l]=await he.createMicrophoneAndCameraTracks();l.play("local-player"),await t.publish([d,l]),r(!0),console.log("Host joined and tracks published successfully")}catch(d){console.error("Failed to join the channel or get camera permissions:",d)}},a=async(d,l)=>{await t.subscribe(d,l),console.log("Subscribed to remote user:",d.uid),l==="video"&&d.videoTrack.play("remote-player"),l==="audio"&&d.audioTrack.play()},c=d=>{console.log("User unpublished:",d.uid)};return D.jsxs("div",{children:[D.jsx("h2",{children:"Agora Video Call (Host)"}),n?D.jsxs("div",{children:[D.jsxs("h3",{children:["Channel: ",i]}),D.jsx("div",{id:"local-player",style:{width:"400px",height:"300px",backgroundColor:"lightgray"}}),D.jsx("div",{id:"remote-player",style:{width:"400px",height:"300px",backgroundColor:"lightgray"}})]}):D.jsxs("div",{children:[D.jsx("input",{type:"text",placeholder:"Enter Channel Name",value:i,onChange:d=>o(d.target.value)}),D.jsx("button",{onClick:s,children:"Start Meeting"})]})]})},Ant="3707331405c84570a88786ab16502a71",Ont="007eJxTYLD+tWtmX/rXgLVOW533yW78IHIwxqSdf4JQkv23uYbKdzkUGIzNDcyNjQ1NDEyTLUxMzQ0SLSzMLcwSkwzNTA2MEs0NX4f8SWsIZGS4MdOJlZEBAkF8FoaS1OISBgYAFykeoQ==",bnt=()=>{const[t,e]=z.useState(null),[n,r]=z.useState(!1),[i,o]=z.useState("test");z.useEffect(()=>((async()=>{const l=he.createClient({mode:"rtc",codec:"vp8"});e(l),l.on("user-published",a),l.on("user-unpublished",c)})(),()=>{t&&(t.leave(),t.off("user-published",a),t.off("user-unpublished",c))}),[]);const s=async()=>{if(i===""){alert("Please enter the channel name provided by the host");return}try{await t.join(Ant,i,Ont,null),console.log(`Joined channel: ${i}`);const[d,l]=await he.createMicrophoneAndCameraTracks();l.play("local-player"),await t.publish([d,l]),r(!0),console.log("Guest joined and tracks published successfully")}catch(d){console.error("Failed to join the channel or get camera permissions:",d)}},a=async(d,l)=>{await t.subscribe(d,l),console.log("Subscribed to remote user:",d.uid),l==="video"&&d.videoTrack.play("remote-player"),l==="audio"&&d.audioTrack.play()},c=d=>{console.log("User unpublished:",d.uid)};return D.jsxs("div",{children:[D.jsx("h2",{children:"Agora Video Call (Guest)"}),n?D.jsxs("div",{children:[D.jsxs("h3",{children:['Connected to "',i,'" channel']}),D.jsx("div",{id:"local-player",style:{width:"400px",height:"300px",backgroundColor:"lightgray"}}),D.jsx("div",{id:"remote-player",style:{width:"400px",height:"300px",backgroundColor:"lightgray"}})]}):D.jsxs("div",{children:[D.jsx("input",{type:"text",placeholder:"Enter Channel Name",value:i,onChange:d=>o(d.target.value)}),D.jsx("button",{onClick:s,children:"Join Meeting"})]})]})};function Nnt(){return D.jsx(k4,{children:D.jsxs(w4,{children:[D.jsx(tr,{path:"/",element:D.jsx(AW,{})}),D.jsx(tr,{path:"/sign-up",element:D.jsx(wW,{})}),D.jsx(tr,{path:"/login",element:D.jsx(OW,{})}),D.jsx(tr,{path:"/home",element:D.jsx(NW,{})}),D.jsx(tr,{path:"/about-us",element:D.jsx(PW,{})}),D.jsx(tr,{path:"/forget-password",element:D.jsx(DW,{})})," ",D.jsx(tr,{path:"/child-profile/:childId",element:D.jsx(kW,{})})," ",D.jsx(tr,{path:"/detect-emotion",element:D.jsx(MW,{})})," ",D.jsx(tr,{path:"/reset-password/:token",element:D.jsx(UW,{})}),D.jsx(tr,{path:"/create-meeting",element:D.jsx(xW,{})}),D.jsx(tr,{path:"/meetings",element:D.jsx(VW,{})}),D.jsx(tr,{path:"/linkpage",element:D.jsx(FW,{})}),D.jsx(tr,{path:"/meeting/host",element:D.jsx(wnt,{})}),D.jsx(tr,{path:"/meeting/gust",element:D.jsx(bnt,{})})]})})}QS.createRoot(document.getElementById("root")).render(D.jsx(Yo.StrictMode,{children:D.jsx(Nnt,{})}));
